import{Q as te,a as B}from"./QBreadcrumbs.7a78a14b.js";import{d as ae,r as k,u as se,v as re,x as ne,o as p,c as w,e as l,ac as u,f as t,g as s,Q as v,ab as r,aS as q,ad as g,br as T,aT as j,ah as de,bs as ie,P as F,h as x,w as ue,a8 as V,i as f,N as ce,a7 as D,b2 as me,a9 as Q}from"./index.7781bbf1.js";import{a as O,Q as Y}from"./QItemLabel.adc0d025.js";import{Q as z}from"./QSelect.b01a34b1.js";import{Q as pe}from"./QDate.b5f916cc.js";import{Q as ve}from"./QPopupProxy.7a607e8b.js";import{Q as ge,a as $}from"./QTable.0439ac63.js";import{Q as fe}from"./QBadge.0b4eda98.js";import{Q as _e}from"./QForm.b0303292.js";import{C as be}from"./ClosePopup.7a52e0e0.js";import{a as M}from"./axios.24b1a536.js";import{u as he}from"./useHelpers.6414b911.js";import{d as K}from"./date.2faa2832.js";import{u as ye,a as we}from"./AddProveedor.3ea1a98f.js";import{u as qe,_ as xe}from"./SelectProduct.cea04132.js";import"./QChip.b36b60ac.js";import"./format.2bc25e5f.js";import"./use-cache.b0833c75.js";import"./QList.40b214f1.js";import"./use-quasar.1edf7f79.js";import"./QInnerLoading.9ba16dd3.js";const Ve={class:"q-ma-lg q-pt-md q-mb-none",style:{"margin-bottom":"10px"}},$e={class:"row q-col-gutter-lg"},Ae=l("label",{class:"text-h6 text-center"},"Nueva Compra",-1),Ce=[Ae],ke={class:"row q-pt-none q-mx-lg q-col-gutter-md"},De={class:"col-xs-12 col-md-5 q-mt-lg q-pl-none"},Qe=l("label",null,"Seleccionar Proveedor: ",-1),Pe=l("label",null,"Numero de Comprobante: ",-1),Se=l("label",null,"Fecha de compra: ",-1),Ue={class:"row items-center justify-end"},Be=l("label",null,"Seleccionar Sucursal: ",-1),Te={key:1,class:"col-xs-12 col-md-5 q-pl-none"},Fe=l("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),Me=l("label",null,"Descripci\xF3n: ",-1),Ne={key:2,class:"col-xs-12 col-md-5 q-pl-none"},Ee=l("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),Ie={class:"col-xs-12 col-md-5"},je=l("label",null,"Filtrar por codigo de barra o nombre del producto: ",-1),Oe={class:"col-12"},Ye={class:"full-width row flex-center text-lime-10 q-gutter-sm"},ze=l("span",{class:"text-subtitle1"}," Agrega alg\xFAn producto ",-1),Ke={class:"col-12",style:{display:"flex","justify-content":"end"}},Le={class:"text-right"},Re=l("td",null,[l("b",null,"SUBTOTAL:")],-1),Ge={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},He={class:"text-right"},Je=l("td",null,[l("b",null,"IVA(12%):")],-1),We={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},Xe={class:"text-right"},Ze=l("td",null,[l("b",null,"TOTAL DESCUENTO:")],-1),eo={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},oo={class:"text-right"},lo=l("td",null,[l("b",null,"TOTAL DE COMPRA:")],-1),to={style:{width:"50px"}},Co=ae({__name:"AddCompra",setup(ao){const{agregarAndValidarStock:L,claim:d,filterByCodBarra:i,columns:R,rows:b,filterArticulo:G,modalSelectProducto:A,getSubtotalByProduct:N,loadingState:P,listProductos:H,quitarArticulo:J,sucursal_selected:h,valorFactura:y}=qe();let{actualizarLista:W}=ye(),E=[];const _=k([]),C=k(!1),{mostrarNotify:m}=he(),S=k([]),n=k({proveedor_id:"",numero_comprobante:"",descripcion:"",inputDate:K.formatDate(Date.now(),"YYYY/MM/DD")}),X=se(),Z=a=>{L(a,"compras"),A.value=!1},ee=async a=>{S.value=[];const{data:o}=await M.get(`/sucursal/find/${a}/company`);o.forEach(e=>{S.value.push({label:e.nombre,value:e.id})})};re(W,(a,o)=>{a&&I()});const I=async()=>{C.value=!1;try{const{data:a}=await M.get("/providers/true");_.value=[],a.forEach(o=>{_.value.push({label:o.razon_social,value:o.id,num_doc:o.numero_documento})}),E=_.value}catch(a){console.log(a)}},oe=async()=>{let a=!1;if(n.value.proveedor_id=="")return m("warning","Debes elegir algun proveedor");if(n.value.numero_comprobante=="")return m("warning","Por favor ingresa el numero de comprobante");if(n.value.descripcion=="")return m("warning","Por favor ingresa una descripci\xF3n");if((d.roles[0]=="Super-Administrador"||d.roles[0]=="Administrador")&&h.value=="")return m("warning","Debes seleccionar una sucursal");if(b.value.length==0)return m("warning","Debes agregar algun producto..");b.value.forEach((o,e)=>{o.cantidad<=0&&(m("warning",`Agrega una cantidad cantidad al producto: ${o.nombre} de la fila: ${e+1}`),a=!0)}),!a&&(n.value.products=b.value,n.value={...n.value,...y.value,fecha_compra:K.formatDate(n.value.inputDate,"DD/MM/YYYY"),user_id:d.id},ie.create({title:"\xBFDeseas agregar esta compra?",ok:{push:!0,color:"cyan-10",label:"Agregar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{F.show({message:"Cargando..."});let o={headers:{sucursal_id:h.value}};await M.post("/buys",n.value,o),F.hide(),m("positive","Compra realizada exitosamente"),X.push("/compras")}catch(o){m("warning",o.response.data.message[0]),F.hide()}}))};(d.roles[0]=="Super-Administrador"||d.roles[0]=="Administrador")&&ee(d.company.id),I();const le=(a="",o)=>{if(a==="")return o(()=>{_.value=E});o(()=>{const e=a.toLowerCase();_.value=_.value.filter(c=>c.num_doc.indexOf(e)>-1||c.label.toLowerCase().indexOf(e)>-1)})},U=()=>{if((d.roles[0]=="Super-Administrador"||d.roles[0]=="Administrador")&&h.value.length==0)return m("warning","Elige una sucursal primeramente");G("compras")};return ne(()=>{b.value=[]}),(a,o)=>(p(),w(de,null,[l("div",Ve,[l("div",$e,[l("div",{class:u(["col-xs-12 col-md-6",[a.$q.screen.width<1022?"q-pt-sm":""]])},[t(te,{class:u(["row q-mr-xs",[a.$q.screen.width<1022?"justify-center q-pt-sm":"justify-start "]])},{default:s(()=>[t(B,{label:"Inicio",icon:"home",to:"/"}),t(B,{label:"Compras",icon:"shopping_cart",to:"/compras"}),t(B,{label:"Agregar Compra",icon:"add_circle"})]),_:1},8,["class"])],2),l("div",{class:u(["col-xs-12 col-md-6",[a.$q.screen.width<1022?"text-center q-pt-sm":"text-right"]])},Ce,2)])]),l("div",ke,[l("div",De,[Qe,t(z,{color:"orange",filled:"",modelValue:n.value.proveedor_id,"onUpdate:modelValue":o[1]||(o[1]=e=>n.value.proveedor_id=e),dense:"",options:_.value,"emit-value":"","map-options":"",onFilter:le,"use-input":"","input-debounce":"0"},{append:s(()=>[t(x,{round:"",dense:"",flat:"",icon:"person_add",onClick:o[0]||(o[0]=ue(e=>C.value=!0,["stop","prevent"]))})]),"no-option":s(()=>[t(O,null,{default:s(()=>[t(Y,{class:"text-grey"},{default:s(()=>[V(" No hay resultados ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),l("div",{class:u(["col-xs-12 col-md-3",a.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[Pe,t(v,{modelValue:n.value.numero_comprobante,"onUpdate:modelValue":o[2]||(o[2]=e=>n.value.numero_comprobante=e),"input-style":{textAlign:"center",fontSize:"16px"},filled:"",mask:"###-###-#########","fill-mask":"",dense:"",required:""},null,8,["modelValue"])],2),l("div",{class:u(["col-xs-12 col-md-4",a.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[Se,t(v,{filled:"",dense:"",modelValue:n.value.inputDate,"onUpdate:modelValue":o[4]||(o[4]=e=>n.value.inputDate=e),"input-style":{textAlign:"center"},mask:"date",rules:["date"]},{append:s(()=>[t(f,{name:"event",class:"cursor-pointer"},{default:s(()=>[t(ve,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[t(pe,{modelValue:n.value.inputDate,"onUpdate:modelValue":o[3]||(o[3]=e=>n.value.inputDate=e)},{default:s(()=>[l("div",Ue,[ce(t(x,{label:"Close",color:"primary",flat:""},null,512),[[be]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],2),r(d).roles[0]=="Super-Administrador"||r(d).roles[0]=="Administrador"?(p(),w("div",{key:0,class:u(["col-xs-12 col-md-5 q-ml-none q-pl-none",a.$q.screen.width>=1023||"q-pt-none"])},[Be,t(z,{filled:"",modelValue:r(h),"onUpdate:modelValue":[o[5]||(o[5]=e=>q(h)?h.value=e:null),o[6]||(o[6]=e=>b.value=[])],options:S.value,"emit-value":"","map-options":"",dense:""},{"no-option":s(()=>[t(O,null,{default:s(()=>[t(Y,{class:"text-grey"},{default:s(()=>[V(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])],2)):g("",!0),r(d).roles[0]!=="Super-Administrador"&&r(d).roles[0]!=="Administrador"&&a.$q.screen.width>=1023?(p(),w("div",Te,[Fe,t(v,{outlined:"","bottom-slots":"",loading:r(P),dense:"",modelValue:r(i),"onUpdate:modelValue":o[8]||(o[8]=e=>q(i)?i.value=e:null),modelModifiers:{trim:!0},onKeyup:T(U,["enter"])},{append:s(()=>[r(i)!==""?(p(),D(f,{key:0,name:"close",onClick:o[7]||(o[7]=e=>i.value=""),class:"cursor-pointer"})):g("",!0),t(f,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])])):g("",!0),l("div",{class:u(["col-xs-12 col-sm-12 col-md-7",a.$q.screen.width<=1023?"q-pl-none q-pt-sm":"q-pt-md"])},[Me,t(v,{modelValue:n.value.descripcion,"onUpdate:modelValue":o[9]||(o[9]=e=>n.value.descripcion=e),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])],2),r(d).roles[0]=="Super-Administrador"||r(d).roles[0]=="Administrador"?(p(),w("div",Ne,[Ee,t(v,{outlined:"","bottom-slots":"",loading:r(P),dense:"",modelValue:r(i),"onUpdate:modelValue":o[11]||(o[11]=e=>q(i)?i.value=e:null),modelModifiers:{trim:!0},onKeyup:T(U,["enter"])},{append:s(()=>[r(i)!==""?(p(),D(f,{key:0,name:"close",onClick:o[10]||(o[10]=e=>i.value=""),class:"cursor-pointer"})):g("",!0),t(f,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])])):g("",!0)]),r(d).roles[0]!=="Super-Administrador"&&r(d).roles[0]!=="Administrador"&&a.$q.screen.width<=1023?(p(),w("div",{key:0,class:u(["row q-pt-lg q-mx-lg",[a.$q.screen.width<=1023?"justify-center":"justify-left q-ml-md"]])},[l("div",Ie,[je,t(v,{outlined:"","bottom-slots":"",loading:r(P),dense:"",modelValue:r(i),"onUpdate:modelValue":o[13]||(o[13]=e=>q(i)?i.value=e:null),modelModifiers:{trim:!0},onKeyup:T(U,["enter"])},{append:s(()=>[r(i)!==""?(p(),D(f,{key:0,name:"close",onClick:o[12]||(o[12]=e=>i.value=""),class:"cursor-pointer"})):g("",!0),t(f,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])])],2)):g("",!0),t(_e,{onSubmit:oe},{default:s(()=>[l("div",{class:u(["row q-mx-lg justify-center",a.$q.screen.xs?"q-mt-lg":"q-mt-md"])},[l("div",Oe,[t(ge,{rows:r(b),columns:r(R),"row-key":"name","hide-pagination":!0,"rows-per-page-options":[50],class:u([a.$q.dark.isActive?"":"my-sticky-header-table3"])},{"no-data":s(({})=>[l("div",Ye,[ze,t(f,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":s(e=>[t($,{props:e},{default:s(()=>[t(v,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:c=>r(N)(e.row),min:"0",type:"number",style:{width:"100px"},modelValue:e.row.cantidad,"onUpdate:modelValue":c=>e.row.cantidad=c,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":s(e=>[t($,{props:e},{default:s(()=>[t(me,{modelValue:e.row.aplicaIva,"onUpdate:modelValue":c=>e.row.aplicaIva=c},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-descuento":s(e=>[t($,{props:e},{default:s(()=>[t(v,{"input-class":"resaltarTextoInput",dense:"",required:"",min:"0",onChange:c=>r(N)(e.row),type:"number",style:{width:"100px"},modelValue:e.row.descuento,"onUpdate:modelValue":c=>e.row.descuento=c,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-pvm":s(e=>[t($,{props:e},{default:s(()=>[V(" $"+Q(e.row.precio_compra),1)]),_:2},1032,["props"])]),"body-cell-acciones":s(e=>[t($,{props:e},{default:s(()=>[t(x,{round:"",color:"deep-orange",onClick:c=>r(J)(e.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),l("div",Ke,[l("table",{class:u([a.$q.screen.xs?"q-pt-sm":"linearTablaDetalle"])},[l("tr",Le,[Re,l("td",Ge," $"+Q(r(y).subtotal),1)]),l("tr",He,[Je,l("td",We," $"+Q(r(y).iva),1)]),l("tr",Xe,[Ze,l("td",eo," $"+Q(r(y).descuento),1)]),l("tr",oo,[lo,l("td",to,[t(fe,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${r(y).total}`},null,8,["label"])])])],2)]),l("div",{class:u(["col-12 flex q-mt-md q-pb-md",[a.$q.screen.width<600?"justify-center":"justify-between"]])},[a.$q.screen.width>600?(p(),D(x,{key:0,icon:"arrow_back",onClick:o[14]||(o[14]=e=>a.$router.push("/compras")),outline:"",rounded:"",class:"q-mr-lg",color:a.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:s(()=>[V(" \xA0 Regresar ")]),_:1},8,["color"])):g("",!0),t(x,{type:"submit",icon:"save",outline:"",rounded:"",class:u(a.$q.screen.width<600?"q-px-xl":"q-px-lg"),style:{color:"#696cff"}},{default:s(()=>[V(" \xA0 Guardar ")]),_:1},8,["class"])],2)],2)]),_:1}),t(j,{modelValue:C.value,"onUpdate:modelValue":o[15]||(o[15]=e=>C.value=e)},{default:s(()=>[t(we)]),_:1},8,["modelValue"]),t(j,{modelValue:r(A),"onUpdate:modelValue":o[16]||(o[16]=e=>q(A)?A.value=e:null)},{default:s(()=>[t(xe,{listProductos:r(H),onAgregarProduct:Z},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}});export{Co as default};
