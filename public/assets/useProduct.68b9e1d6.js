import{u as y}from"./useHelpers.3d139f1a.js";import{r as n,n as A}from"./index.fdc1268b.js";const u=n([]),v=n(""),r=n(!1),m=n({}),b=n(!1),_=n(""),N=n([{name:"acciones",label:"Quitar",align:"left"},{label:"Codigo Barra",align:"left",field:"codigoBarra",name:"codigoBarra"},{label:"Producto",align:"left",field:"nombre",name:"nombre"},{name:"cantidad",label:"Cantidad",align:"center"},{name:"iva",label:"Aplica IVA",align:"center"},{name:"descuento",label:"Descuento(%)",align:"center",field:"descuento"},{label:"Stock",align:"center",field:"stock",name:"stock"},{name:"pvm",label:"Costo Neto",align:"center"},{name:"v_total",label:"Valor Total",align:"center",field:"v_total"}]),B=()=>{const p=n(0),{api:f,mostrarNotify:i,claim:c}=y(),d=(e,a)=>{if(u.value.some(l=>l.id==e.id))i("warning","Ya fue agregado este producto/servicio");else{if(a!=="proforma"&&a!=="compras"&&e.stock<=0&&e.tipo!="Servicio")return i("negative",`No hay stock del articulo ${e.nombre}`);let l=0;e.tipo=="Servicio"||a=="proforma"?(l=1,e.v_total=e.pvp):l=0,e.cantidad=l,e.v_total=a=="proforma"?parseFloat(e.v_total):0,e.descuento=a=="venta"||a=="proforma"?e.descuento:0,u.value.unshift(e),e.tipo=="Servicio"&&g(e,"ventas")}v.value=""},F=async e=>{if(v.value.length==0)return i("warning","Ingresa el termino de busqueda");r.value=!0;try{let a={"company-id":c.company.id},{data:t}=await f.get(`/products/${v.value}`,{headers:a});if(t=t.filter(l=>{if(e=="compras"&&l.tipo=="Producto"||e=="venta")return l}),t.length>1)return m.value={data:t,tipo:e},b.value=!0,r.value=!1;if(t.length===0)return i("warning","No se encontro el articulo..."),r.value=!1;if(c.roles[0]=="ADMINISTRADOR"||c.roles[0]=="SUPER-ADMINISTRADOR"){if(_.value!==t[0].sucursal_id.id)return i("warning","No se encontro el articulo..."),r.value=!1}else if(c.sucursales[0]!==t[0].sucursal_id.id)return i("warning","No se encontro el articulo..."),r.value=!1;r.value=!1,d(t[0],e)}catch(a){console.log(a),r.value=!1}},S=e=>{const a=u.value.findIndex(t=>t.id==e);u.value.splice(a,1)},I=async()=>{const{data:{iva:e}}=await f.get(`/companies/get-iva/${c.company.id}`);e=="4"&&(p.value=15),e=="3"&&(p.value=14),e=="2"&&(p.value=12)},h=A(()=>{let e=0,a=0,t=0,l=0;return u.value.forEach(o=>{o.descuento>0&&(t+=parseFloat(o.v_total)*parseFloat(o.descuento)/100),o.aplicaIva&&(a+=(parseFloat(o.v_total)-parseFloat(o.v_total)*parseFloat(o.descuento)/100)*p.value/100),e+=parseFloat(o.v_total)}),l=e+a-t,{subtotal:s(e),iva:s(a),descuento:s(t),total:s(l)}}),g=(e,a="compras")=>{a=="compras"?e.v_total=parseInt(e.cantidad)*parseFloat((Math.floor(e.precio_compra*100)/100).toString()):e.v_total=s(parseInt(e.cantidad)*parseFloat(e.pvp)),e.pvp=s(e.pvp)},s=e=>{let a=e.toString().split("."),t=parseFloat(a[0]);return a.length>1?t+=parseFloat("."+a[1].substring(0,2)):t+=parseFloat(".00"),parseFloat(t.toFixed(2))};return I(),{agregarAndValidarStock:d,columns:N,claim:c,formatearNumero:s,filterArticulo:F,filterByCodBarra:v,loadingState:r,listProductos:m,modalSelectProducto:b,sucursal_selected:_,iva_selected:p,getSubtotalByProduct:g,quitarArticulo:S,valorFactura:h,rows:u}};export{B as u};
