import{r as c,o as r,a9 as v,g as l,f as o,aV as Y,e as s,aa as V,O as F,h as y,ah as re,i as C,af as p,ae as q,ab as h,c as E,ad as d,Q as T,aU as X,v as N,ba as G,aj as W,ai as ie,bc as Z,by as ne,P as z}from"./index.c1e9c266.js";import{Q as J}from"./QDate.afde6fe2.js";import{Q as K}from"./QPopupProxy.ac5f9150.js";import{Q as ue}from"./QInnerLoading.6590b929.js";import{Q as de,a as ce}from"./QTable.fe6d5a67.js";import{Q as me,a as B}from"./QTooltip.e7da7497.js";import{Q as ee}from"./QSelect.90934d7a.js";import{Q as R}from"./QTd.73524116.js";import{Q as ve}from"./QBadge.26100003.js";import{Q as pe}from"./QPageSticky.418ed1ae.js";import{C as S}from"./ClosePopup.e17be494.js";import{u as fe}from"./useRolPermisos.b0afd7fb.js";import{u as le}from"./useHelpers.b0f80051.js";import{d as ge}from"./date.dd1f3776.js";import{a as _e}from"./use-quasar.01e618a9.js";import"./exceljs.min.7116fb0c.js";import{_ as be}from"./DetalleProducts.58868a55.js";import{e as ye}from"./vue3-q-tel-input.esm.5ec97835.js";import"./format.94f2824d.js";import"./QList.6ef072d3.js";import"./axios.e50523b2.js";import"./QBtnDropdown.cafef135.js";import"./QBtnGroup.13e20355.js";const xe={class:"text-h6 text-center"},he={class:"row flex flex-center"},we={class:"col-xs-11 col-sm-9 text-center q-mt-md q-mb-lg"},Ve=s("label",null,"Enviar por:",-1),ke={key:0,class:"col-xs-11 col-sm-9 text-center q-mb-md"},Ce=s("label",null,"Celular del cliente:",-1),qe={key:1,class:"col-xs-11 col-sm-9 text-center"},$e=s("label",null,"Email del cliente:",-1),Qe={class:"col-xs-9 col-md-12 flex justify-center q-ml-none"},Re={__name:"ModalReenviarComproantes",props:["detalleFactura"],emits:["closeModal"],setup(j,{emit:$}){const w=j,{api:O,mostrarNotify:D}=le(),Q=c(!1),g=c(!1),t=c({tipo_envio:"",telefono:"",email:""});t.value.telefono=w.detalleFactura.customer_id.celular,t.value.email=w.detalleFactura.customer_id.email;const U=()=>{Q.value=!1;const f=/^\w+([.-_+]?\w+)*@\w+([.-]?\w+)*(\.\w{2,10})+$/;let n=[];return t.value.tipo_envio=="whatsapp"&&n.push("telefono"),t.value.tipo_envio=="email"&&n.push("email"),t.value.tipo_envio=="ambas"&&(n=["telefono","email"]),t.value.tipo_envio==""&&(n=["tipo_envio"]),t.value.email.length>5&&!f.test(t.value.email)&&(i.value.email.message="Ingresa un email valido",i.value.email.isValid=!1,Q.value=!0),n.forEach(m=>{t.value[m].length==0&&(i.value[m].message="Debes completar este campo",i.value[m].isValid=!1,Q.value=!0)}),Q.value},i=c({telefono:{message:"",isValid:!0},tipo_envio:{message:"",isValid:!0},email:{message:"",isValid:!0}}),P=async()=>{if(!U()&&!((t.value.tipo_envio=="whatsapp"||t.value.tipo_envio=="ambas")&&!i.value.telefono.isValid))try{g.value=!0,await O.post("/CE/facturas/reenviar-comprobantes",{...t.value,factura:w.detalleFactura}),D("positive","Comprobantes enviados"),$("closeModal"),g.value=!1}catch(f){g.value=!1,D("warning",f.response.data.message),$("closeModal")}},M=f=>{i.value.telefono.isValid=!f};return(f,n)=>(r(),v(X,{style:{width:"400px","max-width":"80vw"}},{default:l(()=>[o(Y,null,{default:l(()=>[s("div",xe,[V(" Enviar Comprobantes "),F(o(y,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[S]])])]),_:1}),o(re,{inset:""}),o(Y,{class:"q-pt-none"},{default:l(()=>[s("div",he,[s("div",we,[Ve,o(ee,{filled:"",dense:"",modelValue:t.value.tipo_envio,"onUpdate:modelValue":n[0]||(n[0]=m=>t.value.tipo_envio=m),error:!i.value.tipo_envio.isValid,"emit-value":"","map-options":"",options:[{label:"WhatsApp",value:"whatsapp"},{label:"Email",value:"email"},{label:"Ambas",value:"ambas"}]},{append:l(()=>[t.value.tipo_envio.length!=0&&t.value.tipo_envio=="whatsapp"?(r(),v(C,{key:0,name:"fa-brands fa-whatsapp",color:"teal-7"})):p("",!0),t.value.tipo_envio.length!=0&&t.value.tipo_envio=="email"?(r(),v(C,{key:1,name:"mail",color:"indigo-5"})):p("",!0),t.value.tipo_envio.length!=0&&t.value.tipo_envio=="ambas"?(r(),v(C,{key:2,name:"fa-solid fa-list-check",color:"deep-orange-4"})):p("",!0)]),error:l(()=>[s("label",{class:q(f.$q.dark.isActive?"text-red-4":"text-negative")},h(i.value.tipo_envio.message),3)]),_:1},8,["modelValue","error"])]),t.value.tipo_envio=="whatsapp"||t.value.tipo_envio=="ambas"?(r(),E("div",ke,[Ce,o(d(ye),{"default-country":"EC","search-text":"Buscar pais...","onUpdate:modelValue":n[1]||(n[1]=m=>i.value.telefono.isValid=!0),onError:M,error:!i.value.telefono.isValid,filled:"",dense:"",tel:t.value.telefono,"onUpdate:tel":n[2]||(n[2]=m=>t.value.telefono=m)},{error:l(()=>[s("label",{class:q(f.$q.dark.isActive?"text-red-4":"text-negative")},h(i.value.telefono.message),3)]),_:1},8,["error","tel"])])):p("",!0),t.value.tipo_envio=="email"||t.value.tipo_envio=="ambas"?(r(),E("div",qe,[$e,o(T,{type:"email",modelValue:t.value.email,"onUpdate:modelValue":[n[3]||(n[3]=m=>t.value.email=m),n[4]||(n[4]=m=>i.value.email.isValid=!0)],"input-class":"resaltarTextoInput",error:!i.value.email.isValid,"lazy-rules":"",dense:"",filled:""},{error:l(()=>[s("label",{class:q(f.$q.dark.isActive?"text-red-4":"text-negative")},h(i.value.email.message),3)]),_:1},8,["modelValue","error"])])):p("",!0),s("div",Qe,[o(y,{label:"Enviar",onClick:P,loading:g.value,class:"q-px-xl q-mt-md q-mb-md",outline:"",rounded:"",style:{color:"#696cff"}},null,8,["loading"])])])]),_:1})]),_:1}))}};const Ee={class:"q-mx-lg q-pt-md"},De={class:"row q-col-gutter-lg"},Pe={style:{display:"flex"}},Ae={class:"col-xs-12 col-sm-3"},Ie={class:"q-mr-sm row q-pt-sm justify-center"},Fe={class:"col-xs-10 col-sm-4"},Se={class:"row items-center justify-end"},Ue={class:"col-xs-12 col-sm-1 flex flex-center"},Me={class:"col-xs-10 col-sm-4"},Te={class:"row items-center justify-end"},Oe={class:"col-12 q-pt-none"},Ne={key:0,class:"text-center row justify-center",style:{width:"100%"}},ze=s("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Comprobantes ",-1),Be=[ze],je=s("label",{class:"q-mr-sm row items-center"},[s("span",null,"Por Sucursal: ")],-1),He=s("div",{class:"full-width row flex-center text-lime-10 q-gutter-sm"},[s("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun resultado ")],-1),fl={__name:"IndexPage",setup(j){const{api:$,claim:w,route:O,mostrarNotify:D}=le(),Q=[{name:"acciones",label:"acciones",align:"center"},{name:"sucursal",label:"Sucursal",align:"center"},{name:"num_comprobante",label:"Num. Comprobante",field:"numero_comprobante",align:"center"},{name:"usuario",label:"Usuario",align:"center"},{name:"cliente",label:"Cliente",align:"center"},{name:"f/h",label:"Fecha/Hora",align:"center",field:"created_at"},{name:"total",label:"Total",name:"total",align:"center"},{name:"estado",label:"Estado",field:"estado",align:"center"}],g=c(""),t=c(""),U=c([]),i=c(!1),P=c(!1),M=c("Todos"),f=c(""),n=c({}),m=c([]),A=c([]),H=c({}),{validarPermisos:L}=fe(),_=_e(),I=c(!1);N(M,(u,a)=>{x()});const ae=()=>{const{tipo:u,fecha:a}=O.params;u!=""&&(M.value=u),a!=""&&(g.value=a.split(" - ")[0].replace(/-/g,"/"),t.value=a.split(" - ")[1].replace(/-/g,"/"))},x=async()=>{try{I.value=!0;let u={headers:{tipo:"PROFORMA","sucursal-id":A.value,desde:g.value,hasta:t.value}};const{data:a}=await $.get("/invoices",u);a.map(e=>{e.created_at=ge.formatDate(e.created_at,"DD/MM/YYYY HH:mm a"),e.loading=!1}),U.value=a,I.value=!1}catch(u){console.log(u),I.value=!1}},oe=async u=>{ne.create({title:"\xBFEstas seguro de querer eliminar esta proforma?",ok:{push:!0,color:"cyan-10",label:"Eliminar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{z.show({message:"Cargando..."}),await $.delete(`/invoices/${u}`),await x(),D("positive","Proforma eliminada exitosamente"),z.hide()}catch(a){D("warning",a.response.data.message),z.hide()}})};N(A,(u,a)=>{x()});const te=async u=>{I.value=!0,m.value=[];const{data:a}=await $.get(`/sucursal/find/${u}/company`);a.forEach(e=>{m.value.push({label:e.nombre,value:e.id})}),m.value.length!=0&&(A.value=m.value[0].value),x()};N(f,(u,a)=>{x()}),w.roles[0]=="SUPER-ADMINISTRADOR"||w.roles[0]=="ADMINISTRADOR"?te(w.company.id):x(),ae();const k=c("list"),se=c({rowsPerPage:10});return(u,a)=>(r(),E(W,null,[s("div",Ee,[s("div",De,[s("div",Pe,[s("div",{style:{display:"flex"},class:q([d(_).screen.xs?"q-mb-md q-mt-none q-pt-xs":"q-ml-lg q-pl-none q-my-md"])},[s("div",{class:q(["row",[d(_).screen.xs?"flex-center":""]])},[s("div",Ae,[s("label",Ie,[s("span",{class:q([d(_).screen.xs?"text-weight-bold":""])}," Filtrar por fecha: ",2)])]),s("div",Fe,[o(T,{outlined:"",dense:"",modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value=e),mask:"date"},{append:l(()=>[g.value!==""?(r(),v(C,{key:0,name:"close",onClick:a[0]||(a[0]=e=>(g.value="",x())),class:"cursor-pointer"})):p("",!0),o(C,{name:"event",class:"cursor-pointer"},{default:l(()=>[o(K,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(J,{modelValue:g.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>g.value=e),x]},{default:l(()=>[s("div",Se,[F(o(y,{label:"Close",color:"primary",flat:""},null,512),[[S]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Ue,[s("label",{class:q(["q-mx-md",[d(_).screen.xs?"text-weight-medium":""]])}," Hasta ",2)]),s("div",Me,[o(T,{outlined:"",dense:"",modelValue:t.value,"onUpdate:modelValue":a[5]||(a[5]=e=>t.value=e),mask:"date"},{append:l(()=>[t.value!==""?(r(),v(C,{key:0,name:"close",onClick:a[3]||(a[3]=e=>(t.value="",x())),class:"cursor-pointer"})):p("",!0),o(C,{name:"event",class:"cursor-pointer"},{default:l(()=>[o(K,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(J,{modelValue:t.value,"onUpdate:modelValue":[a[4]||(a[4]=e=>t.value=e),x]},{default:l(()=>[s("div",Te,[F(o(y,{onClick:x,label:"Close",color:"primary",flat:""},null,512),[[S]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])],2)],2)]),s("div",Oe,[o(X,{flat:"",class:"shadow_custom"},{default:l(()=>[o(de,{"title-class":"text-grey-7 text-h6",rows:U.value,"hide-header":k.value==="grid",loading:I.value,columns:Q,"row-key":"name",grid:k.value==="grid",filter:f.value,pagination:se.value},{loading:l(()=>[o(ue,{showing:"",color:"primary"})]),header:l(e=>[o(me,{props:e,style:{height:"60px"}},{default:l(()=>[(r(!0),E(W,null,ie(e.cols,b=>(r(),v(ce,{key:b.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:l(()=>[V(h(b.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":l(e=>[d(_).screen.xs?(r(),E("div",Ne,Be)):p("",!0),d(w).roles[0]=="SUPER-ADMINISTRADOR"||d(w).roles[0]=="ADMINISTRADOR"?(r(),E("div",{key:1,style:Z([!d(_).screen.xs||"width: 100%;justify-content: center;",{display:"flex"}]),class:q([d(_).screen.xs?"q-mb-md":"q-ml-lg"])},[je,o(ee,{outlined:"",dense:"",modelValue:A.value,"onUpdate:modelValue":a[6]||(a[6]=b=>A.value=b),"emit-value":"","map-options":"",options:m.value},null,8,["modelValue","options"])],6)):p("",!0)]),"top-right":l(e=>[d(_).screen.width>=1023&&d(L)("crear.venta")?(r(),v(y,{key:0,onClick:a[7]||(a[7]=b=>u.$router.push("/proforma/add")),outline:"",color:"primary",label:"Agregar Proforma",class:"q-mr-xs"})):p("",!0),o(T,{style:Z(d(_).screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=b=>f.value=b),placeholder:"Buscar..."},{append:l(()=>[o(C,{name:"search"})]),_:1},8,["style","modelValue"]),k.value==="list"?(r(),v(y,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:l(()=>[F((r(),v(B,{disable:d(_).platform.is.mobile},{default:l(()=>[V(h(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[S]])]),_:2},1032,["icon","onClick"])):p("",!0),e.inFullscreen?p("",!0):(r(),v(y,{key:2,flat:"",round:"",dense:"",icon:k.value==="grid"?"list":"grid_on",onClick:a[9]||(a[9]=b=>{k.value=k.value==="grid"?"list":"grid",u.separator=k.value==="grid"?"none":"horizontal"})},{default:l(()=>[F((r(),v(B,{disable:d(_).platform.is.mobile},{default:l(()=>[V(h(k.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[S]])]),_:1},8,["icon"]))]),"body-cell-total":l(e=>[o(R,{props:e},{default:l(()=>[V(" $"+h(e.row.total),1)]),_:2},1032,["props"])]),"body-cell-cliente":l(e=>[o(R,{props:e},{default:l(()=>[V(h(e.row.customer_id.nombres),1)]),_:2},1032,["props"])]),"body-cell-sucursal":l(e=>[o(R,{props:e},{default:l(()=>[V(h(e.row.sucursal_id.nombre),1)]),_:2},1032,["props"])]),"body-cell-usuario":l(e=>[o(R,{props:e},{default:l(()=>[V(h(e.row.user_id.fullName.toUpperCase()),1)]),_:2},1032,["props"])]),"body-cell-estado":l(e=>[o(R,{props:e},{default:l(()=>[o(ve,{outline:"",class:"q-py-xs q-px-md",color:d(_).dark.isActive?"blue-grey-3":"blue-grey-7",label:e.row.estadoSRI},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":l(e=>[o(R,{props:e},{default:l(()=>[o(y,{round:"",color:"blue-grey",icon:"visibility",size:"10px",class:"q-mr-sm",onClick:b=>(P.value=!0,n.value={...e.row})},null,8,["onClick"]),e.row.estadoSRI=="PROFORMA"?(r(),v(y,{key:0,onClick:b=>u.$router.push(`proforma/add/${e.row.id}`),round:"",color:"blue-grey",icon:"description",size:"10px",class:"q-mr-sm"},null,8,["onClick"])):p("",!0),e.row.estadoSRI=="AUTORIZADO"||e.row.estadoSRI=="PROFORMA"?(r(),v(y,{key:1,round:"",color:"blue-grey",onClick:b=>(i.value=!0,H.value=e.row),icon:"forward_to_inbox",size:"11px"},{default:l(()=>[o(B,{class:"bg-indigo",anchor:"top middle",self:"center middle"},{default:l(()=>[V(" Enviar comprobante por email ")]),_:1})]),_:2},1032,["onClick"])):p("",!0),o(y,{round:"",color:"blue-grey",class:"q-ml-sm",icon:"delete",size:"10px",onClick:b=>oe(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),"no-data":l(({icon:e})=>[He]),_:1},8,["rows","hide-header","loading","grid","filter","pagination"])]),_:1})])])]),d(_).screen.width<=1023&&d(L)("crear.venta")?(r(),v(pe,{key:0,position:"bottom-right",offset:[18,18]},{default:l(()=>[o(y,{round:"",color:"secondary",size:"lg",icon:"add",onClick:a[10]||(a[10]=e=>u.$router.push("/ventas/add"))})]),_:1})):p("",!0),o(G,{modelValue:P.value,"onUpdate:modelValue":a[11]||(a[11]=e=>P.value=e)},{default:l(()=>[o(be,{detalleData:n.value},null,8,["detalleData"])]),_:1},8,["modelValue"]),o(G,{modelValue:i.value,"onUpdate:modelValue":a[13]||(a[13]=e=>i.value=e)},{default:l(()=>[o(Re,{onCloseModal:a[12]||(a[12]=e=>i.value=!1),detalleFactura:H.value},null,8,["detalleFactura"])]),_:1},8,["modelValue"])],64))}};export{fl as default};
