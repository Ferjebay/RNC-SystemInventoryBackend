import{Q as ge,a as M}from"./QBreadcrumbs.f786b5d5.js";import{Q as _e}from"./QSpinnerFacebook.371c6a1c.js";import{r as b,v as be,x as he,o as m,c as Q,e as t,ae as i,f as o,g as a,aU as J,ad as r,bb as F,ba as xe,aj as we,by as ye,P,aV as K,aa as g,ab as p,a9 as _,bA as qe,i as D,w as Ae,af as L,Q as I,bz as Re,h as Z,bj as Ie,O as S}from"./index.c2f812b6.js";import{a as y,Q as q,d as $}from"./format.5d748f1c.js";import{Q as B}from"./QSelect.86574c4b.js";import{Q as V}from"./QTd.d64945f0.js";import{Q as Ve}from"./QTable.1539681d.js";import{Q as Oe}from"./QBadge.6221a6bd.js";import{Q as H}from"./QList.2fc48c7b.js";import{Q as W}from"./QBtnDropdown.0b126c04.js";import{Q as Ce}from"./QForm.266a0277.js";import{C as N}from"./ClosePopup.c968015a.js";import{u as De}from"./useHelpers.3fbfb387.js";import{d as Se}from"./date.42563084.js";import{u as $e,_ as Ne}from"./SelectProduct.700d6f16.js";import"./QBtnGroup.7dd00b9e.js";import"./use-quasar.cf48b602.js";import"./axios.7760d563.js";import"./QInnerLoading.2b460c76.js";const Te={class:"q-ma-lg q-pt-md q-mb-none",style:{"margin-bottom":"10px"}},ke={class:"row q-col-gutter-lg flex items-center"},Ee=t("label",{class:"text-h6 text-center"},"Nueva Retenci\xF3n",-1),Ue=[Ee],Me={class:"row q-mx-lg q-col-gutter-md"},Qe={class:"text-weight-regular"},Fe=t("span",{class:"q-mr-sm"},"N\xB0 Retenci\xF3n:",-1),Pe={key:1,class:"text-weight-regular"},Le={class:"col-xs-12 col-sm-12 col-md-6 q-mt-md q-pl-none"},Be=t("label",null,"Seleccionar Cliente: ",-1),je=t("label",null,"Seleccionar Sucursal: ",-1),ze={class:"row q-pt-lg q-mx-lg q-col-gutter-md"},Ge={class:"col-xs-12 col-md-6 q-pl-none"},Ye=t("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),Je=t("label",null,"Forma de pago:",-1),Ke={class:"q-mx-lg justify-center q-mt-md"},Ze={class:"col-12"},He={class:"full-width row flex-center text-lime-10 q-gutter-sm"},We=t("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1),Xe={class:"row",style:{width:"100%"}},el=t("label",{class:"q-pr-md"}," Descripci\xF3n (Opcional) ",-1),ll=[el],tl={class:"col-xs-12 col-sm-7 col-md-9"},al={class:"q-ml-sm q-mt-md"},sl={class:"col-xs-12 col-sm-4 col-md-5",style:{display:"flex","justify-content":"end"}},ol={class:"text-right"},rl=t("td",null,[t("b",null,"TOTAL BRUTO:")],-1),nl={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},il={class:"text-right"},dl=t("td",null,[t("b",null,"DESCUENTOS:")],-1),ul={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},cl={class:"text-right"},ml=t("td",null,[t("b",null,"SUBTOTAL:")],-1),pl={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},fl={class:"text-right"},vl={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},gl={class:"text-right"},_l=t("td",null,[t("b",null,"TOTAL DE VENTA:")],-1),bl={style:{width:"50px"}},Fl={__name:"AddRetencion",setup(hl){const{filterByCodBarra:A,columns:j,rows:x,modalSelectProducto:O,loadingState:X,listProductos:ee,valorFactura:f,agregarAndValidarStock:le,filterArticulo:te,formatearNumero:ae,getSubtotalByProduct:T,sucursal_selected:v,iva_selected:z,quitarArticulo:se}=$e();let G=[];const h=b([]),{api:C,claim:u,mostrarNotify:w,route:xl,router:oe}=De(),k=b([]),re=b(!1),E=b(!1),U=b(!0),ne=b(""),ie=Date.now();let de=Se.formatDate(ie,"DD/MM/YYYY");(u.roles[0]!=="SUPER-ADMINISTRADOR"||u.roles[0]!=="ADMINISTRADOR")&&(v.value=u.sucursales[0]),j.value[7]={name:"pvp",label:"Precio de Venta",align:"center"};const n=b({customer_id:"5e909ecb-81f5-4cab-a663-ce3786c0db49",numero_comprobante:"--- --- ---------",products:[],user_id:"",forma_pago:"",descripcion:""}),d=b({customer_id:{message:"",isValid:!0},sucursal_id:{message:"",isValid:!0},forma_pago:{message:"",isValid:!0}});be(v,(s,l)=>{Y()});const ue=async s=>{k.value=[];const{data:l}=await C.get(`/sucursal/find/${s}/company`);l.forEach(e=>{k.value.push({label:e.nombre,value:e.id})})},ce=s=>{le(s,"venta"),O.value=!1},me=async()=>{n.value.customer_id,n.value.customer_id="",re.value=!1;try{let s={"company-id":u.company.id};const{data:l}=await C.get("/customers",{headers:s});h.value=[],l.forEach(e=>{h.value.push({label:e.nombres,value:e.id,num_doc:e.numero_documento})}),G=h.value}catch(s){console.log(s)}},pe=(s="",l)=>{if(s==="")return l(()=>{h.value=G});l(()=>{const e=s.toLowerCase();h.value=h.value.filter(c=>c.num_doc.indexOf(e)>-1||c.label.toLowerCase().indexOf(e)>-1)})},fe=s=>{let l=!1;return(u.roles[0]=="SUPER-ADMINISTRADOR"||u.roles[0]=="ADMINISTRADOR")&&v.value==""&&(d.value.sucursal_id.message="Debes seleccionar una sucursal",d.value.sucursal_id.isValid=!1,l=!0),f.value.total>50&&n.value.customer_id=="5e909ecb-81f5-4cab-a663-ce3786c0db49"&&s!="PROFORMA"&&(d.value.customer_id.message="La factura supera los $50.00, no puede ser emitida a CONSUMIDOR FINAL",d.value.customer_id.isValid=!1,l=!0),f.value.total>50&&n.value.forma_pago=="01"&&(d.value.forma_pago.message="La factura supera los $500.00, debes elegir otra forma de pago",d.value.forma_pago.isValid=!1,l=!0),x.value.length==0&&(l=!0,w("warning","Debes agregar algun producto..")),n.value.forma_pago.length==0&&(d.value.forma_pago.message="Debes elegir una forma de pago",d.value.forma_pago.isValid=!1,l=!0),x.value.forEach((e,c)=>{e.cantidad<=0&&(l=!0,w("warning",`Agrega una cantidad cantidad al producto: ${e.nombre} de la fila: ${c+1}`)),e.cantidad>e.stock&&e.tipo!="Servicio"&&(l=!0,w("warning",`La cantidad de venta del producto: ${e.nombre} supera su stock disponible`))}),l},R=async s=>{if(fe(s))return;n.value={...n.value,...f.value,products:x.value,user_id:u.id,tipo:s,send_messages:U,porcentaje_iva:z.value,name_proforma:ne.value};let l;s=="EMISION"&&(l="\xBFDeseas emitir factura de esta proforma?"),s=="FACTURA"&&(l="\xBFDeseas generar esta FACTURA?"),s=="PROFORMA"&&(l="\xBFDeseas guardar como PROFORMA?"),ye.create({title:l,ok:{push:!0,color:"cyan-10",label:"Enviar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{P.show({message:"Cargando..."});let e={headers:{"sucursal-id":v.value}};await C.post("/invoices",n.value,e),P.hide(),w("positive","Venta realizada exitosamente"),oe.push("/ventas")}catch(e){w("warning",e.response.data.message),P.hide()}})},ve=()=>{if((u.roles[0]=="SUPER-ADMINISTRADOR"||u.roles[0]=="ADMINISTRADOR")&&typeof v.value=="undefined")return w("warning","Elige una sucursal primeramente");te("venta")},Y=async()=>{E.value=!0;let s={headers:{"sucursal-id":v.value}};const{data:l}=await C.get("/retenciones/getNumRetencion",s);n.value.numero_comprobante=l.numComprobante,E.value=!1};return he(()=>{x.value=[]}),u.roles[0]=="SUPER-ADMINISTRADOR"||u.roles[0]=="ADMINISTRADOR"?ue(u.company.id):Y(),me(),(s,l)=>(m(),Q(we,null,[t("div",Te,[t("div",ke,[t("div",{class:i(["col-xs-12 col-md-6",[(s.$q.screen.width<1022,"q-pt-sm")]])},[o(ge,{class:i(["row q-mr-xs",[s.$q.screen.width<1022?"justify-center q-pt-sm":"justify-start "]])},{default:a(()=>[o(M,{label:"Inicio",icon:"home",to:"/"}),o(M,{label:"Retenciones",icon:"payments",to:"/retenciones"}),o(M,{label:"Retenci\xF3n",icon:"add_circle"})]),_:1},8,["class"])],2),t("div",{class:i(["col-xs-12 col-md-6",[s.$q.screen.width<1022?"text-center q-pt-sm":"text-right q-pt-sm"]])},Ue,2)])]),o(J,{class:"q-mx-lg q-mt-lg"},{default:a(()=>[o(K,{class:"q-pt-none"},{default:a(()=>[t("div",Me,[t("div",{class:i(["col-xs-12 col-md-6 q-pt-xs q-mt-md",s.$q.screen.width>=1023||"text-center"])},[t("label",{class:i(["text-weight-medium",[s.$q.screen.xs?"text-subtitle1":"text-h5"]])},[g("Fecha de Emisi\xF3n: "),t("span",Qe,p(r(de)),1)],2)],2),t("div",{class:i(["col-xs-12 col-md-6",s.$q.screen.width<=1023?"text-center q-pt-sm":"text-right q-pt-xs q-mt-md"])},[t("label",{class:i(["q-mr-lg text-weight-medium",[s.$q.screen.xs?"text-subtitle1":"text-h5"]])},[Fe,E.value?(m(),_(_e,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(m(),Q("span",Pe,p(n.value.numero_comprobante),1))],2)],2),t("div",Le,[Be,o(B,{color:"orange",filled:"",modelValue:n.value.customer_id,"onUpdate:modelValue":[l[1]||(l[1]=e=>n.value.customer_id=e),l[2]||(l[2]=e=>d.value.customer_id.isValid=!0)],options:h.value,"emit-value":"","map-options":"",dense:"",error:!d.value.customer_id.isValid,onFilter:pe,"use-input":"","input-debounce":"0"},qe({error:a(()=>[t("label",{class:i(s.$q.dark.isActive?"text-red-4":"text-negative")},p(d.value.customer_id.message),3)]),"no-option":a(()=>[o(y,null,{default:a(()=>[o(q,{class:"text-grey"},{default:a(()=>[g(" No hay resultados ")]),_:1})]),_:1})]),_:2},[n.value.customer_id&&n.value.customer_id!=="CONSUMIDOR FINAL"?{name:"append",fn:a(()=>[o(D,{name:"cancel",onClick:l[0]||(l[0]=Ae(e=>n.value.customer_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","error"])]),r(u).roles[0]=="SUPER-ADMINISTRADOR"||r(u).roles[0]=="ADMINISTRADOR"?(m(),Q("div",{key:0,class:i(["col-xs-12 col-md-5 q-mt-md",s.$q.screen.width<=1023?"q-pl-none":"offset-1"])},[je,o(B,{filled:"",modelValue:r(v),"onUpdate:modelValue":[l[3]||(l[3]=e=>F(v)?v.value=e:null),l[4]||(l[4]=e=>(d.value.sucursal_id.isValid=!0,x.value=[]))],error:!d.value.sucursal_id.isValid,options:k.value,"emit-value":"","map-options":"",dense:""},{error:a(()=>[t("label",{class:i(s.$q.dark.isActive?"text-red-4":"text-negative")},p(d.value.sucursal_id.message),3)]),"no-option":a(()=>[o(y,null,{default:a(()=>[o(q,{class:"text-grey"},{default:a(()=>[g(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","error","options"])],2)):L("",!0)]),t("div",ze,[t("div",Ge,[Ye,o(I,{outlined:"","bottom-slots":"",loading:r(X),dense:"",modelValue:r(A),"onUpdate:modelValue":l[6]||(l[6]=e=>F(A)?A.value=e:null),modelModifiers:{trim:!0},onKeyup:Re(ve,["enter"])},{append:a(()=>[r(A)!==""?(m(),_(D,{key:0,name:"close",onClick:l[5]||(l[5]=e=>A.value=""),class:"cursor-pointer"})):L("",!0),o(D,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])]),t("div",{class:i(["col-xs-12 col-sm-5",s.$q.screen.width<=1023?"q-pl-none q-mb-lg":"offset-1"])},[Je,o(B,{dense:"",modelValue:n.value.forma_pago,"onUpdate:modelValue":[l[7]||(l[7]=e=>n.value.forma_pago=e),l[8]||(l[8]=e=>d.value.forma_pago.isValid=!0)],modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",error:!d.value.forma_pago.isValid,options:[{label:"SIN UTILIZACION DEL SISTEMA FINANCIERO",value:"01"},{label:"COMPENSACI\xD3N DE DEUDAS",value:"15"},{label:"TARJETA DE D\xC9BITO",value:"16"},{label:"DINERO ELECTR\xD3NICO",value:"17"},{label:"TARJETA PREPAGO",value:"18"},{label:"TARJETA DE CR\xC9DITO",value:"19"},{label:"OTROS CON UTILIZACI\xD3N DEL SISTEMA FINANCIERO",value:"20"},{label:"ENDOSO DE T\xCDTULOS",value:"21"}]},{error:a(()=>[t("label",{class:i(s.$q.dark.isActive?"text-red-4":"text-negative")},p(d.value.forma_pago.message),3)]),_:1},8,["modelValue","error"])],2)])]),_:1})]),_:1}),o(Ce,{onSubmit:l[16]||(l[16]=e=>R("EMISION"))},{default:a(()=>[t("div",Ke,[t("div",Ze,[o(Ve,{rows:r(x),columns:r(j),"row-key":"name",class:i([s.$q.dark.isActive?"":"my-sticky-header-table3"]),"hide-pagination":!0,"rows-per-page-options":[50]},{"no-data":a(({})=>[t("div",He,[We,o(D,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":a(e=>[o(V,{props:e,class:"flex flex-center"},{default:a(()=>[o(I,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:c=>r(T)(e.row,"ventas"),min:"0",max:e.row.stock,readonly:e.row.tipo=="Servicio",type:"number",style:{width:"80px"},modelValue:e.row.cantidad,"onUpdate:modelValue":c=>e.row.cantidad=c,modelModifiers:{trim:!0}},null,8,["onChange","max","readonly","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-descuento":a(e=>[o(V,{props:e,class:"flex flex-center"},{default:a(()=>[o(I,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:c=>r(T)(e.row,"ventas"),min:"0",type:"number",style:{width:"100px"},modelValue:e.row.descuento,"onUpdate:modelValue":c=>e.row.descuento=c},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":a(e=>[o(V,{props:e},{default:a(()=>[g(p(e.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":a(e=>[o(V,{props:e,class:"flex flex-center"},{default:a(()=>[o(I,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:c=>r(T)(e.row,"ventas"),min:"0",type:"number",style:{width:"100px"},modelValue:e.row.pvp,"onUpdate:modelValue":c=>e.row.pvp=c},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":a(e=>[o(V,{props:e},{default:a(()=>[o(Z,{round:"",color:"deep-orange",onClick:c=>r(se)(e.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),o(J,{class:"q-mt-md"},{default:a(()=>[o(K,{class:"q-pt-none row"},{default:a(()=>[t("div",{class:i(["col-xs-12 col-sm-8 col-md-7 row items-center q-mt-md",s.$q.screen.width<=1023?"q-mt-lg q-mb-sm":""])},[t("div",Xe,[t("div",{class:i(["col-xs-12 col-sm-5 col-md-3 flex flex-center",s.$q.screen.xs?"text-center":"text-right"])},ll,2),t("div",tl,[o(I,{modelValue:n.value.descripcion,"onUpdate:modelValue":l[9]||(l[9]=e=>n.value.descripcion=e),filled:"",type:"textarea",rows:"4"},null,8,["modelValue"])])]),t("div",al,[o(Ie,{"left-label":"",size:"xl",modelValue:U.value,"onUpdate:modelValue":l[10]||(l[10]=e=>U.value=e),label:"Enviar mensaje al cliente",color:"deep-orange-9","checked-icon":"task_alt","unchecked-icon":"highlight_off"},null,8,["modelValue"])])],2),t("div",sl,[t("table",{class:i([s.$q.screen.xs?"":"linearTablaDetalle"])},[t("tr",ol,[rl,t("td",nl," $"+p(r(f).subtotal.toFixed(2)),1)]),t("tr",il,[dl,t("td",ul," $"+p(r(f).descuento.toFixed(2)),1)]),t("tr",cl,[ml,t("td",pl," $"+p(r(ae)(r(f).subtotal-r(f).descuento).toFixed(2)),1)]),t("tr",fl,[t("td",null,[t("b",null,"IVA("+p(r(z))+"%):",1)]),t("td",vl," $"+p(r(f).iva.toFixed(2)),1)]),t("tr",gl,[_l,t("td",bl,[o(Oe,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${r(f).total.toFixed(2)}`},null,8,["label"])])])],2)]),t("div",{class:i(["col-12 flex q-mt-md q-my-lg",[s.$q.screen.width<600?"justify-center":"justify-between"]])},[s.$q.screen.width>600?(m(),_(Z,{key:0,icon:"arrow_back",onClick:l[11]||(l[11]=e=>s.$router.push("/ventas")),outline:"",rounded:"",class:"q-mr-lg",color:s.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:a(()=>[g(" \xA0 Regresar ")]),_:1},8,["color"])):L("",!0),s.$route.params.venta_id==""?(m(),_(W,{key:1,outline:"",rounded:"",style:{color:"#696cff"},label:"Generar",class:i(s.$q.screen.width>=1023?"q-px-xl":"full-width")},{default:a(()=>[o(H,null,{default:a(()=>[S((m(),_(y,{clickable:"",onClick:l[12]||(l[12]=e=>R("FACTURA"))},{default:a(()=>[o(q,null,{default:a(()=>[o($,null,{default:a(()=>[g("FACTURA")]),_:1})]),_:1})]),_:1})),[[N]]),S((m(),_(y,{clickable:"",onClick:l[13]||(l[13]=e=>R("PROFORMA"))},{default:a(()=>[o(q,null,{default:a(()=>[o($,null,{default:a(()=>[g("PROFORMA")]),_:1})]),_:1})]),_:1})),[[N]])]),_:1})]),_:1},8,["class"])):(m(),_(W,{key:2,outline:"",rounded:"",style:{color:"#696cff"},label:"Generar",class:i(s.$q.screen.width>=1023?"q-px-xl":"full-width")},{default:a(()=>[o(H,null,{default:a(()=>[S((m(),_(y,{clickable:"",onClick:l[14]||(l[14]=e=>R("EMISION"))},{default:a(()=>[o(q,null,{default:a(()=>[o($,null,{default:a(()=>[g("Emitir Factura")]),_:1})]),_:1})]),_:1})),[[N]]),S((m(),_(y,{clickable:"",onClick:l[15]||(l[15]=e=>R("PROFORMA"))},{default:a(()=>[o(q,null,{default:a(()=>[o($,null,{default:a(()=>[g("Guardar Cambios")]),_:1})]),_:1})]),_:1})),[[N]])]),_:1})]),_:1},8,["class"]))],2)]),_:1})]),_:1})])]),_:1}),o(xe,{modelValue:r(O),"onUpdate:modelValue":l[17]||(l[17]=e=>F(O)?O.value=e:null)},{default:a(()=>[o(Ne,{listProductos:r(ee),onAgregarProduct:ce},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}};export{Fl as default};
