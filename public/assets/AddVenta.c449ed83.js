import{Q as be,a as H}from"./QBreadcrumbs.fd2dc489.js";import{p as m,m as Z,bx as he,by as _e,n as P,s as ne,bz as re,at as we,r as S,aH as ye,bA as xe,v as X,B as qe,i as N,h as $,z as Ae,aO as Ce,u as Se,l as Ve,x as ke,o as x,c as Y,e as l,ac as g,f as n,g as o,a8 as C,a9 as q,ab as i,a7 as B,bB as Be,aS as G,ad as K,br as $e,Q as W,aT as Oe,ah as De,bs as Ie,P as J,w as Qe,N as ae}from"./index.e2604f41.js";import{b as Pe,a as E,Q as L,c as se}from"./QItemLabel.a39057c6.js";import{Q as le}from"./QSelect.2aac5f58.js";import{Q as Ne,a as I}from"./QTable.1564a250.js";import{Q as Re}from"./QBadge.62804750.js";import{Q as Te}from"./QList.ead62a8b.js";import{Q as Fe}from"./QForm.4e4cdea4.js";import{C as oe}from"./ClosePopup.a0fb7464.js";import{a as Q}from"./axios.dafdfce6.js";import{u as Me}from"./useHelpers.d8fdd9b9.js";import{d as Ue}from"./date.fd6ee6d9.js";import{u as Ee,_ as Le}from"./SelectProduct.62229ccd.js";import"./QChip.9c1ba2ae.js";import"./format.2bc25e5f.js";import"./use-quasar.4e0c8a9c.js";import"./QInnerLoading.517687ca.js";const je=[m("g",{transform:"translate(20 50)"},[m("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.6"},[m("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),m("g",{transform:"translate(50 50)"},[m("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.8"},[m("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.1s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),m("g",{transform:"translate(80 50)"},[m("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.9"},[m("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.2s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])])];var ze=Z({name:"QSpinnerFacebook",props:he,setup(t){const{cSize:u,classes:d}=_e(t);return()=>m("svg",{class:d.value,width:u.value,height:u.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},je)}}),He=Z({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(t,{slots:u}){const d=P(()=>{const f=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(p=>t[p]===!0).map(p=>`q-btn-group--${p}`).join(" ");return`q-btn-group row no-wrap${f.length!==0?" "+f:""}`+(t.spread===!0?" q-btn-group--spread":" inline")});return()=>m("div",{class:d.value},ne(u.default))}});const Ye=Object.keys(re),Ge=t=>Ye.reduce((u,d)=>{const f=t[d];return f!==void 0&&(u[d]=f),u},{});var Ke=Z({name:"QBtnDropdown",props:{...re,...we,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(t,{slots:u,emit:d}){const{proxy:f}=Ae(),p=S(t.modelValue),h=S(null),R=ye(),_=P(()=>{const r={"aria-expanded":p.value===!0?"true":"false","aria-haspopup":"true","aria-controls":R,"aria-label":t.toggleAriaLabel||f.$q.lang.label[p.value===!0?"collapse":"expand"](t.label)};return(t.disable===!0||t.split===!1&&t.disableMainBtn===!0||t.disableDropdown===!0)&&(r["aria-disabled"]="true"),r}),T=P(()=>"q-btn-dropdown__arrow"+(p.value===!0&&t.noIconAnimation===!1?" rotate-180":"")+(t.split===!1?" q-btn-dropdown__arrow-container":"")),F=P(()=>xe(t)),O=P(()=>Ge(t));X(()=>t.modelValue,r=>{h.value!==null&&h.value[r?"show":"hide"]()}),X(()=>t.split,k);function b(r){p.value=!0,d("beforeShow",r)}function j(r){d("show",r),d("update:modelValue",!0)}function M(r){p.value=!1,d("beforeHide",r)}function w(r){d("hide",r),d("update:modelValue",!1)}function v(r){d("click",r)}function V(r){Ce(r),k(),d("click",r)}function D(r){h.value!==null&&h.value.toggle(r)}function U(r){h.value!==null&&h.value.show(r)}function k(r){h.value!==null&&h.value.hide(r)}return Object.assign(f,{show:U,hide:k,toggle:D}),qe(()=>{t.modelValue===!0&&U()}),()=>{const r=[m(N,{class:T.value,name:t.dropdownIcon||f.$q.iconSet.arrow.dropdown})];return t.disableDropdown!==!0&&r.push(m(Pe,{ref:h,id:R,class:t.contentClass,style:t.contentStyle,cover:t.cover,fit:!0,persistent:t.persistent,noRouteDismiss:t.noRouteDismiss,autoClose:t.autoClose,anchor:t.menuAnchor,self:t.menuSelf,offset:t.menuOffset,separateClosePopup:!0,transitionShow:t.transitionShow,transitionHide:t.transitionHide,transitionDuration:t.transitionDuration,onBeforeShow:b,onShow:j,onBeforeHide:M,onHide:w},u.default)),t.split===!1?m($,{class:"q-btn-dropdown q-btn-dropdown--simple",...O.value,..._.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:v},{default:()=>ne(u.label,[]).concat(r),loading:u.loading}):m(He,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:t.rounded,square:t.square,...F.value,glossy:t.glossy,stretch:t.stretch},()=>[m($,{class:"q-btn-dropdown--current",...O.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:V},{default:u.label,loading:u.loading}),m($,{class:"q-btn-dropdown__arrow-container q-anchor--skip",..._.value,...F.value,disable:t.disable===!0||t.disableDropdown===!0,rounded:t.rounded,color:t.color,textColor:t.textColor,dense:t.dense,size:t.size,padding:t.padding,ripple:t.ripple},()=>r)])}}});const We={class:"q-ma-lg q-pt-md q-mb-none",style:{"margin-bottom":"10px"}},Je={class:"row q-col-gutter-lg"},Xe=l("label",{class:"text-h6 text-center"},"Nueva Venta/Proforma",-1),Ze=[Xe],et={class:"row q-mx-lg q-col-gutter-md"},tt={class:"text-weight-regular"},at=l("span",{class:"q-mr-sm"},"N\xB0 Factura:",-1),st={key:1,class:"text-weight-regular"},lt={class:"col-xs-12 col-sm-12 col-md-6 q-mt-md q-pl-none"},ot=l("label",null,"Seleccionar Cliente: ",-1),nt=l("label",null,"Seleccionar Sucursal: ",-1),rt={class:"row q-pt-lg q-mx-lg"},it={class:"col-xs-12 col-md-6"},ut=l("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),dt={class:"row q-mx-lg justify-center"},ct={class:"col-12"},mt={class:"full-width row flex-center text-lime-10 q-gutter-sm"},ft=l("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1),vt={class:"col-12",style:{display:"flex","justify-content":"end"}},gt={class:"text-right"},pt=l("td",null,[l("b",null,"TOTAL BRUTO:")],-1),bt={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},ht={class:"text-right"},_t=l("td",null,[l("b",null,"DESCUENTOS:")],-1),wt={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},yt={class:"text-right"},xt=l("td",null,[l("b",null,"SUBTOTAL:")],-1),qt={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},At={class:"text-right"},Ct=l("td",null,[l("b",null,"IVA(12%):")],-1),St={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},Vt={class:"text-right"},kt=l("td",null,[l("b",null,"TOTAL DE VENTA:")],-1),Bt={style:{width:"50px"}},Yt={__name:"AddVenta",setup(t){const{filterByCodBarra:u,columns:d,rows:f,modalSelectProducto:p,loadingState:h,listProductos:R,valorFactura:_,agregarAndValidarStock:T,filterArticulo:F,getSubtotalByProduct:O,sucursal_selected:b,quitarArticulo:j}=Ee();let M=[];const w=S([]),{claim:v,mostrarNotify:V}=Me(),D=S([]),U=S(!1),k=S(!1),r=Date.now();let ie=Ue.formatDate(r,"DD/MM/YYYY");(v.roles[0]!=="Super-Administrador"||v.roles[0]!=="Administrador")&&(b.value=v.sucursales[0]);const ue=Se(),ee=Ve();d.value[7]={name:"pvp",label:"Precio de Venta",align:"center"};const c=S({customer_id:"386f5a32-7c96-4a51-8f50-86ea8338325b",numero_comprobante:"--- --- ---------",products:[],user_id:""}),y=S({customer_id:{message:"",isValid:!0},sucursal_id:{message:"",isValid:!0}});X(b,(s,e)=>{te()});const de=async s=>{D.value=[];const{data:e}=await Q.get(`/sucursal/find/${s}/company`);e.forEach(a=>{D.value.push({label:a.nombre,value:a.id})})},ce=async()=>{if(ee.params.venta_id!==""){const{data:s}=await Q.get(`/invoices/filterInvoice/${ee.params.venta_id}`);c.value.customer_id=s.customer_id.id,c.value.id=s.id,c.value.clave_acceso=s.clave_acceso,c.value.estadoSRI=s.estadoSRI,b.value=s.sucursal_id.id,s.invoiceToProduct.forEach(e=>{e.product_id.cantidad=e.cantidad,e.product_id.descuento=parseFloat(e.descuento),e.product_id.v_total=e.v_total,T(e.product_id,"proforma")})}},me=s=>{T(s,"venta"),p.value=!1},fe=async()=>{const s=c.value.customer_id;c.value.customer_id="",U.value=!1;try{const{data:e}=await Q.get("/customers");w.value=[],e.forEach(a=>{w.value.push({label:a.nombres,value:a.id,num_doc:a.numero_documento})}),w.value.unshift({label:"CONSUMIDOR FINAL",value:"386f5a32-7c96-4a51-8f50-86ea8338325b",cedula:"9999999999999"}),M=w.value,c.value.customer_id=s,ce()}catch(e){console.log(e)}},ve=(s="",e)=>{if(s==="")return e(()=>{w.value=M});e(()=>{const a=s.toLowerCase();w.value=w.value.filter(A=>A.num_doc.indexOf(a)>-1||A.label.toLowerCase().indexOf(a)>-1)})},ge=()=>{let s=!1;return(v.roles[0]=="Super-Administrador"||v.roles[0]=="Administrador")&&b.value==""&&(y.value.sucursal_id.message="Debes seleccionar una sucursal",y.value.sucursal_id.isValid=!1,s=!0),_.value.total>50&&c.value.customer_id=="386f5a32-7c96-4a51-8f50-86ea8338325b"&&(y.value.customer_id.message="La factura supera los $50.00, no puede ser emitida a CONSUMIDOR FINAL",y.value.customer_id.isValid=!1,s=!0),f.value.length==0&&(s=!0,V("warning","Debes agregar algun producto..")),f.value.forEach((e,a)=>{e.cantidad<=0&&(s=!0,V("warning",`Agrega una cantidad cantidad al producto: ${e.nombre} de la fila: ${a+1}`)),e.cantidad>e.stock&&(s=!0,V("warning",`La cantidad de venta del producto: ${e.nombre} supera su stock disponible`))}),s},z=async s=>{if(ge())return;c.value={...c.value,..._.value,products:f.value,user_id:v.id,tipo:s};let e;s=="EMISION"&&(e="\xBFDeseas emitir factura de esta proforma?"),s=="FACTURA"&&(e="\xBFDeseas generar esta FACTURA?"),s=="PROFORMA"&&(e="\xBFDeseas guardar como PROFORMA?"),Ie.create({title:e,ok:{push:!0,color:"cyan-10",label:"Enviar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{J.show({message:"Cargando..."});let a={headers:{sucursal_id:b.value}};await Q.post("/invoices",c.value,a),J.hide(),V("positive","Venta realizada exitosamente"),ue.push("/ventas")}catch(a){console.log(a),J.hide()}})},pe=()=>{if((v.roles[0]=="Super-Administrador"||v.roles[0]=="Administrador")&&typeof b.value=="undefined")return V("warning","Elige una sucursal primeramente");F("venta")},te=async()=>{k.value=!0;let s={headers:{sucursal_id:b.value}};const{data:e}=await Q.get("/CE/facturas/getNumFactura",s);c.value.numero_comprobante=e.numComprobante,k.value=!1};return ke(()=>{f.value=[]}),v.roles[0]=="Super-Administrador"||v.roles[0]=="Administrador"?de(v.company.id):te(),fe(),(s,e)=>(x(),Y(De,null,[l("div",We,[l("div",Je,[l("div",{class:g(["col-xs-12 col-md-6",[s.$q.screen.width<1022?"q-pt-sm":""]])},[n(be,{class:g(["row q-mr-xs",[s.$q.screen.width<1022?"justify-center q-pt-sm":"justify-start "]])},{default:o(()=>[n(H,{label:"Inicio",icon:"home",to:"/"}),n(H,{label:"Ventas",icon:"payments",to:"/ventas"}),n(H,{label:"Venta/Prof.",icon:"add_circle"})]),_:1},8,["class"])],2),l("div",{class:g(["col-xs-12 col-md-6",[s.$q.screen.width<1022?"text-center q-pt-sm":"text-right"]])},Ze,2)])]),l("div",et,[l("div",{class:g(["col-xs-12 col-md-6 q-pt-xs q-mt-md",s.$q.screen.width>=1023||"text-center"])},[l("label",{class:g(["text-weight-medium",[s.$q.screen.xs?"text-subtitle1":"text-h5"]])},[C("Fecha de Emisi\xF3n: "),l("span",tt,q(i(ie)),1)],2)],2),l("div",{class:g(["col-xs-12 col-md-6",s.$q.screen.width<=1023?"text-center q-pt-sm":"text-right q-pt-xs q-mt-md"])},[l("label",{class:g(["q-mr-lg text-weight-medium",[s.$q.screen.xs?"text-subtitle1":"text-h5"]])},[at,k.value?(x(),B(ze,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(x(),Y("span",st,q(c.value.numero_comprobante),1))],2)],2),l("div",lt,[ot,n(le,{color:"orange",filled:"",modelValue:c.value.customer_id,"onUpdate:modelValue":[e[1]||(e[1]=a=>c.value.customer_id=a),e[2]||(e[2]=a=>y.value.customer_id.isValid=!0)],options:w.value,"emit-value":"","map-options":"",dense:"",error:!y.value.customer_id.isValid,onFilter:ve,"use-input":"","input-debounce":"0"},Be({error:o(()=>[l("label",{class:g(s.$q.dark.isActive?"text-red-4":"text-negative")},q(y.value.customer_id.message),3)]),"no-option":o(()=>[n(E,null,{default:o(()=>[n(L,{class:"text-grey"},{default:o(()=>[C(" No hay resultados ")]),_:1})]),_:1})]),_:2},[c.value.customer_id&&c.value.customer_id!=="CONSUMIDOR FINAL"?{name:"append",fn:o(()=>[n(N,{name:"cancel",onClick:e[0]||(e[0]=Qe(a=>c.value.customer_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","error"])]),i(v).roles[0]=="Super-Administrador"||i(v).roles[0]=="Administrador"?(x(),Y("div",{key:0,class:g(["col-xs-12 col-md-5 q-mt-md",s.$q.screen.width<=1023?"q-pl-none":"offset-1"])},[nt,n(le,{filled:"",modelValue:i(b),"onUpdate:modelValue":[e[3]||(e[3]=a=>G(b)?b.value=a:null),e[4]||(e[4]=a=>(y.value.sucursal_id.isValid=!0,f.value=[]))],error:!y.value.sucursal_id.isValid,options:D.value,"emit-value":"","map-options":"",dense:""},{error:o(()=>[l("label",{class:g(s.$q.dark.isActive?"text-red-4":"text-negative")},q(y.value.sucursal_id.message),3)]),"no-option":o(()=>[n(E,null,{default:o(()=>[n(L,{class:"text-grey"},{default:o(()=>[C(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","error","options"])],2)):K("",!0)]),l("div",rt,[l("div",it,[ut,n(W,{outlined:"","bottom-slots":"",loading:i(h),dense:"",modelValue:i(u),"onUpdate:modelValue":e[6]||(e[6]=a=>G(u)?u.value=a:null),modelModifiers:{trim:!0},onKeyup:$e(pe,["enter"])},{append:o(()=>[i(u)!==""?(x(),B(N,{key:0,name:"close",onClick:e[5]||(e[5]=a=>u.value=""),class:"cursor-pointer"})):K("",!0),n(N,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])])]),n(Fe,{onSubmit:e[10]||(e[10]=a=>z("EMISION"))},{default:o(()=>[l("div",dt,[l("div",ct,[n(Ne,{rows:i(f),columns:i(d),"row-key":"name",class:g([s.$q.dark.isActive?"":"my-sticky-header-table3"]),"hide-pagination":!0,"rows-per-page-options":[50]},{"no-data":o(({})=>[l("div",mt,[ft,n(N,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":o(a=>[n(I,{props:a},{default:o(()=>[n(W,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:A=>i(O)(a.row,"ventas"),min:"0",max:a.row.stock,type:"number",style:{width:"100px"},modelValue:a.row.cantidad,"onUpdate:modelValue":A=>a.row.cantidad=A,modelModifiers:{trim:!0}},null,8,["onChange","max","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-descuento":o(a=>[n(I,{props:a},{default:o(()=>[n(W,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:A=>i(O)(a.row,"ventas"),min:"0",type:"number",style:{width:"100px"},modelValue:a.row.descuento,"onUpdate:modelValue":A=>a.row.descuento=A},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":o(a=>[n(I,{props:a},{default:o(()=>[C(q(a.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":o(a=>[n(I,{props:a},{default:o(()=>[C(" $"+q(a.row.pvp),1)]),_:2},1032,["props"])]),"body-cell-acciones":o(a=>[n(I,{props:a},{default:o(()=>[n($,{round:"",color:"deep-orange",onClick:A=>i(j)(a.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),l("div",vt,[l("table",{class:g([s.$q.screen.xs?"":"linearTablaDetalle"])},[l("tr",gt,[pt,l("td",bt," $"+q(i(_).subtotal),1)]),l("tr",ht,[_t,l("td",wt," $"+q(i(_).descuento),1)]),l("tr",yt,[xt,l("td",qt," $"+q(i(_).subtotal-i(_).descuento),1)]),l("tr",At,[Ct,l("td",St," $"+q(i(_).iva),1)]),l("tr",Vt,[kt,l("td",Bt,[n(Re,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${i(_).total}`},null,8,["label"])])])],2)]),l("div",{class:g(["col-12 flex q-mt-md q-my-lg",[s.$q.screen.width<600?"justify-center":"justify-between"]])},[s.$q.screen.width>600?(x(),B($,{key:0,icon:"arrow_back",onClick:e[7]||(e[7]=a=>s.$router.push("/ventas")),outline:"",rounded:"",class:"q-mr-lg",color:s.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:o(()=>[C(" \xA0 Regresar ")]),_:1},8,["color"])):K("",!0),s.$route.params.venta_id==""?(x(),B(Ke,{key:1,outline:"",rounded:"",style:{color:"#696cff"},label:"Generar",class:g(s.$q.screen.width>=1023?"q-px-xl":"full-width")},{default:o(()=>[n(Te,null,{default:o(()=>[ae((x(),B(E,{clickable:"",onClick:e[8]||(e[8]=a=>z("FACTURA"))},{default:o(()=>[n(L,null,{default:o(()=>[n(se,null,{default:o(()=>[C("FACTURA")]),_:1})]),_:1})]),_:1})),[[oe]]),ae((x(),B(E,{type:"submit",clickable:"",onClick:e[9]||(e[9]=a=>z("PROFORMA"))},{default:o(()=>[n(L,null,{default:o(()=>[n(se,null,{default:o(()=>[C("PROFORMA")]),_:1})]),_:1})]),_:1})),[[oe]])]),_:1})]),_:1},8,["class"])):(x(),B($,{key:2,type:"submit",label:"Emitir Factura",class:g(s.$q.screen.width>=1023?"q-px-xl":"full-width"),outline:"",rounded:"",style:{color:"#696cff"}},null,8,["class"]))],2)])]),_:1}),n(Oe,{modelValue:i(p),"onUpdate:modelValue":e[11]||(e[11]=a=>G(p)?p.value=a:null)},{default:o(()=>[n(Le,{listProductos:i(R),onAgregarProduct:me},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}};export{Yt as default};
