import{n as d,l as W,br as X,bs as Z,d as ee,r as y,u as te,C as ae,o as x,c as Q,e,ah as m,ac as _,ad as c,af as r,ab as T,f as s,bt as se,g as l,h as k,aQ as D,bn as oe,Q as I,aR as O,aj as le,a as re,bo as ne,P as q,i as w,w as ie,aP as de}from"./index.becc66bd.js";import{Q as ce,b as ue}from"./QItemLabel.8aa7a3d0.js";import{Q as me}from"./QSelect.467cdfd1.js";import{Q as pe,a as v,b as ge}from"./QTable.df3e25c9.js";import{Q as fe}from"./QForm.c1623bd2.js";import{api as A}from"./axios.44f0b70d.js";import{u as _e}from"./useHelpers.62c49a13.js";import{d as ve}from"./date.1c6cbe20.js";import{u as he,_ as be}from"./AddCliente.56fccb70.js";import{u as ye,_ as xe}from"./useProduct.5b13728c.js";import{u as we}from"./auth-user.dd663f53.js";import"./QChip.e97fbc5d.js";import"./format.2bc25e5f.js";import"./QList.66169e49.js";import"./use-quasar.0f71ce4b.js";import"./ClosePopup.796684c7.js";import"./QInnerLoading.497845f6.js";const Ce=[d("g",{transform:"translate(20 50)"},[d("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.6"},[d("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),d("g",{transform:"translate(50 50)"},[d("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.8"},[d("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.1s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),d("g",{transform:"translate(80 50)"},[d("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.9"},[d("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.2s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])])];var Se=W({name:"QSpinnerFacebook",props:X,setup(N){const{cSize:p,classes:i}=Z(N);return()=>d("svg",{class:i.value,width:p.value,height:p.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},Ce)}});const Ve={class:"q-ma-lg q-pt-md"},ke={class:"row q-col-gutter-lg"},qe={class:"col-xs-12 col-md-6 text-left"},Ae={class:"text-weight-regular"},Ne=e("span",{class:"q-mr-sm"},"N\xB0 Factura:",-1),Fe={key:1,class:"text-weight-regular"},$e={class:"col-xs-9 col-md-6 q-mt-md"},Qe=e("label",null,"Seleccionar Cliente: ",-1),Te={class:"col-xs-2 col-md-4 q-mt-lg btnAddCliente q-pt-sm q-pl-xs"},De={class:"row q-mt-lg q-mb-xs"},Ie={class:"col-xs-12 col-md-6"},Oe=e("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),Me={class:"row"},Pe={class:"col-12"},Ue={class:"full-width row flex-center text-lime-10 q-gutter-sm"},Be=e("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1),Le={class:"col-12",style:{display:"flex","justify-content":"end"}},ze={class:"text-right"},Ee=e("td",null,[e("b",null,"SUBTOTAL:")],-1),Re={style:{width:"90px"},class:"text-subtitle1 text-weight-regular"},Ye={class:"text-right"},je=e("td",{class:"q-py-sm"},[e("b",null,"IVA(12%):")],-1),Ke={style:{width:"90px"},class:"q-py-sm text-subtitle1 text-weight-regular"},Ge={class:"text-right"},He=e("td",{class:"q-py-sm"},[e("b",null,"TOTAL DESCUENTO:")],-1),Je={style:{width:"90px"},class:"q-py-sm text-subtitle1 text-weight-regular"},We={class:"text-right"},Xe=e("td",null,[e("b",null,"TOTAL DE VENTA:")],-1),Ze={style:{width:"90px"}},vt=ee({__name:"AddVenta",setup(N){let p=[];const i=y([]),h=y(!1),C=y(!1),M=Date.now();let P=ve.formatDate(M,"DD/MM/YYYY");const{mostrarNotify:S}=_e(),{filterByCodBarra:g,columns:F,rows:V,modalSelectProducto:b,loadingState:U,listProductos:B,valorFactura:f,agregarAndValidarStock:L,filterArticulo:z,getSubtotalByProduct:E,quitarArticulo:R}=ye();let{actualizarLista:Y}=he();F.value[7]={name:"pvp",label:"Precio de Venta",align:"center"};const n=y({customer_id:"0fa3a37d-310e-4d3b-a304-c0cd8e58f7ac",numero_comprobante:"",products:[],user_id:""}),j=te(),K=o=>{L(o,"venta"),b.value=!1};ae(Y,(o,a)=>{o&&$()});const $=async()=>{h.value=!1;try{const{data:o}=await A.get("/customers");i.value=[],o.forEach(a=>{a.nombres!="CONSUMIDOR FINAL"&&i.value.push({label:a.nombres,value:a.id,num_doc:a.numero_documento})}),i.value.push({label:"CONSUMIDOR FINAL",value:"0fa3a37d-310e-4d3b-a304-c0cd8e58f7ac",cedula:"0"}),p=i.value}catch(o){console.log(o)}},G=async()=>{if(n.value.customer_id=="")return S("warning","Debes elegir alg\xFAn cliente");if(V.value.length==0)return S("warning","Debes agregar algun producto..");const o=we(),{claim:a}=re.read(o.token);n.value={...n.value,...f.value,products:V.value,user_id:a.id};try{ne.create({title:"\xBFDeseas Generar esta venta?",ok:{push:!0,label:"Agregar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{q.show({message:"Cargando..."}),await A.post("/invoices",n.value),q.hide(),S("positive","Compra realizada exitosamente"),j.push("/ventas")})}catch(t){console.log(t),q.hide()}},H=async()=>{C.value=!0;const{data:o}=await A.get("/CE/facturas/getNumFactura");n.value.numero_comprobante=o.numComprobante,C.value=!1};$(),H();const J=(o="",a)=>{if(o==="")return a(()=>{i.value=p});a(()=>{const t=o.toLowerCase();i.value=i.value.filter(u=>u.num_doc.indexOf(t)>-1||u.label.toLowerCase().indexOf(t)>-1)})};return(o,a)=>(x(),Q(le,null,[e("div",Ve,[e("div",ke,[e("div",qe,[e("label",{class:m(["text-weight-medium",[o.$q.screen.xs?"text-h6":"text-h5"]])},[_("Fecha de Emisi\xF3n: "),e("span",Ae,c(r(P)),1)],2)]),e("div",{class:m(["col-xs-12 col-md-6",[o.$q.screen.xs?"text-left":"text-right"]])},[e("label",{class:m(["q-mr-lg text-weight-medium",[o.$q.screen.xs?"text-h6":"text-h5"]])},[Ne,C.value?(x(),T(Se,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(x(),Q("span",Fe,c(n.value.numero_comprobante),1))],2)],2),e("div",$e,[Qe,s(me,{color:"orange",filled:"",modelValue:n.value.customer_id,"onUpdate:modelValue":a[1]||(a[1]=t=>n.value.customer_id=t),options:i.value,"emit-value":"","map-options":"",dense:"",onFilter:J,"use-input":"","input-debounce":"0"},se({"no-option":l(()=>[s(ce,null,{default:l(()=>[s(ue,{class:"text-grey"},{default:l(()=>[_(" No hay resultados ")]),_:1})]),_:1})]),_:2},[n.value.customer_id&&n.value.customer_id!=="CONSUMIDOR FINAL"?{name:"append",fn:l(()=>[s(w,{name:"cancel",onClick:a[0]||(a[0]=ie(t=>n.value.customer_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"])]),e("div",Te,[s(k,{round:"",color:"primary",size:"13px",style:{"margin-top":"5px"},onClick:a[2]||(a[2]=t=>h.value=!0),icon:"person_add"})])]),e("div",De,[e("div",Ie,[Oe,s(I,{outlined:"","bottom-slots":"",loading:r(U),dense:"",modelValue:r(g),"onUpdate:modelValue":a[4]||(a[4]=t=>D(g)?g.value=t:null),modelModifiers:{trim:!0},onKeyup:a[5]||(a[5]=oe(t=>r(z)("venta"),["enter"]))},{append:l(()=>[r(g)!==""?(x(),T(w,{key:0,name:"close",onClick:a[3]||(a[3]=t=>g.value=""),class:"cursor-pointer"})):de("",!0),s(w,{name:"search"})]),_:1},8,["loading","modelValue"])])]),s(fe,{onSubmit:G},{default:l(()=>[e("div",Me,[e("div",Pe,[s(pe,{rows:r(V),columns:r(F),"row-key":"name",class:m([o.$q.dark.isActive?"":"my-sticky-header-table3"]),"hide-pagination":!0,"rows-per-page-options":[50]},{"no-data":l(({})=>[e("div",Ue,[Be,s(w,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":l(t=>[s(v,{props:t},{default:l(()=>[s(I,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:u=>r(E)(t.row,"ventas"),min:"0",type:"number",style:{width:"100px"},modelValue:t.row.cantidad,"onUpdate:modelValue":u=>t.row.cantidad=u,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":l(t=>[s(v,{props:t},{default:l(()=>[_(c(t.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-descuento":l(t=>[s(v,{props:t},{default:l(()=>[_(c(t.row.descuento)+"% ",1)]),_:2},1032,["props"])]),"body-cell-pvp":l(t=>[s(v,{props:t},{default:l(()=>[_(" $"+c(t.row.pvp),1)]),_:2},1032,["props"])]),"body-cell-acciones":l(t=>[s(v,{props:t},{default:l(()=>[s(k,{round:"",color:"deep-orange",onClick:u=>r(R)(t.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),e("div",Le,[e("table",{class:m([o.$q.screen.xs?"":"linearTablaDetalle"])},[e("tr",ze,[Ee,e("td",Re," $"+c(r(f).subtotal),1)]),e("tr",Ye,[je,e("td",Ke," $"+c(r(f).iva),1)]),e("tr",Ge,[He,e("td",Je," $"+c(r(f).descuento),1)]),e("tr",We,[Xe,e("td",Ze,[s(ge,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${r(f).total}`},null,8,["label"])])])],2)]),e("div",{class:m(["col-md-4 offset-4",[o.$q.screen.xs?"q-mt-md":""]])},[s(k,{square:"",color:"green-10",type:"submit",label:"Agregar Venta",class:"full-width",icon:"shopping_cart"})],2)])]),_:1})]),s(O,{modelValue:h.value,"onUpdate:modelValue":a[6]||(a[6]=t=>h.value=t)},{default:l(()=>[s(be)]),_:1},8,["modelValue"]),s(O,{modelValue:r(b),"onUpdate:modelValue":a[7]||(a[7]=t=>D(b)?b.value=t:null)},{default:l(()=>[s(xe,{listProductos:r(B),onAgregarProduct:K},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}});export{vt as default};
