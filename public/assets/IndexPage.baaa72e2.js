import{Q as X,a as F,b as H}from"./QTable.7fcf9738.js";import{Q as Y,a as q}from"./QTooltip.eebfcb15.js";import{r as m,C as G,o as s,a9 as n,g as o,f as a,aV as P,e as c,aa as f,O as T,h as i,ah as Z,i as D,aU as B,v as J,c as Q,aY as K,ad as S,af as w,aj as I,ai as W,Q as ee,aZ as le,ab as z,bz as oe}from"./index.7acef9a6.js";import{Q as U}from"./QBadge.4e6bc3c4.js";import{Q as ae}from"./QPageSticky.07d80fd0.js";import{C as j}from"./ClosePopup.01114e94.js";import{u as M}from"./useHelpers.5242f772.js";import{Q as te}from"./QSelect.520b4c98.js";import{Q as se}from"./QFile.2aec0b60.js";import"./QList.363f54d0.js";import"./format.b7cf0653.js";import"./use-quasar.c0f2ab40.js";import"./axios.870a43e3.js";const re={class:"text-h6 text-center"},ne={class:"row justify-center"},ie={class:"col-xs-12 col-md-7 justify-center q-my-md"},ce=c("label",{class:"text-center",style:{display:"block"}}," Router: ",-1),de={class:"col-xs-12 col-md-7 justify-center q-my-md"},ue=c("label",{class:"text-center",style:{display:"block"}}," Subir archivo excel: ",-1),me={__name:"ModalImportarClientes",props:["router_selected"],setup(N){const A=N,{api:k,claim:v}=M(),y=m([]),b=m(""),_=m(null),h=m(!1),x=async()=>{const{data:d}=await k.get(`/router/find/${v.company.id}`);y.value=[],d.forEach((u,p)=>{y.value.push({label:u.nombre,value:u.id})}),b.value=A.router_selected};G(()=>{const d=document.createElement("script");d.src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js",d.async=!0,document.head.appendChild(d)});const C=()=>{_.value==null&&(h.value=!0);const d=new FileReader;d.onload=function(u){const p=u.target.result,$=XLSX.read(p,{type:"binary"}),V=$.SheetNames[0],E=XLSX.utils.sheet_to_json($.Sheets[V]);console.log(E[2].__EMPTY_11)},d.readAsBinaryString(_.value)};return x(),(d,u)=>(s(),n(B,{style:{width:"1000px","max-width":"70vw"}},{default:o(()=>[a(P,{class:"q-py-sm"},{default:o(()=>[c("div",re,[f(" Importar Clientes "),T(a(i,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[j]])])]),_:1}),a(Z,{inset:""}),a(P,{class:"q-pa-none",id:"box-map"},{default:o(()=>[c("div",ne,[c("div",ie,[ce,a(te,{dense:"",modelValue:b.value,"onUpdate:modelValue":u[0]||(u[0]=p=>b.value=p),modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",options:y.value},null,8,["modelValue","options"])]),c("div",de,[ue,a(se,{filled:"",dense:"",modelValue:_.value,"onUpdate:modelValue":u[1]||(u[1]=p=>_.value=p),"error-message":"Debes agregar el archivo excel",error:!h.value,accept:".xls, .xlsx"},{prepend:o(()=>[a(D,{name:"fa-solid fa-file-excel"})]),_:1},8,["modelValue","error"])]),c("div",{onClick:C,class:"col-xs-12 col-md-7 text-center q-my-md"},[a(i,{id:"btn-coordenadas",color:"teal-10","icon-right":"group"},{default:o(()=>[f(" Cargar Clientes \xA0 ")]),_:1})])])]),_:1})]),_:1}))}},pe={class:"q-ma-lg q-pt-md"},ge={class:"row q-col-gutter-lg"},fe={class:"col-12"},ve={class:"full-width row flex-center text-lime-10 q-gutter-sm"},ye=c("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1),De={__name:"IndexPage",setup(N){const A=[{name:"acciones",label:"acciones",align:"center"},{align:"center",label:"Nombre Router",field:"nombre",name:"nombre"},{align:"center",label:"IP/Host",field:"ip_host",name:"ip_host"},{align:"center",label:"Empresa",field:"empresa_name",name:"empresa_name"},{name:"estado",label:"Estado",align:"center",field:"estado"}],k=m(""),v=m([]),y=m(!1),b=m(!1),_=m(""),{api:h,claim:x,mostrarNotify:C,confirmDelete:d,isDeleted:u}=M(),p=async()=>{y.value=!0;try{const{data:t}=await h.get("/router");t.forEach(l=>{l.empresa_name=l.company_id.nombre_comercial,l.estado=l.isActive?"Activo":"Inactivo",l.loading=!1}),v.value=t}catch(t){C("warning",t.response.data.message)}y.value=!1},$=async(t,l)=>{try{const{data:{msg:e}}=await h.patch(`/router/${t}/${l}`);C("positive",e),p()}catch(e){console.log(e)}};J(u,(t,l)=>{t&&p()});const V=async t=>{try{d("Estas seguro de eliminar este router?",`/router/${t}`)}catch(l){console.log(l)}},E=async t=>{oe.create({title:"Confirmar",message:"\xBFDeseas reescribir los clientes existente al mickrotik?",ok:{push:!0,label:"SI",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{await h.post(`/mikrotik/reparar-router/${t}`),C("warning","Clientes agregados exitosamente")}catch(l){typeof l.response.data.message=="object"&&l.response.data.message.unshift("No pudo agregar los siguientes clientes porque ya existen:"),C("warning",l.response.data.message)}})},L=async(t,l)=>{try{v.value[l].loading=!0;const e=await h.post(`/mikrotik/download-clients-excel/${t}`,{},{responseType:"arraybuffer"}),r=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),R=document.createElement("a");R.href=window.URL.createObjectURL(r),R.download="ejemplo.xlsx",document.body.appendChild(R),R.click(),document.body.removeChild(R),v.value[l].loading=!1}catch(e){console.log(e),v.value[l].loading=!1}};p();const g=m("list"),O=m({rowsPerPage:10});return(t,l)=>(s(),Q(I,null,[c("div",pe,[c("div",ge,[c("div",fe,[a(B,{flat:"",class:"shadow_custom"},{default:o(()=>[a(X,{"title-class":"text-grey-7 text-h6",title:"Listado de Routers",rows:v.value,loading:y.value,"hide-header":g.value==="grid",columns:A,"row-key":"name",grid:g.value==="grid",filter:k.value,pagination:O.value},{header:o(e=>[a(Y,{props:e,style:{height:"60px"}},{default:o(()=>[(s(!0),Q(I,null,W(e.cols,r=>(s(),n(H,{key:r.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:o(()=>[f(z(r.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-right":o(e=>[!t.$q.screen.xs&&S(x).roles[0]=="SUPER-ADMINISTRADOR"?(s(),n(i,{key:0,onClick:l[0]||(l[0]=r=>t.$router.push({name:"router.add"})),outline:"",color:"primary",label:"Agregar Router",class:"q-mr-xs"})):w("",!0),a(ee,{style:le(t.$q.screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=r=>k.value=r),placeholder:"Buscar..."},{append:o(()=>[a(D,{name:"search"})]),_:1},8,["style","modelValue"]),g.value==="list"?(s(),n(i,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:o(()=>[T((s(),n(q,{disable:t.$q.platform.is.mobile},{default:o(()=>[f(z(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[j]])]),_:2},1032,["icon","onClick"])):w("",!0),e.inFullscreen?w("",!0):(s(),n(i,{key:2,flat:"",round:"",dense:"",icon:g.value==="grid"?"list":"grid_on",onClick:l[2]||(l[2]=r=>{g.value=g.value==="grid"?"list":"grid",t.separator=g.value==="grid"?"none":"horizontal"})},{default:o(()=>[T((s(),n(q,{disable:t.$q.platform.is.mobile},{default:o(()=>[f(z(g.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[j]])]),_:1},8,["icon"]))]),"body-cell-estado":o(e=>[a(F,{props:e},{default:o(()=>[e.row.isActive?(s(),n(U,{key:0,outline:"",color:"positive",label:"Activo",class:"q-pa-sm"})):(s(),n(U,{key:1,outline:"",color:"red",label:"Inactivo",class:"q-pa-sm"}))]),_:2},1032,["props"])]),"body-cell-acciones":o(e=>[a(F,{props:e},{default:o(()=>[e.row.isActive?(s(),Q(I,{key:0},[a(i,{round:"",color:"blue-grey",onClick:r=>t.$router.push({name:"router.edit",params:{router_id:e.row.id}}),icon:"edit",class:"q-mr-sm",size:"10px"},null,8,["onClick"]),a(i,{onClick:r=>E(e.row.id),round:"",color:"blue-grey",icon:"fa-solid fa-gears",class:"q-mr-sm",size:"10px"},{default:o(()=>[a(q,{class:"bg-indigo",anchor:"top middle",self:"center middle"},{default:o(()=>[f(" Reparar router ")]),_:1})]),_:2},1032,["onClick"]),a(i,{onClick:r=>L(e.row.id,e.rowIndex),loading:e.row.loading,round:"",color:"blue-grey",icon:"fa-solid fa-file-excel",class:"q-mr-sm",size:"10px"},{default:o(()=>[a(q,{class:"bg-indigo",anchor:"top middle",self:"center middle"},{default:o(()=>[f(" Descargar plantilla clientes ")]),_:1})]),_:2},1032,["onClick","loading"]),a(i,{onClick:r=>(b.value=!0,_.value=e.row.id),loading:e.row.loading,round:"",color:"blue-grey",icon:"upload",class:"q-mr-sm",size:"10px"},{default:o(()=>[a(q,{class:"bg-indigo",anchor:"top middle",self:"center middle"},{default:o(()=>[f(" Importar Clientes ")]),_:1})]),_:2},1032,["onClick","loading"]),e.row.isActive&&S(x).roles[0]=="SUPER-ADMINISTRADOR"?(s(),n(i,{key:0,round:"",color:"blue-grey",icon:"close",onClick:r=>$(e.row.id,!1),size:"10px"},null,8,["onClick"])):w("",!0)],64)):(s(),Q(I,{key:1},[e.row.isActive?w("",!0):(s(),n(i,{key:0,round:"",color:"blue-grey",icon:"done",onClick:r=>$(e.row.id,!0),size:"10px"},null,8,["onClick"])),!e.row.isActive&&S(x).roles[0]=="SUPER-ADMINISTRADOR"?(s(),n(i,{key:1,round:"",color:"blue-grey",class:"q-ml-sm",icon:"delete",onClick:r=>V(e.row.id),size:"10px"},null,8,["onClick"])):w("",!0)],64))]),_:2},1032,["props"])]),"no-data":o(({icon:e})=>[c("div",ve,[a(D,{size:"2em",name:"sentiment_dissatisfied"}),ye,a(D,{size:"2em",name:k.value?"filter_b_and_w":e},null,8,["name"])])]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),a(K,{modelValue:b.value,"onUpdate:modelValue":l[3]||(l[3]=e=>b.value=e)},{default:o(()=>[a(me,{router_selected:_.value},null,8,["router_selected"])]),_:1},8,["modelValue"]),t.$q.screen.xs&&S(x).roles[0]=="SUPER-ADMINISTRADOR"?(s(),n(ae,{key:0,position:"bottom-right",offset:[18,18]},{default:o(()=>[a(i,{round:"",color:"secondary",size:"lg",icon:"add",onClick:l[4]||(l[4]=e=>t.$router.push({name:"router.add"}))})]),_:1})):w("",!0)],64))}};export{De as default};
