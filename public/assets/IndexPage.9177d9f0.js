import{d as X,r as d,v as U,o as i,c as q,e as t,ae as h,ad as r,f as s,g as a,Q as R,aU as Z,a9 as m,af as p,ba as ee,aj as F,i as w,O as D,h as y,ai as le,bc as z,aa as I,ab as N,bb as ae}from"./index.be94c587.js";import{Q as B}from"./QDate.d53ff7a4.js";import{Q as E}from"./QPopupProxy.5435ca16.js";import{Q as se}from"./QInnerLoading.7ed58150.js";import{Q as oe,a as te}from"./QTable.d584c9f0.js";import{Q as re,a as M}from"./QTooltip.89cd7b96.js";import{Q as j}from"./QSelect.89a77a4e.js";import{Q as ne}from"./QBadge.72a11161.js";import{Q as L}from"./QTd.61f93a27.js";import{Q as ie}from"./QPageSticky.7a648adf.js";import{C as A}from"./ClosePopup.f4cd24aa.js";import{u as ue}from"./useRolPermisos.32f3e484.js";import{u as de}from"./useHelpers.c4c84032.js";import{a as ce}from"./use-quasar.f35fd550.js";import{d as me}from"./date.ae726c3a.js";import{_ as pe}from"./DetalleProducts.dff0ef66.js";import"./format.bd326351.js";import"./QList.55daf97a.js";import"./axios.ab9f230c.js";import"./QBtnDropdown.3f0504ed.js";import"./QBtnGroup.a8fde2d6.js";const ve={class:"q-ma-lg q-pt-md"},fe={class:"row q-col-gutter-lg"},ge={class:"col-xs-12 col-sm-3"},be={class:"q-mr-sm row q-pt-sm justify-center"},ye={class:"col-xs-10 col-sm-4"},_e={class:"row items-center justify-end"},xe={class:"col-xs-12 col-sm-1 flex flex-center"},he={class:"col-xs-10 col-sm-4"},we={class:"row items-center justify-end"},ke={class:"col-12 q-pt-xs"},Ce={key:0,class:"text-center row justify-center",style:{width:"100%"}},Ve=t("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Compras ",-1),Qe=[Ve],qe=t("label",{class:"q-mr-sm row items-center"},[t("span",null,"Tipo: ")],-1),De=t("label",{class:"q-mx-sm row items-center"},[t("span",null,"Sucursal: ")],-1),Ae=t("div",{class:"full-width row flex-center text-lime-10 q-gutter-sm"},[t("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun resultado ")],-1),Xe=X({__name:"IndexPage",setup(Se){const Y=[{name:"acciones",label:"acciones",align:"center"},{name:"sucursal",label:"Sucursal",align:"center",field:"sucursal_name"},{name:"num_comprobante",label:"Num Comprobante",field:"numero_comprobante",align:"center"},{name:"usuario",label:"Usuario",align:"center",field:"user_name"},{name:"proveedor",label:"Proveedor",align:"center",field:"proveedor_name"},{name:"fecha",label:"Fecha Compra",align:"center",field:"fecha_compra"},{name:"total",label:"Total",field:"total",align:"center"},{name:"estado",label:"Estado",field:"estado",align:"center"}],O=d([]),S=d(!1);let k=d({});const v=d(""),f=d(""),C=d("TODOS");d({desde:"",hasta:"",pv_id:""});const V=d(""),{validarPermisos:T}=ue(),{api:$,claim:g,mostrarNotify:P,route:H}=de(),n=ce(),_=d(!1),Q=d(""),x=d([]);U(C,(o,l)=>{c()});const G=()=>{const{fecha:o}=H.params;o!=""&&(v.value=o.split(" - ")[0].replace(/-/g,"/"),f.value=o.split(" - ")[1].replace(/-/g,"/"))},c=async()=>{try{_.value=!0,x.value.length==0&&await K();let o={headers:{"company-id":g.company.id,"sucursal-id":Q.value,desde:v.value,hasta:f.value,tipo:C.value}};const{data:l}=await $.get("/buys",o);l.map(e=>{e.fecha_compra=me.formatDate(e.created_at,"DD/MM/YYYY"),e.sucursal_name=e.sucursal_id.nombre,e.proveedor_name=e.proveedor_id.razon_social,e.user_name=e.user_id.fullName,e.total=`${e.total}`}),O.value=l,_.value=!1}catch(o){console.log(o),_.value=!1}},J=o=>{n.dialog({title:"<center>\xBFEstas seguro de anular esta compra?</center>",message:`<span><strong>Num Comprobante</strong>: ${o.numero_comprobante}</span> <br>
              <span class='q-my-lg'><strong>Proveedor</strong>: ${o.proveedor_name}</span> <br>
              <span class='q-my-lg'><strong>Fecha/Hora</strong>: ${o.fecha_compra}</span> <br>
              <span><strong>Total</strong>: ${o.total}</span> <br>`,html:!0,ok:{push:!0,label:"Anular",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{n.loading.show({message:"Cargando..."}),await $.delete(`/buys/${o.id}`),P("positive","Compra Anulada exitosamente"),c(),n.loading.hide()}catch(l){console.log(l)}})},K=async()=>{_.value=!0;try{const{data:o}=await $.get(`/sucursal/find/${g.company.id}/company`);o.forEach(l=>{x.value.push({label:l.nombre,value:l.id})}),(g.roles[0]=="SUPER-ADMINISTRADOR"||g.roles[0]=="ADMINISTRADOR")&&x.value.unshift({label:"TODOS",value:null}),x.value.length!==0&&(Q.value=x.value[0].value)}catch(o){P("warning",o.response.data.message)}_.value=!1};G(),c(),U(V,(o,l)=>{c()});const b=d("list"),W=d({rowsPerPage:10});return(o,l)=>(i(),q(F,null,[t("div",ve,[t("div",fe,[t("div",{class:h(["q-mb-md q-mt-none",[r(n).screen.xs?"q-mb-md q-pt-sm":"q-ml-lg q-pl-none"]]),style:{display:"flex"}},[t("div",{class:h(["row",[r(n).screen.xs?"flex-center":""]])},[t("div",ge,[t("label",be,[t("span",{class:h([r(n).screen.xs?"text-weight-bold":""])}," Filtrar por fecha: ",2)])]),t("div",ye,[s(R,{outlined:"",dense:"",modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=e=>v.value=e),mask:"date"},{append:a(()=>[v.value!==""?(i(),m(w,{key:0,name:"close",onClick:l[0]||(l[0]=e=>(v.value="",c())),class:"cursor-pointer"})):p("",!0),s(w,{name:"event",class:"cursor-pointer"},{default:a(()=>[s(E,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[s(B,{modelValue:v.value,"onUpdate:modelValue":[l[1]||(l[1]=e=>v.value=e),c]},{default:a(()=>[t("div",_e,[D(s(y,{label:"Close",color:"primary",flat:""},null,512),[[A]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",xe,[t("label",{class:h(["q-mx-md",[r(n).screen.xs?"text-weight-medium":""]])}," Hasta ",2)]),t("div",he,[s(R,{outlined:"",dense:"",modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=e=>f.value=e),mask:"date"},{append:a(()=>[f.value!==""?(i(),m(w,{key:0,name:"close",onClick:l[3]||(l[3]=e=>(f.value="",c())),class:"cursor-pointer"})):p("",!0),s(w,{name:"event",class:"cursor-pointer"},{default:a(()=>[s(E,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[s(B,{modelValue:f.value,"onUpdate:modelValue":[l[4]||(l[4]=e=>f.value=e),c]},{default:a(()=>[t("div",we,[D(s(y,{onClick:c,label:"Close",color:"primary",flat:""},null,512),[[A]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])],2)],2),t("div",ke,[s(Z,{flat:"",class:"shadow_custom"},{default:a(()=>[s(oe,{"title-class":"text-grey-7 text-h6",rows:O.value,loading:_.value,"hide-header":b.value==="grid",columns:Y,"row-key":"name",grid:b.value==="grid",filter:V.value,pagination:W.value},{loading:a(()=>[s(se,{showing:"",color:"primary"})]),header:a(e=>[s(re,{props:e,style:{height:"60px"}},{default:a(()=>[(i(!0),q(F,null,le(e.cols,u=>(i(),m(te,{key:u.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:a(()=>[I(N(u.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":a(e=>[r(g).roles[0]!=="SUPER-ADMINISTRADOR"&&r(g).roles[0]!=="ADMINISTRADOR"?(i(),q("div",Ce,Qe)):p("",!0),t("div",{style:z([{display:"flex"},!r(n).screen.xs||"width: 100%;justify-content: center;position: relative;right: 8px;"]),class:h([r(n).screen.xs?"q-mb-md":""])},[qe,s(j,{outlined:"",dense:"",modelValue:C.value,"onUpdate:modelValue":l[6]||(l[6]=u=>C.value=u),"emit-value":"","map-options":"",options:[{label:"Todos",value:"TODOS"},{label:"Aceptados",value:"Aceptados"},{label:"Anulados",value:"Anulados"}]},null,8,["modelValue"])],6),r(g).roles[0]=="SUPER-ADMINISTRADOR"||r(g).roles[0]=="ADMINISTRADOR"?(i(),q("div",{key:1,style:{display:"flex"},class:h([r(n).screen.xs?"q-mb-md":""])},[De,s(j,{outlined:"",dense:"",modelValue:Q.value,"onUpdate:modelValue":[l[7]||(l[7]=u=>Q.value=u),l[8]||(l[8]=u=>c())],"emit-value":"","map-options":"",options:x.value},null,8,["modelValue","options"])],2)):p("",!0)]),"top-right":a(e=>[!r(n).screen.xs&&r(T)("crear.compra")?(i(),m(y,{key:0,onClick:l[9]||(l[9]=u=>o.$router.push("/compras/add")),outline:"",color:"primary",label:"Agregar Compra",class:"q-mr-xs"})):p("",!0),s(R,{style:z(r(n).screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:V.value,"onUpdate:modelValue":l[10]||(l[10]=u=>V.value=u),placeholder:"Buscar..."},{append:a(()=>[s(w,{name:"search"})]),_:1},8,["style","modelValue"]),b.value==="list"?(i(),m(y,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:a(()=>[D((i(),m(M,{disable:r(n).platform.is.mobile},{default:a(()=>[I(N(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[A]])]),_:2},1032,["icon","onClick"])):p("",!0),e.inFullscreen?p("",!0):(i(),m(y,{key:2,flat:"",round:"",dense:"",icon:b.value==="grid"?"list":"grid_on",onClick:l[11]||(l[11]=u=>{b.value=b.value==="grid"?"list":"grid",o.separator=b.value==="grid"?"none":"horizontal"})},{default:a(()=>[D((i(),m(M,{disable:r(n).platform.is.mobile},{default:a(()=>[I(N(b.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[A]])]),_:1},8,["icon"]))]),"body-cell-estado":a(e=>[s(L,{props:e},{default:a(()=>[s(ne,{outline:"",class:"q-py-xs q-px-md",color:e.row.isActive?"secondary":"negative",label:e.row.isActive?"Aceptado":"Anulado"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":a(e=>[s(L,{props:e},{default:a(()=>[s(y,{round:"",color:"blue-grey",icon:"visibility",class:"q-mr-sm",onClick:u=>(S.value=!0,ae(k)?k.value={...e.row}:k={...e.row}),size:"10px"},null,8,["onClick"]),e.row.isActive&&r(T)("anular.compra")?(i(),m(y,{key:0,round:"",color:"blue-grey",onClick:u=>J(e.row),icon:"close",size:"10px"},null,8,["onClick"])):p("",!0)]),_:2},1032,["props"])]),"no-data":a(({icon:e})=>[Ae]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),r(n).screen.xs&&r(T)("crear.compra")?(i(),m(ie,{key:0,position:"bottom-right",offset:[18,18]},{default:a(()=>[s(y,{round:"",color:"secondary",size:"lg",icon:"add",onClick:l[12]||(l[12]=e=>o.$router.push("/compras/add"))})]),_:1})):p("",!0),s(ee,{modelValue:S.value,"onUpdate:modelValue":l[13]||(l[13]=e=>S.value=e)},{default:a(()=>[s(pe,{detalleData:r(k)},null,8,["detalleData"])]),_:1},8,["modelValue"])],64))}});export{Xe as default};
