import{Q as se,a as U}from"./QBreadcrumbs.d067d31e.js";import{d as re,r as I,u as ne,v as de,x as ie,o as p,c as w,e as t,ae as u,f as l,g as a,aU as B,ba as F,ad as r,bb as q,aj as ue,by as ce,P as Q,aV as j,h as x,w as me,aa as D,Q as v,i as f,O as pe,af as g,bz as T,a9 as $,bj as ve,ab as S}from"./index.881c7505.js";import{a as z,Q as Y}from"./format.14a0a558.js";import{Q as K}from"./QSelect.767c69a4.js";import{Q as fe}from"./QDate.1fc67c7c.js";import{Q as ge}from"./QPopupProxy.ee13f0f1.js";import{Q as _e,a as V}from"./QTable.583aede7.js";import{Q as be}from"./QBadge.11d13b3a.js";import{Q as ye}from"./QForm.e2a73df0.js";import{C as he}from"./ClosePopup.f1c15012.js";import{a as M}from"./axios.2eda3048.js";import{u as we}from"./useHelpers.8e61de58.js";import{d as L}from"./date.f82140d8.js";import{u as qe,a as xe}from"./AddProveedor.37f32425.js";import{u as De,_ as Ve}from"./SelectProduct.a2a5d381.js";import"./QList.ee2e54b2.js";import"./use-quasar.d73fa91c.js";import"./QInnerLoading.1ce3863c.js";const Ae={class:"q-ma-lg q-pt-md q-mb-none",style:{"margin-bottom":"10px"}},Re={class:"row q-col-gutter-lg"},Ie=t("label",{class:"text-h6 text-center"},"Nueva Compra",-1),$e=[Ie],Se={class:"row q-pt-none q-mx-lg q-col-gutter-md"},Ce={class:"col-xs-12 col-md-5 q-mt-lg q-pl-none"},Pe=t("label",null,"Seleccionar Proveedor: ",-1),ke=t("label",null,"Numero de Comprobante: ",-1),Ue=t("label",null,"Fecha de compra: ",-1),Qe={class:"row items-center justify-end"},Te=t("label",null,"Seleccionar Sucursal: ",-1),Me={key:1,class:"col-xs-12 col-md-5 q-pl-none"},Ne=t("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),Oe=t("label",null,"Descripci\xF3n: ",-1),Ee={key:2,class:"col-xs-12 col-md-5 q-pl-none"},Be=t("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),Fe={class:"col-xs-12 col-md-5"},je=t("label",null,"Filtrar por codigo de barra o nombre del producto: ",-1),ze={class:"col-12"},Ye={class:"full-width row flex-center text-lime-10 q-gutter-sm"},Ke=t("span",{class:"text-subtitle1"}," Agrega alg\xFAn producto ",-1),Le={class:"col-12",style:{display:"flex","justify-content":"end"}},Ge={class:"text-right"},He=t("td",null,[t("b",null,"SUBTOTAL:")],-1),Je={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},We={class:"text-right"},Xe=t("td",null,[t("b",null,"IVA(12%):")],-1),Ze={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},eo={class:"text-right"},oo=t("td",null,[t("b",null,"TOTAL DESCUENTO:")],-1),lo={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},to={class:"text-right"},ao=t("td",null,[t("b",null,"TOTAL DE COMPRA:")],-1),so={style:{width:"50px"}},Ao=re({__name:"AddCompra",setup(ro){const{agregarAndValidarStock:G,claim:d,filterByCodBarra:i,columns:H,rows:b,filterArticulo:J,modalSelectProducto:A,getSubtotalByProduct:N,loadingState:C,listProductos:W,quitarArticulo:X,sucursal_selected:y,valorFactura:h}=De();let{actualizarLista:Z}=qe(),O=[];const _=I([]),R=I(!1),{mostrarNotify:m}=we(),P=I([]),n=I({proveedor_id:"",numero_comprobante:"",descripcion:"",inputDate:L.formatDate(Date.now(),"YYYY/MM/DD")}),ee=ne(),oe=s=>{G(s,"compras"),A.value=!1},le=async s=>{P.value=[];const{data:o}=await M.get(`/sucursal/find/${s}/company`);o.forEach(e=>{P.value.push({label:e.nombre,value:e.id})})};de(Z,(s,o)=>{s&&E()});const E=async()=>{R.value=!1;try{const{data:s}=await M.get("/providers/true");_.value=[],s.forEach(o=>{_.value.push({label:o.razon_social,value:o.id,num_doc:o.numero_documento})}),O=_.value}catch(s){console.log(s)}},te=async()=>{let s=!1;if(n.value.proveedor_id=="")return m("warning","Debes elegir algun proveedor");if(n.value.numero_comprobante=="")return m("warning","Por favor ingresa el numero de comprobante");if(n.value.descripcion=="")return m("warning","Por favor ingresa una descripci\xF3n");if((d.roles[0]=="SUPER-ADMINISTRADOR"||d.roles[0]=="ADMINISTRADOR")&&y.value=="")return m("warning","Debes seleccionar una sucursal");if(b.value.length==0)return m("warning","Debes agregar algun producto..");b.value.forEach((o,e)=>{o.cantidad<=0&&(m("warning",`Agrega una cantidad cantidad al producto: ${o.nombre} de la fila: ${e+1}`),s=!0)}),!s&&(n.value.products=b.value,n.value={...n.value,...h.value,fecha_compra:L.formatDate(n.value.inputDate,"DD/MM/YYYY"),user_id:d.id},ce.create({title:"\xBFDeseas agregar esta compra?",ok:{push:!0,color:"cyan-10",label:"Agregar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{Q.show({message:"Cargando..."});let o={headers:{"sucursal-id":y.value}};await M.post("/buys",n.value,o),Q.hide(),m("positive","Compra realizada exitosamente"),ee.push("/compras")}catch(o){m("warning",o.response.data.message),Q.hide()}}))};(d.roles[0]=="SUPER-ADMINISTRADOR"||d.roles[0]=="ADMINISTRADOR")&&le(d.company.id),E();const ae=(s="",o)=>{if(s==="")return o(()=>{_.value=O});o(()=>{const e=s.toLowerCase();_.value=_.value.filter(c=>c.num_doc.indexOf(e)>-1||c.label.toLowerCase().indexOf(e)>-1)})},k=()=>{if((d.roles[0]=="SUPER-ADMINISTRADOR"||d.roles[0]=="ADMINISTRADOR")&&y.value.length==0)return m("warning","Elige una sucursal primeramente");J("compras")};return ie(()=>{b.value=[]}),(s,o)=>(p(),w(ue,null,[t("div",Ae,[t("div",Re,[t("div",{class:u(["col-xs-12 col-md-6",[s.$q.screen.width<1022?"q-pt-sm":""]])},[l(se,{class:u(["row q-mr-xs",[s.$q.screen.width<1022?"justify-center q-pt-sm":"justify-start "]])},{default:a(()=>[l(U,{label:"Inicio",icon:"home",to:"/"}),l(U,{label:"Compras",icon:"shopping_cart",to:"/compras"}),l(U,{label:"Agregar Compra",icon:"add_circle"})]),_:1},8,["class"])],2),t("div",{class:u(["col-xs-12 col-md-6",[s.$q.screen.width<1022?"text-center q-pt-sm":"text-right"]])},$e,2)])]),l(B,{class:"q-mt-none q-mx-lg"},{default:a(()=>[l(j,{class:"q-pt-none row"},{default:a(()=>[t("div",Se,[t("div",Ce,[Pe,l(K,{color:"orange",filled:"",modelValue:n.value.proveedor_id,"onUpdate:modelValue":o[1]||(o[1]=e=>n.value.proveedor_id=e),dense:"",options:_.value,"emit-value":"","map-options":"",onFilter:ae,"use-input":"","input-debounce":"0"},{append:a(()=>[l(x,{round:"",dense:"",flat:"",icon:"person_add",onClick:o[0]||(o[0]=me(e=>R.value=!0,["stop","prevent"]))})]),"no-option":a(()=>[l(z,null,{default:a(()=>[l(Y,{class:"text-grey"},{default:a(()=>[D(" No hay resultados ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),t("div",{class:u(["col-xs-12 col-md-3",s.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[ke,l(v,{modelValue:n.value.numero_comprobante,"onUpdate:modelValue":o[2]||(o[2]=e=>n.value.numero_comprobante=e),"input-style":{textAlign:"center",fontSize:"16px"},filled:"",mask:"###-###-#########","fill-mask":"",dense:"",required:""},null,8,["modelValue"])],2),t("div",{class:u(["col-xs-12 col-md-4",s.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[Ue,l(v,{filled:"",dense:"",modelValue:n.value.inputDate,"onUpdate:modelValue":o[4]||(o[4]=e=>n.value.inputDate=e),"input-style":{textAlign:"center"},mask:"date",rules:["date"]},{append:a(()=>[l(f,{name:"event",class:"cursor-pointer"},{default:a(()=>[l(ge,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(fe,{modelValue:n.value.inputDate,"onUpdate:modelValue":o[3]||(o[3]=e=>n.value.inputDate=e)},{default:a(()=>[t("div",Qe,[pe(l(x,{label:"Close",color:"primary",flat:""},null,512),[[he]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],2),r(d).roles[0]=="SUPER-ADMINISTRADOR"||r(d).roles[0]=="ADMINISTRADOR"?(p(),w("div",{key:0,class:u(["col-xs-12 col-md-5 q-ml-none q-pl-none",s.$q.screen.width>=1023||"q-pt-none"])},[Te,l(K,{filled:"",modelValue:r(y),"onUpdate:modelValue":[o[5]||(o[5]=e=>q(y)?y.value=e:null),o[6]||(o[6]=e=>b.value=[])],options:P.value,"emit-value":"","map-options":"",dense:""},{"no-option":a(()=>[l(z,null,{default:a(()=>[l(Y,{class:"text-grey"},{default:a(()=>[D(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])],2)):g("",!0),r(d).roles[0]!=="SUPER-ADMINISTRADOR"&&r(d).roles[0]!=="ADMINISTRADOR"&&s.$q.screen.width>=1023?(p(),w("div",Me,[Ne,l(v,{outlined:"","bottom-slots":"",loading:r(C),dense:"",modelValue:r(i),"onUpdate:modelValue":o[8]||(o[8]=e=>q(i)?i.value=e:null),modelModifiers:{trim:!0},onKeyup:T(k,["enter"])},{append:a(()=>[r(i)!==""?(p(),$(f,{key:0,name:"close",onClick:o[7]||(o[7]=e=>i.value=""),class:"cursor-pointer"})):g("",!0),l(f,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])])):g("",!0),t("div",{class:u(["col-xs-12 col-sm-12 col-md-7",s.$q.screen.width<=1023?"q-pl-none q-pt-sm":"q-pt-md"])},[Oe,l(v,{modelValue:n.value.descripcion,"onUpdate:modelValue":o[9]||(o[9]=e=>n.value.descripcion=e),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])],2),r(d).roles[0]=="SUPER-ADMINISTRADOR"||r(d).roles[0]=="ADMINISTRADOR"?(p(),w("div",Ee,[Be,l(v,{outlined:"","bottom-slots":"",loading:r(C),dense:"",modelValue:r(i),"onUpdate:modelValue":o[11]||(o[11]=e=>q(i)?i.value=e:null),modelModifiers:{trim:!0},onKeyup:T(k,["enter"])},{append:a(()=>[r(i)!==""?(p(),$(f,{key:0,name:"close",onClick:o[10]||(o[10]=e=>i.value=""),class:"cursor-pointer"})):g("",!0),l(f,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])])):g("",!0)]),r(d).roles[0]!=="SUPER-ADMINISTRADOR"&&r(d).roles[0]!=="ADMINISTRADOR"&&s.$q.screen.width<=1023?(p(),w("div",{key:0,class:u(["row q-pt-lg q-mx-lg",[s.$q.screen.width<=1023?"justify-center":"justify-left q-ml-md"]])},[t("div",Fe,[je,l(v,{outlined:"","bottom-slots":"",loading:r(C),dense:"",modelValue:r(i),"onUpdate:modelValue":o[13]||(o[13]=e=>q(i)?i.value=e:null),modelModifiers:{trim:!0},onKeyup:T(k,["enter"])},{append:a(()=>[r(i)!==""?(p(),$(f,{key:0,name:"close",onClick:o[12]||(o[12]=e=>i.value=""),class:"cursor-pointer"})):g("",!0),l(f,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])])],2)):g("",!0)]),_:1})]),_:1}),l(ye,{onSubmit:te},{default:a(()=>[t("div",{class:u(["q-mx-lg justify-center",s.$q.screen.xs?"q-mt-lg":"q-mt-md"])},[t("div",ze,[l(_e,{rows:r(b),columns:r(H),"row-key":"name","hide-pagination":!0,"rows-per-page-options":[50],class:u([s.$q.dark.isActive?"":"my-sticky-header-table3"])},{"no-data":a(({})=>[t("div",Ye,[Ke,l(f,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":a(e=>[l(V,{props:e},{default:a(()=>[l(v,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:c=>r(N)(e.row),min:"0",type:"number",style:{width:"100px"},modelValue:e.row.cantidad,"onUpdate:modelValue":c=>e.row.cantidad=c,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":a(e=>[l(V,{props:e},{default:a(()=>[l(ve,{modelValue:e.row.aplicaIva,"onUpdate:modelValue":c=>e.row.aplicaIva=c},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-descuento":a(e=>[l(V,{props:e},{default:a(()=>[l(v,{"input-class":"resaltarTextoInput",dense:"",required:"",min:"0",onChange:c=>r(N)(e.row),type:"number",style:{width:"100px"},modelValue:e.row.descuento,"onUpdate:modelValue":c=>e.row.descuento=c,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-pvm":a(e=>[l(V,{props:e},{default:a(()=>[D(" $"+S(e.row.precio_compra),1)]),_:2},1032,["props"])]),"body-cell-acciones":a(e=>[l(V,{props:e},{default:a(()=>[l(x,{round:"",color:"deep-orange",onClick:c=>r(X)(e.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),l(B,{class:"q-mt-md"},{default:a(()=>[l(j,{class:"q-pt-none row"},{default:a(()=>[t("div",Le,[t("table",{class:u([s.$q.screen.xs?"q-pt-sm":"linearTablaDetalle"])},[t("tr",Ge,[He,t("td",Je," $"+S(r(h).subtotal),1)]),t("tr",We,[Xe,t("td",Ze," $"+S(r(h).iva),1)]),t("tr",eo,[oo,t("td",lo," $"+S(r(h).descuento),1)]),t("tr",to,[ao,t("td",so,[l(be,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${r(h).total}`},null,8,["label"])])])],2)]),t("div",{class:u(["col-12 flex q-mt-md q-pb-md",[s.$q.screen.width<600?"justify-center":"justify-between"]])},[s.$q.screen.width>600?(p(),$(x,{key:0,icon:"arrow_back",onClick:o[14]||(o[14]=e=>s.$router.push("/compras")),outline:"",rounded:"",class:"q-mr-lg",color:s.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:a(()=>[D(" \xA0 Regresar ")]),_:1},8,["color"])):g("",!0),l(x,{type:"submit",icon:"save",outline:"",rounded:"",class:u(s.$q.screen.width<600?"q-px-xl":"q-px-lg"),style:{color:"#696cff"}},{default:a(()=>[D(" \xA0 Guardar ")]),_:1},8,["class"])],2)]),_:1})]),_:1})],2)]),_:1}),l(F,{modelValue:R.value,"onUpdate:modelValue":o[15]||(o[15]=e=>R.value=e)},{default:a(()=>[l(xe)]),_:1},8,["modelValue"]),l(F,{modelValue:r(A),"onUpdate:modelValue":o[16]||(o[16]=e=>q(A)?A.value=e:null)},{default:a(()=>[l(Ve,{listProductos:r(W),onAgregarProduct:oe},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}});export{Ao as default};
