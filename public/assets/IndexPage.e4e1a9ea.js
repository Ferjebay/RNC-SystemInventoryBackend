import{Q as ce,a as U,b as me}from"./QTable.1564a250.js";import{Q as pe,a as Z}from"./QTooltip.3197add4.js";import{Q as te}from"./QSelect.2aac5f58.js";import{r as v,d as L,o as c,a7 as f,g as a,ab as t,e as r,f as l,Q as $,h as b,aP as J,a8 as V,N as R,aQ as M,af as se,v as G,B as ve,c as P,aS as Q,aT as ee,ad as h,ah as K,ag as fe,ac as ge,aU as _e,i as H,a9 as I}from"./index.e2604f41.js";import{Q as ye}from"./QBadge.62804750.js";import{Q as be}from"./QPageSticky.57089bda.js";import{C as j}from"./ClosePopup.a0fb7464.js";import{a as F}from"./axios.dafdfce6.js";import{Q as we}from"./QForm.4e4cdea4.js";import{u as re}from"./useHelpers.d8fdd9b9.js";import"./QList.ead62a8b.js";import"./QItemLabel.a39057c6.js";import"./QChip.9c1ba2ae.js";import"./format.2bc25e5f.js";import"./use-quasar.4e0c8a9c.js";const s=v({aplicaIva:!1,codigoBarra:"",nombre:"",precio_compra:0,pvp:0,stock:0,descuento:0}),O=v(!1),le=v(!1),oe=v(!1),ae=v(!1);v(!1);const W=()=>{const{claim:S,mostrarNotify:w}=re(),n=()=>{s.value.aplicaIva=!1,s.value.codigoBarra="",s.value.nombre="",s.value.precio_compra=0,s.value.pvp=0,s.value.stock=0,s.value.descuento=0};return{allowOnlyNumber:()=>{s.value.codigoBarra=s.value.codigoBarra.replace(/\D/g,""),s.value.stock.toString().length>0?s.value.stock=parseFloat(s.value.stock.toString().replace(/\D/g,"")):s.value.stock=0,s.value.descuento.toString().length>0?s.value.descuento=parseFloat(s.value.descuento.toString().replace(/\D/g,"")):s.value.descuento=0},actualizarTabla:ae,claim:S,formProduct:s,transformToUpperCase:()=>{s.value.nombre=s.value.nombre.toUpperCase()},limpiarFormulario:n,loading:O,onSubmit:async g=>{try{O.value=!0,g?await F.patch("/products/"+s.value.id,s.value):await F.post("/products",s.value),w("positive",`Producto ${g?"editado":"agregado"} exitosamente`),le.value=!1,oe.value=!1,ae.value=!0,n(),O.value=!1}catch(_){O.value=!1,w("warning",_.response.data.message)}},validDecimal:g=>{let _=0;g=="pvm"?_=s.value.precio_compra:_=s.value.pvp;const i=/^\d{0,9}(\.\d{1,2})?$/;setTimeout(function(){let d=0;if(g=="pvm"?d=s.value.precio_compra:d=s.value.pvp,!i.test(d.toString())){const z=parseFloat(_.toString().substring(0,_.toString().length-1));g=="pvm"?s.value.precio_compra=z:s.value.pvp=z}},0)},modalAgregarProducto:le,modalEditarProducto:oe}};const xe={class:"row q-pt-lg q-gutter-lg justify-center"},he={class:"col-xs-12 col-sm-5"},ke=r("label",null,"Codigo Barra / Serial:",-1),Pe={class:"col-xs-12 col-sm-5"},Ve=r("label",null,"Nombre Producto:",-1),qe={class:"col-xs-12 col-sm-5"},$e=r("label",null,"Precio de Compra:",-1),Se={class:"col-xs-12 col-sm-5"},Ce=r("label",null,"PVP:",-1),Be={class:"col-xs-12 col-sm-5"},Qe=r("label",null,"Aplica IVA:",-1),Ie={class:"col-xs-12 col-sm-5"},Ae=r("label",null,"Descuento(%):",-1),Te={class:"col-xs-12 col-sm-5"},Ue=r("label",null,"Stock:",-1),Fe={class:"col-xs-9 col-sm-12 q-mt-lg q-mb-md flex justify-center"},ne=L({__name:"FormProduct",props:{edit:{type:Boolean}},setup(S){const w=S,{formProduct:n,allowOnlyNumber:m,transformToUpperCase:x,validDecimal:q,onSubmit:N,loading:g}=W();return(_,i)=>(c(),f(we,{onSubmit:i[9]||(i[9]=d=>t(N)(w.edit))},{default:a(()=>[r("div",xe,[r("div",he,[ke,l($,{modelValue:t(n).codigoBarra,"onUpdate:modelValue":i[0]||(i[0]=d=>t(n).codigoBarra=d),onKeyup:t(m),dense:"",filled:"",required:""},null,8,["modelValue","onKeyup"])]),r("div",Pe,[Ve,l($,{modelValue:t(n).nombre,"onUpdate:modelValue":i[1]||(i[1]=d=>t(n).nombre=d),modelModifiers:{trim:!0},onKeyup:t(x),dense:"",filled:"",required:""},null,8,["modelValue","onKeyup"])]),r("div",qe,[$e,l($,{type:"number",modelValue:t(n).precio_compra,"onUpdate:modelValue":i[2]||(i[2]=d=>t(n).precio_compra=d),modelModifiers:{trim:!0},min:"0","input-class":"resaltarTextoInput",step:".01",onKeyup:i[3]||(i[3]=d=>t(q)("pvm")),dense:"",filled:"",required:""},null,8,["modelValue"])]),r("div",Se,[Ce,l($,{modelValue:t(n).pvp,"onUpdate:modelValue":i[4]||(i[4]=d=>t(n).pvp=d),modelModifiers:{trim:!0},type:"number",min:"0","input-class":"resaltarTextoInput",step:".01",onKeyup:i[5]||(i[5]=d=>t(q)("pvp")),dense:"",filled:"",required:""},null,8,["modelValue"])]),r("div",Be,[Qe,l(te,{modelValue:t(n).aplicaIva,"onUpdate:modelValue":i[6]||(i[6]=d=>t(n).aplicaIva=d),filled:"",dense:"",required:"","emit-value":"","map-options":"",options:[{label:"SI",value:!0},{label:"NO",value:!1}]},null,8,["modelValue"])]),r("div",Ie,[Ae,l($,{type:_.$q.platform.is.mobile?"number":"text",modelValue:t(n).descuento,"onUpdate:modelValue":i[7]||(i[7]=d=>t(n).descuento=d),"input-class":"resaltarTextoInput",onKeyup:t(m),dense:"",filled:"",required:""},null,8,["type","modelValue","onKeyup"])]),r("div",Te,[Ue,l($,{modelValue:t(n).stock,"onUpdate:modelValue":i[8]||(i[8]=d=>t(n).stock=d),readonly:"","input-class":"resaltarTextoInput",onKeyup:t(m),dense:"",filled:"",required:""},null,8,["modelValue","onKeyup"])]),r("div",Fe,[l(b,{label:_.edit?"Editar":"Guardar",loading:t(g),class:"q-px-xl",type:"submit",color:"green-9"},null,8,["label","loading"])])])]),_:1}))}}),Ne={class:"text-h6 text-center"},ze=L({__name:"AddProduct",setup(S){const{limpiarFormulario:w}=W();return w(),(n,m)=>(c(),f(J,{style:{width:"643px !important","max-width":"fit-content"}},{default:a(()=>[l(M,null,{default:a(()=>[r("div",Ne,[V(" Agregar Producto "),R(l(b,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[j]])])]),_:1}),l(se,{inset:""}),l(M,{class:"q-pt-none"},{default:a(()=>[l(ne,{edit:!1})]),_:1})]),_:1}))}}),De={class:"text-h6 text-center"},Ee=L({__name:"EditProduct",setup(S){return(w,n)=>(c(),f(J,{style:{width:"643px !important","max-width":"fit-content"}},{default:a(()=>[l(M,null,{default:a(()=>[r("div",De,[V(" Editar Producto "),R(l(b,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[j]])])]),_:1}),l(se,{inset:""}),l(M,{class:"q-pt-none"},{default:a(()=>[l(ne,{edit:!0})]),_:1})]),_:1}))}}),Ke={class:"q-ma-lg q-pt-md"},Oe={class:"row q-col-gutter-lg"},Re={class:"col-12"},Me={key:0,class:"text-center row justify-center",style:{width:"100%"}},je=r("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Productos ",-1),Le=[je],Ge=r("label",{class:"q-mr-sm row items-center"},[r("span",null,"Sucursal: ")],-1),He={key:0},Je={key:1},We={class:"full-width row flex-center text-lime-10 q-gutter-sm"},Xe=r("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1),pl=L({__name:"IndexPage",setup(S){let{actualizarTabla:w,claim:n,modalAgregarProducto:m,modalEditarProducto:x,formProduct:q}=W();const N=[{name:"acciones",label:"acciones",align:"center"},{name:"codigoBarra",label:"Codigo de Barra",align:"center",field:"codigoBarra"},{name:"producto",label:"Producto",align:"center",field:"nombre"},{name:"stock",label:"Stock",align:"center",field:"stock"},{name:"aplicaIva",label:"Aplica Iva",align:"center",field:"aplicaIva"},{name:"estado",label:"Estado",align:"center",field:"isActive"}],{mostrarNotify:g,confirmDelete:_,isDeleted:i}=re(),d=v([]),z=v("codigo"),D=v(""),X=v(),A=v(!1),E=v(""),T=v([]),y=v({sortBy:"desc",descending:!1,page:1,rowsPerPage:5,rowsNumber:5}),Y=async(u,o)=>{try{const{data:{msg:e}}=await F.patch(`/products/${u}/${o}`);g("positive",e),C(1,y.value.rowsPerPage,null)}catch(e){console.log(e)}};G(i,(u,o)=>{u&&C(1,y.value.rowsPerPage,null)}),G(z,(u,o)=>{C(1,y.value.rowsPerPage,null)}),G(w,(u,o)=>{u&&(C(1,y.value.rowsPerPage,null),w.value=!1)});const ie=async u=>{try{_("Estas seguro de eliminar este producto?",`/products/${u}`)}catch(o){console.log(o)}},ue=async()=>{A.value=!0;try{const{data:u}=await F.get("/sucursal");u.forEach(o=>{T.value.push({label:o.nombre,value:o.id})}),T.value.length!==0&&(E.value=T.value[0].value)}catch(u){g("warning",u.response.data.message)}A.value=!1},C=async(u=1,o=5,e=null)=>{T.value.length==0&&await ue();let p={headers:{sucursal_id:E.value}};try{const{data:B}=await F.get("/products",{params:{page:u,limit:o,busqueda:0},headers:p.headers});y.value.rowsNumber=B.meta.totalItems,d.value=B.items}catch(B){console.log(B)}};async function de(u){const{page:o,rowsPerPage:e,sortBy:p,descending:B}=u.pagination;A.value=!0,await C(o,e),y.value.page=o,y.value.rowsPerPage=e,y.value.sortBy=p,y.value.descending=B,A.value=!1}ve(()=>{X.value.requestServerInteraction()});const k=v("list");return(u,o)=>(c(),P(K,null,[r("div",Ke,[r("div",Oe,[r("div",Re,[l(J,{flat:"",class:"shadow_custom"},{default:a(()=>[l(ce,{"title-class":"text-grey-7 text-h6",rows:d.value,loading:A.value,"hide-header":k.value==="grid",columns:N,"row-key":"name",grid:k.value==="grid",filter:D.value,pagination:y.value,"onUpdate:pagination":o[5]||(o[5]=e=>y.value=e),"rows-per-page-options":[3,7,15,0],ref_key:"tableRef",ref:X,"binary-state-sort":"",onRequest:de},{header:a(e=>[l(pe,{props:e,style:{height:"60px"}},{default:a(()=>[(c(!0),P(K,null,fe(e.cols,p=>(c(),f(me,{key:p.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:a(()=>[V(I(p.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":a(e=>[t(n).roles[0]!=="Super-Administrador"&&t(n).roles[0]!=="Administrador"?(c(),P("div",Me,Le)):h("",!0),t(n).roles[0]=="Super-Administrador"||t(n).roles[0]=="Administrador"?(c(),P("div",{key:1,style:{display:"flex"},class:ge([u.$q.screen.xs?"q-mb-md":""])},[Ge,l(te,{outlined:"",dense:"",modelValue:E.value,"onUpdate:modelValue":[o[0]||(o[0]=p=>E.value=p),o[1]||(o[1]=p=>C())],"emit-value":"","map-options":"",options:T.value},null,8,["modelValue","options"])],2)):h("",!0)]),"top-right":a(e=>[u.$q.screen.xs?h("",!0):(c(),f(b,{key:0,onClick:o[2]||(o[2]=p=>Q(m)?m.value=!t(m):m=!t(m)),outline:"",color:"primary",label:"Agregar Producto",class:"q-mr-xs"})),l($,{style:_e(u.$q.screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":o[3]||(o[3]=p=>D.value=p),placeholder:"Buscar..."},{append:a(()=>[l(H,{name:"search"})]),_:1},8,["style","modelValue"]),k.value==="list"?(c(),f(b,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:a(()=>[R((c(),f(Z,{disable:u.$q.platform.is.mobile},{default:a(()=>[V(I(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[j]])]),_:2},1032,["icon","onClick"])):h("",!0),e.inFullscreen?h("",!0):(c(),f(b,{key:2,flat:"",round:"",dense:"",icon:k.value==="grid"?"list":"grid_on",onClick:o[4]||(o[4]=p=>{k.value=k.value==="grid"?"list":"grid",u.separator=k.value==="grid"?"none":"horizontal"})},{default:a(()=>[R((c(),f(Z,{disable:u.$q.platform.is.mobile},{default:a(()=>[V(I(k.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[j]])]),_:1},8,["icon"]))]),"body-cell-acciones":a(e=>[l(U,{props:e},{default:a(()=>[l(b,{round:"",color:"blue-grey",onClick:p=>(Q(q)?q.value={...e.row}:q={...e.row},Q(x)?x.value=!0:x=!0),icon:"edit",class:"q-mr-sm",size:"10px"},null,8,["onClick"]),e.row.isActive?(c(),P(K,{key:0},[e.row.isActive?(c(),f(b,{key:0,round:"",color:"blue-grey",icon:"close",onClick:p=>Y(e.row.id,!1),size:"10px"},null,8,["onClick"])):h("",!0)],64)):(c(),P(K,{key:1},[e.row.isActive?h("",!0):(c(),f(b,{key:0,round:"",color:"blue-grey",icon:"done",size:"10px",onClick:p=>Y(e.row.id,!0)},null,8,["onClick"])),e.row.isActive?h("",!0):(c(),f(b,{key:1,round:"",color:"blue-grey",class:"q-ml-sm",icon:"delete",size:"10px",onClick:p=>ie(e.row.id)},null,8,["onClick"]))],64))]),_:2},1032,["props"])]),"body-cell-codigoBarra":a(e=>[l(U,{props:e},{default:a(()=>[V(I(e.row.codigoBarra),1)]),_:2},1032,["props"])]),"body-cell-producto":a(e=>[l(U,{props:e},{default:a(()=>[V(I(e.row.nombre),1)]),_:2},1032,["props"])]),"body-cell-aplicaIva":a(e=>[l(U,{props:e},{default:a(()=>[V(I(e.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-estado":a(e=>[l(U,{props:e},{default:a(()=>[l(ye,{outline:"",class:"q-py-xs q-px-md",color:e.row.isActive?"positive":"dark"},{default:a(()=>[e.row.isActive?(c(),P("span",He,"Activo")):(c(),P("span",Je,"Inactivo"))]),_:2},1032,["color"])]),_:2},1032,["props"])]),"no-data":a(({icon:e})=>[r("div",We,[l(H,{size:"2em",name:"sentiment_dissatisfied"}),Xe,l(H,{size:"2em",name:D.value?"filter_b_and_w":e},null,8,["name"])])]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),l(ee,{modelValue:t(m),"onUpdate:modelValue":o[6]||(o[6]=e=>Q(m)?m.value=e:m=e)},{default:a(()=>[l(ze)]),_:1},8,["modelValue"]),l(ee,{modelValue:t(x),"onUpdate:modelValue":o[7]||(o[7]=e=>Q(x)?x.value=e:x=e)},{default:a(()=>[l(Ee)]),_:1},8,["modelValue"]),u.$q.screen.xs?(c(),f(be,{key:0,position:"bottom-right",offset:[18,18]},{default:a(()=>[l(b,{round:"",color:"secondary",size:"lg",icon:"add",onClick:o[8]||(o[8]=e=>Q(m)?m.value=!0:m=!0)})]),_:1})):h("",!0)],64))}});export{pl as default};
