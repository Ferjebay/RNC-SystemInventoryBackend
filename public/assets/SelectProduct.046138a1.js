import{r as n,n as w,d as I,o as S,ad as k,g as o,aP as x,f as l,aQ as F,e as B,ai as Q,ah as N,h as q,i as V,ae as g,af as v}from"./index.c45ffa3b.js";import{Q as M,a as u}from"./QTable.804bbd40.js";import{Q as $}from"./QInnerLoading.bfbc07be.js";import{api as T}from"./axios.f92fb9a5.js";import{u as z}from"./useHelpers.eb8fd38c.js";const p=n([]),b=n(""),c=n(!1),P=n({}),A=n(!1),C=n(""),D=n([{name:"acciones",label:"Quitar",align:"left"},{label:"Codigo Barra",align:"left",field:"codigoBarra",name:"codigoBarra"},{label:"Producto",align:"left",field:"nombre",name:"nombre"},{name:"cantidad",label:"Cantidad",align:"left"},{name:"iva",label:"Aplica IVA",align:"center"},{name:"descuento",label:"descuento %",align:"left",field:"descuento"},{label:"Stock",align:"center",field:"stock",name:"stock"},{name:"pvm",label:"Costo Neto",align:"center"},{name:"v_total",label:"Valor Total",align:"center",field:"v_total"}]),E=()=>{const{mostrarNotify:s,claim:d}=z(),f=(e,a)=>{if(p.value.some(t=>t.codigoBarra==e.codigoBarra))s("warning","Ya fue agregado este articulo");else{if(a!=="compras"&&e.stock<=0)return s("negative",`No hay stock del articulo ${e.nombre}`);e.cantidad=a=="proforma"?e.cantidad:0,e.v_total=a=="proforma"?e.v_total:0,e.descuento=a=="venta"||a=="proforma"?e.descuento:0,p.value.unshift(e),b.value=""}},h=async e=>{if(b.value.length==0)return s("warning","Ingresa el termino de busqueda");c.value=!0;try{const{data:a}=await T.get(`/products/${b.value}`);if(a.length>1)return P.value={data:a,tipo:e},A.value=!0,c.value=!1;if(a.length===0)return s("warning","No se encontro el articulo..."),c.value=!1;if(d.roles[0]=="Administrador"||d.roles[0]=="Super-Administrador"){if(C.value!==a[0].sucursal_id.id)return s("warning","No se encontro el articulo..."),c.value=!1}else if(d.sucursales[0]!==a[0].sucursal_id.id)return s("warning","No se encontro el articulo..."),c.value=!1;c.value=!1,f(a[0],e)}catch(a){console.log(a),c.value=!1}},m=e=>{const a=p.value.findIndex(i=>i.id==e);p.value.splice(a,1)},y=w(()=>{let e=0,a=0,i=0,t=0;return p.value.forEach(r=>{r.descuento>0&&(i+=parseFloat(r.v_total)*parseFloat(r.descuento)/100),r.aplicaIva&&(a+=(parseFloat(r.v_total)-parseFloat(r.v_total)*parseFloat(r.descuento)/100)*.12),e+=parseFloat(r.v_total)}),t=e+a-i,{subtotal:parseFloat((Math.floor(e*100)/100).toString()),iva:parseFloat((Math.floor(a*100)/100).toString()),descuento:parseFloat((Math.floor(i*100)/100).toString()),total:parseFloat((Math.floor(t*100)/100).toString())}});return{agregarAndValidarStock:f,columns:D,claim:d,filterArticulo:h,filterByCodBarra:b,loadingState:c,listProductos:P,modalSelectProducto:A,sucursal_selected:C,getSubtotalByProduct:(e,a="compras")=>{a=="compras"?e.v_total=parseFloat(e.cantidad)*parseFloat((Math.floor(e.precio_compra*100)/100).toString()):e.v_total=parseFloat(e.cantidad)*parseFloat((Math.floor(e.pvp*100)/100).toString())},quitarArticulo:m,valorFactura:y,rows:p}};const H=B("div",{class:"text-h6 text-center"},"Selecciona un producto",-1),L={class:"row q-gutter-sm"},O={class:"col-xs-12 col-sm-12 q-my-sm"},R=I({__name:"SelectProduct",props:{listProductos:{}},emits:["agregarProduct"],setup(s,{emit:d}){const f=s,h=[{name:"add",label:"Agregar"},{name:"codigoBarra",label:"Codigo Barra",align:"left",field:"codigoBarra"},{name:"producto",label:"Producto",align:"left",field:"nombre"},{name:"stock",label:"Stock",align:"center",field:"stock"},{name:"aplicaIva",label:"Aplica IVA",align:"center",field:"aplicaIva"},{name:"stock",label:"Stock",align:"center",field:"stock"},{name:"pvm",label:"Precio de Compra",align:"center",field:"pvm"},{name:"sucursal",label:"Sucursal",align:"center",field:"sucursal"}],{claim:m,sucursal_selected:y}=E();let _;m.roles[0]=="Administrador"||m.roles[0]=="Super-Administrador"?_=y.value:_=m.sucursales[0];const e=n([]);return f.listProductos.tipo,e.value=f.listProductos.data,(a,i)=>(S(),k(x,{style:{width:"1040px","max-width":"80vw"}},{default:o(()=>[l(F,{class:"q-pb-none"},{default:o(()=>[H]),_:1}),l(F,null,{default:o(()=>[B("div",L,[B("div",O,[l(M,{class:Q([a.$q.dark.isActive?"":"my-sticky-header-table2"]),rows:e.value,columns:h,"hide-bottom":"","row-key":"name"},{"body-cell-add":o(t=>[l(u,{props:t},{default:o(()=>[N(_)==t.row.sucursal_id.id?(S(),k(q,{key:0,round:"",color:"green-9",class:"q-ml-md",size:"sm",onClick:r=>d("agregarProduct",t.row),icon:"fa-solid fa-plus"},null,8,["onClick"])):(S(),k(V,{key:1,color:"red-9",class:"q-ml-md",size:"sm",name:"fa-solid fa-ban"}))]),_:2},1032,["props"])]),"body-cell-descuento":o(t=>[l(u,{props:t},{default:o(()=>[g(v(t.row.descuento)+"% ",1)]),_:2},1032,["props"])]),"body-cell-aplicaIva":o(t=>[l(u,{props:t},{default:o(()=>[g(v(t.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":o(t=>[l(u,{props:t},{default:o(()=>[g("$"+v(t.row.pvp.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-pvm":o(t=>[l(u,{props:t},{default:o(()=>[g("$"+v(t.row.precio_compra),1)]),_:2},1032,["props"])]),"body-cell-sucursal":o(t=>[l(u,{props:t},{default:o(()=>[g(v(t.row.sucursal_id.nombre),1)]),_:2},1032,["props"])]),loading:o(()=>[l($,{showing:"",color:"primary"})]),_:1},8,["class","rows"])])])]),_:1})]),_:1}))}});export{R as _,E as u};
