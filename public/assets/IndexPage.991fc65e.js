import{r as c,o as i,a9 as v,g as l,f as o,aV as W,e as s,aa as h,O as M,h as y,ah as ne,i as q,af as p,ae as $,ab as w,c as I,ad as d,Q as N,aU as le,v as z,ba as Z,aj as J,ai as ue,bc as K,by as de,P as j}from"./index.0b8d6997.js";import{Q as X}from"./QDate.e5fedc66.js";import{Q as ee}from"./QPopupProxy.34079c04.js";import{Q as ce}from"./QInnerLoading.51cfe06a.js";import{Q as me,a as ve}from"./QTable.4665959d.js";import{Q as pe,a as B}from"./QTooltip.3fd1d54c.js";import{Q as ae}from"./QSelect.8dc4cc15.js";import{Q as A}from"./QTd.f5519a84.js";import{Q as fe}from"./QBadge.bd353ee9.js";import{Q as ge}from"./QPageSticky.ba9fc743.js";import{C as U}from"./ClosePopup.a83c1c85.js";import{M as _e}from"./index.2065a85c.js";import{u as be}from"./useRolPermisos.f0a8152c.js";import{u as oe}from"./useHelpers.5acef332.js";import{d as ye}from"./date.9f894731.js";import{a as xe}from"./use-quasar.b57495cd.js";import"./exceljs.min.d23373ab.js";import{_ as we}from"./DetalleProducts.e684930f.js";import{e as he}from"./vue3-q-tel-input.esm.7863adcd.js";import"./format.aa15af7d.js";import"./QList.c4a9a700.js";import"./axios.d97ac043.js";import"./QBtnDropdown.a332e24d.js";import"./QBtnGroup.0974dea5.js";const Ve={class:"text-h6 text-center"},ke={class:"row flex flex-center"},Ce={class:"col-xs-11 col-sm-9 text-center q-mt-md q-mb-lg"},qe=s("label",null,"Enviar por:",-1),$e={key:0,class:"col-xs-11 col-sm-9 text-center q-mb-md"},Qe=s("label",null,"Celular del cliente:",-1),Re={key:1,class:"col-xs-11 col-sm-9 text-center"},Ee=s("label",null,"Email del cliente:",-1),De={class:"col-xs-9 col-md-12 flex justify-center q-ml-none"},Ae={__name:"ModalReenviarComproantes",props:["detalleFactura"],emits:["closeModal"],setup(H,{emit:V}){const Q=H,{api:k,mostrarNotify:T}=oe(),R=c(!1),E=c(!1),t=c({tipo_envio:"",telefono:"",email:""});t.value.telefono=Q.detalleFactura.customer_id.celular,t.value.email=Q.detalleFactura.customer_id.email;const x=()=>{R.value=!1;const f=/^\w+([.-_+]?\w+)*@\w+([.-]?\w+)*(\.\w{2,10})+$/;let n=[];return t.value.tipo_envio=="whatsapp"&&n.push("telefono"),t.value.tipo_envio=="email"&&n.push("email"),t.value.tipo_envio=="ambas"&&(n=["telefono","email"]),t.value.tipo_envio==""&&(n=["tipo_envio"]),t.value.email.length>5&&!f.test(t.value.email)&&(r.value.email.message="Ingresa un email valido",r.value.email.isValid=!1,R.value=!0),n.forEach(m=>{t.value[m].length==0&&(r.value[m].message="Debes completar este campo",r.value[m].isValid=!1,R.value=!0)}),R.value},r=c({telefono:{message:"",isValid:!0},tipo_envio:{message:"",isValid:!0},email:{message:"",isValid:!0}}),O=async()=>{if(!x()&&!((t.value.tipo_envio=="whatsapp"||t.value.tipo_envio=="ambas")&&!r.value.telefono.isValid))try{E.value=!0,await k.post("/CE/facturas/reenviar-comprobantes",{...t.value,factura:Q.detalleFactura}),T("positive","Comprobantes enviados"),V("closeModal"),E.value=!1}catch(f){E.value=!1,T("warning",f.response.data.message),V("closeModal")}},D=f=>{r.value.telefono.isValid=!f};return(f,n)=>(i(),v(le,{style:{width:"400px","max-width":"80vw"}},{default:l(()=>[o(W,null,{default:l(()=>[s("div",Ve,[h(" Enviar Comprobantes "),M(o(y,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[U]])])]),_:1}),o(ne,{inset:""}),o(W,{class:"q-pt-none"},{default:l(()=>[s("div",ke,[s("div",Ce,[qe,o(ae,{filled:"",dense:"",modelValue:t.value.tipo_envio,"onUpdate:modelValue":n[0]||(n[0]=m=>t.value.tipo_envio=m),error:!r.value.tipo_envio.isValid,"emit-value":"","map-options":"",options:[{label:"WhatsApp",value:"whatsapp"},{label:"Email",value:"email"},{label:"Ambas",value:"ambas"}]},{append:l(()=>[t.value.tipo_envio.length!=0&&t.value.tipo_envio=="whatsapp"?(i(),v(q,{key:0,name:"fa-brands fa-whatsapp",color:"teal-7"})):p("",!0),t.value.tipo_envio.length!=0&&t.value.tipo_envio=="email"?(i(),v(q,{key:1,name:"mail",color:"indigo-5"})):p("",!0),t.value.tipo_envio.length!=0&&t.value.tipo_envio=="ambas"?(i(),v(q,{key:2,name:"fa-solid fa-list-check",color:"deep-orange-4"})):p("",!0)]),error:l(()=>[s("label",{class:$(f.$q.dark.isActive?"text-red-4":"text-negative")},w(r.value.tipo_envio.message),3)]),_:1},8,["modelValue","error"])]),t.value.tipo_envio=="whatsapp"||t.value.tipo_envio=="ambas"?(i(),I("div",$e,[Qe,o(d(he),{"default-country":"EC","search-text":"Buscar pais...","onUpdate:modelValue":n[1]||(n[1]=m=>r.value.telefono.isValid=!0),onError:D,error:!r.value.telefono.isValid,filled:"",dense:"",tel:t.value.telefono,"onUpdate:tel":n[2]||(n[2]=m=>t.value.telefono=m)},{error:l(()=>[s("label",{class:$(f.$q.dark.isActive?"text-red-4":"text-negative")},w(r.value.telefono.message),3)]),_:1},8,["error","tel"])])):p("",!0),t.value.tipo_envio=="email"||t.value.tipo_envio=="ambas"?(i(),I("div",Re,[Ee,o(N,{type:"email",modelValue:t.value.email,"onUpdate:modelValue":[n[3]||(n[3]=m=>t.value.email=m),n[4]||(n[4]=m=>r.value.email.isValid=!0)],"input-class":"resaltarTextoInput",error:!r.value.email.isValid,"lazy-rules":"",dense:"",filled:""},{error:l(()=>[s("label",{class:$(f.$q.dark.isActive?"text-red-4":"text-negative")},w(r.value.email.message),3)]),_:1},8,["modelValue","error"])])):p("",!0),s("div",De,[o(y,{label:"Enviar",onClick:O,loading:E.value,class:"q-px-xl q-mt-md q-mb-md",outline:"",rounded:"",style:{color:"#696cff"}},null,8,["loading"])])])]),_:1})]),_:1}))}};const Ie={class:"q-mx-lg q-pt-md"},Pe={class:"row q-col-gutter-lg"},Se={style:{display:"flex"}},Fe={class:"col-xs-12 col-sm-3"},Me={class:"q-mr-sm row q-pt-sm justify-center"},Ue={class:"col-xs-10 col-sm-4"},Te={class:"row items-center justify-end"},Oe={class:"col-xs-12 col-sm-1 flex flex-center"},Ne={class:"col-xs-10 col-sm-4"},ze={class:"row items-center justify-end"},je={class:"col-12 q-pt-none"},Be={key:0,class:"text-center row justify-center",style:{width:"100%"}},He=s("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Comprobantes ",-1),Le=[He],Ye=s("label",{class:"q-mr-sm row items-center"},[s("span",null,"Por Sucursal: ")],-1),Ge=s("div",{class:"full-width row flex-center text-lime-10 q-gutter-sm"},[s("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun resultado ")],-1),yl={__name:"IndexPage",setup(H){let V;const{api:Q,claim:k,route:T,mostrarNotify:R}=oe(),E=u=>{const a=new _e("http://205.235.6.149:3000/socket.io/socket.io.js",{extraHeaders:{autentication:k.id}});V==null||V.removeAllListeners(),V=a.socket("/"),V.on("updateStateInvoice",async()=>{await _()})},t=[{name:"acciones",label:"acciones",align:"center"},{name:"sucursal",label:"Sucursal",align:"center"},{name:"num_comprobante",label:"Num. Comprobante",field:"numero_comprobante",align:"center"},{name:"usuario",label:"Usuario",align:"center"},{name:"cliente",label:"Cliente",align:"center"},{name:"f/h",label:"Fecha/Hora",align:"center",field:"created_at"},{name:"total",label:"Total",name:"total",align:"center"},{name:"estado",label:"Estado",field:"estado",align:"center"}],x=c(""),r=c(""),O=c([]),D=c(!1),f=c(!1),n=c("Todos"),m=c(""),L=c({}),P=c([]),S=c([]),Y=c({}),{validarPermisos:G}=be(),g=xe(),F=c(!1);z(n,(u,a)=>{_()});const te=()=>{const{tipo:u,fecha:a}=T.params;u!=""&&(n.value=u),a!=""&&(x.value=a.split(" - ")[0].replace(/-/g,"/"),r.value=a.split(" - ")[1].replace(/-/g,"/"))},_=async()=>{try{F.value=!0;let u={headers:{tipo:"PROFORMA","sucursal-id":S.value,desde:x.value,hasta:r.value}};const{data:a}=await Q.get("/invoices",u);a.map(e=>{e.created_at=ye.formatDate(e.created_at,"DD/MM/YYYY HH:mm a"),e.loading=!1}),O.value=a,F.value=!1}catch(u){console.log(u),F.value=!1}},se=async u=>{de.create({title:"\xBFEstas seguro de querer eliminar esta proforma?",ok:{push:!0,color:"cyan-10",label:"Eliminar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{j.show({message:"Cargando..."}),await Q.delete(`/invoices/${u}`),await _(),R("positive","Proforma eliminada exitosamente"),j.hide()}catch(a){R("warning",a.response.data.message),j.hide()}})};z(S,(u,a)=>{_()});const re=async u=>{F.value=!0,P.value=[];const{data:a}=await Q.get(`/sucursal/find/${u}/company`);a.forEach(e=>{P.value.push({label:e.nombre,value:e.id})}),P.value.length!=0&&(S.value=P.value[0].value),_()};E(),z(m,(u,a)=>{_()}),k.roles[0]=="SUPER-ADMINISTRADOR"||k.roles[0]=="ADMINISTRADOR"?re(k.company.id):_(),te();const C=c("list"),ie=c({rowsPerPage:10});return(u,a)=>(i(),I(J,null,[s("div",Ie,[s("div",Pe,[s("div",Se,[s("div",{style:{display:"flex"},class:$([d(g).screen.xs?"q-mb-md q-mt-none q-pt-xs":"q-ml-lg q-pl-none q-my-md"])},[s("div",{class:$(["row",[d(g).screen.xs?"flex-center":""]])},[s("div",Fe,[s("label",Me,[s("span",{class:$([d(g).screen.xs?"text-weight-bold":""])}," Filtrar por fecha: ",2)])]),s("div",Ue,[o(N,{outlined:"",dense:"",modelValue:x.value,"onUpdate:modelValue":a[2]||(a[2]=e=>x.value=e),mask:"date"},{append:l(()=>[x.value!==""?(i(),v(q,{key:0,name:"close",onClick:a[0]||(a[0]=e=>(x.value="",_())),class:"cursor-pointer"})):p("",!0),o(q,{name:"event",class:"cursor-pointer"},{default:l(()=>[o(ee,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(X,{modelValue:x.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>x.value=e),_]},{default:l(()=>[s("div",Te,[M(o(y,{label:"Close",color:"primary",flat:""},null,512),[[U]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Oe,[s("label",{class:$(["q-mx-md",[d(g).screen.xs?"text-weight-medium":""]])}," Hasta ",2)]),s("div",Ne,[o(N,{outlined:"",dense:"",modelValue:r.value,"onUpdate:modelValue":a[5]||(a[5]=e=>r.value=e),mask:"date"},{append:l(()=>[r.value!==""?(i(),v(q,{key:0,name:"close",onClick:a[3]||(a[3]=e=>(r.value="",_())),class:"cursor-pointer"})):p("",!0),o(q,{name:"event",class:"cursor-pointer"},{default:l(()=>[o(ee,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(X,{modelValue:r.value,"onUpdate:modelValue":[a[4]||(a[4]=e=>r.value=e),_]},{default:l(()=>[s("div",ze,[M(o(y,{onClick:_,label:"Close",color:"primary",flat:""},null,512),[[U]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])],2)],2)]),s("div",je,[o(le,{flat:"",class:"shadow_custom"},{default:l(()=>[o(me,{"title-class":"text-grey-7 text-h6",rows:O.value,"hide-header":C.value==="grid",loading:F.value,columns:t,"row-key":"name",grid:C.value==="grid",filter:m.value,pagination:ie.value},{loading:l(()=>[o(ce,{showing:"",color:"primary"})]),header:l(e=>[o(pe,{props:e,style:{height:"60px"}},{default:l(()=>[(i(!0),I(J,null,ue(e.cols,b=>(i(),v(ve,{key:b.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:l(()=>[h(w(b.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":l(e=>[d(g).screen.xs?(i(),I("div",Be,Le)):p("",!0),d(k).roles[0]=="SUPER-ADMINISTRADOR"||d(k).roles[0]=="ADMINISTRADOR"?(i(),I("div",{key:1,style:K([!d(g).screen.xs||"width: 100%;justify-content: center;",{display:"flex"}]),class:$([d(g).screen.xs?"q-mb-md":"q-ml-lg"])},[Ye,o(ae,{outlined:"",dense:"",modelValue:S.value,"onUpdate:modelValue":a[6]||(a[6]=b=>S.value=b),"emit-value":"","map-options":"",options:P.value},null,8,["modelValue","options"])],6)):p("",!0)]),"top-right":l(e=>[d(g).screen.width>=1023&&d(G)("crear.venta")?(i(),v(y,{key:0,onClick:a[7]||(a[7]=b=>u.$router.push("/proforma/add")),outline:"",color:"primary",label:"Agregar Proforma",class:"q-mr-xs"})):p("",!0),o(N,{style:K(d(g).screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:m.value,"onUpdate:modelValue":a[8]||(a[8]=b=>m.value=b),placeholder:"Buscar..."},{append:l(()=>[o(q,{name:"search"})]),_:1},8,["style","modelValue"]),C.value==="list"?(i(),v(y,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:l(()=>[M((i(),v(B,{disable:d(g).platform.is.mobile},{default:l(()=>[h(w(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[U]])]),_:2},1032,["icon","onClick"])):p("",!0),e.inFullscreen?p("",!0):(i(),v(y,{key:2,flat:"",round:"",dense:"",icon:C.value==="grid"?"list":"grid_on",onClick:a[9]||(a[9]=b=>{C.value=C.value==="grid"?"list":"grid",u.separator=C.value==="grid"?"none":"horizontal"})},{default:l(()=>[M((i(),v(B,{disable:d(g).platform.is.mobile},{default:l(()=>[h(w(C.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[U]])]),_:1},8,["icon"]))]),"body-cell-total":l(e=>[o(A,{props:e},{default:l(()=>[h(" $"+w(e.row.total),1)]),_:2},1032,["props"])]),"body-cell-cliente":l(e=>[o(A,{props:e},{default:l(()=>[h(w(e.row.customer_id.nombres),1)]),_:2},1032,["props"])]),"body-cell-sucursal":l(e=>[o(A,{props:e},{default:l(()=>[h(w(e.row.sucursal_id.nombre),1)]),_:2},1032,["props"])]),"body-cell-usuario":l(e=>[o(A,{props:e},{default:l(()=>[h(w(e.row.user_id.fullName.toUpperCase()),1)]),_:2},1032,["props"])]),"body-cell-estado":l(e=>[o(A,{props:e},{default:l(()=>[o(fe,{outline:"",class:"q-py-xs q-px-md",color:d(g).dark.isActive?"blue-grey-3":"blue-grey-7",label:e.row.estadoSRI},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":l(e=>[o(A,{props:e},{default:l(()=>[o(y,{round:"",color:"blue-grey",icon:"visibility",size:"10px",class:"q-mr-sm",onClick:b=>(f.value=!0,L.value={...e.row})},null,8,["onClick"]),e.row.estadoSRI=="PROFORMA"?(i(),v(y,{key:0,onClick:b=>u.$router.push(`proforma/add/${e.row.id}`),round:"",color:"blue-grey",icon:"description",size:"10px",class:"q-mr-sm"},null,8,["onClick"])):p("",!0),e.row.estadoSRI=="AUTORIZADO"||e.row.estadoSRI=="PROFORMA"?(i(),v(y,{key:1,round:"",color:"blue-grey",onClick:b=>(D.value=!0,Y.value=e.row),icon:"forward_to_inbox",size:"11px"},{default:l(()=>[o(B,{class:"bg-indigo",anchor:"top middle",self:"center middle"},{default:l(()=>[h(" Enviar comprobante por email ")]),_:1})]),_:2},1032,["onClick"])):p("",!0),o(y,{round:"",color:"blue-grey",class:"q-ml-sm",icon:"delete",size:"10px",onClick:b=>se(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),"no-data":l(({icon:e})=>[Ge]),_:1},8,["rows","hide-header","loading","grid","filter","pagination"])]),_:1})])])]),d(g).screen.width<=1023&&d(G)("crear.venta")?(i(),v(ge,{key:0,position:"bottom-right",offset:[18,18]},{default:l(()=>[o(y,{round:"",color:"secondary",size:"lg",icon:"add",onClick:a[10]||(a[10]=e=>u.$router.push("/ventas/add"))})]),_:1})):p("",!0),o(Z,{modelValue:f.value,"onUpdate:modelValue":a[11]||(a[11]=e=>f.value=e)},{default:l(()=>[o(we,{detalleData:L.value},null,8,["detalleData"])]),_:1},8,["modelValue"]),o(Z,{modelValue:D.value,"onUpdate:modelValue":a[13]||(a[13]=e=>D.value=e)},{default:l(()=>[o(Ae,{onCloseModal:a[12]||(a[12]=e=>D.value=!1),detalleFactura:Y.value},null,8,["detalleFactura"])]),_:1},8,["modelValue"])],64))}};export{yl as default};
