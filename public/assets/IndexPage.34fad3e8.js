import{Q as _e,a as Y,b as ge}from"./QTable.208cdf47.js";import{a as le,Q as be}from"./QTooltip.d0ac592a.js";import{r as y,C as ye,v as K,d as te,o,a9 as f,g as l,ad as a,e as r,ae as X,f as e,Q as z,h as C,aU as G,aa as D,O as E,aV as I,ah as oe,i as O,ab as N,c as S,af as w,aj as T,ai as ce,B as xe,a8 as he,bb as F,ba as Z}from"./index.7e6e0c1f.js";import{a as j,Q as P,d as ee}from"./format.a57e8416.js";import{Q as me}from"./QList.b38dfcbe.js";import{Q as Ce}from"./QBtnDropdown.0c07dfc6.js";import{Q as ne}from"./QBadge.c29970ea.js";import{Q as we}from"./QPageSticky.e732586e.js";import{C as A}from"./ClosePopup.465445af.js";import{u as ae}from"./useHelpers.104cd01b.js";import{a as ie}from"./axios.7bffd825.js";import{Q as fe}from"./QSelect.f9dfedb4.js";import{Q as ke}from"./QForm.3ac0604a.js";import{Q as Ve}from"./QFile.594ce218.js";import{u as $e}from"./useRolPermisos.71da533c.js";import"./QBtnGroup.fdc05c3f.js";import"./use-quasar.fab57ded.js";const M=y(!1),g=y({nombres:"",tipo_documento:"",numero_documento:"",email:"",celular:"",direccion:""}),re=y(!1),ue=y(!1),de=y(!1),se=()=>{const{claim:U,mostrarNotify:$}=ae(),u=()=>{g.value.nombres="",g.value.tipo_documento="",g.value.numero_documento="",g.value.email="",g.value.celular="",g.value.direccion=""},p=()=>{g.value.numero_documento=g.value.numero_documento.replace(/\D/g,""),g.value.celular=g.value.celular.replace(/\D/g,"")};return ye(()=>{K(g.value,(c,b)=>{if(g.value.nombres=c.nombres.toUpperCase(),c.tipo_documento!==""&&c.tipo_documento!=="04"&&g.value.numero_documento.length>10){const k=c.numero_documento.length-10,V=c.numero_documento.substring(0,c.numero_documento.length-k);g.value.numero_documento=V}})}),{actualizarLista:de,formCliente:g,loading:M,limpiarFormulario:u,allowOnlyNumber:p,modalAgregarCliente:re,modalEditarCliente:ue,validateNumDocument:[c=>c.length>=(g.value.tipo_documento==="04"?13:10)||`Debes completar ${g.value.tipo_documento==="04"?13:10} digitos`],validateNumCelular:[c=>c.length>=10||"Debes completar 10 digitos"],onSubmit:async c=>{try{M.value=!0;let b={company_id:U.company.id};c?await ie.patch("/customers/"+g.value.id,g.value,{headers:b}):await ie.post("/customers/create",g.value,{headers:b}),$("positive",`Cliente ${c?"editado":"agregado"} exitosamente`),re.value=!1,ue.value=!1,de.value=!0,M.value=!1}catch(b){$("warning",b.response.data.message),M.value=!1}}}},qe={class:"row q-pt-lg q-gutter-lg justify-center"},De=r("label",null,"Raz\xF3n Social:",-1),Qe={class:"col-xs-12 col-sm-5"},Se=r("label",null,"Tipo de Documento:",-1),Ee={class:"col-xs-12 col-sm-5"},Ae=r("label",null,"Numero de Documento:",-1),Ue={class:"col-xs-12 col-sm-5"},Re=r("label",null,"Email:",-1),Ne={class:"col-xs-12 col-sm-5"},Fe=r("label",null,"Celular:",-1),ze=r("label",null,"Direcci\xF3n:",-1),Ie={class:"col-xs-9 col-sm-12 flex justify-center"},pe=te({__name:"FormCliente",props:{edit:{type:Boolean}},setup(U){const $=U,{formCliente:u,loading:p,allowOnlyNumber:x,validateNumDocument:c,validateNumCelular:b,onSubmit:k}=se();return(V,m)=>(o(),f(ke,{onSubmit:m[6]||(m[6]=n=>a(k)($.edit))},{default:l(()=>[r("div",qe,[r("div",{class:X(["col-xs-12 col-sm-11",[V.$q.screen.xs?"":"q-px-md"]])},[De,e(z,{modelValue:a(u).nombres,"onUpdate:modelValue":m[0]||(m[0]=n=>a(u).nombres=n),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])],2),r("div",Qe,[Se,e(fe,{dense:"",modelValue:a(u).tipo_documento,"onUpdate:modelValue":m[1]||(m[1]=n=>a(u).tipo_documento=n),modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",options:[{label:"RUC",value:"04"},{label:"Cedula",value:"05"},{label:"Pasaporte",value:"06"}]},null,8,["modelValue"])]),r("div",Ee,[Ae,e(z,{modelValue:a(u).numero_documento,"onUpdate:modelValue":m[2]||(m[2]=n=>a(u).numero_documento=n),disable:a(u).tipo_documento==="",counter:"",maxlength:a(u).tipo_documento==="04"?13:10,rules:a(c),"lazy-rules":"",dense:"",filled:"",required:"",onKeyup:a(x)},null,8,["modelValue","disable","maxlength","rules","onKeyup"])]),r("div",Ue,[Re,e(z,{modelValue:a(u).email,"onUpdate:modelValue":m[3]||(m[3]=n=>a(u).email=n),modelModifiers:{trim:!0},type:"email",dense:"",filled:"",required:""},null,8,["modelValue"])]),r("div",Ne,[Fe,e(z,{modelValue:a(u).celular,"onUpdate:modelValue":m[4]||(m[4]=n=>a(u).celular=n),modelModifiers:{trim:!0},counter:"",maxlength:"10",rules:a(b),"lazy-rules":"",onKeyup:a(x),dense:"",filled:"",required:""},null,8,["modelValue","rules","onKeyup"])]),r("div",{class:X(["col-xs-12 col-sm-11",[V.$q.screen.xs?"":"q-px-md"]])},[ze,e(z,{modelValue:a(u).direccion,"onUpdate:modelValue":m[5]||(m[5]=n=>a(u).direccion=n),dense:"",filled:"",required:""},null,8,["modelValue"])],2),r("div",Ie,[e(C,{label:V.edit?"Editar":"Guardar",loading:a(p),class:"q-px-xl",type:"submit",outline:"",rounded:"",style:{color:"#696cff"}},null,8,["label","loading"])])])]),_:1}))}}),Le={class:"text-h6 text-center"},Te=te({__name:"AddCliente",setup(U){const{limpiarFormulario:$}=se();return $(),(u,p)=>(o(),f(G,{style:{width:"843px !important","max-width":"fit-content"}},{default:l(()=>[e(I,null,{default:l(()=>[r("div",Le,[D(" Agregar Cliente "),E(e(C,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[A]])])]),_:1}),e(oe,{inset:""}),e(I,{class:"q-pt-none"},{default:l(()=>[e(pe,{edit:!1})]),_:1})]),_:1}))}}),Pe={class:"text-h6 text-center"},Be=te({__name:"EditCliente",setup(U){return($,u)=>(o(),f(G,{style:{width:"843px !important","max-width":"fit-content"}},{default:l(()=>[e(I,null,{default:l(()=>[r("div",Pe,[D(" Editar Cliente "),E(e(C,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[A]])])]),_:1}),e(oe,{inset:""}),e(I,{class:"q-pt-none"},{default:l(()=>[e(pe,{edit:!0})]),_:1})]),_:1}))}});const Me={class:"text-h6 text-center"},Oe={class:"row flex flex-center"},je={class:"col-xs-11 col-sm-9 text-center q-mt-sm"},Ke=r("label",null,"Subir clientes desde excel:",-1),Xe={key:0,class:"col-xs-11 col-sm-9 text-center q-mt-md"},Ge=r("label",null,"Elige una sucursal:",-1),He={key:0,class:"col-12 q-mt-md"},Je={class:"col-xs-9 col-md-12 flex justify-center q-ml-none"},We={__name:"ModalCargarExcel",emits:["actualizarDatos"],setup(U,{emit:$}){const u=y(null),p=y(!1),x=y([]),c=y([]),b=y([]),k=y(""),{api:V,claim:m}=ae(),n=y({file:{message:"",isValid:!0},sucursal:{message:"",isValid:!0}});K(u,i=>{const s=i[0],_=new FileReader;_.onload=function(h){const R=h.target.result;H(R)},_.readAsBinaryString(s)});const L=async()=>{b.value=[];const{data:i}=await V.get(`/sucursal/find/${m.company.id}/company`);i.forEach(s=>{b.value.push({label:s.nombre,value:s.id})}),(m.roles[0]!=="SUPER-ADMINISTRADOR"||m.roles[0]!=="ADMINISTRADOR")&&(k.value=m.sucursales[0])};function H(i){const s=XLSX.read(i,{type:"binary"}),_=s.Sheets[s.SheetNames[0]],h=XLSX.utils.sheet_to_json(_,{header:1});x.value=h}function B(i){return new Promise(s=>setTimeout(s,i))}const J=()=>{let i=!1;return u.value==null&&(n.value.file.message="Debes completar este campo",n.value.file.isValid=!1,i=!0),k.value.length==0&&(n.value.sucursal.message="Debes completar este campo",n.value.sucursal.isValid=!1,i=!0),n.value.isValid&&u.value[0].type!=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"&&(n.value.file.message="Debes subir un archivo excel",n.value.file.isValid=!1,i=!0),i},W=async()=>{if(!J()){p.value=!0;for(let i=1;i<x.value.length;i++){if(x.value[i].length>0){const s=x.value[i];c.value.unshift({nombre:s[0],estado:"cargando",message:"",index:i});try{await B(50);let _={company_id:m.company.id},h;s[1].toLowerCase()=="ruc"&&(h="04"),s[1].toLowerCase()=="cedula"&&(h="05"),s[1].toLowerCase()=="pasaporte"&&(h="06"),await V.post("/customers/create",{nombres:s[0],tipo_documento:h,numero_documento:s[2].toString(),email:s[3],celular:s[4].toString(),direccion:s[5]},{headers:_});let R=c.value.find(Q=>Q.index==i);R.estado="success"}catch(_){let h=c.value.find(R=>R.index==i);h.estado="error",h.message=_.response.data.message}}i+1==x.value.length&&($("actualizarDatos"),p.value=!1)}}};return L(),(i,s)=>(o(),f(G,{style:{width:"600px","max-width":"80vw"}},{default:l(()=>[e(I,null,{default:l(()=>[r("div",Me,[D(" Carga masiva de clientes "),E(e(C,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[A]])])]),_:1}),e(oe,{inset:""}),e(I,{class:"q-pt-md"},{default:l(()=>[r("div",Oe,[r("div",je,[Ke,e(Ve,{"input-class":"inputFileClick",accept:".xls, .xlsx",dense:"",error:!n.value.file.isValid,"onUpdate:modelValue":[s[0]||(s[0]=_=>n.value.file.isValid=!0),s[1]||(s[1]=_=>u.value=_)],modelValue:u.value,outlined:"",multiple:"",append:""},{append:l(()=>[e(O,{name:"fa-solid fa-file-excel"})]),error:l(()=>[r("label",{class:X(i.$q.dark.isActive?"text-red-4":"text-negative")},N(n.value.file.message),3)]),_:1},8,["error","modelValue"])]),a(m).roles[0]=="SUPER-ADMINISTRADOR"||a(m).roles[0]=="ADMINISTRADOR"?(o(),S("div",Xe,[Ge,e(fe,{outlined:"",dense:"",modelValue:k.value,"onUpdate:modelValue":[s[2]||(s[2]=_=>k.value=_),s[3]||(s[3]=_=>n.value.sucursal.isValid=!0)],error:!n.value.sucursal.isValid,"emit-value":"","map-options":"",options:b.value},{error:l(()=>[r("label",{class:X(i.$q.dark.isActive?"text-red-4":"text-negative")},N(n.value.sucursal.message),3)]),_:1},8,["modelValue","error","options"])])):w("",!0)]),c.value.length>0?(o(),S("div",He,[e(me,{bordered:"",id:"scrollList"},{default:l(()=>[(o(!0),S(T,null,ce(c.value,(_,h)=>E((o(),f(j,{key:h,clickable:""},{default:l(()=>[e(P,null,{default:l(()=>[D(N(_.nombre),1)]),_:2},1024),e(P,{avatar:""},{default:l(()=>[_.estado=="cargando"?(o(),f(xe,{key:0,size:"30px",color:"primary"})):w("",!0),_.estado=="success"?(o(),f(O,{key:1,name:"check_circle",color:"green-9"})):w("",!0),_.estado=="error"?(o(),f(O,{key:2,name:"error",color:"negative"},{default:l(()=>[e(le,{anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:l(()=>[D(N(_.message),1)]),_:2},1024)]),_:2},1024)):w("",!0)]),_:2},1024)]),_:2},1024)),[[he]])),128))]),_:1})])):w("",!0),r("div",Je,[e(C,{label:"Subir clientes",loading:p.value,class:"q-px-xl q-mt-md q-mb-md",onClick:W,outline:"",rounded:"",style:{color:"#696cff"}},null,8,["loading"])])]),_:1})]),_:1}))}},Ye={class:"q-ma-lg q-pt-md"},Ze={class:"row q-col-gutter-lg"},el={class:"col-12"},ll={key:0},tl={key:1},ol={key:2},al=r("div",{class:"full-width row flex-center text-lime-10 q-gutter-sm"},[r("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ")],-1),Cl={__name:"IndexPage",setup(U){const $=[{name:"acciones",label:"acciones",align:"center"},{name:"nombre",align:"center",label:"Cliente",field:"nombres",sortable:!0},{name:"tipo_documento",align:"center",label:"Tipo de Documento",field:"tipo_documento"},{name:"numero_documento",align:"center",label:"Numero de Documento",field:"numero_documento"},{name:"email",label:"Email",field:"email",align:"center"},{name:"celular",label:"Celular",field:"celular",align:"center"},{name:"estado",label:"Estado",align:"center",field:"estado"}];let{actualizarLista:u,modalAgregarCliente:p,modalEditarCliente:x,formCliente:c}=se();const{validarPermisos:b}=$e(),k=y(!1),V=y(""),m=y([]),n=y(!1),{api:L,claim:H,mostrarNotify:B,confirmDelete:J,isDeleted:W}=ae();K(u,(v,d)=>{v&&i()});const i=async()=>{n.value=!0;try{let v={company_id:H.company.id};const{data:d}=await L.get("/customers",{headers:v});m.value=d,u.value=!1}catch(v){B("warning",v.response.data.message)}n.value=!1},s=async(v,d)=>{try{const{data:{msg:t}}=await L.patch(`/customers/${v}/${d}`);B("positive",t),i()}catch(t){console.log(t)}};K(W,(v,d)=>{v&&i()});const _=async v=>{J("Estas seguro de eliminar este cliente?",`/customers/${v}`)},h=()=>{var v="/plantillas/clientes_plantilla.xlsx";window.location.href=v},R=async()=>{try{const{data:v}=await L.post("/customers/download-clients-excel",{},{responseType:"arraybuffer"}),d=new Blob([v],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=document.createElement("a");t.href=window.URL.createObjectURL(d),t.download="clientes.xlsx",document.body.appendChild(t),t.click(),document.body.removeChild(t),console.log(v)}catch{}};i();const Q=y("list"),ve=y({rowsPerPage:10});return(v,d)=>(o(),S(T,null,[r("div",Ye,[r("div",Ze,[r("div",el,[e(G,{flat:"",class:"shadow_custom"},{default:l(()=>[e(_e,{"title-class":"text-grey-7 text-h6",title:"Listado de Clientes",rows:m.value,loading:n.value,"hide-header":Q.value==="grid",columns:$,"row-key":"name",grid:Q.value==="grid",filter:V.value,pagination:ve.value},{header:l(t=>[e(be,{props:t,style:{height:"60px"}},{default:l(()=>[(o(!0),S(T,null,ce(t.cols,q=>(o(),f(ge,{key:q.name,props:t,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:l(()=>[D(N(q.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-right":l(t=>[!v.$q.screen.xs&&a(b)("crear.cliente")?(o(),f(C,{key:0,onClick:d[0]||(d[0]=q=>F(p)?p.value=!a(p):p=!a(p)),outline:"",color:"primary",label:"Agregar Cliente",class:"q-mr-xs"})):w("",!0),e(Ce,{class:"q-mr-xs",outline:"",color:"teal-6",icon:"fa-solid fa-file-excel"},{default:l(()=>[e(me,null,{default:l(()=>[E((o(),f(j,{clickable:"",onClick:d[1]||(d[1]=q=>k.value=!0)},{default:l(()=>[e(P,null,{default:l(()=>[e(ee,null,{default:l(()=>[D("Importar Excel")]),_:1})]),_:1})]),_:1})),[[A]]),E((o(),f(j,{onClick:h,clickable:""},{default:l(()=>[e(P,null,{default:l(()=>[e(ee,null,{default:l(()=>[D("Exportar Plantilla")]),_:1})]),_:1})]),_:1})),[[A]]),E((o(),f(j,{onClick:R,clickable:""},{default:l(()=>[e(P,null,{default:l(()=>[e(ee,null,{default:l(()=>[D("Exportar Clientes")]),_:1})]),_:1})]),_:1})),[[A]])]),_:1})]),_:1}),e(z,{outlined:"",dense:"",debounce:"300",modelValue:V.value,"onUpdate:modelValue":d[2]||(d[2]=q=>V.value=q),placeholder:"Buscar..."},{append:l(()=>[e(O,{name:"search"})]),_:1},8,["modelValue"]),Q.value==="list"?(o(),f(C,{key:1,flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen",onClick:t.toggleFullscreen},{default:l(()=>[E((o(),f(le,{disable:v.$q.platform.is.mobile},{default:l(()=>[D(N(t.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[A]])]),_:2},1032,["icon","onClick"])):w("",!0),t.inFullscreen?w("",!0):(o(),f(C,{key:2,flat:"",round:"",dense:"",icon:Q.value==="grid"?"list":"grid_on",onClick:d[3]||(d[3]=q=>{Q.value=Q.value==="grid"?"list":"grid",v.separator=Q.value==="grid"?"none":"horizontal"})},{default:l(()=>[E((o(),f(le,{disable:v.$q.platform.is.mobile},{default:l(()=>[D(N(Q.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[A]])]),_:1},8,["icon"]))]),"body-cell-tipo_documento":l(t=>[e(Y,{props:t},{default:l(()=>[r("div",null,[t.row.tipo_documento==4?(o(),S("label",ll,"RUC")):t.row.tipo_documento==5?(o(),S("label",tl,"Cedula")):(o(),S("label",ol,"Pasaporte"))])]),_:2},1032,["props"])]),"body-cell-estado":l(t=>[e(Y,{props:t},{default:l(()=>[t.row.isActive?(o(),f(ne,{key:0,outline:"",color:"positive",label:"Activo",class:"q-pa-sm"})):(o(),f(ne,{key:1,outline:"",color:"red",label:"Inactivo",class:"q-pa-sm"}))]),_:2},1032,["props"])]),"body-cell-acciones":l(t=>[e(Y,{props:t},{default:l(()=>[t.row.isActive?(o(),S(T,{key:0},[a(b)("editar.cliente")?(o(),f(C,{key:0,round:"",color:"blue-grey",onClick:q=>(F(c)?c.value={...t.row}:c={...t.row},F(x)?x.value=!0:x=!0),icon:"edit",class:"q-mr-sm",size:"10px"},null,8,["onClick"])):w("",!0),t.row.isActive&&a(b)("inactivar.cliente")?(o(),f(C,{key:1,round:"",color:"blue-grey",icon:"close",onClick:q=>s(t.row.id,!1),size:"10px"},null,8,["onClick"])):w("",!0)],64)):(o(),S(T,{key:1},[!t.row.isActive&&a(b)("activar.cliente")?(o(),f(C,{key:0,round:"",color:"blue-grey",icon:"done",onClick:q=>s(t.row.id,!0),size:"10px"},null,8,["onClick"])):w("",!0),!t.row.estado&&a(b)("eliminar.cliente")?(o(),f(C,{key:1,round:"",color:"blue-grey",class:"q-ml-sm",icon:"delete",onClick:q=>_(t.row.id),size:"10px"},null,8,["onClick"])):w("",!0)],64))]),_:2},1032,["props"])]),"no-data":l(({icon:t})=>[al]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),v.$q.screen.xs&&a(b)("crear.cliente")?(o(),f(we,{key:0,position:"bottom-right",offset:[18,18]},{default:l(()=>[e(C,{round:"",color:"secondary",size:"lg",icon:"add",onClick:d[4]||(d[4]=t=>F(p)?p.value=!a(p):p=!a(p))})]),_:1})):w("",!0),e(Z,{modelValue:a(p),"onUpdate:modelValue":d[5]||(d[5]=t=>F(p)?p.value=t:p=t)},{default:l(()=>[e(Te)]),_:1},8,["modelValue"]),e(Z,{modelValue:a(x),"onUpdate:modelValue":d[6]||(d[6]=t=>F(x)?x.value=t:x=t)},{default:l(()=>[e(Be)]),_:1},8,["modelValue"]),e(Z,{modelValue:k.value,"onUpdate:modelValue":d[8]||(d[8]=t=>k.value=t)},{default:l(()=>[e(We,{onActualizarDatos:d[7]||(d[7]=t=>i())})]),_:1},8,["modelValue"])],64))}};export{Cl as default};
