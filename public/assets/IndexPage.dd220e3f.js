import{Q as Z,a as N,c as ee,b as te}from"./QTable.ab430b4f.js";import{Q as oe,a as U}from"./QTooltip.73375d96.js";import{Q as ae}from"./QSelect.60fb7254.js";import{r as y,v as se,B as re,o as s,c as m,e as i,f as l,g as r,aP as le,a7 as n,ad as c,ah as $,ag as ne,ab as E,ac as ie,h as u,Q as de,aU as D,i as x,N as S,a8 as z,a9 as P}from"./index.349610b2.js";import{Q as C}from"./QBadge.ab282333.js";import{Q as ce}from"./QPageSticky.eb8d9f57.js";import{C as L}from"./ClosePopup.af4a4206.js";import{api as A}from"./axios.9a6212db.js";import{u as ue}from"./useHelpers.cdec0ff9.js";import{u as me}from"./useRedIpv4.4b4289a6.js";import{u as pe}from"./useCliente.de2562c8.js";import"./QList.99705dab.js";import"./QItemLabel.09e165b8.js";import"./QChip.970758e5.js";import"./format.2bc25e5f.js";import"./use-quasar.0505bd38.js";import"./date.a91dbd13.js";const ge={class:"q-ma-lg q-pt-md"},fe={class:"row q-col-gutter-lg"},ve={class:"col-12"},ye=i("label",{class:"q-mr-sm row items-center"},[i("span",null,"Router: ")],-1),be={key:1,class:"text-center row justify-center",style:{width:"100%"}},he=i("label",{class:"q-mb-sm text-grey-7 text-h6"}," Redes IPv4 ",-1),we=[he],ke={class:"absolute-full flex justify-around"},_e={class:"full-width row flex-center text-lime-10 q-gutter-sm"},Ie=i("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1),Le={__name:"IndexPage",setup($e){const{obtenerListaSubred:M,groupedIpsByRed:Ce}=pe(),G=[{name:"acciones",label:"acciones",align:"center"},{align:"center",label:"Nombre",field:"nombre",name:"nombre"},{align:"center",label:"Red",field:"red",name:"red"},{align:"center",label:"Uso IPS",field:"uso_ips",name:"uso_ips"},{align:"center",label:"CIDR",name:"cidr",field:"cidr"},{align:"center",label:"Router",field:"router_name",name:"router_name"},{name:"estado",label:"Estado",align:"center",field:"estado"}],b=y("");let{listRouter:k,cargarRouter:H}=me();const{mostrarNotify:F,confirmDelete:J,isDeleted:K}=ue(),_=y(""),V=y([]),q=y(!1),T=[],O=o=>{const[a,e]=o.split("/"),t=parseInt(e,10);function p(Q){return Q.split(".").reduce((B,R)=>(B<<8)+parseInt(R,10),0)}function g(Q){return Array.from({length:4},(B,R)=>Q>>8*(3-R)&255).join(".")}const f=p(a),v=(1<<32-t)-1,h=g(f&~v),w=g(f|v);return{rangoInicio:h,rangoFin:w}},W=(o,a,e)=>{function t(v){return v.split(".").reduce((h,w)=>(h<<8)+parseInt(w,10),0)}const p=t(o),g=t(a),f=t(e);return p>=g&&p<=f},I=async()=>{q.value=!0;try{let o={headers:{router_id:b.value}};(await A.get(`/customers/get-ips/${b.value}`)).data.forEach(t=>{T.push(t.ipv4)});const{data:e}=await A.get("/red-ipv4",o);e.forEach(t=>{t.router_name=t.router_id.nombre,t.cidr=t.cidr.split(" ")[0];const p=M(`${t.red}/${t.cidr}`);t.totalIps=p.length-2;const{rangoInicio:g,rangoFin:f}=O(`${t.red}/${t.cidr}`),v=T.filter(w=>W(w,g,f));t.totalIpsUsadas=v.length;const h=Math.floor(t.totalIpsUsadas*100/t.totalIps*100)/100/100;t.porcentaje=h}),V.value=e}catch(o){F("warning",o.response.data.message)}q.value=!1},j=async(o,a)=>{try{const{data:{msg:e}}=await A.patch(`/red-ipv4/${o}/${a}`);F("positive",e),I()}catch(e){console.log(e)}};se(K,(o,a)=>{o&&I()});const X=async o=>{try{J("Estas seguro de eliminar esta red IPv4?",`/red-ipv4/${o}`)}catch(a){console.log(a)}};re(async()=>{await H(),k.value.length>0&&(b.value=k.value[0].value),I()});const d=y("list"),Y=y({rowsPerPage:10});return(o,a)=>(s(),m($,null,[i("div",ge,[i("div",fe,[i("div",ve,[l(le,{flat:"",class:"shadow_custom"},{default:r(()=>[l(Z,{"title-class":"text-grey-7 text-h6",title:"Redes IPv4",rows:V.value,loading:q.value,"hide-header":d.value==="grid",columns:G,"row-key":"name",grid:d.value==="grid",filter:_.value,pagination:Y.value},{header:r(e=>[l(oe,{props:e,style:{height:"60px"}},{default:r(()=>[(s(!0),m($,null,ne(e.cols,t=>(s(),n(te,{key:t.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:r(()=>[z(P(t.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":r(e=>[E(k).length>1?(s(),m("div",{key:0,style:{display:"flex"},class:ie([o.$q.screen.xs?"q-mb-md":""])},[ye,l(ae,{outlined:"",dense:"",modelValue:b.value,"onUpdate:modelValue":[a[0]||(a[0]=t=>b.value=t),I],"emit-value":"","map-options":"",options:E(k)},null,8,["modelValue","options"])],2)):(s(),m("div",be,we))]),"top-right":r(e=>[o.$q.screen.xs?c("",!0):(s(),n(u,{key:0,onClick:a[1]||(a[1]=t=>o.$router.push({name:"redesIpv4.add"})),outline:"",color:"primary",label:"Nuevo",class:"q-mr-xs"})),l(de,{style:D(o.$q.screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=t=>_.value=t),placeholder:"Buscar..."},{append:r(()=>[l(x,{name:"search"})]),_:1},8,["style","modelValue"]),d.value==="list"?(s(),n(u,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:r(()=>[S((s(),n(U,{disable:o.$q.platform.is.mobile},{default:r(()=>[z(P(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[L]])]),_:2},1032,["icon","onClick"])):c("",!0),e.inFullscreen?c("",!0):(s(),n(u,{key:2,flat:"",round:"",dense:"",icon:d.value==="grid"?"list":"grid_on",onClick:a[3]||(a[3]=t=>{d.value=d.value==="grid"?"list":"grid",o.separator=d.value==="grid"?"none":"horizontal"})},{default:r(()=>[S((s(),n(U,{disable:o.$q.platform.is.mobile},{default:r(()=>[z(P(d.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[L]])]),_:1},8,["icon"]))]),"body-cell-uso_ips":r(e=>[l(N,{props:e},{default:r(()=>[(s(),m("div",{key:0,style:D(o.$q.screen.xs?"min-width: 180px;":"min-width: 140px;")},[l(ee,{stripe:"",rounded:"",size:"25px",value:e.row.porcentaje,color:"cyan-9"},{default:r(()=>[i("div",ke,[l(C,{color:"transparent",class:"text-weight-bold","text-color":o.$q.dark.isActive?"grey-3":"grey-9",label:(e.row.porcentaje*100).toFixed(2)+"%"},null,8,["text-color","label"]),l(C,{color:"transparent",class:"text-weight-bolder","text-color":o.$q.dark.isActive?"grey-3":"grey-9",label:`(${e.row.totalIpsUsadas} de ${e.row.totalIps})`},null,8,["text-color","label"])])]),_:2},1032,["value"])],4))]),_:2},1032,["props"])]),"body-cell-estado":r(e=>[l(N,{props:e},{default:r(()=>[e.row.isActive?(s(),n(C,{key:0,outline:"",color:"positive",label:"Activo",class:"q-pa-sm"})):(s(),n(C,{key:1,outline:"",color:"red",label:"Inactivo",class:"q-pa-sm"}))]),_:2},1032,["props"])]),"body-cell-acciones":r(e=>[l(N,{props:e},{default:r(()=>[e.row.isActive?(s(),n(u,{key:0,round:"",color:"blue-grey",onClick:t=>o.$router.push({name:"redesIpv4.edit",params:{id:e.row.id}}),icon:"edit",class:"q-mr-sm",size:"10px"},null,8,["onClick"])):c("",!0),e.row.isActive?(s(),m($,{key:1},[e.row.isActive?(s(),n(u,{key:0,round:"",color:"blue-grey",icon:"close",onClick:t=>j(e.row.id,!1),size:"10px"},null,8,["onClick"])):c("",!0)],64)):(s(),m($,{key:2},[e.row.isActive?c("",!0):(s(),n(u,{key:0,round:"",color:"blue-grey",icon:"done",onClick:t=>j(e.row.id,!0),size:"10px"},null,8,["onClick"])),e.row.isActive?c("",!0):(s(),n(u,{key:1,round:"",color:"blue-grey",class:"q-ml-sm",icon:"delete",onClick:t=>X(e.row.id),size:"10px"},null,8,["onClick"]))],64))]),_:2},1032,["props"])]),"no-data":r(({icon:e})=>[i("div",_e,[l(x,{size:"2em",name:"sentiment_dissatisfied"}),Ie,l(x,{size:"2em",name:_.value?"filter_b_and_w":e},null,8,["name"])])]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),o.$q.screen.xs?(s(),n(ce,{key:0,position:"bottom-right",offset:[18,18]},{default:r(()=>[l(u,{round:"",color:"secondary",size:"lg",icon:"add",onClick:a[4]||(a[4]=e=>o.$router.push({name:"redesIpv4.add"}))})]),_:1})):c("",!0)],64))}};export{Le as default};
