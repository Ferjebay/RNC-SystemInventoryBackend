import{Q as oe,a as C}from"./QBreadcrumbs.11c5a3ec.js";import{Q as te}from"./QSpinnerFacebook.dd8efeb3.js";import{r as p,v as U,x as se,o as V,c as k,e as t,ae as i,f as s,g as r,aU as M,aj as re,by as ie,P as S,aV as E,aa as g,ab as m,ad as v,a9 as F,bC as ne,i as N,w as ue,bb as de,af as P,Q as R,O as me,h as A}from"./index.b55b9a32.js";import{a as B,Q as j}from"./format.12edf3e6.js";import{Q as x}from"./QSelect.a667b63f.js";import{Q as ce}from"./QDate.cf5e3861.js";import{Q as pe}from"./QPopupProxy.4c62a1ef.js";import{Q as ve}from"./QTd.d354857a.js";import{Q as fe}from"./QTable.62b55291.js";import{Q as be}from"./QForm.17c764b1.js";import{C as ge}from"./ClosePopup.32e108db.js";import{u as _e}from"./useHelpers.0546c524.js";import{d as qe}from"./date.2a22ff86.js";import{u as Ve}from"./useProduct.f83e2843.js";import"./QList.87d11fc4.js";import"./use-quasar.1438c1d0.js";import"./axios.0013d944.js";const Ae={class:"q-ma-lg q-pt-md q-mb-none",style:{"margin-bottom":"10px"}},xe={class:"row q-col-gutter-lg flex items-center"},De=t("label",{class:"text-h6 text-center"},"Nueva Retenci\xF3n",-1),Re=[De],ye={class:"text-weight-regular"},he=t("span",{class:"q-mr-sm"},"N\xB0 Retenci\xF3n:",-1),$e={key:1,class:"text-weight-regular"},we={class:"col-xs-12 col-sm-12 col-md-6 q-mt-md q-pl-none"},Ie=t("label",null,"Seleccionar Cliente: ",-1),Ce=t("label",null,"Seleccionar Sucursal: ",-1),ke=t("label",null,"Numero de Comprobante: ",-1),Se=t("label",null,"Fecha de emision: ",-1),Ne={class:"row items-center justify-end"},Oe=t("label",null,"Tipo de documento:",-1),Qe=t("label",null,"Impuesto:",-1),Te=t("label",null,"Retenci\xF3n del I.V.A:",-1),Ue=t("label",null,"Base Imponible:",-1),Me=t("label",null,"Valor Retenido:",-1),Ee={class:"col-xs-12 col-md-2 flex flex-center"},Fe={class:"q-mx-lg justify-center q-mt-md"},Pe={class:"col-12"},Be={class:"full-width row flex-center text-lime-10 q-gutter-sm"},je=t("span",{class:"text-subtitle1"}," No existen impuestos ",-1),na={__name:"AddRetencion",setup(Le){const{rows:b,valorFactura:y,formatearNumero:h,sucursal_selected:c,iva_selected:L,quitarArticulo:z}=Ve(),O=p([{name:"acciones",label:"Quitar",align:"left"},{label:"cod_reten",align:"left",field:"Cod. Reten.",name:"cod_reten"},{label:"Impuesto",align:"left",field:"Codigo",name:"codigo"},{name:"descripcion",label:"Descripci\xF3n",align:"center"},{name:"base_imponible",label:"Base imponible",align:"center"},{name:"porcentaje",label:"Porcentaje",align:"center",field:"descuento"},{label:"total",align:"center",field:"Total",name:"stock"},{name:"documento",label:"Documento",align:"center"},{name:"fecha",label:"Fecha",align:"center",field:"v_total"}]),{api:D,claim:d,mostrarNotify:_,router:Y}=_e();let Q=[];const f=p([]),$=p([]),w=p(!1),H=p(!0),G=Date.now();let J=qe.formatDate(G,"DD/MM/YYYY");(d.roles[0]!=="SUPER-ADMINISTRADOR"||d.roles[0]!=="ADMINISTRADOR")&&(c.value=d.sucursales[0]),O.value[7]={name:"pvp",label:"Precio de Venta",align:"center"};const o=p({customer_id:"5e909ecb-81f5-4cab-a663-ce3786c0db49",numero_comprobante:"--- --- ---------",numero_comprobante_factura:"",products:[],user_id:"",descripcion:"",inputDate:"",tipo_documento:"FACTURA",tipo_impuesto:"",retencion:"",base_imponible:0,valor_retenido:0}),u=p({customer_id:{message:"",isValid:!0},sucursal_id:{message:"",isValid:!0},forma_pago:{message:"",isValid:!0}}),n=p({numero_comprobante_factura:{message:"",isValid:!0},inputDate:{message:"",isValid:!0},tipo_impuesto:{message:"",isValid:!0},retencion:{message:"",isValid:!0},base_imponible:{message:"",isValid:!0}});U(()=>o.value.inputDate,a=>{n.value.inputDate.isValid=!0}),U(c,(a,e)=>{T()});const K=async a=>{$.value=[];const{data:e}=await D.get(`/sucursal/find/${a}/company`);e.forEach(l=>{$.value.push({label:l.nombre,value:l.id})})},W=async()=>{o.value.customer_id="";try{let a={"company-id":d.company.id};const{data:e}=await D.get("/customers",{headers:a});f.value=[],e.forEach(l=>{f.value.push({label:l.nombres,value:l.id,num_doc:l.numero_documento})}),Q=f.value}catch(a){console.log(a)}},X=(a="",e)=>{if(a==="")return e(()=>{f.value=Q});e(()=>{const l=a.toLowerCase();f.value=f.value.filter(q=>q.num_doc.indexOf(l)>-1||q.label.toLowerCase().indexOf(l)>-1)})},Z=a=>{let e=!1;return(d.roles[0]=="SUPER-ADMINISTRADOR"||d.roles[0]=="ADMINISTRADOR")&&c.value==""&&(u.value.sucursal_id.message="Debes seleccionar una sucursal",u.value.sucursal_id.isValid=!1,e=!0),y.value.total>50&&o.value.customer_id=="5e909ecb-81f5-4cab-a663-ce3786c0db49"&&a!="PROFORMA"&&(u.value.customer_id.message="La factura supera los $50.00, no puede ser emitida a CONSUMIDOR FINAL",u.value.customer_id.isValid=!1,e=!0),y.value.total>50&&o.value.forma_pago=="01"&&(u.value.forma_pago.message="La factura supera los $500.00, debes elegir otra forma de pago",u.value.forma_pago.isValid=!1,e=!0),b.value.length==0&&(e=!0,_("warning","Debes agregar algun producto..")),o.value.forma_pago.length==0&&(u.value.forma_pago.message="Debes elegir una forma de pago",u.value.forma_pago.isValid=!1,e=!0),b.value.forEach((l,q)=>{l.cantidad<=0&&(e=!0,_("warning",`Agrega una cantidad cantidad al producto: ${l.nombre} de la fila: ${q+1}`)),l.cantidad>l.stock&&l.tipo!="Servicio"&&(e=!0,_("warning",`La cantidad de venta del producto: ${l.nombre} supera su stock disponible`))}),e},ee=()=>{let a=!1;return["numero_comprobante_factura","inputDate","tipo_impuesto","retencion"].forEach(l=>{o.value[l].length==0&&(n.value[l].message="Debes completar este campo",n.value[l].isValid=!1,a=!0)}),n.value.numero_comprobante_factura.isValid&&o.value.numero_comprobante_factura.includes("_")&&(n.value.numero_comprobante_factura.message="Debes completar este campo",n.value.numero_comprobante_factura.isValid=!1,a=!0),o.value.base_imponible<=0&&(n.value.base_imponible.message="Debes completar este campo",n.value.base_imponible.isValid=!1,a=!0),a},ae=()=>{ee()||console.log("enviado")},le=async a=>{if(Z(a))return;o.value={...o.value,...y.value,products:b.value,user_id:d.id,tipo:a,send_messages:H,porcentaje_iva:L.value,name_proforma:nombre_proforma.value};let e;a=="EMISION"&&(e="\xBFDeseas emitir factura de esta proforma?"),a=="FACTURA"&&(e="\xBFDeseas generar esta FACTURA?"),a=="PROFORMA"&&(e="\xBFDeseas guardar como PROFORMA?"),ie.create({title:e,ok:{push:!0,color:"cyan-10",label:"Enviar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{S.show({message:"Cargando..."});let l={headers:{"sucursal-id":c.value}};await D.post("/invoices",o.value,l),S.hide(),_("positive","Venta realizada exitosamente"),Y.push("/ventas")}catch(l){_("warning",l.response.data.message),S.hide()}})},T=async()=>{w.value=!0;let a={headers:{"sucursal-id":c.value}};const{data:e}=await D.get("/retenciones/getNumRetencion",a);o.value.numero_comprobante=e.numComprobante,w.value=!1},I=()=>{if(o.value.tipo_impuesto=="IVA"&&o.value.retencion!=""&&o.value.base_imponible>0){let a=0;o.value.retencion==9&&(a=10),o.value.retencion==10&&(a=20),o.value.retencion==1&&(a=30),o.value.retencion==11&&(a=50),o.value.retencion==2&&(a=70),o.value.retencion==3&&(a=100);const e=h(o.value.base_imponible*a/100);o.value.valor_retenido=e}};return se(()=>{b.value=[]}),d.roles[0]=="SUPER-ADMINISTRADOR"||d.roles[0]=="ADMINISTRADOR"?K(d.company.id):T(),W(),(a,e)=>(V(),k(re,null,[t("div",Ae,[t("div",xe,[t("div",{class:i(["col-xs-12 col-md-6",[(a.$q.screen.width<1022,"q-pt-sm")]])},[s(oe,{class:i(["row q-mr-xs",[a.$q.screen.width<1022?"justify-center q-pt-sm":"justify-start "]])},{default:r(()=>[s(C,{label:"Inicio",icon:"home",to:"/"}),s(C,{label:"Retenciones",icon:"payments",to:"/retenciones"}),s(C,{label:"Retenci\xF3n",icon:"add_circle"})]),_:1},8,["class"])],2),t("div",{class:i(["col-xs-12 col-md-6",[a.$q.screen.width<1022?"text-center q-pt-sm":"text-right q-pt-sm"]])},Re,2)])]),s(M,{class:"q-mx-lg q-mt-lg"},{default:r(()=>[s(E,{class:"q-pt-none"},{default:r(()=>[t("div",{class:i(["row q-col-gutter-md",[a.$q.screen.xs?"q-mx-xs":"q-mx-lg"]])},[t("div",{class:i(["col-xs-12 col-md-6 q-pt-xs q-mt-md",a.$q.screen.width>=1023||"text-center q-pl-none"])},[t("label",{class:i(["text-weight-medium",[a.$q.screen.xs?"text-subtitle1":"text-h5"]])},[g("Fecha de Emisi\xF3n: "),t("span",ye,m(v(J)),1)],2)],2),t("div",{class:i(["col-xs-12 col-md-6",a.$q.screen.width<=1023?"text-center q-pt-sm q-pl-none":"text-right q-pt-xs q-mt-md"])},[t("label",{class:i(["text-weight-medium",[a.$q.screen.xs?"text-subtitle1":"text-h5 q-mr-lg"]])},[he,w.value?(V(),F(te,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(V(),k("span",$e,m(o.value.numero_comprobante),1))],2)],2),t("div",we,[Ie,s(x,{color:"orange",filled:"",modelValue:o.value.customer_id,"onUpdate:modelValue":[e[1]||(e[1]=l=>o.value.customer_id=l),e[2]||(e[2]=l=>u.value.customer_id.isValid=!0)],options:f.value,"emit-value":"","map-options":"",dense:"",error:!u.value.customer_id.isValid,onFilter:X,"use-input":"","input-debounce":"0"},ne({error:r(()=>[t("label",{class:i(a.$q.dark.isActive?"text-red-4":"text-negative")},m(u.value.customer_id.message),3)]),"no-option":r(()=>[s(B,null,{default:r(()=>[s(j,{class:"text-grey"},{default:r(()=>[g(" No hay resultados ")]),_:1})]),_:1})]),_:2},[o.value.customer_id&&o.value.customer_id!=="CONSUMIDOR FINAL"?{name:"append",fn:r(()=>[s(N,{name:"cancel",onClick:e[0]||(e[0]=ue(l=>o.value.customer_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","error"])]),v(d).roles[0]=="SUPER-ADMINISTRADOR"||v(d).roles[0]=="ADMINISTRADOR"?(V(),k("div",{key:0,class:i(["col-xs-12 col-md-5 q-mt-md",a.$q.screen.width<=1023?"q-pl-none":"offset-1"])},[Ce,s(x,{filled:"",modelValue:v(c),"onUpdate:modelValue":[e[3]||(e[3]=l=>de(c)?c.value=l:null),e[4]||(e[4]=l=>(u.value.sucursal_id.isValid=!0,b.value=[]))],error:!u.value.sucursal_id.isValid,options:$.value,"emit-value":"","map-options":"",dense:""},{error:r(()=>[t("label",{class:i(a.$q.dark.isActive?"text-red-4":"text-negative")},m(u.value.sucursal_id.message),3)]),"no-option":r(()=>[s(B,null,{default:r(()=>[s(j,{class:"text-grey"},{default:r(()=>[g(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","error","options"])],2)):P("",!0)],2),t("div",{class:i(["row q-pt-none q-col-gutter-md",[a.$q.screen.xs?"q-mx-xs":"q-mx-lg q-mb-md"]])},[t("div",{class:i(["col-xs-12 col-md-4 q-pl-none",a.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[ke,s(R,{modelValue:o.value.numero_comprobante_factura,"onUpdate:modelValue":[e[5]||(e[5]=l=>o.value.numero_comprobante_factura=l),e[6]||(e[6]=l=>n.value.numero_comprobante_factura.isValid=!0)],"input-style":{textAlign:"center",fontSize:"16px"},error:!n.value.numero_comprobante_factura.isValid,filled:"",mask:"###-###-#########","fill-mask":"",dense:""},{error:r(()=>[t("label",{class:i(a.$q.dark.isActive?"text-red-4":"text-negative")},m(n.value.numero_comprobante_factura.message),3)]),_:1},8,["modelValue","error"])],2),t("div",{class:i(["col-xs-12 col-md-4",a.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[Se,s(R,{filled:"",dense:"",modelValue:o.value.inputDate,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.inputDate=l),"input-style":{textAlign:"center"},error:!n.value.inputDate.isValid},{append:r(()=>[s(N,{name:"event",class:"cursor-pointer"},{default:r(()=>[s(pe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[s(ce,{modelValue:o.value.inputDate,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.inputDate=l)},{default:r(()=>[t("div",Ne,[me(s(A,{label:"Close",color:"primary",flat:""},null,512),[[ge]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),error:r(()=>[t("label",{class:i(a.$q.dark.isActive?"text-red-4":"text-negative")},m(n.value.inputDate.message),3)]),_:1},8,["modelValue","error"])],2),t("div",{class:i(["col-xs-12 col-md-4",a.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[Oe,s(x,{modelValue:o.value.tipo_documento,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.tipo_documento=l),modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",dense:"",options:[{label:"FACTURA",value:"FACTURA"},{label:"NOTA DE DEBITO",value:"NOTA_DE_DEBITO"},{label:"LIQ. DE COMPRAS",value:"LIQ_COMPRAS"}]},null,8,["modelValue","options"])],2),t("div",{class:i(["col-xs-12 col-md-4 q-pl-none",a.$q.screen.width<=1023?"q-pl-none":""])},[Qe,s(x,{modelValue:o.value.tipo_impuesto,"onUpdate:modelValue":[e[10]||(e[10]=l=>o.value.tipo_impuesto=l),e[11]||(e[11]=l=>n.value.tipo_impuesto.isValid=!0)],modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",dense:"",error:!n.value.tipo_impuesto.isValid,options:[{label:"I.V.A",value:"IVA"},{label:"Impuesto a la Renta",value:"impuesto_renta"}]},{error:r(()=>[t("label",{class:i(a.$q.dark.isActive?"text-red-4":"text-negative")},m(n.value.tipo_impuesto.message),3)]),_:1},8,["modelValue","error","options"])],2),t("div",{class:i(["col-xs-12 col-md-2",a.$q.screen.width<=1023?"q-pl-none":""])},[Te,s(x,{modelValue:o.value.retencion,"onUpdate:modelValue":[e[12]||(e[12]=l=>o.value.retencion=l),e[13]||(e[13]=l=>n.value.retencion.isValid=!0)],modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",dense:"",error:!n.value.retencion.isValid,options:[{label:"10%",value:9},{label:"20%",value:10},{label:"30%",value:1},{label:"50%",value:11},{label:"70%",value:2},{label:"100%",value:3}]},{error:r(()=>[t("label",{class:i(a.$q.dark.isActive?"text-red-4":"text-negative")},m(n.value.retencion.message),3)]),_:1},8,["modelValue","error"])],2),t("div",{class:i(["col-xs-12 col-md-2",a.$q.screen.width<=1023?"q-pl-none":""])},[Ue,s(R,{"input-class":"resaltarTextoInput",dense:"",filled:"",onChange:e[14]||(e[14]=l=>(o.value.base_imponible=v(h)(o.value.base_imponible),I())),"onUpdate:modelValue":[e[15]||(e[15]=l=>n.value.base_imponible.isValid=!0),e[16]||(e[16]=l=>o.value.base_imponible=l)],error:!n.value.base_imponible.isValid,min:"0",type:"number",modelValue:o.value.base_imponible},{error:r(()=>[t("label",{class:i(a.$q.dark.isActive?"text-red-4":"text-negative")},m(n.value.base_imponible.message),3)]),_:1},8,["error","modelValue"])],2),t("div",{class:i(["col-xs-12 col-md-2",a.$q.screen.width<=1023?"q-pl-none":""])},[Me,s(R,{"input-class":"resaltarTextoInput",dense:"",filled:"",onChange:e[17]||(e[17]=l=>o.value.valor_retenido=v(h)(o.value.valor_retenido)),min:"0",type:"number",modelValue:o.value.valor_retenido,"onUpdate:modelValue":e[18]||(e[18]=l=>o.value.valor_retenido=l)},null,8,["modelValue"])],2),t("div",Ee,[s(A,{onClick:ae,class:"q-mt-md","icon-right":"add_circle",outline:"",rounded:"",color:a.$q.dark.isActive?"teal-4":"blue-grey-8"},{default:r(()=>[g(" A\xF1adir impuesto\xA0 ")]),_:1},8,["color"])])],2)]),_:1})]),_:1}),s(be,{onSubmit:le},{default:r(()=>[t("div",Fe,[t("div",Pe,[s(fe,{rows:v(b),columns:O.value,"row-key":"name",class:i([a.$q.dark.isActive?"":"my-sticky-header-table3"]),"hide-pagination":!0,"rows-per-page-options":[50]},{"no-data":r(({})=>[t("div",Be,[je,s(N,{size:"2em",name:"playlist_add"})])]),"body-cell-acciones":r(l=>[s(ve,{props:l},{default:r(()=>[s(A,{round:"",color:"deep-orange",onClick:q=>v(z)(l.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),s(M,{class:"q-mt-md"},{default:r(()=>[s(E,{class:"q-py-none row"},{default:r(()=>[t("div",{class:i(["col-12 flex q-my-md",[a.$q.screen.width<600?"justify-center":"justify-between"]])},[a.$q.screen.width>600?(V(),F(A,{key:0,icon:"arrow_back",onClick:e[19]||(e[19]=l=>a.$router.push("/ventas")),outline:"",rounded:"",class:"q-mr-lg",color:a.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:r(()=>[g(" \xA0 Regresar ")]),_:1},8,["color"])):P("",!0),s(A,{"icon-right":"send",onClick:e[20]||(e[20]=l=>a.$router.push("/ventas")),outline:"",rounded:"",class:"q-mr-lg",style:{color:"#696cff"}},{default:r(()=>[g(" Enviar \xA0 ")]),_:1})],2)]),_:1})]),_:1})])]),_:1})],64))}};export{na as default};
