import{r as n,n as N,d as C,o as y,a9 as k,g as l,aR as w,f as t,aS as A,e as I,ae as x,ad as R,h as M,i as Q,aa as v,ab as _}from"./index.9a174042.js";import{Q as D,a as p}from"./QTable.9d0332f1.js";import{Q as q}from"./QInnerLoading.9799454b.js";import{a as T}from"./axios.ba8f4325.js";import{u as V}from"./useHelpers.ae76dc84.js";const f=n([]),b=n(""),c=n(!1),F=n({}),P=n(!1),B=n(""),$=n([{name:"acciones",label:"Quitar",align:"left"},{label:"Codigo Barra",align:"left",field:"codigoBarra",name:"codigoBarra"},{label:"Producto",align:"left",field:"nombre",name:"nombre"},{name:"cantidad",label:"Cantidad",align:"left"},{name:"iva",label:"Aplica IVA",align:"center"},{name:"descuento",label:"descuento %",align:"left",field:"descuento"},{label:"Stock",align:"center",field:"stock",name:"stock"},{name:"pvm",label:"Costo Neto",align:"center"},{name:"v_total",label:"Valor Total",align:"center",field:"v_total"}]),O=()=>{const{mostrarNotify:s,claim:u}=V(),m=(e,o)=>{if(f.value.some(a=>a.codigoBarra==e.codigoBarra))s("warning","Ya fue agregado este articulo");else{if(o!=="compras"&&e.stock<=0&&e.tipo!="Servicio")return s("negative",`No hay stock del articulo ${e.nombre}`);let a=0;o=="proforma"?a=e.cantidad:e.tipo=="Servicio"?a=1:a=0,e.cantidad=a,e.v_total=o=="proforma"?e.v_total:0,e.descuento=o=="venta"||o=="proforma"?e.descuento:0,f.value.unshift(e),e.tipo=="Servicio"&&d(e,"ventas"),b.value=""}},S=async e=>{if(b.value.length==0)return s("warning","Ingresa el termino de busqueda");c.value=!0;try{const{data:o}=await T.get(`/products/${b.value}`);if(o.length>1)return F.value={data:o,tipo:e},P.value=!0,c.value=!1;if(o.length===0)return s("warning","No se encontro el articulo..."),c.value=!1;if(u.roles[0]=="ADMINISTRADOR"||u.roles[0]=="SUPER-ADMINISTRADOR"){if(B.value!==o[0].sucursal_id.id)return s("warning","No se encontro el articulo..."),c.value=!1}else if(u.sucursales[0]!==o[0].sucursal_id.id)return s("warning","No se encontro el articulo..."),c.value=!1;c.value=!1,m(o[0],e)}catch(o){console.log(o),c.value=!1}},g=e=>{const o=f.value.findIndex(i=>i.id==e);f.value.splice(o,1)},h=N(()=>{let e=0,o=0,i=0,a=0;return f.value.forEach(r=>{r.descuento>0&&(i+=parseFloat(r.v_total)*parseFloat(r.descuento)/100),r.aplicaIva&&(o+=(parseFloat(r.v_total)-parseFloat(r.v_total)*parseFloat(r.descuento)/100)*.12),e+=parseFloat(r.v_total)}),a=e+o-i,{subtotal:parseFloat((Math.floor(e*100)/100).toString()),iva:parseFloat((Math.floor(o*100)/100).toString()),descuento:parseFloat((Math.floor(i*100)/100).toString()),total:parseFloat((Math.floor(a*100)/100).toString())}}),d=(e,o="compras")=>{o=="compras"?e.v_total=parseFloat(e.cantidad)*parseFloat((Math.floor(e.precio_compra*100)/100).toString()):e.v_total=parseFloat(e.cantidad)*parseFloat((Math.floor(e.pvp*100)/100).toString())};return{agregarAndValidarStock:m,columns:$,claim:u,filterArticulo:S,filterByCodBarra:b,loadingState:c,listProductos:F,modalSelectProducto:P,sucursal_selected:B,getSubtotalByProduct:d,quitarArticulo:g,valorFactura:h,rows:f}};const z=I("div",{class:"text-h6 text-center"},"Selecciona un producto",-1),E={class:"row q-gutter-sm"},U={class:"col-xs-12 col-sm-12 q-my-sm"},J=C({__name:"SelectProduct",props:{listProductos:{}},emits:["agregarProduct"],setup(s,{emit:u}){const m=s,S=[{name:"add",label:"Agregar"},{name:"codigoBarra",label:"Codigo Barra",align:"left",field:"codigoBarra"},{name:"producto",label:"Producto",align:"left",field:"nombre"},{name:"stock",label:"Stock",align:"center",field:"stock"},{name:"aplicaIva",label:"Aplica IVA",align:"center",field:"aplicaIva"},{name:"stock",label:"Stock",align:"center",field:"stock"},{name:"pvm",label:"Precio de Compra",align:"center",field:"pvm"},{name:"sucursal",label:"Sucursal",align:"center",field:"sucursal"}],{claim:g,sucursal_selected:h}=O();let d;g.roles[0]=="ADMINISTRADOR"||g.roles[0]=="SUPER-ADMINISTRADOR"?d=h.value:d=g.sucursales[0];const e=n([]);return m.listProductos.tipo,e.value=m.listProductos.data,(o,i)=>(y(),k(w,{style:{width:"1040px","max-width":"80vw"}},{default:l(()=>[t(A,{class:"q-pb-none"},{default:l(()=>[z]),_:1}),t(A,null,{default:l(()=>[I("div",E,[I("div",U,[t(D,{class:x([o.$q.dark.isActive?"":"my-sticky-header-table2"]),rows:e.value,columns:S,"hide-bottom":"","row-key":"name"},{"body-cell-add":l(a=>[t(p,{props:a},{default:l(()=>[R(d)==a.row.sucursal_id.id?(y(),k(M,{key:0,round:"",color:"green-9",class:"q-ml-md",size:"sm",onClick:r=>u("agregarProduct",a.row),icon:"fa-solid fa-plus"},null,8,["onClick"])):(y(),k(Q,{key:1,color:"red-9",class:"q-ml-md",size:"sm",name:"fa-solid fa-ban"}))]),_:2},1032,["props"])]),"body-cell-descuento":l(a=>[t(p,{props:a},{default:l(()=>[v(_(a.row.descuento)+"% ",1)]),_:2},1032,["props"])]),"body-cell-aplicaIva":l(a=>[t(p,{props:a},{default:l(()=>[v(_(a.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":l(a=>[t(p,{props:a},{default:l(()=>[v("$"+_(a.row.pvp.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-pvm":l(a=>[t(p,{props:a},{default:l(()=>[v("$"+_(a.row.precio_compra),1)]),_:2},1032,["props"])]),"body-cell-sucursal":l(a=>[t(p,{props:a},{default:l(()=>[v(_(a.row.sucursal_id.nombre),1)]),_:2},1032,["props"])]),loading:l(()=>[t(q,{showing:"",color:"primary"})]),_:1},8,["class","rows"])])])]),_:1})]),_:1}))}});export{J as _,O as u};
