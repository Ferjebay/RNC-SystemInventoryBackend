import{n as d,l as K,br as pe,bs as be,m as O,p as re,bt as ie,au as he,r as _,L as _e,bu as we,C as L,t as ye,i as Q,h as k,z as xe,aM as Ce,d as Se,a as Ae,u as qe,bv as Be,v as Ve,o as h,c as j,e as o,ag as B,ac as y,ad as x,af as u,ab as V,f as n,bw as ke,g as r,ah as ee,aQ as te,bp as De,Q as Y,aR as ae,ak as $e,bq as Ie,P as G,w as Oe,O as oe}from"./index.2805e896.js";import{c as Qe,Q as R,b as U,a as le}from"./QItemLabel.97811c6c.js";import{Q as se}from"./QSelect.33f025f5.js";import{Q as Fe,a as $,b as Me}from"./QTable.dabacdad.js";import{Q as Ne}from"./QList.89551e60.js";import{Q as Te}from"./QForm.68568e3a.js";import{C as ne}from"./ClosePopup.8588c8f1.js";import{api as I}from"./axios.28271b20.js";import{u as Pe}from"./useHelpers.f793ee4e.js";import{d as Re}from"./date.ffaab94c.js";import{u as Ue,_ as Le}from"./AddCliente.fe3d335b.js";import{u as ze,_ as Ee}from"./useProduct.c8683e9f.js";import{u as He}from"./auth-user.bd96786e.js";import"./QChip.6d91f2a3.js";import"./format.2bc25e5f.js";import"./use-quasar.031f688c.js";import"./QInnerLoading.ca973f47.js";const je=[d("g",{transform:"translate(20 50)"},[d("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.6"},[d("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),d("g",{transform:"translate(50 50)"},[d("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.8"},[d("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.1s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),d("g",{transform:"translate(80 50)"},[d("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.9"},[d("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.2s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])])];var Ye=K({name:"QSpinnerFacebook",props:pe,setup(e){const{cSize:c,classes:i}=be(e);return()=>d("svg",{class:i.value,width:c.value,height:c.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},je)}}),Ge=K({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(e,{slots:c}){const i=O(()=>{const g=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(m=>e[m]===!0).map(m=>`q-btn-group--${m}`).join(" ");return`q-btn-group row no-wrap${g.length!==0?" "+g:""}`+(e.spread===!0?" q-btn-group--spread":" inline")});return()=>d("div",{class:i.value},re(c.default))}});const Ke=Object.keys(ie),We=e=>Ke.reduce((c,i)=>{const g=e[i];return g!==void 0&&(c[i]=g),c},{});var Je=K({name:"QBtnDropdown",props:{...ie,...he,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:c,emit:i}){const{proxy:g}=xe(),m=_(e.modelValue),v=_(null),C=_e(),F=O(()=>{const l={"aria-expanded":m.value===!0?"true":"false","aria-haspopup":"true","aria-controls":C,"aria-label":e.toggleAriaLabel||g.$q.lang.label[m.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(l["aria-disabled"]="true"),l}),z=O(()=>"q-btn-dropdown__arrow"+(m.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),M=O(()=>we(e)),p=O(()=>We(e));L(()=>e.modelValue,l=>{v.value!==null&&v.value[l?"show":"hide"]()}),L(()=>e.split,D);function S(l){m.value=!0,i("beforeShow",l)}function E(l){i("show",l),i("update:modelValue",!0)}function N(l){m.value=!1,i("beforeHide",l)}function w(l){i("hide",l),i("update:modelValue",!1)}function T(l){i("click",l)}function A(l){Ce(l),D(),i("click",l)}function q(l){v.value!==null&&v.value.toggle(l)}function P(l){v.value!==null&&v.value.show(l)}function D(l){v.value!==null&&v.value.hide(l)}return Object.assign(g,{show:P,hide:D,toggle:q}),ye(()=>{e.modelValue===!0&&P()}),()=>{const l=[d(Q,{class:z.value,name:e.dropdownIcon||g.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&l.push(d(Qe,{ref:v,id:C,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:S,onShow:E,onBeforeHide:N,onHide:w},c.default)),e.split===!1?d(k,{class:"q-btn-dropdown q-btn-dropdown--simple",...p.value,...F.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:T},{default:()=>re(c.label,[]).concat(l),loading:c.loading}):d(Ge,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...M.value,glossy:e.glossy,stretch:e.stretch},()=>[d(k,{class:"q-btn-dropdown--current",...p.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:A},{default:c.label,loading:c.loading}),d(k,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...F.value,...M.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>l)])}}});const Xe={class:"q-ma-lg q-pt-md"},Ze={class:"row q-col-gutter-lg"},et={class:"col-xs-12 col-md-6 text-left"},tt={class:"text-weight-regular"},at=o("span",{class:"q-mr-sm"},"N\xB0 Factura:",-1),ot={key:1,class:"text-weight-regular"},lt={class:"col-xs-9 col-md-5 q-mt-md"},st=o("label",null,"Seleccionar Cliente: ",-1),nt={class:"col-xs-2 col-md-2 q-mt-lg btnAddCliente q-pt-sm q-pl-xs"},rt={key:0,class:"col-xs-9 col-md-4 q-mt-md"},it=o("label",null,"Seleccionar Sucursal: ",-1),ut={class:"row q-mt-lg q-mb-xs"},dt={class:"col-xs-12 col-md-6"},ct=o("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),mt={class:"row"},ft={class:"col-12"},vt={class:"full-width row flex-center text-lime-10 q-gutter-sm"},gt=o("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1),pt={class:"col-12",style:{display:"flex","justify-content":"end"}},bt={class:"text-right"},ht=o("td",null,[o("b",null,"SUBTOTAL:")],-1),_t={style:{width:"90px"},class:"text-subtitle1 text-weight-regular"},wt={class:"text-right"},yt=o("td",{class:"q-py-sm"},[o("b",null,"IVA(12%):")],-1),xt={style:{width:"90px"},class:"q-py-sm text-subtitle1 text-weight-regular"},Ct={class:"text-right"},St=o("td",{class:"q-py-sm"},[o("b",null,"TOTAL DESCUENTO:")],-1),At={style:{width:"90px"},class:"q-py-sm text-subtitle1 text-weight-regular"},qt={class:"text-right"},Bt=o("td",null,[o("b",null,"TOTAL DE VENTA:")],-1),Vt={style:{width:"90px"}},jt=Se({__name:"AddVenta",setup(e){let c=[];const i=_([]),g=_([]),m=_(""),v=_(!1),C=_(!1),F=Date.now();let z=Re.formatDate(F,"DD/MM/YYYY");const M=He(),{claim:p}=Ae.read(M.token),{mostrarNotify:S}=Pe(),E=qe(),N=Be(),{filterByCodBarra:w,columns:T,rows:A,modalSelectProducto:q,loadingState:P,listProductos:D,valorFactura:l,agregarAndValidarStock:W,filterArticulo:ue,getSubtotalByProduct:J,quitarArticulo:de}=ze();let{actualizarLista:ce}=Ue();T.value[7]={name:"pvp",label:"Precio de Venta",align:"center"};const f=_({customer_id:"0fa3a37d-310e-4d3b-a304-c0cd8e58f7ac",numero_comprobante:"--- --- ---------",products:[],user_id:""});L(m,(s,t)=>{Z()});const me=async s=>{g.value=[];const{data:t}=await I.get(`/sucursal/find/${s}/company`);t.forEach(a=>{g.value.push({label:a.nombre,value:a.id})})},fe=async()=>{if(N.params.venta_id!==""){const{data:s}=await I.get(`/invoices/filterInvoice/${N.params.venta_id}`);f.value.customer_id=s.customer_id.id,f.value.id=s.id,f.value.clave_acceso=s.clave_acceso,f.value.estadoSRI=s.estadoSRI,s.invoiceToProduct.forEach(t=>{t.product_id.cantidad=t.cantidad,t.product_id.v_total=t.v_total,W(t.product_id,"proforma")})}},ve=s=>{W(s,"venta"),q.value=!1};L(ce,(s,t)=>{s&&X()});const X=async()=>{v.value=!1;try{const{data:s}=await I.get("/customers");i.value=[],s.forEach(t=>{t.nombres!="CONSUMIDOR FINAL"&&i.value.push({label:t.nombres,value:t.id,num_doc:t.numero_documento})}),i.value.push({label:"CONSUMIDOR FINAL",value:"0fa3a37d-310e-4d3b-a304-c0cd8e58f7ac",cedula:"0"}),c=i.value}catch(s){console.log(s)}},ge=(s="",t)=>{if(s==="")return t(()=>{i.value=c});t(()=>{const a=s.toLowerCase();i.value=i.value.filter(b=>b.num_doc.indexOf(a)>-1||b.label.toLowerCase().indexOf(a)>-1)})},H=async s=>{if(f.value.customer_id=="")return S("warning","Debes elegir alg\xFAn cliente");if(A.value.length==0)return S("warning","Debes agregar algun producto..");if((p.roles[0]=="Super-Administrador"||p.roles[0]=="Administrador")&&m.value=="")return S("warning","Debes seleccionar una sucursal");f.value={...f.value,...l.value,products:A.value,user_id:p.id,tipo:s},Ie.create({title:`\xBFDeseas generar esta ${s=="FACTURA"?"factura":"proforma"}?`,ok:{push:!0,label:"Agregar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{G.show({message:"Cargando..."});let t={headers:{sucursal_id:m.value}};await I.post("/invoices",f.value,t),G.hide(),S("positive","Venta realizada exitosamente"),E.push("/ventas")}catch(t){console.log(t),G.hide()}})},Z=async()=>{C.value=!0;let s={headers:{sucursal_id:m.value}};const{data:t}=await I.get("/CE/facturas/getNumFactura",s);f.value.numero_comprobante=t.numComprobante,C.value=!1};return Ve(()=>{A.value=[]}),p.roles[0]=="Super-Administrador"||p.roles[0]=="Administrador"?me(p.company.id):Z(),X(),fe(),(s,t)=>(h(),j($e,null,[o("div",Xe,[o("div",Ze,[o("div",et,[o("label",{class:B(["text-weight-medium",[s.$q.screen.xs?"text-h6":"text-h5"]])},[y("Fecha de Emisi\xF3n: "),o("span",tt,x(u(z)),1)],2)]),o("div",{class:B(["col-xs-12 col-md-6",[s.$q.screen.xs?"text-left":"text-right"]])},[o("label",{class:B(["q-mr-lg text-weight-medium",[s.$q.screen.xs?"text-h6":"text-h5"]])},[at,C.value?(h(),V(Ye,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(h(),j("span",ot,x(f.value.numero_comprobante),1))],2)],2),o("div",lt,[st,n(se,{color:"orange",filled:"",modelValue:f.value.customer_id,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value.customer_id=a),options:i.value,"emit-value":"","map-options":"",dense:"",onFilter:ge,"use-input":"","input-debounce":"0"},ke({"no-option":r(()=>[n(R,null,{default:r(()=>[n(U,{class:"text-grey"},{default:r(()=>[y(" No hay resultados ")]),_:1})]),_:1})]),_:2},[f.value.customer_id&&f.value.customer_id!=="CONSUMIDOR FINAL"?{name:"append",fn:r(()=>[n(Q,{name:"cancel",onClick:t[0]||(t[0]=Oe(a=>f.value.customer_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"])]),o("div",nt,[n(k,{round:"",color:"primary",size:"13px",style:{"margin-top":"5px"},onClick:t[2]||(t[2]=a=>v.value=!0),icon:"person_add"})]),u(p).roles[0]=="Super-Administrador"||u(p).roles[0]=="Administrador"?(h(),j("div",rt,[it,n(se,{filled:"",modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=a=>m.value=a),options:g.value,"emit-value":"","map-options":"",dense:""},{"no-option":r(()=>[n(R,null,{default:r(()=>[n(U,{class:"text-grey"},{default:r(()=>[y(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])])):ee("",!0)]),o("div",ut,[o("div",dt,[ct,n(Y,{outlined:"","bottom-slots":"",loading:u(P),dense:"",modelValue:u(w),"onUpdate:modelValue":t[5]||(t[5]=a=>te(w)?w.value=a:null),modelModifiers:{trim:!0},onKeyup:t[6]||(t[6]=De(a=>u(ue)("venta"),["enter"]))},{append:r(()=>[u(w)!==""?(h(),V(Q,{key:0,name:"close",onClick:t[4]||(t[4]=a=>w.value=""),class:"cursor-pointer"})):ee("",!0),n(Q,{name:"search"})]),_:1},8,["loading","modelValue"])])]),n(Te,{onSubmit:t[9]||(t[9]=a=>H("EMISION"))},{default:r(()=>[o("div",mt,[o("div",ft,[n(Fe,{rows:u(A),columns:u(T),"row-key":"name",class:B([s.$q.dark.isActive?"":"my-sticky-header-table3"]),"hide-pagination":!0,"rows-per-page-options":[50]},{"no-data":r(({})=>[o("div",vt,[gt,n(Q,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":r(a=>[n($,{props:a},{default:r(()=>[n(Y,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:b=>u(J)(a.row,"ventas"),min:"0",type:"number",style:{width:"100px"},modelValue:a.row.cantidad,"onUpdate:modelValue":b=>a.row.cantidad=b,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-descuento":r(a=>[n($,{props:a},{default:r(()=>[n(Y,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:b=>u(J)(a.row,"ventas"),min:"0",type:"number",style:{width:"100px"},modelValue:a.row.descuento,"onUpdate:modelValue":b=>a.row.descuento=b,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":r(a=>[n($,{props:a},{default:r(()=>[y(x(a.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":r(a=>[n($,{props:a},{default:r(()=>[y(" $"+x(a.row.pvp),1)]),_:2},1032,["props"])]),"body-cell-acciones":r(a=>[n($,{props:a},{default:r(()=>[n(k,{round:"",color:"deep-orange",onClick:b=>u(de)(a.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),o("div",pt,[o("table",{class:B([s.$q.screen.xs?"":"linearTablaDetalle"])},[o("tr",bt,[ht,o("td",_t," $"+x(u(l).subtotal),1)]),o("tr",wt,[yt,o("td",xt," $"+x(u(l).iva),1)]),o("tr",Ct,[St,o("td",At," $"+x(u(l).descuento),1)]),o("tr",qt,[Bt,o("td",Vt,[n(Me,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${u(l).total}`},null,8,["label"])])])],2)]),o("div",{class:B(["col-md-4 offset-4",[s.$q.screen.xs?"q-mt-md":""]])},[s.$route.params.venta_id==""?(h(),V(Je,{key:0,color:"green-10",label:"Generar",class:"full-width"},{default:r(()=>[n(Ne,null,{default:r(()=>[oe((h(),V(R,{clickable:"",onClick:t[7]||(t[7]=a=>H("FACTURA"))},{default:r(()=>[n(U,null,{default:r(()=>[n(le,null,{default:r(()=>[y("FACTURA")]),_:1})]),_:1})]),_:1})),[[ne]]),oe((h(),V(R,{type:"submit",clickable:"",onClick:t[8]||(t[8]=a=>H("PROFORMA"))},{default:r(()=>[n(U,null,{default:r(()=>[n(le,null,{default:r(()=>[y("PROFORMA")]),_:1})]),_:1})]),_:1})),[[ne]])]),_:1})]),_:1})):(h(),V(k,{key:1,square:"",color:"green-10",type:"submit",label:"Agregar Venta",class:"full-width",icon:"shopping_cart"}))],2)])]),_:1})]),n(ae,{modelValue:v.value,"onUpdate:modelValue":t[10]||(t[10]=a=>v.value=a)},{default:r(()=>[n(Le)]),_:1},8,["modelValue"]),n(ae,{modelValue:u(q),"onUpdate:modelValue":t[11]||(t[11]=a=>te(q)?q.value=a:null)},{default:r(()=>[n(Ee,{listProductos:u(D),onAgregarProduct:ve},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}});export{jt as default};
