import{d as K,r as u,v as U,o as n,c as q,e as r,ae as S,ad as o,f as l,g as s,Q as P,aU as W,a9 as c,af as p,aY as ee,aj as O,i as b,O as Q,h as _,ai as ae,aZ as z,aa as N,ab as R,aX as le}from"./index.ad0f1a33.js";import{Q as B}from"./QDate.55ce4406.js";import{Q as E}from"./QPopupProxy.3c348944.js";import{Q as se,a as M,b as te}from"./QTable.37c20cdb.js";import{Q as oe,a as j}from"./QTooltip.01e3a258.js";import{Q as Y}from"./QSelect.70d53dd2.js";import{Q as re}from"./QBadge.295e8592.js";import{Q as ne}from"./QPageSticky.84496238.js";import{C as D}from"./ClosePopup.2559bc98.js";import{u as ie}from"./useRolPermisos.b9cb57f7.js";import{u as ue}from"./useHelpers.9e513d04.js";import{a as de}from"./use-quasar.4c29637a.js";import{d as me}from"./date.5ccc23a7.js";import{_ as ce}from"./DetalleProducts.5b654e88.js";import"./format.0be0c6a3.js";import"./QList.b1d39dec.js";import"./axios.89b97088.js";import"./QInnerLoading.4d03d1e1.js";import"./QBtnDropdown.abf73c3f.js";import"./QBtnGroup.d03bd374.js";const pe={class:"q-ma-lg q-pt-md"},ve={class:"row q-col-gutter-lg"},fe={class:"col-12 q-pt-xs"},ge=r("label",{class:"q-mr-sm row q-pt-sm"},[r("span",null,"Filtrar por fecha: ")],-1),_e={class:"row items-center justify-end"},be=r("label",{class:"q-mx-md q-pt-sm"},"Hasta",-1),ye={class:"row items-center justify-end"},he={key:0,class:"text-center row justify-center",style:{width:"100%"}},xe=r("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Compras ",-1),we=[xe],ke=r("label",{class:"q-mr-sm row items-center"},[r("span",null,"Tipo: ")],-1),Ce=r("label",{class:"q-mx-sm row items-center"},[r("span",null,"Sucursal: ")],-1),Ve={class:"full-width row flex-center text-lime-10 q-gutter-sm"},qe=r("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun resultado ",-1),Ge=K({__name:"IndexPage",setup(Qe){const H=[{name:"acciones",label:"acciones",align:"center"},{name:"sucursal",label:"Sucursal",align:"center",field:"sucursal_name"},{name:"num_comprobante",label:"Num Comprobante",field:"numero_comprobante",align:"center"},{name:"usuario",label:"Usuario",align:"center",field:"user_name"},{name:"proveedor",label:"Proveedor",align:"center",field:"proveedor_name"},{name:"fecha",label:"Fecha Compra",align:"center",field:"fecha_compra"},{name:"total",label:"Total",field:"total",align:"center"},{name:"estado",label:"Estado",field:"estado",align:"center"}],F=u([]),A=u(!1);let k=u({});const v=u(""),f=u(""),h=u("TODOS");u({desde:"",hasta:"",pv_id:""});const x=u(""),{validarPermisos:$}=ie(),{api:T,claim:C,mostrarNotify:I,route:L}=ue(),d=de(),y=u(!1),V=u(""),w=u([]);U(h,(t,a)=>{m()});const G=()=>{const{fecha:t}=L.params;t!=""&&(v.value=t.split(" - ")[0].replace(/-/g,"/"),f.value=t.split(" - ")[1].replace(/-/g,"/"))},m=async()=>{try{y.value=!0,w.value.length==0&&await Z(),console.log(h.value);let t={headers:{sucursal_id:V.value,desde:v.value,hasta:f.value,tipo:h.value}};const{data:a}=await T.get("/buys",t);a.map(e=>{e.fecha_compra=me.formatDate(e.created_at,"DD/MM/YYYY"),e.sucursal_name=e.sucursal_id.nombre,e.proveedor_name=e.proveedor_id.razon_social,e.user_name=e.user_id.fullName,e.total=`$${e.total}`}),F.value=a,y.value=!1}catch(t){console.log(t),y.value=!1}},X=t=>{d.dialog({title:"<center>\xBFEstas seguro de anular esta compra?</center>",message:`<span><strong>Num Comprobante</strong>: ${t.numero_comprobante}</span> <br>
              <span class='q-my-lg'><strong>Proveedor</strong>: ${t.proveedor_name}</span> <br>
              <span class='q-my-lg'><strong>Fecha/Hora</strong>: ${t.fecha_compra}</span> <br>
              <span><strong>Total</strong>: ${t.total}</span> <br>`,html:!0,ok:{push:!0,label:"Anular",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{d.loading.show({message:"Cargando..."}),await T.delete(`/buys/${t.id}`),I("positive","Compra Anulada exitosamente"),m(),d.loading.hide()}catch(a){console.log(a)}})},Z=async()=>{y.value=!0;try{const{data:t}=await T.get("/sucursal");t.forEach(a=>{w.value.push({label:a.nombre,value:a.id})}),w.value.length!==0&&(V.value=w.value[0].value)}catch(t){I("warning",t.response.data.message)}y.value=!1};G(),m(),U(x,(t,a)=>{m()});const g=u("list"),J=u({rowsPerPage:10});return(t,a)=>(n(),q(O,null,[r("div",pe,[r("div",ve,[r("div",fe,[r("div",{class:S(["q-my-md",[o(d).screen.xs?"q-mb-md":"q-ml-lg"]]),style:{display:"flex"}},[ge,l(P,{outlined:"",dense:"",modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value=e),mask:"date"},{append:s(()=>[v.value!==""?(n(),c(b,{key:0,name:"close",onClick:a[0]||(a[0]=e=>(v.value="",m())),class:"cursor-pointer"})):p("",!0),l(b,{name:"event",class:"cursor-pointer"},{default:s(()=>[l(E,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[l(B,{modelValue:v.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>v.value=e),m]},{default:s(()=>[r("div",_e,[Q(l(_,{label:"Close",color:"primary",flat:""},null,512),[[D]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),be,l(P,{outlined:"",dense:"",modelValue:f.value,"onUpdate:modelValue":a[5]||(a[5]=e=>f.value=e),mask:"date"},{append:s(()=>[f.value!==""?(n(),c(b,{key:0,name:"close",onClick:a[3]||(a[3]=e=>(f.value="",m())),class:"cursor-pointer"})):p("",!0),l(b,{name:"event",class:"cursor-pointer"},{default:s(()=>[l(E,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[l(B,{modelValue:f.value,"onUpdate:modelValue":[a[4]||(a[4]=e=>f.value=e),m]},{default:s(()=>[r("div",ye,[Q(l(_,{onClick:m,label:"Close",color:"primary",flat:""},null,512),[[D]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],2),l(W,{flat:"",class:"shadow_custom"},{default:s(()=>[l(se,{"title-class":"text-grey-7 text-h6",rows:F.value,loading:y.value,"hide-header":g.value==="grid",columns:H,"row-key":"name",grid:g.value==="grid",filter:x.value,pagination:J.value},{header:s(e=>[l(oe,{props:e,style:{height:"60px"}},{default:s(()=>[(n(!0),q(O,null,ae(e.cols,i=>(n(),c(te,{key:i.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:s(()=>[N(R(i.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":s(e=>[o(C).roles[0]!=="SUPER-ADMINISTRADOR"&&o(C).roles[0]!=="ADMINISTRADOR"?(n(),q("div",he,we)):p("",!0),r("div",{style:z([{display:"flex"},!o(d).screen.xs||"width: 100%;justify-content: center;position: relative;right: 8px;"]),class:S([o(d).screen.xs?"q-mb-md":""])},[ke,l(Y,{outlined:"",dense:"",modelValue:h.value,"onUpdate:modelValue":a[6]||(a[6]=i=>h.value=i),"emit-value":"","map-options":"",options:[{label:"Todos",value:"TODOS"},{label:"Aceptados",value:"Aceptados"},{label:"Anulados",value:"Anulados"}]},null,8,["modelValue"])],6),o(C).roles[0]=="SUPER-ADMINISTRADOR"||o(C).roles[0]=="ADMINISTRADOR"?(n(),q("div",{key:1,style:{display:"flex"},class:S([o(d).screen.xs?"q-mb-md":""])},[Ce,l(Y,{outlined:"",dense:"",modelValue:V.value,"onUpdate:modelValue":[a[7]||(a[7]=i=>V.value=i),a[8]||(a[8]=i=>m())],"emit-value":"","map-options":"",options:w.value},null,8,["modelValue","options"])],2)):p("",!0)]),"top-right":s(e=>[!o(d).screen.xs&&o($)("crear.compra")?(n(),c(_,{key:0,onClick:a[9]||(a[9]=i=>t.$router.push("/compras/add")),outline:"",color:"primary",label:"Agregar Compra",class:"q-mr-xs"})):p("",!0),l(P,{style:z(o(d).screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:x.value,"onUpdate:modelValue":a[10]||(a[10]=i=>x.value=i),placeholder:"Buscar..."},{append:s(()=>[l(b,{name:"search"})]),_:1},8,["style","modelValue"]),g.value==="list"?(n(),c(_,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:s(()=>[Q((n(),c(j,{disable:o(d).platform.is.mobile},{default:s(()=>[N(R(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[D]])]),_:2},1032,["icon","onClick"])):p("",!0),e.inFullscreen?p("",!0):(n(),c(_,{key:2,flat:"",round:"",dense:"",icon:g.value==="grid"?"list":"grid_on",onClick:a[11]||(a[11]=i=>{g.value=g.value==="grid"?"list":"grid",t.separator=g.value==="grid"?"none":"horizontal"})},{default:s(()=>[Q((n(),c(j,{disable:o(d).platform.is.mobile},{default:s(()=>[N(R(g.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[D]])]),_:1},8,["icon"]))]),"body-cell-estado":s(e=>[l(M,{props:e},{default:s(()=>[l(re,{outline:"",class:"q-py-xs q-px-md",color:e.row.isActive?"secondary":"negative",label:e.row.isActive?"Aceptado":"Anulado"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":s(e=>[l(M,{props:e},{default:s(()=>[l(_,{round:"",color:"blue-grey",icon:"visibility",class:"q-mr-sm",onClick:i=>(A.value=!0,le(k)?k.value={...e.row}:k={...e.row}),size:"10px"},null,8,["onClick"]),e.row.isActive&&o($)("anular.compra")?(n(),c(_,{key:0,round:"",color:"blue-grey",onClick:i=>X(e.row),icon:"close",size:"10px"},null,8,["onClick"])):p("",!0)]),_:2},1032,["props"])]),"no-data":s(({icon:e})=>[r("div",Ve,[l(b,{size:"2em",name:"sentiment_dissatisfied"}),qe,l(b,{size:"2em",name:x.value?"filter_b_and_w":e},null,8,["name"])])]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),o(d).screen.xs&&o($)("crear.compra")?(n(),c(ne,{key:0,position:"bottom-right",offset:[18,18]},{default:s(()=>[l(_,{round:"",color:"secondary",size:"lg",icon:"add",onClick:a[12]||(a[12]=e=>t.$router.push("/compras/add"))})]),_:1})):p("",!0),l(ee,{modelValue:A.value,"onUpdate:modelValue":a[13]||(a[13]=e=>A.value=e)},{default:s(()=>[l(ce,{detalleData:o(k)},null,8,["detalleData"])]),_:1},8,["modelValue"])],64))}});export{Ge as default};
