import{Q as E,a as A,b as I}from"./QTable.b8561b9c.js";import{Q as L,a as S}from"./QTooltip.1c4eedd1.js";import{Q as H}from"./QSelect.d548565d.js";import{d as j,r as n,a as G,v as O,o,c as w,e as m,f as t,g as s,aP as R,ab as i,a7 as c,ad as g,aT as J,ah as F,ag as K,ac as M,h as f,Q as W,aU as X,i as C,N as z,a8 as k,a9 as Q}from"./index.56865ea9.js";import{Q as Y}from"./QBadge.2548bc93.js";import{Q as Z}from"./QPageSticky.a2386b91.js";import{C as N}from"./ClosePopup.6ede23af.js";import{a as $}from"./axios.260c29fd.js";import{u as ee,_ as ae}from"./DetalleProducts.41cfc077.js";import{u as le}from"./useHelpers.16467bd1.js";import{a as se,u as te}from"./use-quasar.fe1b283b.js";import"./QList.cc87e7d3.js";import"./QItemLabel.11af56b0.js";import"./QChip.e08c3411.js";import"./format.2bc25e5f.js";import"./QInnerLoading.2acd2285.js";const oe={class:"q-ma-lg q-pt-md"},re={class:"row q-col-gutter-lg"},ne={class:"col-12"},ie={key:0,class:"text-center row justify-center",style:{width:"100%"}},ue=m("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Compras ",-1),de=[ue],ce=m("label",{class:"q-mr-sm row items-center"},[m("span",null,"Sucursal: ")],-1),me={class:"full-width row flex-center text-lime-10 q-gutter-sm"},ge=m("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun resultado ",-1),Fe=j({__name:"IndexPage",setup(pe){const P=[{name:"acciones",label:"acciones",align:"center"},{name:"sucursal",label:"Sucursal",align:"center",field:"sucursal_name"},{name:"num_comprobante",label:"Num Comprobante",field:"numero_comprobante",align:"center"},{name:"usuario",label:"Usuario",align:"center",field:"user_name"},{name:"proveedor",label:"Proveedor",align:"center",field:"proveedor_name"},{name:"fecha",label:"Fecha Compra",align:"center",field:"fecha_compra"},{name:"total",label:"Total",field:"total",align:"center"},{name:"estado",label:"Estado",field:"estado",align:"center"}],V=n([]),x=n(!1);n({desde:"",hasta:"",pv_id:""});const v=n("");n({}),ee();const{mostrarNotify:q}=le(),u=se(),p=n(!1),T=te(),{claim:b}=G.read(T.token),h=n(""),_=n([]),y=async()=>{try{p.value=!0,_.value.length==0&&await D();let l={headers:{sucursal_id:h.value}};const{data:a}=await $.get("/buys",l);a.map(e=>{e.fecha_compra=e.fecha_compra,e.sucursal_name=e.sucursal_id.nombre,e.proveedor_name=e.proveedor_id.razon_social,e.user_name=e.user_id.fullName,e.total=`$${e.total}`}),V.value=a,p.value=!1}catch(l){console.log(l),p.value=!1}},B=l=>{u.dialog({title:"<center>\xBFEstas seguro de anular esta compra?</center>",message:`<span><strong>Num Comprobante</strong>: ${l.numero_comprobante}</span> <br>
              <span class='q-my-lg'><strong>Proveedor</strong>: ${l.proveedor_name}</span> <br>
              <span class='q-my-lg'><strong>Fecha/Hora</strong>: ${l.fecha_compra}</span> <br>
              <span><strong>Total</strong>: ${l.total}</span> <br>`,html:!0,ok:{push:!0,label:"Anular",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{u.loading.show({message:"Cargando..."}),await $.delete(`/buys/${l.id}`),q("positive","Compra Anulada exitosamente"),y(),u.loading.hide()}catch(a){console.log(a)}})},D=async()=>{p.value=!0;try{const{data:l}=await $.get("/sucursal");l.forEach(a=>{_.value.push({label:a.nombre,value:a.id})}),_.value.length!==0&&(h.value=_.value[0].value)}catch(l){q("warning",l.response.data.message)}p.value=!1};y(),O(v,(l,a)=>{y()});const d=n("list"),U=n({rowsPerPage:10});return(l,a)=>(o(),w(F,null,[m("div",oe,[m("div",re,[m("div",ne,[t(R,{flat:"",class:"shadow_custom"},{default:s(()=>[t(E,{"title-class":"text-grey-7 text-h6",rows:V.value,loading:p.value,"hide-header":d.value==="grid",columns:P,"row-key":"name",grid:d.value==="grid",filter:v.value,pagination:U.value},{header:s(e=>[t(L,{props:e,style:{height:"60px"}},{default:s(()=>[(o(!0),w(F,null,K(e.cols,r=>(o(),c(I,{key:r.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:s(()=>[k(Q(r.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":s(e=>[i(b).roles[0]!=="Super-Administrador"&&i(b).roles[0]!=="Administrador"?(o(),w("div",ie,de)):g("",!0),i(b).roles[0]=="Super-Administrador"||i(b).roles[0]=="Administrador"?(o(),w("div",{key:1,style:{display:"flex"},class:M([i(u).screen.xs?"q-mb-md":""])},[ce,t(H,{outlined:"",dense:"",modelValue:h.value,"onUpdate:modelValue":[a[0]||(a[0]=r=>h.value=r),a[1]||(a[1]=r=>y())],"emit-value":"","map-options":"",options:_.value},null,8,["modelValue","options"])],2)):g("",!0)]),"top-right":s(e=>[i(u).screen.xs?g("",!0):(o(),c(f,{key:0,onClick:a[2]||(a[2]=r=>l.$router.push("/compras/add")),outline:"",color:"primary",label:"Agregar Compra",class:"q-mr-xs"})),t(W,{style:X(i(u).screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=r=>v.value=r),placeholder:"Buscar..."},{append:s(()=>[t(C,{name:"search"})]),_:1},8,["style","modelValue"]),d.value==="list"?(o(),c(f,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:s(()=>[z((o(),c(S,{disable:i(u).platform.is.mobile},{default:s(()=>[k(Q(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[N]])]),_:2},1032,["icon","onClick"])):g("",!0),e.inFullscreen?g("",!0):(o(),c(f,{key:2,flat:"",round:"",dense:"",icon:d.value==="grid"?"list":"grid_on",onClick:a[4]||(a[4]=r=>{d.value=d.value==="grid"?"list":"grid",l.separator=d.value==="grid"?"none":"horizontal"})},{default:s(()=>[z((o(),c(S,{disable:i(u).platform.is.mobile},{default:s(()=>[k(Q(d.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[N]])]),_:1},8,["icon"]))]),"body-cell-estado":s(e=>[t(A,{props:e},{default:s(()=>[t(Y,{outline:"",class:"q-py-xs q-px-md",color:e.row.isActive?"secondary":"negative",label:e.row.isActive?"Aceptado":"Anulado"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":s(e=>[t(A,{props:e},{default:s(()=>[t(f,{round:"",color:"blue-grey",icon:"visibility",class:"q-mr-sm",onClick:r=>(x.value=!0,l.detalleData={...e.row}),size:"10px"},null,8,["onClick"]),e.row.isActive?(o(),c(f,{key:0,round:"",color:"blue-grey",onClick:r=>B(e.row),icon:"close",size:"10px"},null,8,["onClick"])):g("",!0)]),_:2},1032,["props"])]),"no-data":s(({icon:e})=>[m("div",me,[t(C,{size:"2em",name:"sentiment_dissatisfied"}),ge,t(C,{size:"2em",name:v.value?"filter_b_and_w":e},null,8,["name"])])]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),i(u).screen.xs?(o(),c(Z,{key:0,position:"bottom-right",offset:[18,18]},{default:s(()=>[t(f,{round:"",color:"secondary",size:"lg",icon:"add",onClick:a[5]||(a[5]=e=>l.$router.push("/compras/add"))})]),_:1})):g("",!0),t(J,{modelValue:x.value,"onUpdate:modelValue":a[6]||(a[6]=e=>x.value=e)},{default:s(()=>[t(ae,{detalleData:l.detalleData},null,8,["detalleData"])]),_:1},8,["modelValue"])],64))}});export{Fe as default};
