import{Q as pe,a as H}from"./QBreadcrumbs.50604a24.js";import{p as m,m as oe,bx as be,by as he,bz as ne,at as _e,r as S,aH as we,n as U,bA as ye,v as X,B as xe,i as P,s as qe,h as B,z as Ae,aO as Ce,u as Se,l as Ve,x as ke,o as x,c as Y,e as l,ac as v,f as n,g as o,a8 as C,a9 as q,ab as i,a7 as $,bB as $e,aS as K,ad as G,br as Be,Q as W,aT as Oe,ah as De,bs as Ie,P as J,w as Qe,N as te}from"./index.5d1f09cd.js";import{b as Pe,a as E,Q as L,c as ae}from"./QItemLabel.762c223e.js";import{Q as se}from"./QSelect.c4dd2bd4.js";import{Q as Ne,a as I}from"./QTable.c7b8d510.js";import{Q as Re}from"./QBadge.830994ce.js";import{Q as Te}from"./QList.225b0277.js";import{Q as Fe}from"./QBtnGroup.0a1fe0b9.js";import{Q as Me}from"./QForm.ffdb1aff.js";import{C as le}from"./ClosePopup.488eb010.js";import{a as Q}from"./axios.8d86dbdf.js";import{u as Ue}from"./useHelpers.087d2c36.js";import{d as Ee}from"./date.f629cf57.js";import{u as Le,_ as je}from"./SelectProduct.e21c0e01.js";import"./QChip.b975933a.js";import"./format.2bc25e5f.js";import"./use-quasar.fbb59c95.js";import"./QInnerLoading.dc866427.js";const ze=[m("g",{transform:"translate(20 50)"},[m("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.6"},[m("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),m("g",{transform:"translate(50 50)"},[m("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.8"},[m("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.1s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),m("g",{transform:"translate(80 50)"},[m("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.9"},[m("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.2s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])])];var He=oe({name:"QSpinnerFacebook",props:be,setup(t){const{cSize:d,classes:c}=he(t);return()=>m("svg",{class:c.value,width:d.value,height:d.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},ze)}});const Ye=Object.keys(ne),Ke=t=>Ye.reduce((d,c)=>{const g=t[c];return g!==void 0&&(d[c]=g),d},{});var Ge=oe({name:"QBtnDropdown",props:{...ne,..._e,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(t,{slots:d,emit:c}){const{proxy:g}=Ae(),_=S(t.modelValue),b=S(null),N=we(),h=U(()=>{const r={"aria-expanded":_.value===!0?"true":"false","aria-haspopup":"true","aria-controls":N,"aria-label":t.toggleAriaLabel||g.$q.lang.label[_.value===!0?"collapse":"expand"](t.label)};return(t.disable===!0||t.split===!1&&t.disableMainBtn===!0||t.disableDropdown===!0)&&(r["aria-disabled"]="true"),r}),R=U(()=>"q-btn-dropdown__arrow"+(_.value===!0&&t.noIconAnimation===!1?" rotate-180":"")+(t.split===!1?" q-btn-dropdown__arrow-container":"")),T=U(()=>ye(t)),O=U(()=>Ke(t));X(()=>t.modelValue,r=>{b.value!==null&&b.value[r?"show":"hide"]()}),X(()=>t.split,k);function p(r){_.value=!0,c("beforeShow",r)}function j(r){c("show",r),c("update:modelValue",!0)}function F(r){_.value=!1,c("beforeHide",r)}function w(r){c("hide",r),c("update:modelValue",!1)}function f(r){c("click",r)}function V(r){Ce(r),k(),c("click",r)}function D(r){b.value!==null&&b.value.toggle(r)}function M(r){b.value!==null&&b.value.show(r)}function k(r){b.value!==null&&b.value.hide(r)}return Object.assign(g,{show:M,hide:k,toggle:D}),xe(()=>{t.modelValue===!0&&M()}),()=>{const r=[m(P,{class:R.value,name:t.dropdownIcon||g.$q.iconSet.arrow.dropdown})];return t.disableDropdown!==!0&&r.push(m(Pe,{ref:b,id:N,class:t.contentClass,style:t.contentStyle,cover:t.cover,fit:!0,persistent:t.persistent,noRouteDismiss:t.noRouteDismiss,autoClose:t.autoClose,anchor:t.menuAnchor,self:t.menuSelf,offset:t.menuOffset,separateClosePopup:!0,transitionShow:t.transitionShow,transitionHide:t.transitionHide,transitionDuration:t.transitionDuration,onBeforeShow:p,onShow:j,onBeforeHide:F,onHide:w},d.default)),t.split===!1?m(B,{class:"q-btn-dropdown q-btn-dropdown--simple",...O.value,...h.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:f},{default:()=>qe(d.label,[]).concat(r),loading:d.loading}):m(Fe,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:t.rounded,square:t.square,...T.value,glossy:t.glossy,stretch:t.stretch},()=>[m(B,{class:"q-btn-dropdown--current",...O.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:V},{default:d.label,loading:d.loading}),m(B,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...h.value,...T.value,disable:t.disable===!0||t.disableDropdown===!0,rounded:t.rounded,color:t.color,textColor:t.textColor,dense:t.dense,size:t.size,padding:t.padding,ripple:t.ripple},()=>r)])}}});const We={class:"q-ma-lg q-pt-md q-mb-none",style:{"margin-bottom":"10px"}},Je={class:"row q-col-gutter-lg"},Xe=l("label",{class:"text-h6 text-center"},"Nueva Venta/Proforma",-1),Ze=[Xe],et={class:"row q-mx-lg q-col-gutter-md"},tt={class:"text-weight-regular"},at=l("span",{class:"q-mr-sm"},"N\xB0 Factura:",-1),st={key:1,class:"text-weight-regular"},lt={class:"col-xs-12 col-sm-12 col-md-6 q-mt-md q-pl-none"},ot=l("label",null,"Seleccionar Cliente: ",-1),nt=l("label",null,"Seleccionar Sucursal: ",-1),rt={class:"row q-pt-lg q-mx-lg"},it={class:"col-xs-12 col-md-6"},ut=l("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),dt={class:"row q-mx-lg justify-center"},ct={class:"col-12"},mt={class:"full-width row flex-center text-lime-10 q-gutter-sm"},ft=l("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1),vt={class:"col-12",style:{display:"flex","justify-content":"end"}},gt={class:"text-right"},pt=l("td",null,[l("b",null,"TOTAL BRUTO:")],-1),bt={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},ht={class:"text-right"},_t=l("td",null,[l("b",null,"DESCUENTOS:")],-1),wt={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},yt={class:"text-right"},xt=l("td",null,[l("b",null,"SUBTOTAL:")],-1),qt={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},At={class:"text-right"},Ct=l("td",null,[l("b",null,"IVA(12%):")],-1),St={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},Vt={class:"text-right"},kt=l("td",null,[l("b",null,"TOTAL DE VENTA:")],-1),$t={style:{width:"50px"}},Kt={__name:"AddVenta",setup(t){const{filterByCodBarra:d,columns:c,rows:g,modalSelectProducto:_,loadingState:b,listProductos:N,valorFactura:h,agregarAndValidarStock:R,filterArticulo:T,getSubtotalByProduct:O,sucursal_selected:p,quitarArticulo:j}=Le();let F=[];const w=S([]),{claim:f,mostrarNotify:V}=Ue(),D=S([]),M=S(!1),k=S(!1),r=Date.now();let re=Ee.formatDate(r,"DD/MM/YYYY");(f.roles[0]!=="Super-Administrador"||f.roles[0]!=="Administrador")&&(p.value=f.sucursales[0]);const ie=Se(),Z=Ve();c.value[7]={name:"pvp",label:"Precio de Venta",align:"center"};const u=S({customer_id:"386f5a32-7c96-4a51-8f50-86ea8338325b",numero_comprobante:"--- --- ---------",products:[],user_id:""}),y=S({customer_id:{message:"",isValid:!0},sucursal_id:{message:"",isValid:!0}});X(p,(s,e)=>{ee()});const ue=async s=>{D.value=[];const{data:e}=await Q.get(`/sucursal/find/${s}/company`);e.forEach(a=>{D.value.push({label:a.nombre,value:a.id})})},de=async()=>{if(Z.params.venta_id!==""){const{data:s}=await Q.get(`/invoices/filterInvoice/${Z.params.venta_id}`);u.value.customer_id=s.customer_id.id,u.value.id=s.id,u.value.clave_acceso=s.clave_acceso,u.value.estadoSRI=s.estadoSRI,p.value=s.sucursal_id.id,s.invoiceToProduct.forEach(e=>{e.product_id.cantidad=e.cantidad,e.product_id.descuento=parseFloat(e.descuento),e.product_id.v_total=e.v_total,R(e.product_id,"proforma")})}},ce=s=>{R(s,"venta"),_.value=!1},me=async()=>{const s=u.value.customer_id;u.value.customer_id="",M.value=!1;try{const{data:e}=await Q.get("/customers");w.value=[],e.forEach(a=>{w.value.push({label:a.nombres,value:a.id,num_doc:a.numero_documento})}),w.value.unshift({label:"CONSUMIDOR FINAL",value:"386f5a32-7c96-4a51-8f50-86ea8338325b",cedula:"9999999999999"}),F=w.value,u.value.customer_id=s,de()}catch(e){console.log(e)}},fe=(s="",e)=>{if(s==="")return e(()=>{w.value=F});e(()=>{const a=s.toLowerCase();w.value=w.value.filter(A=>A.num_doc.indexOf(a)>-1||A.label.toLowerCase().indexOf(a)>-1)})},ve=()=>{let s=!1;return(f.roles[0]=="Super-Administrador"||f.roles[0]=="Administrador")&&p.value==""&&(y.value.sucursal_id.message="Debes seleccionar una sucursal",y.value.sucursal_id.isValid=!1,s=!0),h.value.total>50&&u.value.customer_id=="386f5a32-7c96-4a51-8f50-86ea8338325b"&&(y.value.customer_id.message="La factura supera los $50.00, no puede ser emitida a CONSUMIDOR FINAL",y.value.customer_id.isValid=!1,s=!0),g.value.length==0&&(s=!0,V("warning","Debes agregar algun producto..")),g.value.forEach((e,a)=>{e.cantidad<=0&&(s=!0,V("warning",`Agrega una cantidad cantidad al producto: ${e.nombre} de la fila: ${a+1}`)),e.cantidad>e.stock&&(s=!0,V("warning",`La cantidad de venta del producto: ${e.nombre} supera su stock disponible`))}),s},z=async s=>{if(ve())return;u.value={...u.value,...h.value,products:g.value,user_id:f.id,tipo:s};let e;s=="EMISION"&&(e="\xBFDeseas emitir factura de esta proforma?"),s=="FACTURA"&&(e="\xBFDeseas generar esta FACTURA?"),s=="PROFORMA"&&(e="\xBFDeseas guardar como PROFORMA?"),Ie.create({title:e,ok:{push:!0,color:"cyan-10",label:"Enviar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{J.show({message:"Cargando..."});let a={headers:{sucursal_id:p.value}};await Q.post("/invoices",u.value,a),J.hide(),V("positive","Venta realizada exitosamente"),ie.push("/ventas")}catch(a){console.log(a),J.hide()}})},ge=()=>{if((f.roles[0]=="Super-Administrador"||f.roles[0]=="Administrador")&&typeof p.value=="undefined")return V("warning","Elige una sucursal primeramente");T("venta")},ee=async()=>{k.value=!0;let s={headers:{sucursal_id:p.value}};const{data:e}=await Q.get("/CE/facturas/getNumFactura",s);u.value.numero_comprobante=e.numComprobante,k.value=!1};return ke(()=>{g.value=[]}),f.roles[0]=="Super-Administrador"||f.roles[0]=="Administrador"?ue(f.company.id):ee(),me(),(s,e)=>(x(),Y(De,null,[l("div",We,[l("div",Je,[l("div",{class:v(["col-xs-12 col-md-6",[s.$q.screen.width<1022?"q-pt-sm":""]])},[n(pe,{class:v(["row q-mr-xs",[s.$q.screen.width<1022?"justify-center q-pt-sm":"justify-start "]])},{default:o(()=>[n(H,{label:"Inicio",icon:"home",to:"/"}),n(H,{label:"Ventas",icon:"payments",to:"/ventas"}),n(H,{label:"Venta/Prof.",icon:"add_circle"})]),_:1},8,["class"])],2),l("div",{class:v(["col-xs-12 col-md-6",[s.$q.screen.width<1022?"text-center q-pt-sm":"text-right"]])},Ze,2)])]),l("div",et,[l("div",{class:v(["col-xs-12 col-md-6 q-pt-xs q-mt-md",s.$q.screen.width>=1023||"text-center"])},[l("label",{class:v(["text-weight-medium",[s.$q.screen.xs?"text-subtitle1":"text-h5"]])},[C("Fecha de Emisi\xF3n: "),l("span",tt,q(i(re)),1)],2)],2),l("div",{class:v(["col-xs-12 col-md-6",s.$q.screen.width<=1023?"text-center q-pt-sm":"text-right q-pt-xs q-mt-md"])},[l("label",{class:v(["q-mr-lg text-weight-medium",[s.$q.screen.xs?"text-subtitle1":"text-h5"]])},[at,k.value?(x(),$(He,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(x(),Y("span",st,q(u.value.numero_comprobante),1))],2)],2),l("div",lt,[ot,n(se,{color:"orange",filled:"",modelValue:u.value.customer_id,"onUpdate:modelValue":[e[1]||(e[1]=a=>u.value.customer_id=a),e[2]||(e[2]=a=>y.value.customer_id.isValid=!0)],options:w.value,"emit-value":"","map-options":"",dense:"",error:!y.value.customer_id.isValid,onFilter:fe,"use-input":"","input-debounce":"0"},$e({error:o(()=>[l("label",{class:v(s.$q.dark.isActive?"text-red-4":"text-negative")},q(y.value.customer_id.message),3)]),"no-option":o(()=>[n(E,null,{default:o(()=>[n(L,{class:"text-grey"},{default:o(()=>[C(" No hay resultados ")]),_:1})]),_:1})]),_:2},[u.value.customer_id&&u.value.customer_id!=="CONSUMIDOR FINAL"?{name:"append",fn:o(()=>[n(P,{name:"cancel",onClick:e[0]||(e[0]=Qe(a=>u.value.customer_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","error"])]),i(f).roles[0]=="Super-Administrador"||i(f).roles[0]=="Administrador"?(x(),Y("div",{key:0,class:v(["col-xs-12 col-md-5 q-mt-md",s.$q.screen.width<=1023?"q-pl-none":"offset-1"])},[nt,n(se,{filled:"",modelValue:i(p),"onUpdate:modelValue":[e[3]||(e[3]=a=>K(p)?p.value=a:null),e[4]||(e[4]=a=>(y.value.sucursal_id.isValid=!0,g.value=[]))],error:!y.value.sucursal_id.isValid,options:D.value,"emit-value":"","map-options":"",dense:""},{error:o(()=>[l("label",{class:v(s.$q.dark.isActive?"text-red-4":"text-negative")},q(y.value.sucursal_id.message),3)]),"no-option":o(()=>[n(E,null,{default:o(()=>[n(L,{class:"text-grey"},{default:o(()=>[C(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","error","options"])],2)):G("",!0)]),l("div",rt,[l("div",it,[ut,n(W,{outlined:"","bottom-slots":"",loading:i(b),dense:"",modelValue:i(d),"onUpdate:modelValue":e[6]||(e[6]=a=>K(d)?d.value=a:null),modelModifiers:{trim:!0},onKeyup:Be(ge,["enter"])},{append:o(()=>[i(d)!==""?(x(),$(P,{key:0,name:"close",onClick:e[5]||(e[5]=a=>d.value=""),class:"cursor-pointer"})):G("",!0),n(P,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])])]),n(Me,{onSubmit:e[10]||(e[10]=a=>z("EMISION"))},{default:o(()=>[l("div",dt,[l("div",ct,[n(Ne,{rows:i(g),columns:i(c),"row-key":"name",class:v([s.$q.dark.isActive?"":"my-sticky-header-table3"]),"hide-pagination":!0,"rows-per-page-options":[50]},{"no-data":o(({})=>[l("div",mt,[ft,n(P,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":o(a=>[n(I,{props:a},{default:o(()=>[n(W,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:A=>i(O)(a.row,"ventas"),min:"0",max:a.row.stock,type:"number",style:{width:"100px"},modelValue:a.row.cantidad,"onUpdate:modelValue":A=>a.row.cantidad=A,modelModifiers:{trim:!0}},null,8,["onChange","max","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-descuento":o(a=>[n(I,{props:a},{default:o(()=>[n(W,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:A=>i(O)(a.row,"ventas"),min:"0",type:"number",style:{width:"100px"},modelValue:a.row.descuento,"onUpdate:modelValue":A=>a.row.descuento=A},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":o(a=>[n(I,{props:a},{default:o(()=>[C(q(a.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":o(a=>[n(I,{props:a},{default:o(()=>[C(" $"+q(a.row.pvp),1)]),_:2},1032,["props"])]),"body-cell-acciones":o(a=>[n(I,{props:a},{default:o(()=>[n(B,{round:"",color:"deep-orange",onClick:A=>i(j)(a.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),l("div",vt,[l("table",{class:v([s.$q.screen.xs?"":"linearTablaDetalle"])},[l("tr",gt,[pt,l("td",bt," $"+q(i(h).subtotal),1)]),l("tr",ht,[_t,l("td",wt," $"+q(i(h).descuento),1)]),l("tr",yt,[xt,l("td",qt," $"+q(i(h).subtotal-i(h).descuento),1)]),l("tr",At,[Ct,l("td",St," $"+q(i(h).iva),1)]),l("tr",Vt,[kt,l("td",$t,[n(Re,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${i(h).total}`},null,8,["label"])])])],2)]),l("div",{class:v(["col-12 flex q-mt-md q-my-lg",[s.$q.screen.width<600?"justify-center":"justify-between"]])},[s.$q.screen.width>600?(x(),$(B,{key:0,icon:"arrow_back",onClick:e[7]||(e[7]=a=>s.$router.push("/ventas")),outline:"",rounded:"",class:"q-mr-lg",color:s.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:o(()=>[C(" \xA0 Regresar ")]),_:1},8,["color"])):G("",!0),s.$route.params.venta_id==""?(x(),$(Ge,{key:1,outline:"",rounded:"",style:{color:"#696cff"},label:"Generar",class:v(s.$q.screen.width>=1023?"q-px-xl":"full-width")},{default:o(()=>[n(Te,null,{default:o(()=>[te((x(),$(E,{clickable:"",onClick:e[8]||(e[8]=a=>z("FACTURA"))},{default:o(()=>[n(L,null,{default:o(()=>[n(ae,null,{default:o(()=>[C("FACTURA")]),_:1})]),_:1})]),_:1})),[[le]]),te((x(),$(E,{type:"submit",clickable:"",onClick:e[9]||(e[9]=a=>z("PROFORMA"))},{default:o(()=>[n(L,null,{default:o(()=>[n(ae,null,{default:o(()=>[C("PROFORMA")]),_:1})]),_:1})]),_:1})),[[le]])]),_:1})]),_:1},8,["class"])):(x(),$(B,{key:2,type:"submit",label:"Emitir Factura",class:v(s.$q.screen.width>=1023?"q-px-xl":"full-width"),outline:"",rounded:"",style:{color:"#696cff"}},null,8,["class"]))],2)])]),_:1}),n(Oe,{modelValue:i(_),"onUpdate:modelValue":e[11]||(e[11]=a=>K(_)?_.value=a:null)},{default:o(()=>[n(je,{listProductos:i(N),onAgregarProduct:ce},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}};export{Kt as default};
