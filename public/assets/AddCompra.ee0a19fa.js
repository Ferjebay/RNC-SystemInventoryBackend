import{Q as ie,a as B}from"./QBreadcrumbs.1267adc5.js";import{r as q,u as ce,v as J,x as me,o as f,c as $,e as s,ae as i,f as o,g as t,aU as K,ba as W,ad as r,bb as I,aj as pe,bB as fe,P as j,aV as X,h as R,w as ve,aa as m,Q as V,i as Z,O as ge,af as b,a9 as T,B as F,al as z,ab as x,bj as _e}from"./index.fdc1268b.js";import{a as h,Q as y,d as L}from"./format.dc12c0ef.js";import{Q as S}from"./QSelect.e64e646f.js";import{Q as be}from"./QDate.79398b67.js";import{Q as he}from"./QPopupProxy.f34696f2.js";import{Q as C}from"./QTd.6312596b.js";import{Q as ye}from"./QTable.77890ccf.js";import{Q as we}from"./QBadge.c8304c49.js";import{Q as qe}from"./QForm.5cf1f317.js";import{C as Ve}from"./ClosePopup.117d4991.js";import{u as xe}from"./useHelpers.3d139f1a.js";import{d as ee}from"./date.7aa5471f.js";import{u as Ae,a as De}from"./AddProveedor.28a9335a.js";import{_ as $e}from"./SelectProduct.1cbcd809.js";import{u as Ie}from"./useProduct.68b9e1d6.js";import"./QList.e642c693.js";import"./use-quasar.1d150640.js";import"./axios.3804d50e.js";import"./provincias.d5c49733.js";import"./QInnerLoading.13ab5f20.js";const Re={class:"q-ma-lg q-pt-md q-mb-none",style:{"margin-bottom":"10px"}},Se={class:"row q-col-gutter-lg"},Ce=s("label",{class:"text-h6 text-center"},"Nueva Compra",-1),Pe=[Ce],ke={class:"row q-pt-none q-mx-lg q-col-gutter-md"},Qe={class:"col-xs-12 col-md-5 q-mt-lg q-pl-none"},Ue=s("label",null,"Seleccionar Proveedor: ",-1),Te=s("label",null,"Numero de Comprobante: ",-1),Ne=s("label",null,"Fecha de compra: ",-1),Oe={class:"row items-center justify-end"},Me=s("label",null,"Seleccionar Sucursal: ",-1),Ee={key:1,class:"col-xs-12 col-md-5 q-pl-none"},Be=s("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),je=s("label",null,"Descripci\xF3n: ",-1),Fe={key:2,class:"col-xs-12 col-md-5 q-pl-none"},ze=s("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),Le={class:"col-xs-12 col-md-5"},Ye=s("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),Ge={class:"col-12"},He={class:"full-width row flex-center text-lime-10 q-gutter-sm"},Je=s("span",{class:"text-subtitle1"}," Agrega alg\xFAn producto ",-1),Ke={class:"col-12",style:{display:"flex","justify-content":"end"}},We={class:"text-right"},Xe=s("td",null,[s("b",null,"SUBTOTAL:")],-1),Ze={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},el={class:"text-right"},ll=s("td",null,[s("b",null,"IVA(12%):")],-1),ol={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},tl={class:"text-right"},al=s("td",null,[s("b",null,"TOTAL DESCUENTO:")],-1),sl={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},rl={class:"text-right"},nl=s("td",null,[s("b",null,"TOTAL DE COMPRA:")],-1),dl={style:{width:"50px"}},Cl={__name:"AddCompra",setup(ul){const{agregarAndValidarStock:P,claim:u,filterByCodBarra:c,columns:le,rows:p,modalSelectProducto:k,getSubtotalByProduct:N,loadingState:A,listProductos:oe,quitarArticulo:te,sucursal_selected:v,valorFactura:D}=Ie();let{actualizarLista:ae}=Ae(),Y=[];const w=q([]),g=q([]),O=q([]),Q=q(!1),{api:U,mostrarNotify:_}=xe(),M=q([]),d=q({proveedor_id:"",numero_comprobante:"",descripcion:"",inputDate:ee.formatDate(Date.now(),"YYYY/MM/DD")}),se=ce(),re=a=>{P(a,"compras"),k.value=!1},ne=async a=>{M.value=[];const{data:l}=await U.get(`/sucursal/find/${a}/company`);l.forEach(e=>{M.value.push({label:e.nombre,value:e.id})})};J(v,(a,l)=>{H()}),J(ae,(a,l)=>{a&&G()});const G=async()=>{Q.value=!1;try{const{data:a}=await U.get("/providers/true");w.value=[],a.forEach(l=>{w.value.push({label:l.razon_social,value:l.id,num_doc:l.numero_documento})}),Y=w.value}catch(a){console.log(a)}},de=async()=>{let a=!1;if(d.value.proveedor_id=="")return _("warning","Debes elegir algun proveedor");if(d.value.numero_comprobante=="")return _("warning","Por favor ingresa el numero de comprobante");if(d.value.descripcion=="")return _("warning","Por favor ingresa una descripci\xF3n");if((u.roles[0]=="SUPER-ADMINISTRADOR"||u.roles[0]=="ADMINISTRADOR")&&v.value=="")return _("warning","Debes seleccionar una sucursal");if(p.value.length==0)return _("warning","Debes agregar algun producto..");p.value.forEach((l,e)=>{l.cantidad<=0&&(_("warning",`Agrega una cantidad cantidad al producto: ${l.nombre} de la fila: ${e+1}`),a=!0)}),!a&&(d.value.products=p.value,d.value={...d.value,...D.value,fecha_compra:ee.formatDate(d.value.inputDate,"DD/MM/YYYY"),user_id:u.id},fe.create({title:"\xBFDeseas agregar esta compra?",ok:{push:!0,color:"cyan-10",label:"Agregar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{j.show({message:"Cargando..."});let l={headers:{"sucursal-id":v.value}};await U.post("/buys",d.value,l),j.hide(),_("positive","Compra realizada exitosamente"),se.push("/compras")}catch(l){_("warning",l.response.data.message),j.hide()}}))};(u.roles[0]=="SUPER-ADMINISTRADOR"||u.roles[0]=="ADMINISTRADOR")&&ne(u.company.id),G();const ue=(a="",l)=>{if(a==="")return l(()=>{w.value=Y});l(()=>{const e=a.toLowerCase();w.value=w.value.filter(n=>n.num_doc.indexOf(e)>-1||n.label.toLowerCase().indexOf(e)>-1)})},E=(a="",l)=>{if(a===""){l(()=>{g.value=O.value});return}l(()=>{const e=a.toLowerCase();g.value=O.value.filter(n=>n.label.toLowerCase().indexOf(e)>-1)})},H=async()=>{A.value=!0;let a={"sucursal-id":v.value};try{const{data:l}=await U.get("/products",{params:{page:1,limit:1e5,busqueda:""},headers:a});g.value=[],l.items.forEach(e=>{g.value.push({label:e.nombre,value:e.id,detalles:e})}),O.value=g.value,A.value=!1}catch(l){console.log(l)}};return(u.roles[0]!=="SUPER-ADMINISTRADOR"||u.roles[0]!=="ADMINISTRADOR")&&(v.value=u.sucursales[0],H()),me(()=>{p.value=[]}),(a,l)=>(f(),$(pe,null,[s("div",Re,[s("div",Se,[s("div",{class:i(["col-xs-12 col-md-6",[a.$q.screen.width<1022?"q-pt-sm":""]])},[o(ie,{class:i(["row q-mr-xs",[a.$q.screen.width<1022?"justify-center q-pt-sm":"justify-start "]])},{default:t(()=>[o(B,{label:"Inicio",icon:"home",to:"/"}),o(B,{label:"Compras",icon:"shopping_cart",to:"/compras"}),o(B,{label:"Agregar Compra",icon:"add_circle"})]),_:1},8,["class"])],2),s("div",{class:i(["col-xs-12 col-md-6",[a.$q.screen.width<1022?"text-center q-pt-sm":"text-right"]])},Pe,2)])]),o(K,{class:"q-mt-none q-mx-lg"},{default:t(()=>[o(X,{class:"q-pt-none row"},{default:t(()=>[s("div",ke,[s("div",Qe,[Ue,o(S,{color:"orange",filled:"",modelValue:d.value.proveedor_id,"onUpdate:modelValue":l[1]||(l[1]=e=>d.value.proveedor_id=e),dense:"",options:w.value,"emit-value":"","map-options":"",onFilter:ue,"use-input":"","input-debounce":"0"},{append:t(()=>[o(R,{round:"",dense:"",flat:"",icon:"person_add",onClick:l[0]||(l[0]=ve(e=>Q.value=!0,["stop","prevent"]))})]),"no-option":t(()=>[o(h,null,{default:t(()=>[o(y,{class:"text-grey"},{default:t(()=>[m(" No hay resultados ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),s("div",{class:i(["col-xs-12 col-md-3",a.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[Te,o(V,{modelValue:d.value.numero_comprobante,"onUpdate:modelValue":l[2]||(l[2]=e=>d.value.numero_comprobante=e),"input-style":{textAlign:"center",fontSize:"16px"},filled:"",mask:"###-###-#########","fill-mask":"",dense:"",required:""},null,8,["modelValue"])],2),s("div",{class:i(["col-xs-12 col-md-4",a.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[Ne,o(V,{filled:"",dense:"",modelValue:d.value.inputDate,"onUpdate:modelValue":l[4]||(l[4]=e=>d.value.inputDate=e),"input-style":{textAlign:"center"},mask:"date",rules:["date"]},{append:t(()=>[o(Z,{name:"event",class:"cursor-pointer"},{default:t(()=>[o(he,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[o(be,{modelValue:d.value.inputDate,"onUpdate:modelValue":l[3]||(l[3]=e=>d.value.inputDate=e)},{default:t(()=>[s("div",Oe,[ge(o(R,{label:"Close",color:"primary",flat:""},null,512),[[Ve]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],2),r(u).roles[0]=="SUPER-ADMINISTRADOR"||r(u).roles[0]=="ADMINISTRADOR"?(f(),$("div",{key:0,class:i(["col-xs-12 col-md-5 q-ml-none q-pl-none",a.$q.screen.width>=1023||"q-pt-none"])},[Me,o(S,{filled:"",modelValue:r(v),"onUpdate:modelValue":[l[5]||(l[5]=e=>I(v)?v.value=e:null),l[6]||(l[6]=e=>p.value=[])],options:M.value,"emit-value":"","map-options":"",dense:""},{"no-option":t(()=>[o(h,null,{default:t(()=>[o(y,{class:"text-grey"},{default:t(()=>[m(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])],2)):b("",!0),r(u).roles[0]!=="SUPER-ADMINISTRADOR"&&r(u).roles[0]!=="ADMINISTRADOR"&&a.$q.screen.width>=1023?(f(),$("div",Ee,[Be,o(S,{filled:"",modelValue:r(c),"onUpdate:modelValue":[l[7]||(l[7]=e=>I(c)?c.value=e:null),l[8]||(l[8]=e=>r(P)(r(c).detalles,"compras"))],dense:"",options:g.value,onFilter:E,"use-input":"","input-debounce":"900"},{"no-option":t(()=>[o(h,null,{default:t(()=>[o(y,{class:"text-grey"},{default:t(()=>[m(" No hay resultados ")]),_:1})]),_:1})]),append:t(()=>[r(A)?(f(),T(F,{key:0,size:"1.2rem"})):b("",!0)]),option:t(e=>[o(h,z(e.itemProps,{class:r(p).some(n=>n.id==e.opt.value)?a.$q.dark.isActive?"bg-indigo-4":"bg-indigo-1":""}),{default:t(()=>[o(y,null,{default:t(()=>[o(L,null,{default:t(()=>[m(x(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","options"])])):b("",!0),s("div",{class:i(["col-xs-12 col-sm-12 col-md-7",a.$q.screen.width<=1023?"q-pl-none q-pt-sm":"q-pt-md"])},[je,o(V,{modelValue:d.value.descripcion,"onUpdate:modelValue":l[9]||(l[9]=e=>d.value.descripcion=e),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])],2),r(u).roles[0]=="SUPER-ADMINISTRADOR"||r(u).roles[0]=="ADMINISTRADOR"?(f(),$("div",Fe,[ze,o(S,{filled:"",modelValue:r(c),"onUpdate:modelValue":[l[10]||(l[10]=e=>I(c)?c.value=e:null),l[11]||(l[11]=e=>r(P)(r(c).detalles,"compras"))],dense:"",options:g.value,onFilter:E,"use-input":"","input-debounce":"900"},{"no-option":t(()=>[o(h,null,{default:t(()=>[o(y,{class:"text-grey"},{default:t(()=>[m(" No hay resultados ")]),_:1})]),_:1})]),append:t(()=>[r(A)?(f(),T(F,{key:0,size:"1.2rem"})):b("",!0)]),option:t(e=>[o(h,z(e.itemProps,{class:r(p).some(n=>n.id==e.opt.value)?a.$q.dark.isActive?"bg-indigo-4":"bg-indigo-1":""}),{default:t(()=>[o(y,null,{default:t(()=>[o(L,null,{default:t(()=>[m(x(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","options"])])):b("",!0)]),r(u).roles[0]!=="SUPER-ADMINISTRADOR"&&r(u).roles[0]!=="ADMINISTRADOR"&&a.$q.screen.width<=1023?(f(),$("div",{key:0,class:i(["row q-pt-lg q-mx-lg",[a.$q.screen.width<=1023?"justify-center":"justify-left q-ml-md"]])},[s("div",Le,[Ye,o(S,{filled:"",modelValue:r(c),"onUpdate:modelValue":[l[12]||(l[12]=e=>I(c)?c.value=e:null),l[13]||(l[13]=e=>r(P)(r(c).detalles,"compras"))],dense:"",options:g.value,onFilter:E,"use-input":"","input-debounce":"900"},{"no-option":t(()=>[o(h,null,{default:t(()=>[o(y,{class:"text-grey"},{default:t(()=>[m(" No hay resultados ")]),_:1})]),_:1})]),append:t(()=>[r(A)?(f(),T(F,{key:0,size:"1.2rem"})):b("",!0)]),option:t(e=>[o(h,z(e.itemProps,{class:r(p).some(n=>n.id==e.opt.value)?a.$q.dark.isActive?"bg-indigo-4":"bg-indigo-1":""}),{default:t(()=>[o(y,null,{default:t(()=>[o(L,null,{default:t(()=>[m(x(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","options"])])],2)):b("",!0)]),_:1})]),_:1}),o(qe,{onSubmit:de},{default:t(()=>[s("div",{class:i(["q-mx-lg justify-center",a.$q.screen.xs?"q-mt-lg":"q-mt-md"])},[s("div",Ge,[o(ye,{rows:r(p),columns:r(le),"row-key":"name","hide-pagination":!0,"rows-per-page-options":[50],class:i([a.$q.dark.isActive?"":"my-sticky-header-table3"])},{"no-data":t(({})=>[s("div",He,[Je,o(Z,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":t(e=>[o(C,{props:e,class:"flex flex-center"},{default:t(()=>[o(V,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:n=>r(N)(e.row),min:"0",type:"number",style:{width:"100px"},modelValue:e.row.cantidad,"onUpdate:modelValue":n=>e.row.cantidad=n,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":t(e=>[o(C,{props:e},{default:t(()=>[o(_e,{modelValue:e.row.aplicaIva,"onUpdate:modelValue":n=>e.row.aplicaIva=n},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-descuento":t(e=>[o(C,{props:e,class:"flex flex-center"},{default:t(()=>[o(V,{"input-class":"resaltarTextoInput",dense:"",required:"",min:"0",onChange:n=>r(N)(e.row),type:"number",style:{width:"100px"},modelValue:e.row.descuento,"onUpdate:modelValue":n=>e.row.descuento=n,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-pvm":t(e=>[o(C,{props:e,class:"flex flex-center"},{default:t(()=>[o(V,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:n=>r(N)(e.row),min:"0",type:"number",style:{width:"100px"},modelValue:e.row.precio_compra,"onUpdate:modelValue":n=>e.row.precio_compra=n,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":t(e=>[o(C,{props:e},{default:t(()=>[o(R,{round:"",color:"deep-orange",onClick:n=>r(te)(e.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),o(K,{class:"q-mt-md"},{default:t(()=>[o(X,{class:"q-pt-none row"},{default:t(()=>[s("div",Ke,[s("table",{class:i([a.$q.screen.xs?"q-pt-sm":"linearTablaDetalle"])},[s("tr",We,[Xe,s("td",Ze," $"+x(r(D).subtotal),1)]),s("tr",el,[ll,s("td",ol," $"+x(r(D).iva),1)]),s("tr",tl,[al,s("td",sl," $"+x(r(D).descuento),1)]),s("tr",rl,[nl,s("td",dl,[o(we,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${r(D).total}`},null,8,["label"])])])],2)]),s("div",{class:i(["col-12 flex q-mt-md q-pb-md",[a.$q.screen.width<600?"justify-center":"justify-between"]])},[a.$q.screen.width>600?(f(),T(R,{key:0,icon:"arrow_back",onClick:l[14]||(l[14]=e=>a.$router.push("/compras")),outline:"",rounded:"",class:"q-mr-lg",color:a.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:t(()=>[m(" \xA0 Regresar ")]),_:1},8,["color"])):b("",!0),o(R,{type:"submit",icon:"save",outline:"",rounded:"",class:i(a.$q.screen.width<600?"q-px-xl":"q-px-lg"),style:{color:"#696cff"}},{default:t(()=>[m(" \xA0 Guardar ")]),_:1},8,["class"])],2)]),_:1})]),_:1})],2)]),_:1}),o(W,{modelValue:Q.value,"onUpdate:modelValue":l[15]||(l[15]=e=>Q.value=e)},{default:t(()=>[o(De)]),_:1},8,["modelValue"]),o(W,{modelValue:r(k),"onUpdate:modelValue":l[16]||(l[16]=e=>I(k)?k.value=e:null)},{default:t(()=>[o($e,{listProductos:r(oe),onAgregarProduct:re},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}};export{Cl as default};
