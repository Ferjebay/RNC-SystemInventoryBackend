import{r as u,o as i,a9 as v,g as l,f as o,aV as J,e as s,aa as k,O,h as _,ah as me,i as q,af as p,ae as $,ab as h,c as A,ad as m,Q as z,aU as te,v as K,C as ce,ba as X,aj as ee,ai as ve,bc as ae,bB as pe,P as H}from"./index.1cbd9e99.js";import{Q as le}from"./QDate.40677a9e.js";import{Q as oe}from"./QPopupProxy.3985e831.js";import{Q as fe}from"./QInnerLoading.a031c8ab.js";import{Q as ge,a as be}from"./QTable.69088364.js";import{Q as _e,a as L}from"./QTooltip.813f37c5.js";import{Q as se}from"./QSelect.6382f384.js";import{Q as S}from"./QTd.5f7adff8.js";import{Q as ye}from"./QBadge.299ae865.js";import{Q as we}from"./QPageSticky.a901da36.js";import{C as B}from"./ClosePopup.90808a62.js";import{M as he}from"./index.2065a85c.js";import{u as xe}from"./useRolPermisos.01455327.js";import{u as ne}from"./useHelpers.a744ed64.js";import{d as ke}from"./date.339c78b6.js";import{a as Ve}from"./use-quasar.2394b267.js";import"./exceljs.min.20016c93.js";import{_ as Ce}from"./DetalleProducts.a6ae5918.js";import{e as qe}from"./vue3-q-tel-input.esm.b4e3dc51.js";import"./format.ccefe754.js";import"./QList.e00f48c7.js";import"./axios.d4266fd7.js";import"./QBtnDropdown.d9f6334a.js";import"./QBtnGroup.79e0a464.js";const $e={class:"text-h6 text-center"},Re={class:"row flex flex-center"},Qe={class:"col-xs-11 col-sm-9 text-center q-mt-md q-mb-lg"},Pe=s("label",null,"Enviar por:",-1),Ee={key:0,class:"col-xs-11 col-sm-9 text-center q-mb-md"},Ie=s("label",null,"Celular del cliente:",-1),De={key:1,class:"col-xs-11 col-sm-9 text-center"},Se=s("label",null,"Email del cliente:",-1),Ae={class:"col-xs-9 col-md-12 flex justify-center q-ml-none"},Fe={__name:"ModalReenviarComproantes",props:["detalleFactura"],emits:["closeModal"],setup(Y,{emit:V}){const R=Y,{api:x,claim:j,mostrarNotify:F}=ne(),E=u(!1),I=u(!1),t=u({tipo_envio:"",telefono:"",email:""});t.value.telefono=R.detalleFactura.customer_id.celular,t.value.email=R.detalleFactura.customer_id.email;const w=()=>{E.value=!1;const b=/^\w+([.-_+]?\w+)*@\w+([.-]?\w+)*(\.\w{2,10})+$/;let r=[];return t.value.tipo_envio=="whatsapp"&&r.push("telefono"),t.value.tipo_envio=="email"&&r.push("email"),t.value.tipo_envio=="ambas"&&(r=["telefono","email"]),t.value.tipo_envio==""&&(r=["tipo_envio"]),t.value.email.length>5&&!b.test(t.value.email)&&(c.value.email.message="Ingresa un email valido",c.value.email.isValid=!1,E.value=!0),r.forEach(f=>{t.value[f].length==0&&(c.value[f].message="Debes completar este campo",c.value[f].isValid=!1,E.value=!0)}),E.value},c=u({telefono:{message:"",isValid:!0},tipo_envio:{message:"",isValid:!0},email:{message:"",isValid:!0}}),D=async()=>{if(w())return;const{data:b}=await x.get(`/companies/find/${j.company.id}`);if(!((t.value.tipo_envio=="whatsapp"||t.value.tipo_envio=="ambas")&&!c.value.telefono.isValid))try{I.value=!0,await x.post("/CE/facturas/reenviar-comprobantes",{...t.value,telefono:b[0].telefono,number:t.value.telefono,factura:R.detalleFactura}),F("positive","Comprobantes enviados"),V("closeModal"),I.value=!1}catch(r){I.value=!1,F("warning",r.response.data.message),V("closeModal")}},M=b=>{c.value.telefono.isValid=!b};return(b,r)=>(i(),v(te,{style:{width:"400px","max-width":"80vw"}},{default:l(()=>[o(J,null,{default:l(()=>[s("div",$e,[k(" Enviar Comprobantes "),O(o(_,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[B]])])]),_:1}),o(me,{inset:""}),o(J,{class:"q-pt-none"},{default:l(()=>[s("div",Re,[s("div",Qe,[Pe,o(se,{filled:"",dense:"",modelValue:t.value.tipo_envio,"onUpdate:modelValue":r[0]||(r[0]=f=>t.value.tipo_envio=f),error:!c.value.tipo_envio.isValid,"emit-value":"","map-options":"",options:[{label:"WhatsApp",value:"whatsapp"},{label:"Email",value:"email"},{label:"Ambas",value:"ambas"}]},{append:l(()=>[t.value.tipo_envio.length!=0&&t.value.tipo_envio=="whatsapp"?(i(),v(q,{key:0,name:"fa-brands fa-whatsapp",color:"teal-7"})):p("",!0),t.value.tipo_envio.length!=0&&t.value.tipo_envio=="email"?(i(),v(q,{key:1,name:"mail",color:"indigo-5"})):p("",!0),t.value.tipo_envio.length!=0&&t.value.tipo_envio=="ambas"?(i(),v(q,{key:2,name:"fa-solid fa-list-check",color:"deep-orange-4"})):p("",!0)]),error:l(()=>[s("label",{class:$(b.$q.dark.isActive?"text-red-4":"text-negative")},h(c.value.tipo_envio.message),3)]),_:1},8,["modelValue","error"])]),t.value.tipo_envio=="whatsapp"||t.value.tipo_envio=="ambas"?(i(),A("div",Ee,[Ie,o(m(qe),{"default-country":"EC","search-text":"Buscar pais...","onUpdate:modelValue":r[1]||(r[1]=f=>c.value.telefono.isValid=!0),onError:M,error:!c.value.telefono.isValid,filled:"",dense:"",tel:t.value.telefono,"onUpdate:tel":r[2]||(r[2]=f=>t.value.telefono=f)},{error:l(()=>[s("label",{class:$(b.$q.dark.isActive?"text-red-4":"text-negative")},h(c.value.telefono.message),3)]),_:1},8,["error","tel"])])):p("",!0),t.value.tipo_envio=="email"||t.value.tipo_envio=="ambas"?(i(),A("div",De,[Se,o(z,{type:"email",modelValue:t.value.email,"onUpdate:modelValue":[r[3]||(r[3]=f=>t.value.email=f),r[4]||(r[4]=f=>c.value.email.isValid=!0)],"input-class":"resaltarTextoInput",error:!c.value.email.isValid,"lazy-rules":"",dense:"",filled:""},{error:l(()=>[s("label",{class:$(b.$q.dark.isActive?"text-red-4":"text-negative")},h(c.value.email.message),3)]),_:1},8,["modelValue","error"])])):p("",!0),s("div",Ae,[o(_,{label:"Enviar",onClick:D,loading:I.value,class:"q-px-xl q-mt-md q-mb-md",outline:"",rounded:"",style:{color:"#696cff"}},null,8,["loading"])])])]),_:1})]),_:1}))}};const Me={class:"q-mx-lg q-pt-md"},Ue={class:"row q-col-gutter-lg"},Te={style:{display:"flex"}},Ne={class:"col-xs-12 col-sm-3"},Oe={class:"q-mr-sm row q-pt-sm justify-center"},Be={class:"col-xs-10 col-sm-4"},ze={class:"row items-center justify-end"},je={class:"col-xs-12 col-sm-1 flex flex-center"},He={class:"col-xs-10 col-sm-4"},Le={class:"row items-center justify-end"},Ye={class:"col-12 q-pt-none"},Ge={key:0,class:"text-center row justify-center",style:{width:"100%"}},We=s("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Comprobantes ",-1),Ze=[We],Je=s("label",{class:"q-mr-sm row items-center"},[s("span",null,"Por Sucursal: ")],-1),Ke=s("div",{class:"full-width row flex-center text-lime-10 q-gutter-sm"},[s("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun resultado ")],-1),ka={__name:"IndexPage",setup(Y){let V;const{api:R,claim:x,route:j,mostrarNotify:F}=ne(),E=n=>{const a=new he("https://facturacion.rednuevaconexion.net/socket.io/socket.io.js",{extraHeaders:{autentication:x.id}});V==null||V.removeAllListeners(),V=a.socket("/"),V.on("updateStateInvoice",async()=>{await y()})},I=[{name:"acciones",label:"acciones",align:"center"},{name:"sucursal",label:"Sucursal",align:"center"},{name:"num_comprobante",label:"Num. Comprobante",field:"numero_comprobante",align:"center"},{name:"usuario",label:"Usuario",align:"center"},{name:"cliente",label:"Cliente",align:"center"},{name:"f/h",label:"Fecha/Hora",align:"center",field:"created_at"},{name:"total",label:"Total",name:"total",align:"center"},{name:"estado",label:"Estado",field:"estado",align:"center"}],t=u(""),w=u(""),c=u([]),D=u(!1),M=u(!1),b=u("Todos"),r=u(""),f=u({}),U=u([]),T=u([]),G=u({}),W=u(),{validarPermisos:Z}=xe(),g=Ve(),Q=u(!1);K(b,(n,a)=>{y()});const re=()=>{const{tipo:n,fecha:a}=j.params;n!=""&&(b.value=n),a!=""&&(t.value=a.split(" - ")[0].replace(/-/g,"/"),w.value=a.split(" - ")[1].replace(/-/g,"/"))};async function ie(n){const{page:a,rowsPerPage:e,sortBy:d,descending:N}=n.pagination;Q.value=!0,await y(a,e),P.value.page=a,P.value.rowsPerPage=e,P.value.sortBy=d,P.value.descending=N,Q.value=!1}const y=async(n=1,a=10)=>{try{Q.value=!0;let e={tipo:"PROFORMA","sucursal-id":T.value,desde:t.value,hasta:w.value};const{data:d}=await R.get("/invoices",{params:{page:n,limit:a,busqueda:r.value},headers:e});P.value.rowsNumber=d.meta.totalItems,d.items.map(N=>{N.created_at=ke.formatDate(N.created_at,"DD/MM/YYYY HH:mm a"),N.loading=!1}),c.value=d.items,Q.value=!1}catch(e){console.log(e),Q.value=!1}},ue=async n=>{pe.create({title:"\xBFEstas seguro de querer eliminar esta proforma?",ok:{push:!0,color:"cyan-10",label:"Eliminar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{H.show({message:"Cargando..."}),await R.delete(`/invoices/${n}`),await y(),F("positive","Proforma eliminada exitosamente"),H.hide()}catch(a){F("warning",a.response.data.message),H.hide()}})};K(T,(n,a)=>{y()});const de=async n=>{Q.value=!0,U.value=[];const{data:a}=await R.get(`/sucursal/find/${n}/company`);a.forEach(e=>{U.value.push({label:e.nombre,value:e.id})}),U.value.length!=0&&(T.value=U.value[0].value),y()};E(),ce(async()=>{(x.roles[0]=="SUPER-ADMINISTRADOR"||x.roles[0]=="ADMINISTRADOR")&&await de(x.company.id),re(),W.value.requestServerInteraction()});const C=u("list"),P=u({sortBy:"desc",descending:!1,page:1,rowsPerPage:10,rowsNumber:15});return(n,a)=>(i(),A(ee,null,[s("div",Me,[s("div",Ue,[s("div",Te,[s("div",{style:{display:"flex"},class:$([m(g).screen.xs?"q-mb-md q-mt-none q-pt-xs":"q-ml-lg q-pl-none q-my-md"])},[s("div",{class:$(["row",[m(g).screen.xs?"flex-center":""]])},[s("div",Ne,[s("label",Oe,[s("span",{class:$([m(g).screen.xs?"text-weight-bold":""])}," Filtrar por fecha: ",2)])]),s("div",Be,[o(z,{outlined:"",dense:"",modelValue:t.value,"onUpdate:modelValue":a[3]||(a[3]=e=>t.value=e),mask:"date"},{append:l(()=>[t.value!==""?(i(),v(q,{key:0,name:"close",onClick:a[0]||(a[0]=e=>(t.value="",y(n.page=1,n.limit=10))),class:"cursor-pointer"})):p("",!0),o(q,{name:"event",class:"cursor-pointer"},{default:l(()=>[o(oe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(le,{modelValue:t.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>t.value=e),a[2]||(a[2]=e=>y(n.page=1,n.limit=10))]},{default:l(()=>[s("div",ze,[O(o(_,{label:"Close",color:"primary",flat:""},null,512),[[B]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",je,[s("label",{class:$(["q-mx-md",[m(g).screen.xs?"text-weight-medium":""]])}," Hasta ",2)]),s("div",He,[o(z,{outlined:"",dense:"",modelValue:w.value,"onUpdate:modelValue":a[8]||(a[8]=e=>w.value=e),mask:"date"},{append:l(()=>[w.value!==""?(i(),v(q,{key:0,name:"close",onClick:a[4]||(a[4]=e=>(w.value="",y(n.page=1,n.limit=10))),class:"cursor-pointer"})):p("",!0),o(q,{name:"event",class:"cursor-pointer"},{default:l(()=>[o(oe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(le,{modelValue:w.value,"onUpdate:modelValue":[a[6]||(a[6]=e=>w.value=e),a[7]||(a[7]=e=>y(n.page=1,n.limit=10))]},{default:l(()=>[s("div",Le,[O(o(_,{onClick:a[5]||(a[5]=e=>y(n.page=1,n.limit=10)),label:"Close",color:"primary",flat:""},null,512),[[B]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])],2)],2)]),s("div",Ye,[o(te,{flat:"",class:"shadow_custom"},{default:l(()=>[o(ge,{"hide-header":C.value==="grid",loading:Q.value,columns:I,"row-key":"name",grid:C.value==="grid",rows:c.value,filter:r.value,pagination:P.value,"onUpdate:pagination":a[13]||(a[13]=e=>P.value=e),"rows-per-page-options":[10,15,20,0],ref_key:"tableRef",ref:W,"binary-state-sort":"",onRequest:ie},{loading:l(()=>[o(fe,{showing:"",color:"primary"})]),header:l(e=>[o(_e,{props:e,style:{height:"60px"}},{default:l(()=>[(i(!0),A(ee,null,ve(e.cols,d=>(i(),v(be,{key:d.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:l(()=>[k(h(d.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":l(e=>[m(g).screen.xs?(i(),A("div",Ge,Ze)):p("",!0),m(x).roles[0]=="SUPER-ADMINISTRADOR"||m(x).roles[0]=="ADMINISTRADOR"?(i(),A("div",{key:1,style:ae([!m(g).screen.xs||"width: 100%;justify-content: center;",{display:"flex"}]),class:$([m(g).screen.xs?"q-mb-md":"q-ml-lg"])},[Je,o(se,{outlined:"",dense:"",modelValue:T.value,"onUpdate:modelValue":a[9]||(a[9]=d=>T.value=d),"emit-value":"","map-options":"",options:U.value},null,8,["modelValue","options"])],6)):p("",!0)]),"top-right":l(e=>[m(g).screen.width>=1023&&m(Z)("crear.venta")?(i(),v(_,{key:0,onClick:a[10]||(a[10]=d=>n.$router.push("/proforma/add")),outline:"",color:"primary",label:"Agregar Proforma",class:"q-mr-xs"})):p("",!0),o(z,{style:ae(m(g).screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"800",modelValue:r.value,"onUpdate:modelValue":a[11]||(a[11]=d=>r.value=d),placeholder:"Buscar..."},{append:l(()=>[o(q,{name:"search"})]),_:1},8,["style","modelValue"]),C.value==="list"?(i(),v(_,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:l(()=>[O((i(),v(L,{disable:m(g).platform.is.mobile},{default:l(()=>[k(h(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[B]])]),_:2},1032,["icon","onClick"])):p("",!0),e.inFullscreen?p("",!0):(i(),v(_,{key:2,flat:"",round:"",dense:"",icon:C.value==="grid"?"list":"grid_on",onClick:a[12]||(a[12]=d=>{C.value=C.value==="grid"?"list":"grid",n.separator=C.value==="grid"?"none":"horizontal"})},{default:l(()=>[O((i(),v(L,{disable:m(g).platform.is.mobile},{default:l(()=>[k(h(C.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[B]])]),_:1},8,["icon"]))]),"body-cell-total":l(e=>[o(S,{props:e},{default:l(()=>[k(" $"+h(e.row.total),1)]),_:2},1032,["props"])]),"body-cell-cliente":l(e=>[o(S,{props:e},{default:l(()=>[k(h(e.row.customer_id.nombres),1)]),_:2},1032,["props"])]),"body-cell-sucursal":l(e=>[o(S,{props:e},{default:l(()=>[k(h(e.row.sucursal_id.nombre),1)]),_:2},1032,["props"])]),"body-cell-usuario":l(e=>[o(S,{props:e},{default:l(()=>[k(h(e.row.user_id.fullName.toUpperCase()),1)]),_:2},1032,["props"])]),"body-cell-estado":l(e=>[o(S,{props:e},{default:l(()=>[o(ye,{outline:"",class:"q-py-xs q-px-md",color:m(g).dark.isActive?"blue-grey-3":"blue-grey-7",label:e.row.estadoSRI},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":l(e=>[o(S,{props:e},{default:l(()=>[o(_,{round:"",color:"blue-grey",icon:"visibility",size:"10px",class:"q-mr-sm",onClick:d=>(M.value=!0,f.value={...e.row})},null,8,["onClick"]),e.row.estadoSRI=="PROFORMA"?(i(),v(_,{key:0,onClick:d=>n.$router.push(`proforma/add/${e.row.id}`),round:"",color:"blue-grey",icon:"description",size:"10px",class:"q-mr-sm"},null,8,["onClick"])):p("",!0),e.row.estadoSRI=="AUTORIZADO"||e.row.estadoSRI=="PROFORMA"?(i(),v(_,{key:1,round:"",color:"blue-grey",onClick:d=>(D.value=!0,G.value=e.row),icon:"forward_to_inbox",size:"11px"},{default:l(()=>[o(L,{class:"bg-indigo",anchor:"top middle",self:"center middle"},{default:l(()=>[k(" Enviar comprobante por email ")]),_:1})]),_:2},1032,["onClick"])):p("",!0),o(_,{round:"",color:"blue-grey",class:"q-ml-sm",icon:"delete",size:"10px",onClick:d=>ue(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),"no-data":l(({icon:e})=>[Ke]),_:1},8,["hide-header","loading","grid","rows","filter","pagination"])]),_:1})])])]),m(g).screen.width<=1023&&m(Z)("crear.venta")?(i(),v(we,{key:0,position:"bottom-right",offset:[18,18]},{default:l(()=>[o(_,{round:"",color:"secondary",size:"lg",icon:"add",onClick:a[14]||(a[14]=e=>n.$router.push("/ventas/add"))})]),_:1})):p("",!0),o(X,{modelValue:M.value,"onUpdate:modelValue":a[15]||(a[15]=e=>M.value=e)},{default:l(()=>[o(Ce,{detalleData:f.value},null,8,["detalleData"])]),_:1},8,["modelValue"]),o(X,{modelValue:D.value,"onUpdate:modelValue":a[17]||(a[17]=e=>D.value=e)},{default:l(()=>[o(Fe,{onCloseModal:a[16]||(a[16]=e=>D.value=!1),detalleFactura:G.value},null,8,["detalleFactura"])]),_:1},8,["modelValue"])],64))}};export{ka as default};
