import{d as K,r as d,v as U,o as i,c as Q,e as o,ae as x,ad as n,f as l,g as s,Q as P,aU as W,a9 as m,af as p,aY as ee,aj as O,i as b,O as D,h as _,ai as ae,aZ as z,aa as N,ab as R,aX as le}from"./index.7acef9a6.js";import{Q as B}from"./QDate.45629d37.js";import{Q as E}from"./QPopupProxy.bb2b4fd4.js";import{Q as se,a as j,b as te}from"./QTable.7fcf9738.js";import{Q as oe,a as M}from"./QTooltip.eebfcb15.js";import{Q as Y}from"./QSelect.520b4c98.js";import{Q as ne}from"./QBadge.4e6bc3c4.js";import{Q as re}from"./QPageSticky.07d80fd0.js";import{C as A}from"./ClosePopup.01114e94.js";import{u as ie}from"./useRolPermisos.ffb5276b.js";import{u as ue}from"./useHelpers.5242f772.js";import{a as de}from"./use-quasar.c0f2ab40.js";import{d as ce}from"./date.d88e2a07.js";import{_ as me}from"./DetalleProducts.9ab65425.js";import"./format.b7cf0653.js";import"./QList.363f54d0.js";import"./axios.870a43e3.js";import"./QInnerLoading.5cd5fa79.js";import"./QBtnDropdown.8c3a17b0.js";import"./QBtnGroup.412e0da0.js";const pe={class:"q-ma-lg q-pt-md"},ve={class:"row q-col-gutter-lg"},fe={class:"col-xs-12 col-sm-3"},ge={class:"q-mr-sm row q-pt-sm justify-center"},_e={class:"col-xs-10 col-sm-4"},be={class:"row items-center justify-end"},ye={class:"col-xs-12 col-sm-1 flex flex-center"},xe={class:"col-xs-10 col-sm-4"},he={class:"row items-center justify-end"},we={class:"col-12 q-pt-xs"},ke={key:0,class:"text-center row justify-center",style:{width:"100%"}},Ce=o("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Compras ",-1),Ve=[Ce],qe=o("label",{class:"q-mr-sm row items-center"},[o("span",null,"Tipo: ")],-1),Qe=o("label",{class:"q-mx-sm row items-center"},[o("span",null,"Sucursal: ")],-1),De={class:"full-width row flex-center text-lime-10 q-gutter-sm"},Ae=o("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun resultado ",-1),Je=K({__name:"IndexPage",setup($e){const H=[{name:"acciones",label:"acciones",align:"center"},{name:"sucursal",label:"Sucursal",align:"center",field:"sucursal_name"},{name:"num_comprobante",label:"Num Comprobante",field:"numero_comprobante",align:"center"},{name:"usuario",label:"Usuario",align:"center",field:"user_name"},{name:"proveedor",label:"Proveedor",align:"center",field:"proveedor_name"},{name:"fecha",label:"Fecha Compra",align:"center",field:"fecha_compra"},{name:"total",label:"Total",field:"total",align:"center"},{name:"estado",label:"Estado",field:"estado",align:"center"}],F=d([]),$=d(!1);let C=d({});const v=d(""),f=d(""),h=d("TODOS");d({desde:"",hasta:"",pv_id:""});const w=d(""),{validarPermisos:T}=ie(),{api:S,claim:V,mostrarNotify:I,route:L}=ue(),r=de(),y=d(!1),q=d(""),k=d([]);U(h,(t,a)=>{c()});const G=()=>{const{fecha:t}=L.params;t!=""&&(v.value=t.split(" - ")[0].replace(/-/g,"/"),f.value=t.split(" - ")[1].replace(/-/g,"/"))},c=async()=>{try{y.value=!0,k.value.length==0&&await Z(),console.log(h.value);let t={headers:{sucursal_id:q.value,desde:v.value,hasta:f.value,tipo:h.value}};const{data:a}=await S.get("/buys",t);a.map(e=>{e.fecha_compra=ce.formatDate(e.created_at,"DD/MM/YYYY"),e.sucursal_name=e.sucursal_id.nombre,e.proveedor_name=e.proveedor_id.razon_social,e.user_name=e.user_id.fullName,e.total=`$${e.total}`}),F.value=a,y.value=!1}catch(t){console.log(t),y.value=!1}},X=t=>{r.dialog({title:"<center>\xBFEstas seguro de anular esta compra?</center>",message:`<span><strong>Num Comprobante</strong>: ${t.numero_comprobante}</span> <br>
              <span class='q-my-lg'><strong>Proveedor</strong>: ${t.proveedor_name}</span> <br>
              <span class='q-my-lg'><strong>Fecha/Hora</strong>: ${t.fecha_compra}</span> <br>
              <span><strong>Total</strong>: ${t.total}</span> <br>`,html:!0,ok:{push:!0,label:"Anular",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{r.loading.show({message:"Cargando..."}),await S.delete(`/buys/${t.id}`),I("positive","Compra Anulada exitosamente"),c(),r.loading.hide()}catch(a){console.log(a)}})},Z=async()=>{y.value=!0;try{const{data:t}=await S.get("/sucursal");t.forEach(a=>{k.value.push({label:a.nombre,value:a.id})}),k.value.length!==0&&(q.value=k.value[0].value)}catch(t){I("warning",t.response.data.message)}y.value=!1};G(),c(),U(w,(t,a)=>{c()});const g=d("list"),J=d({rowsPerPage:10});return(t,a)=>(i(),Q(O,null,[o("div",pe,[o("div",ve,[o("div",{class:x(["q-mb-md q-mt-none",[n(r).screen.xs?"q-mb-md q-pt-sm":"q-ml-lg q-pl-none"]]),style:{display:"flex"}},[o("div",{class:x(["row",[n(r).screen.xs?"flex-center":""]])},[o("div",fe,[o("label",ge,[o("span",{class:x([n(r).screen.xs?"text-weight-bold":""])}," Filtrar por fecha: ",2)])]),o("div",_e,[l(P,{outlined:"",dense:"",modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value=e),mask:"date"},{append:s(()=>[v.value!==""?(i(),m(b,{key:0,name:"close",onClick:a[0]||(a[0]=e=>(v.value="",c())),class:"cursor-pointer"})):p("",!0),l(b,{name:"event",class:"cursor-pointer"},{default:s(()=>[l(E,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[l(B,{modelValue:v.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>v.value=e),c]},{default:s(()=>[o("div",be,[D(l(_,{label:"Close",color:"primary",flat:""},null,512),[[A]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("div",ye,[o("label",{class:x(["q-mx-md",[n(r).screen.xs?"text-weight-medium":""]])}," Hasta ",2)]),o("div",xe,[l(P,{outlined:"",dense:"",modelValue:f.value,"onUpdate:modelValue":a[5]||(a[5]=e=>f.value=e),mask:"date"},{append:s(()=>[f.value!==""?(i(),m(b,{key:0,name:"close",onClick:a[3]||(a[3]=e=>(f.value="",c())),class:"cursor-pointer"})):p("",!0),l(b,{name:"event",class:"cursor-pointer"},{default:s(()=>[l(E,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[l(B,{modelValue:f.value,"onUpdate:modelValue":[a[4]||(a[4]=e=>f.value=e),c]},{default:s(()=>[o("div",he,[D(l(_,{onClick:c,label:"Close",color:"primary",flat:""},null,512),[[A]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])],2)],2),o("div",we,[l(W,{flat:"",class:"shadow_custom"},{default:s(()=>[l(se,{"title-class":"text-grey-7 text-h6",rows:F.value,loading:y.value,"hide-header":g.value==="grid",columns:H,"row-key":"name",grid:g.value==="grid",filter:w.value,pagination:J.value},{header:s(e=>[l(oe,{props:e,style:{height:"60px"}},{default:s(()=>[(i(!0),Q(O,null,ae(e.cols,u=>(i(),m(te,{key:u.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:s(()=>[N(R(u.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":s(e=>[n(V).roles[0]!=="SUPER-ADMINISTRADOR"&&n(V).roles[0]!=="ADMINISTRADOR"?(i(),Q("div",ke,Ve)):p("",!0),o("div",{style:z([{display:"flex"},!n(r).screen.xs||"width: 100%;justify-content: center;position: relative;right: 8px;"]),class:x([n(r).screen.xs?"q-mb-md":""])},[qe,l(Y,{outlined:"",dense:"",modelValue:h.value,"onUpdate:modelValue":a[6]||(a[6]=u=>h.value=u),"emit-value":"","map-options":"",options:[{label:"Todos",value:"TODOS"},{label:"Aceptados",value:"Aceptados"},{label:"Anulados",value:"Anulados"}]},null,8,["modelValue"])],6),n(V).roles[0]=="SUPER-ADMINISTRADOR"||n(V).roles[0]=="ADMINISTRADOR"?(i(),Q("div",{key:1,style:{display:"flex"},class:x([n(r).screen.xs?"q-mb-md":""])},[Qe,l(Y,{outlined:"",dense:"",modelValue:q.value,"onUpdate:modelValue":[a[7]||(a[7]=u=>q.value=u),a[8]||(a[8]=u=>c())],"emit-value":"","map-options":"",options:k.value},null,8,["modelValue","options"])],2)):p("",!0)]),"top-right":s(e=>[!n(r).screen.xs&&n(T)("crear.compra")?(i(),m(_,{key:0,onClick:a[9]||(a[9]=u=>t.$router.push("/compras/add")),outline:"",color:"primary",label:"Agregar Compra",class:"q-mr-xs"})):p("",!0),l(P,{style:z(n(r).screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:w.value,"onUpdate:modelValue":a[10]||(a[10]=u=>w.value=u),placeholder:"Buscar..."},{append:s(()=>[l(b,{name:"search"})]),_:1},8,["style","modelValue"]),g.value==="list"?(i(),m(_,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:s(()=>[D((i(),m(M,{disable:n(r).platform.is.mobile},{default:s(()=>[N(R(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[A]])]),_:2},1032,["icon","onClick"])):p("",!0),e.inFullscreen?p("",!0):(i(),m(_,{key:2,flat:"",round:"",dense:"",icon:g.value==="grid"?"list":"grid_on",onClick:a[11]||(a[11]=u=>{g.value=g.value==="grid"?"list":"grid",t.separator=g.value==="grid"?"none":"horizontal"})},{default:s(()=>[D((i(),m(M,{disable:n(r).platform.is.mobile},{default:s(()=>[N(R(g.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[A]])]),_:1},8,["icon"]))]),"body-cell-estado":s(e=>[l(j,{props:e},{default:s(()=>[l(ne,{outline:"",class:"q-py-xs q-px-md",color:e.row.isActive?"secondary":"negative",label:e.row.isActive?"Aceptado":"Anulado"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":s(e=>[l(j,{props:e},{default:s(()=>[l(_,{round:"",color:"blue-grey",icon:"visibility",class:"q-mr-sm",onClick:u=>($.value=!0,le(C)?C.value={...e.row}:C={...e.row}),size:"10px"},null,8,["onClick"]),e.row.isActive&&n(T)("anular.compra")?(i(),m(_,{key:0,round:"",color:"blue-grey",onClick:u=>X(e.row),icon:"close",size:"10px"},null,8,["onClick"])):p("",!0)]),_:2},1032,["props"])]),"no-data":s(({icon:e})=>[o("div",De,[l(b,{size:"2em",name:"sentiment_dissatisfied"}),Ae,l(b,{size:"2em",name:w.value?"filter_b_and_w":e},null,8,["name"])])]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),n(r).screen.xs&&n(T)("crear.compra")?(i(),m(re,{key:0,position:"bottom-right",offset:[18,18]},{default:s(()=>[l(_,{round:"",color:"secondary",size:"lg",icon:"add",onClick:a[12]||(a[12]=e=>t.$router.push("/compras/add"))})]),_:1})):p("",!0),l(ee,{modelValue:$.value,"onUpdate:modelValue":a[13]||(a[13]=e=>$.value=e)},{default:s(()=>[l(me,{detalleData:n(C)},null,8,["detalleData"])]),_:1},8,["modelValue"])],64))}});export{Je as default};
