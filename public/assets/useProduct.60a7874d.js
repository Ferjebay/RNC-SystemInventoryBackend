import{d as B,r as s,o as P,ab as C,g as t,aN as S,f as o,aO as h,e as F,ag as I,h as A,ac as f,ad as g,m as N}from"./index.33b032fc.js";import{Q,a as d}from"./QTable.39b792aa.js";import{Q as w}from"./QInnerLoading.a02cffd5.js";import{api as V}from"./axios.af8f8fcb.js";import{u as q}from"./useHelpers.1a30e8cf.js";const $=F("div",{class:"text-h6 text-center"},"Buscar Producto",-1),T={class:"row q-gutter-sm"},z={class:"col-xs-12 col-sm-12 q-my-sm"},j=B({__name:"SelectProduct",props:{listProductos:{}},emits:["agregarProduct"],setup(c,{emit:u}){const _=c,b=[{name:"add",label:"Agregar"},{name:"codigoBarra",label:"Codigo Barra",align:"left",field:"codigoBarra"},{name:"producto",label:"Producto",align:"left",field:"nombre"},{name:"stock",label:"Stock",align:"center",field:"stock"},{name:"aplicaIva",label:"Aplica IVA",align:"center",field:"aplicaIva"},{name:"stock",label:"Stock",align:"center",field:"stock"},{name:"pvm",label:"Precio de Compra",align:"center",field:"pvm"}],p=s([]);return p.value=_.listProductos,(y,a)=>(P(),C(S,{style:{width:"1040px","max-width":"80vw"}},{default:t(()=>[o(h,{class:"q-pb-none"},{default:t(()=>[$]),_:1}),o(h,null,{default:t(()=>[F("div",T,[F("div",z,[o(Q,{class:I([y.$q.dark.isActive?"":"my-sticky-header-table2"]),rows:p.value,columns:b,"hide-bottom":"","row-key":"name"},{"body-cell-add":t(e=>[o(d,{props:e},{default:t(()=>[o(A,{round:"",color:"green-10",class:"q-ml-md",size:"sm",onClick:r=>u("agregarProduct",e.row),icon:"fa-solid fa-plus"},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-descuento":t(e=>[o(d,{props:e},{default:t(()=>[f(g(e.row.descuento)+"% ",1)]),_:2},1032,["props"])]),"body-cell-aplicaIva":t(e=>[o(d,{props:e},{default:t(()=>[f(g(e.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":t(e=>[o(d,{props:e},{default:t(()=>[f("$"+g(e.row.pvp.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-pvm":t(e=>[o(d,{props:e},{default:t(()=>[f("$"+g(e.row.precio_compra),1)]),_:2},1032,["props"])]),loading:t(()=>[o(w,{showing:"",color:"primary"})]),_:1},8,["class","rows"])])])]),_:1})]),_:1}))}}),n=s([]),v=s(""),i=s(!1),k=s([]),x=s(!1),O=s([{name:"acciones",label:"Quitar",align:"left"},{label:"Codigo Barra",align:"left",field:"codigoBarra",name:"codigoBarra"},{label:"Producto",align:"left",field:"nombre",name:"nombre"},{name:"cantidad",label:"Cantidad",align:"left"},{name:"iva",label:"Aplica IVA",align:"center"},{name:"descuento",label:"Valor de descuento($)",align:"left",field:"descuento"},{label:"Stock",align:"center",field:"stock",name:"stock"},{name:"pvm",label:"Costo Neto",align:"center"},{name:"v_total",label:"Valor Total",align:"center",field:"v_total"}]),G=()=>{const{mostrarNotify:c}=q(),u=(a,e)=>{if(n.value.some(m=>m.codigoBarra==a.codigoBarra))c("warning","Ya fue agregado este articulo");else{if(e!=="compras"&&a.stock<=0)return c("negative",`No hay stock del articulo ${a.nombre}`);a.cantidad=e=="proforma"?a.cantidad:0,a.v_total=e=="proforma"?a.v_total:0,a.descuento=e=="venta"?a.descuento:0,n.value.unshift(a),v.value=""}},_=async a=>{if(v.value.length==0)return c("warning","Ingresa el termino de busqueda");i.value=!0;try{const{data:e}=await V.get(`/products/${v.value}`);if(e.length>1)return k.value=e,x.value=!0,i.value=!1;if(e.length===0)return c("warning","No se encontro el articulo..."),i.value=!1;i.value=!1,u(e[0],a)}catch(e){console.log(e),i.value=!1}},b=a=>{const e=n.value.findIndex(r=>r.id==a);n.value.splice(e,1)},p=N(()=>{let a=0,e=0,r=0,m=0;return n.value.forEach(l=>{l.descuento>0&&(r+=parseFloat(l.v_total)*parseFloat(l.descuento)/100),l.aplicaIva&&(e+=(parseFloat(l.v_total)-parseFloat(l.v_total)*parseFloat(l.descuento)/100)*.12),a+=parseFloat(l.v_total)}),m=a+e-r,{subtotal:parseFloat(a.toFixed(2)),iva:parseFloat(e.toFixed(2)),descuento:parseFloat(r.toFixed(2)),total:parseFloat(m.toFixed(2))}});return{agregarAndValidarStock:u,columns:O,filterArticulo:_,filterByCodBarra:v,loadingState:i,listProductos:k,modalSelectProducto:x,getSubtotalByProduct:(a,e="compras")=>{e=="compras"?a.v_total=(parseFloat(a.cantidad)*parseFloat(a.precio_compra)).toFixed(2):a.v_total=(parseFloat(a.cantidad)*parseFloat(a.pvp)).toFixed(2)},quitarArticulo:b,valorFactura:p,rows:n}};export{j as _,G as u};
