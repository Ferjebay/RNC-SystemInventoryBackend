import{d as j,r as y,u as E,C as R,o as P,c as K,e as o,f as t,g as l,Q as c,af as n,aQ as Q,bn as H,aR as q,aj as G,a as J,bo as W,P as x,h as g,w as X,ac as A,i as h,O as Z,ab as ee,aP as oe,ah as U,a$ as te,ad as b}from"./index.becc66bd.js";import{Q as ae,b as le}from"./QItemLabel.8aa7a3d0.js";import{Q as se}from"./QSelect.467cdfd1.js";import{Q as re}from"./QDate.a9054f89.js";import{Q as ne}from"./QPopupProxy.5d730869.js";import{Q as de,a as _,b as ie}from"./QTable.df3e25c9.js";import{Q as ue}from"./QForm.c1623bd2.js";import{C as ce}from"./ClosePopup.796684c7.js";import{api as k}from"./axios.44f0b70d.js";import{u as me}from"./useHelpers.62c49a13.js";import{d as $}from"./date.1c6cbe20.js";import{u as pe,a as _e}from"./AddProveedor.f63aed88.js";import{u as fe,_ as ve}from"./useProduct.5b13728c.js";import{u as ge}from"./auth-user.dd663f53.js";import"./QChip.e97fbc5d.js";import"./format.2bc25e5f.js";import"./QList.66169e49.js";import"./use-quasar.0f71ce4b.js";import"./QInnerLoading.497845f6.js";const he={class:"row q-pt-lg q-gutter-md justify-center"},be={class:"col-xs-10 col-md-5 q-mt-lg"},we=o("label",null,"Seleccionar Proveedor: ",-1),ye={class:"col-xs-10 col-md-3 q-mt-lg"},xe=o("label",null,"Numero de Comprobante: ",-1),Ve={class:"col-xs-10 col-md-3 q-mt-lg q-ml-md"},Ce=o("label",null,"Fecha de compra: ",-1),De={class:"row items-center justify-end"},Pe={class:"col-xs-10 col-md-5"},Qe=o("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),qe={class:"col-xs-10 col-md-6"},Ae=o("label",null,"Descripci\xF3n: ",-1),Ue={class:"row q-ma-lg q-pt-md justify-center"},ke={class:"col-xs-11 col-md-12"},$e={class:"full-width row flex-center text-lime-10 q-gutter-sm"},Se=o("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1),Te={class:"col-xs-11 col-md-12",style:{display:"flex","justify-content":"end"}},Be={class:"text-right"},Fe=o("td",null,[o("b",null,"SUBTOTAL:")],-1),Me={style:{width:"90px"},class:"text-subtitle1 text-weight-regular"},Ie={class:"text-right"},Oe=o("td",{class:"q-py-sm"},[o("b",null,"IVA(12%):")],-1),Ne={style:{width:"90px"},class:"q-py-sm text-subtitle1 text-weight-regular"},Ye={class:"text-right"},ze=o("td",{class:"q-py-sm"},[o("b",null,"TOTAL DESCUENTO:")],-1),Le={style:{width:"90px"},class:"q-py-sm text-subtitle1 text-weight-regular"},je={class:"text-right"},Ee=o("td",null,[o("b",null,"TOTAL DE COMPRA:")],-1),Re={style:{width:"90px"}},Ke={class:"col-md-4 offset-4"},fo=j({__name:"AddCompra",setup(He){const{agregarAndValidarStock:S,filterByCodBarra:m,columns:T,rows:w,filterArticulo:B,modalSelectProducto:f,getSubtotalByProduct:V,loadingState:F,listProductos:M,quitarArticulo:I,valorFactura:p}=fe();let{actualizarLista:O}=pe(),C=[];const i=y([]),v=y(!1),{mostrarNotify:u}=me(),s=y({proveedor_id:"",numero_comprobante:"",descripcion:"",inputDate:$.formatDate(Date.now(),"YYYY/MM/DD")}),N=E(),Y=r=>{S(r),f.value=!1};R(O,(r,a)=>{r&&D()});const D=async()=>{v.value=!1;try{const{data:r}=await k.get("/providers/true");i.value=[],r.forEach(a=>{i.value.push({label:a.razon_social,value:a.id,num_doc:a.numero_documento})}),C=i.value}catch(r){console.log(r)}},z=async()=>{if(s.value.proveedor_id=="")return u("warning","Debes elegir algun proveedor");if(s.value.numero_comprobante=="")return u("warning","Por favor ingresa el numero de comprobante");if(s.value.descripcion=="")return u("warning","Por favor ingresa una descripci\xF3n");if(w.value.length==0)return u("warning","Debes agregar algun producto..");s.value.products=w.value;const r=ge(),{claim:a}=J.read(r.token);s.value={...s.value,...p.value,fecha_compra:$.formatDate(s.value.inputDate,"YYYY-MM-DD"),user_id:a.id},W.create({title:"\xBFDeseas Agregar esta Compra?",ok:{push:!0,label:"Agregar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{x.show({message:"Cargando..."}),await k.post("/buys",s.value),x.hide(),u("positive","Compra realizada exitosamente"),N.push("/compras")}catch(e){u("warning",e.response.data.message[0]),x.hide()}})};D();const L=(r="",a)=>{if(r==="")return a(()=>{i.value=C});a(()=>{const e=r.toLowerCase();i.value=i.value.filter(d=>d.num_doc.indexOf(e)>-1||d.label.toLowerCase().indexOf(e)>-1)})};return(r,a)=>(P(),K(G,null,[o("div",he,[o("div",be,[we,t(se,{color:"orange",filled:"",modelValue:s.value.proveedor_id,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value.proveedor_id=e),dense:"",options:i.value,"emit-value":"","map-options":"",onFilter:L,"use-input":"","input-debounce":"0"},{append:l(()=>[t(g,{round:"",dense:"",flat:"",icon:"person_add",onClick:a[0]||(a[0]=X(e=>v.value=!0,["stop","prevent"]))})]),"no-option":l(()=>[t(ae,null,{default:l(()=>[t(le,{class:"text-grey"},{default:l(()=>[A(" No hay resultados ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),o("div",ye,[xe,t(c,{modelValue:s.value.numero_comprobante,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value.numero_comprobante=e),dense:"",filled:"",required:""},null,8,["modelValue"])]),o("div",Ve,[Ce,t(c,{filled:"",dense:"",modelValue:s.value.inputDate,"onUpdate:modelValue":a[4]||(a[4]=e=>s.value.inputDate=e),mask:"date",rules:["date"]},{append:l(()=>[t(h,{name:"event",class:"cursor-pointer"},{default:l(()=>[t(ne,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[t(re,{modelValue:s.value.inputDate,"onUpdate:modelValue":a[3]||(a[3]=e=>s.value.inputDate=e)},{default:l(()=>[o("div",De,[Z(t(g,{label:"Close",color:"primary",flat:""},null,512),[[ce]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("div",Pe,[Qe,t(c,{outlined:"","bottom-slots":"",loading:n(F),dense:"",modelValue:n(m),"onUpdate:modelValue":a[6]||(a[6]=e=>Q(m)?m.value=e:null),modelModifiers:{trim:!0},onKeyup:H(n(B),["enter"])},{append:l(()=>[n(m)!==""?(P(),ee(h,{key:0,name:"close",onClick:a[5]||(a[5]=e=>m.value=""),class:"cursor-pointer"})):oe("",!0),t(h,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])]),o("div",qe,[Ae,t(c,{modelValue:s.value.descripcion,"onUpdate:modelValue":a[7]||(a[7]=e=>s.value.descripcion=e),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])])]),t(ue,{onSubmit:z},{default:l(()=>[o("div",Ue,[o("div",ke,[t(de,{rows:n(w),columns:n(T),"row-key":"name","hide-pagination":!0,"rows-per-page-options":[50],class:U([r.$q.dark.isActive?"":"my-sticky-header-table3"])},{"no-data":l(({})=>[o("div",$e,[Se,t(h,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":l(e=>[t(_,{props:e},{default:l(()=>[t(c,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:d=>n(V)(e.row),min:"0",type:"number",style:{width:"100px"},modelValue:e.row.cantidad,"onUpdate:modelValue":d=>e.row.cantidad=d,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":l(e=>[t(_,{props:e},{default:l(()=>[t(te,{modelValue:e.row.aplicaIva,"onUpdate:modelValue":d=>e.row.aplicaIva=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-descuento":l(e=>[t(_,{props:e},{default:l(()=>[t(c,{"input-class":"resaltarTextoInput",dense:"",required:"",min:"0",onChange:d=>n(V)(e.row),type:"number",style:{width:"100px"},modelValue:e.row.descuento,"onUpdate:modelValue":d=>e.row.descuento=d,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-pvm":l(e=>[t(_,{props:e},{default:l(()=>[A(" $"+b(e.row.precio_compra),1)]),_:2},1032,["props"])]),"body-cell-acciones":l(e=>[t(_,{props:e},{default:l(()=>[t(g,{round:"",color:"deep-orange",onClick:d=>n(I)(e.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),o("div",Te,[o("table",{class:U([r.$q.screen.xs?"":"linearTablaDetalle"])},[o("tr",Be,[Fe,o("td",Me," $"+b(n(p).subtotal),1)]),o("tr",Ie,[Oe,o("td",Ne," $"+b(n(p).iva),1)]),o("tr",Ye,[ze,o("td",Le," $"+b(n(p).descuento),1)]),o("tr",je,[Ee,o("td",Re,[t(ie,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${n(p).total}`},null,8,["label"])])])],2)]),o("div",Ke,[t(g,{square:"",color:"green-10",type:"submit",label:"Agregar Compra",class:"full-width",icon:"shopping_cart"})])])]),_:1}),t(q,{modelValue:v.value,"onUpdate:modelValue":a[8]||(a[8]=e=>v.value=e)},{default:l(()=>[t(_e)]),_:1},8,["modelValue"]),t(q,{modelValue:n(f),"onUpdate:modelValue":a[9]||(a[9]=e=>Q(f)?f.value=e:null)},{default:l(()=>[t(ve,{listProductos:n(M),onAgregarProduct:Y},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}});export{fo as default};
