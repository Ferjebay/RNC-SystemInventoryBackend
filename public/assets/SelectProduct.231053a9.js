import{r as n,n as R,d as V,o as A,a9 as F,g as o,aU as x,f as r,aV as w,e as N,ae as D,ad as q,h as T,i as $,aa as _,ab as b}from"./index.7e6e0c1f.js";import{Q as M,a as m}from"./QTable.208cdf47.js";import{Q as O}from"./QInnerLoading.843c21ad.js";import{u as z}from"./useHelpers.104cd01b.js";const v=n([]),I=n(""),d=n(!1),B=n({}),C=n(!1),Q=n(""),E=n([{name:"acciones",label:"Quitar",align:"left"},{label:"Codigo Barra",align:"left",field:"codigoBarra",name:"codigoBarra"},{label:"Producto",align:"left",field:"nombre",name:"nombre"},{name:"cantidad",label:"Cantidad",align:"left"},{name:"iva",label:"Aplica IVA",align:"center"},{name:"descuento",label:"descuento %",align:"left",field:"descuento"},{label:"Stock",align:"center",field:"stock",name:"stock"},{name:"pvm",label:"Costo Neto",align:"center"},{name:"v_total",label:"Valor Total",align:"center",field:"v_total"}]),U=()=>{const p=n(0),{api:y,mostrarNotify:c,claim:i}=z(),f=(e,l)=>{if(v.value.some(s=>s.id==e.id))c("warning","Ya fue agregado este articulo");else{if(l!=="compras"&&e.stock<=0&&e.tipo!="Servicio")return c("negative",`No hay stock del articulo ${e.nombre}`);let s=0;l=="proforma"?s=e.cantidad:e.tipo=="Servicio"?s=1:s=0,e.cantidad=s,e.v_total=l=="proforma"?parseFloat(e.pvp):0,e.descuento=l=="venta"||l=="proforma"?e.descuento:0,v.value.unshift(e),e.tipo=="Servicio"&&k(e,"ventas"),I.value=""}},h=async e=>{if(I.value.length==0)return c("warning","Ingresa el termino de busqueda");d.value=!0;try{let l={company_id:i.company.id},{data:t}=await y.get(`/products/${I.value}`,{headers:l});if(t=t.filter(s=>{if(e=="compras"&&s.tipo=="Producto"||e=="venta")return s}),t.length>1)return B.value={data:t,tipo:e},C.value=!0,d.value=!1;if(t.length===0)return c("warning","No se encontro el articulo..."),d.value=!1;if(i.roles[0]=="ADMINISTRADOR"||i.roles[0]=="SUPER-ADMINISTRADOR"){if(Q.value!==t[0].sucursal_id.id)return c("warning","No se encontro el articulo..."),d.value=!1}else if(i.sucursales[0]!==t[0].sucursal_id.id)return c("warning","No se encontro el articulo..."),d.value=!1;d.value=!1,f(t[0],e)}catch(l){console.log(l),d.value=!1}},g=e=>{const l=v.value.findIndex(t=>t.id==e);v.value.splice(l,1)},S=async()=>{const{data:{iva:e}}=await y.get(`/companies/get-iva/${i.company.id}`);e=="4"&&(p.value=15),e=="3"&&(p.value=14),e=="2"&&(p.value=12)},P=R(()=>{let e=0,l=0,t=0,s=0;return v.value.forEach(u=>{u.descuento>0&&(t+=parseFloat(u.v_total)*parseFloat(u.descuento)/100),u.aplicaIva&&(l+=(parseFloat(u.v_total)-parseFloat(u.v_total)*parseFloat(u.descuento)/100)*p.value/100),e+=parseFloat(u.v_total)}),s=e+l-t,{subtotal:a(e),iva:a(l),descuento:a(t),total:a(s)}}),k=(e,l="compras")=>{l=="compras"?e.v_total=parseInt(e.cantidad)*parseFloat((Math.floor(e.precio_compra*100)/100).toString()):e.v_total=a(parseInt(e.cantidad)*parseFloat(e.pvp))},a=e=>{let l=e.toString().split("."),t=parseFloat(l[0]);return l.length>1?t+=parseFloat("."+l[1].substring(0,2)):t+=parseFloat(".00"),parseFloat(t.toFixed(2))};return S(),{agregarAndValidarStock:f,columns:E,claim:i,formatearNumero:a,filterArticulo:h,filterByCodBarra:I,loadingState:d,listProductos:B,modalSelectProducto:C,sucursal_selected:Q,iva_selected:p,getSubtotalByProduct:k,quitarArticulo:g,valorFactura:P,rows:v}};const H=N("div",{class:"text-h6 text-center"},"Selecciona un producto",-1),L={class:"row q-gutter-sm"},Y={class:"col-xs-12 col-sm-12 q-my-sm"},W=V({__name:"SelectProduct",props:{listProductos:{}},emits:["agregarProduct"],setup(p,{emit:y}){const c=p,i=[{name:"add",label:"Agregar"},{name:"codigoBarra",label:"Codigo Barra",align:"left",field:"codigoBarra"},{name:"producto",label:"Producto",align:"left",field:"nombre"},{name:"stock",label:"Stock",align:"center",field:"stock"},{name:"aplicaIva",label:"Aplica IVA",align:"center",field:"aplicaIva"},{name:"pvm",label:"Precio de Compra",align:"center",field:"pvm"},{name:"pvp",label:"P.V.P",align:"center",field:"pvp"},{name:"sucursal",label:"Sucursal",align:"center",field:"sucursal"}],{claim:f,sucursal_selected:h}=U();let g;f.roles[0]=="ADMINISTRADOR"||f.roles[0]=="SUPER-ADMINISTRADOR"?g=h.value:g=f.sucursales[0];const S=n([]);return c.listProductos.tipo,S.value=c.listProductos.data,(P,k)=>(A(),F(x,{style:{width:"1040px","max-width":"80vw"}},{default:o(()=>[r(w,{class:"q-pb-none"},{default:o(()=>[H]),_:1}),r(w,null,{default:o(()=>[N("div",L,[N("div",Y,[r(M,{class:D([P.$q.dark.isActive?"":"my-sticky-header-table2"]),rows:S.value,columns:i,"hide-bottom":"","row-key":"name"},{"body-cell-add":o(a=>[r(m,{props:a},{default:o(()=>[q(g)==a.row.sucursal_id.id?(A(),F(T,{key:0,round:"",color:"green-9",class:"q-ml-md",size:"sm",onClick:e=>y("agregarProduct",a.row),icon:"fa-solid fa-plus"},null,8,["onClick"])):(A(),F($,{key:1,color:"red-9",class:"q-ml-md",size:"sm",name:"fa-solid fa-ban"}))]),_:2},1032,["props"])]),"body-cell-descuento":o(a=>[r(m,{props:a},{default:o(()=>[_(b(a.row.descuento)+"% ",1)]),_:2},1032,["props"])]),"body-cell-aplicaIva":o(a=>[r(m,{props:a},{default:o(()=>[_(b(a.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":o(a=>[r(m,{props:a},{default:o(()=>[_("$"+b(a.row.pvp),1)]),_:2},1032,["props"])]),"body-cell-pvm":o(a=>[r(m,{props:a},{default:o(()=>[_("$"+b(a.row.precio_compra),1)]),_:2},1032,["props"])]),"body-cell-sucursal":o(a=>[r(m,{props:a},{default:o(()=>[_(b(a.row.sucursal_id.nombre),1)]),_:2},1032,["props"])]),loading:o(()=>[r(O,{showing:"",color:"primary"})]),_:1},8,["class","rows"])])])]),_:1})]),_:1}))}});export{W as _,U as u};
