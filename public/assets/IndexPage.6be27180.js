import{m as X,r as h,n as Y,bk as Z,_ as ee,b5 as ae,p as U,z as le,h as V,o as w,a9 as S,g as l,f as a,aV as C,e as n,aa as k,O as R,ah as B,Q,ad as H,aU as D,c as z,ba as A,aj as G,ai as te,af as oe,ab as K,by as O}from"./index.ff6c63a6.js";import{c as se,m as T,Q as $,d as F,a as P}from"./format.2828d3a5.js";import{Q as L}from"./QList.1afe1699.js";import{Q as W}from"./QForm.274c2a2a.js";import{C as J}from"./ClosePopup.03d65a7b.js";import{u as I}from"./useHelpers.43624c8a.js";import{a as ne}from"./use-quasar.5b94fead.js";import"./axios.74fd605e.js";function N(e,i=new WeakMap){if(Object(e)!==e)return e;if(i.has(e))return i.get(e);const o=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const u=e.valueOf();if(Object(u)!==u){const c=new e.constructor(u);return i.set(e,c),c}}return i.set(e,o),e instanceof Set?e.forEach(u=>{o.add(N(u,i))}):e instanceof Map&&e.forEach((u,c)=>{o.set(c,N(u,i))}),Object.assign(o,...Object.keys(e).map(u=>({[u]:N(e[u],i)})))}var E=X({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(e,{slots:i,emit:o}){const{proxy:u}=le(),{$q:c}=u,t=h(null),m=h(""),r=h("");let _=!1;const q=Y(()=>Z({initialValue:m.value,validate:e.validate,set:p,cancel:s,updatePosition:y},"value",()=>r.value,x=>{r.value=x}));function p(){e.validate(r.value)!==!1&&(j()===!0&&(o("save",r.value,m.value),o("update:modelValue",r.value)),b())}function s(){j()===!0&&o("cancel",r.value,m.value),b()}function y(){ee(()=>{t.value.updatePosition()})}function j(){return ae(r.value,m.value)===!1}function b(){_=!0,t.value.hide()}function d(){_=!1,m.value=N(e.modelValue),r.value=N(e.modelValue),o("beforeShow")}function f(){o("show")}function v(){_===!1&&j()===!0&&(e.autoSave===!0&&e.validate(r.value)===!0?(o("save",r.value,m.value),o("update:modelValue",r.value)):o("cancel",r.value,m.value)),o("beforeHide")}function M(){o("hide")}function g(){const x=i.default!==void 0?[].concat(i.default(q.value)):[];return e.title&&x.unshift(U("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&x.push(U("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[U(V,{flat:!0,color:e.color,label:e.labelCancel||c.lang.label.cancel,onClick:s}),U(V,{flat:!0,color:e.color,label:e.labelSet||c.lang.label.set,onClick:p})])),x}return Object.assign(u,{set:p,cancel:s,show(x){t.value!==null&&t.value.show(x)},hide(x){t.value!==null&&t.value.hide(x)},updatePosition:y}),()=>{if(e.disable!==!0)return U(se,{ref:t,class:"q-popup-edit",cover:e.cover,onBeforeShow:d,onShow:f,onBeforeHide:v,onHide:M,onEscapeKey:s},g)}}});const ue={class:"text-h6 text-center"},re={class:"row q-pt-lg q-gutter-lg justify-center"},ce={class:"col-xs-12"},ie=n("label",{class:"text-center"},"Nombre:",-1),de={class:"col-xs-12"},pe=n("label",{class:"text-center"},"Descripcion:",-1),fe={class:"col-xs-9 col-sm-12 q-mt-lg q-mb-md flex justify-center"},me={__name:"ModalProforma",props:["clausulas","aceptacion"],emits:["hideModal"],setup(e,{emit:i}){const o=e,{capitalize:u}=T,c=h(!1),t=h({nombre:"",descripcion:""}),{api:m,claim:r,mostrarNotify:_}=I(),q=async()=>{try{o.clausulas.unshift({...t.value});let p={company_id:r.company.id};await m.post("/proforma/clausula",{clausulas:o.clausulas,aceptacion_proforma:o.aceptacion},{headers:p}),_("positive","Clausula agregada exitosamente"),i("hideModal")}catch(p){console.log(p),_("warning","No se pudo agregar la clausula")}};return(p,s)=>(w(),S(D,{style:{width:"500px !important","max-width":"80vw"}},{default:l(()=>[a(C,null,{default:l(()=>[n("div",ue,[k(" Nueva Clausula "),R(a(V,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[J]])])]),_:1}),a(B,{inset:""}),a(C,{class:"q-pt-none"},{default:l(()=>[a(W,{onSubmit:q},{default:l(()=>[n("div",re,[n("div",ce,[ie,a(Q,{modelValue:t.value.nombre,"onUpdate:modelValue":s[0]||(s[0]=y=>t.value.nombre=y),modelModifiers:{trim:!0},onKeyup:s[1]||(s[1]=y=>t.value.nombre=H(u)(t.value.nombre)),dense:"",filled:"",required:""},null,8,["modelValue"])]),n("div",de,[pe,a(Q,{type:"textarea",rows:"3",onKeyup:s[2]||(s[2]=y=>t.value.descripcion=H(u)(t.value.descripcion)),modelValue:t.value.descripcion,"onUpdate:modelValue":s[3]||(s[3]=y=>t.value.descripcion=y),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),n("div",fe,[a(V,{label:"Guardar",loading:c.value,outline:"",rounded:"",class:"q-px-xl",type:"submit",style:{color:"#696cff"}},null,8,["loading"])])])]),_:1})]),_:1})]),_:1}))}},ve={class:"text-h6 text-center"},_e={class:"row q-pt-lg q-gutter-lg justify-center"},ge={class:"col-xs-12"},ye=n("label",{class:"text-center"},"Detalle:",-1),be={class:"col-xs-9 col-sm-12 q-mt-lg q-mb-md flex justify-center"},xe={__name:"ModalAceptacionPropuesta",props:["clausulas","aceptacion","proforma_id"],emits:["hideModal"],setup(e,{emit:i}){const o=e,{capitalize:u}=T,c=h(!1),t=h(""),{api:m,claim:r,mostrarNotify:_}=I(),q=async()=>{try{let p={company_id:r.company.id};await m.post("/proforma/clausula",{clausulas:o.clausulas,aceptacion_proforma:t.value},{headers:p}),_("positive","Clausula agregada exitosamente"),i("hideModal")}catch{_("warning","No se pudo agregar la clausula")}};return(p,s)=>(w(),S(D,{style:{width:"500px !important","max-width":"80vw"}},{default:l(()=>[a(C,null,{default:l(()=>[n("div",ve,[k(" Aceptaci\xF3n de la propuesta "),R(a(V,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[J]])])]),_:1}),a(B,{inset:""}),a(C,{class:"q-pt-none"},{default:l(()=>[a(W,{onSubmit:q},{default:l(()=>[n("div",_e,[n("div",ge,[ye,a(Q,{type:"textarea",rows:"4",modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=y=>t.value=y),modelModifiers:{trim:!0},onKeyup:s[1]||(s[1]=y=>t.value=H(u)(t.value)),dense:"",filled:"",required:""},null,8,["modelValue"])]),n("div",be,[a(V,{label:"Guardar",loading:c.value,outline:"",rounded:"",class:"q-px-xl",type:"submit",style:{color:"#696cff"}},null,8,["loading"])])])]),_:1})]),_:1})]),_:1}))}},he={class:"q-ma-lg q-pt-md"},Ve={class:"row q-col-gutter-lg"},we={class:"col-xs-12 col-sm-7"},qe=n("div",{class:"text-h6 q-pt-sm"},"Clausulas de la propuesta",-1),Ce={class:"text-weight-medium text-left"},$e={class:"text-weight-medium text-justify"},Se={class:"text-grey-8 q-gutter-xs"},ke={class:"col-xs-12 col-sm-5"},Me=n("div",{class:"text-h6 q-pt-sm"},"Aceptaci\xF3n de la propuesta",-1),Qe={class:"text-weight-medium text-justify",id:"text-aceptacion"},je={class:"text-grey-8 q-gutter-xs"},He={__name:"IndexPage",setup(e){const{api:i,claim:o,mostrarNotify:u}=I(),c=h([]),t=h(""),m=h("");h(!1);const r=h(!1),_=h(!1),q=ne(),p=async()=>{const{data:b}=await i.get(`/proforma/${o.company.id}`);m.value=b.id,c.value=b.clausulas?b.clausulas:[],t.value=b.aceptacion_proforma?b.aceptacion_proforma:""},s=async()=>{setTimeout(async()=>{await i.patch(`/proforma/${m.value}`,{clausulas:c.value,aceptacion_proforma:t.value})},1e3)},y=b=>{q.dialog({title:"Confirmar",message:"Deseas quitar esta clausula?",ok:{push:!0,label:"Quitar",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{c.value.splice(b,1),s()}catch(d){u("negative",d.response.data.message)}})},j=()=>{q.dialog({title:"Confirmar",message:"Deseas quitar esta aceptaci\xF3n?",ok:{push:!0,label:"Quitar",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{await i.patch(`/proforma/${m.value}`,{clausulas:c.value,aceptacion_proforma:""}),p()}catch(b){u("negative",b.response.data.message)}})};return p(),(b,d)=>(w(),z(G,null,[n("div",he,[n("div",Ve,[n("div",we,[a(D,{class:"my-card"},{default:l(()=>[a(C,{class:"text-white flex justify-between q-pt-sm q-pb-sm"},{default:l(()=>[qe,a(V,{onClick:d[0]||(d[0]=f=>r.value=!0),round:"",color:"primary",icon:"add"})]),_:1}),a(B),a(C,{class:"q-pa-none"},{default:l(()=>[a(L,{bordered:"",class:"rounded-borders q-pt-sm"},{default:l(()=>{var f;return[((f=c.value)==null?void 0:f.length)>0?(w(!0),z(G,{key:0},te(c.value,(v,M)=>(w(),S(P,{key:M},{default:l(()=>[a($,{top:"",class:"col-2 gt-sm flex flex-center"},{default:l(()=>[n("span",Ce,[k(K(v.nombre)+" ",1),a(E,{modelValue:v.nombre,"onUpdate:modelValue":g=>v.nombre=g,buttons:"",onSave:s,"label-set":"Guardar","label-cancel":"Cancelar","auto-save":""},{default:l(g=>[a(Q,{modelValue:g.value,"onUpdate:modelValue":x=>g.value=x,dense:"",autofocus:"",counter:"",onKeyup:O(g.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),_:2},1024),a($,{top:""},{default:l(()=>[n("span",$e,[k(K(v.descripcion)+" ",1),a(E,{modelValue:v.descripcion,"onUpdate:modelValue":g=>v.descripcion=g,buttons:"",onSave:s,"label-set":"Guardar","label-cancel":"Cancelar","auto-save":""},{default:l(g=>[a(Q,{type:"textarea",rows:"4",modelValue:g.value,"onUpdate:modelValue":x=>g.value=x,dense:"",autofocus:"",counter:"",onKeyup:O(g.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),_:2},1024),a($,{top:"",side:"",class:"flex flex-center"},{default:l(()=>[n("div",Se,[a(V,{class:"gt-xs",onClick:g=>y(M),size:"12px",flat:"",dense:"",round:"",icon:"delete"},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)):(w(),S(P,{key:1,class:"text-center"},{default:l(()=>[a($,{top:"",class:"col-12 gt-sm"},{default:l(()=>[a(F,{class:"q-mt-sm"},{default:l(()=>[k(" No hay clausulas ")]),_:1})]),_:1})]),_:1}))]}),_:1})]),_:1})]),_:1})]),n("div",ke,[a(D,{class:"my-card"},{default:l(()=>[a(C,{class:"text-white flex justify-between q-pt-sm q-pb-sm"},{default:l(()=>{var f;return[Me,((f=t.value)==null?void 0:f.length)==0?(w(),S(V,{key:0,onClick:d[1]||(d[1]=v=>_.value=!0),round:"",color:"primary",icon:"add"})):oe("",!0)]}),_:1}),a(B),a(C,{class:"q-pa-none"},{default:l(()=>[a(L,{bordered:"",class:"rounded-borders q-pt-sm"},{default:l(()=>{var f;return[((f=t.value)==null?void 0:f.length)>0?(w(),S(P,{key:0},{default:l(()=>[a($,{top:""},{default:l(()=>[n("span",Qe,[k(K(t.value)+" ",1),a(E,{modelValue:t.value,"onUpdate:modelValue":d[2]||(d[2]=v=>t.value=v),buttons:"",onSave:s,"label-set":"Guardar","label-cancel":"Cancelar","auto-save":""},{default:l(v=>[a(Q,{type:"textarea",rows:"4",modelValue:v.value,"onUpdate:modelValue":M=>v.value=M,dense:"",autofocus:"",counter:"",onKeyup:O(v.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:1},8,["modelValue"])])]),_:1}),a($,{top:"",side:""},{default:l(()=>[n("div",je,[a(V,{class:"gt-xs",onClick:j,size:"12px",flat:"",dense:"",round:"",icon:"delete"})])]),_:1})]),_:1})):(w(),S(P,{key:1,class:"text-center"},{default:l(()=>[a($,{top:"",class:"col-12 gt-sm"},{default:l(()=>[a(F,{class:"q-mt-sm"},{default:l(()=>[k(" No hay clausulas ")]),_:1})]),_:1})]),_:1}))]}),_:1})]),_:1})]),_:1})])])]),a(A,{modelValue:r.value,"onUpdate:modelValue":d[4]||(d[4]=f=>r.value=f)},{default:l(()=>[a(me,{clausulas:c.value,aceptacion:t.value,onHideModal:d[3]||(d[3]=f=>(r.value=!1,p()))},null,8,["clausulas","aceptacion"])]),_:1},8,["modelValue"]),a(A,{modelValue:_.value,"onUpdate:modelValue":d[6]||(d[6]=f=>_.value=f)},{default:l(()=>[a(xe,{clausulas:c.value,aceptacion:t.value,proforma_id:m.value,onHideModal:d[5]||(d[5]=f=>(_.value=!1,p()))},null,8,["clausulas","aceptacion","proforma_id"])]),_:1},8,["modelValue"])],64))}};export{He as default};
