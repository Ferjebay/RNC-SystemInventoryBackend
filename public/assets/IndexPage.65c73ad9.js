import{d as X,r as d,v as U,o as i,c as Q,e as o,ae as y,ad as r,f as s,g as l,Q as P,aU as Z,a9 as m,af as p,ba as ee,aj as O,i as w,O as D,h as b,ai as ae,bc as z,aa as N,ab as R,bb as le}from"./index.e3eab811.js";import{Q as B}from"./QDate.546d0b9d.js";import{Q as E}from"./QPopupProxy.df8107c2.js";import{Q as se,a as j,b as te}from"./QTable.a6eed54e.js";import{Q as oe,a as M}from"./QTooltip.607ea652.js";import{Q as Y}from"./QSelect.57fbc56d.js";import{Q as re}from"./QBadge.2f39c146.js";import{Q as ne}from"./QPageSticky.fbad4b5f.js";import{C as A}from"./ClosePopup.f52126f3.js";import{u as ie}from"./useRolPermisos.ba10dfd6.js";import{u as ue}from"./useHelpers.ba7357b2.js";import{a as de}from"./use-quasar.b74492d8.js";import{d as ce}from"./date.1b4823d8.js";import{_ as me}from"./DetalleProducts.d7c94f59.js";import"./format.cdb105f3.js";import"./QList.876a2ede.js";import"./axios.f0c5ece9.js";import"./QInnerLoading.da36f073.js";import"./QBtnDropdown.c9b35e3e.js";import"./QBtnGroup.193e2417.js";const pe={class:"q-ma-lg q-pt-md"},ve={class:"row q-col-gutter-lg"},fe={class:"col-xs-12 col-sm-3"},ge={class:"q-mr-sm row q-pt-sm justify-center"},be={class:"col-xs-10 col-sm-4"},_e={class:"row items-center justify-end"},ye={class:"col-xs-12 col-sm-1 flex flex-center"},xe={class:"col-xs-10 col-sm-4"},he={class:"row items-center justify-end"},we={class:"col-12 q-pt-xs"},ke={key:0,class:"text-center row justify-center",style:{width:"100%"}},Ce=o("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Compras ",-1),Ve=[Ce],qe=o("label",{class:"q-mr-sm row items-center"},[o("span",null,"Tipo: ")],-1),Qe=o("label",{class:"q-mx-sm row items-center"},[o("span",null,"Sucursal: ")],-1),De=o("div",{class:"full-width row flex-center text-lime-10 q-gutter-sm"},[o("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun resultado ")],-1),Ke=X({__name:"IndexPage",setup(Ae){const H=[{name:"acciones",label:"acciones",align:"center"},{name:"sucursal",label:"Sucursal",align:"center",field:"sucursal_name"},{name:"num_comprobante",label:"Num Comprobante",field:"numero_comprobante",align:"center"},{name:"usuario",label:"Usuario",align:"center",field:"user_name"},{name:"proveedor",label:"Proveedor",align:"center",field:"proveedor_name"},{name:"fecha",label:"Fecha Compra",align:"center",field:"fecha_compra"},{name:"total",label:"Total",field:"total",align:"center"},{name:"estado",label:"Estado",field:"estado",align:"center"}],F=d([]),$=d(!1);let k=d({});const v=d(""),f=d(""),C=d("TODOS");d({desde:"",hasta:"",pv_id:""});const V=d(""),{validarPermisos:T}=ie(),{api:S,claim:x,mostrarNotify:I,route:L}=ue(),n=de(),_=d(!1),q=d(""),h=d([]);U(C,(t,a)=>{c()});const G=()=>{const{fecha:t}=L.params;t!=""&&(v.value=t.split(" - ")[0].replace(/-/g,"/"),f.value=t.split(" - ")[1].replace(/-/g,"/"))},c=async()=>{try{_.value=!0,h.value.length==0&&await K();let t={headers:{sucursal_id:q.value,desde:v.value,hasta:f.value,tipo:C.value}};const{data:a}=await S.get("/buys",t);a.map(e=>{e.fecha_compra=ce.formatDate(e.created_at,"DD/MM/YYYY"),e.sucursal_name=e.sucursal_id.nombre,e.proveedor_name=e.proveedor_id.razon_social,e.user_name=e.user_id.fullName,e.total=`$${e.total}`}),F.value=a,_.value=!1}catch(t){console.log(t),_.value=!1}},J=t=>{n.dialog({title:"<center>\xBFEstas seguro de anular esta compra?</center>",message:`<span><strong>Num Comprobante</strong>: ${t.numero_comprobante}</span> <br>
              <span class='q-my-lg'><strong>Proveedor</strong>: ${t.proveedor_name}</span> <br>
              <span class='q-my-lg'><strong>Fecha/Hora</strong>: ${t.fecha_compra}</span> <br>
              <span><strong>Total</strong>: ${t.total}</span> <br>`,html:!0,ok:{push:!0,label:"Anular",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{n.loading.show({message:"Cargando..."}),await S.delete(`/buys/${t.id}`),I("positive","Compra Anulada exitosamente"),c(),n.loading.hide()}catch(a){console.log(a)}})},K=async()=>{_.value=!0;try{const{data:t}=await S.get(`/sucursal/find/${x.company.id}/company`);t.forEach(a=>{h.value.push({label:a.nombre,value:a.id})}),h.value.length!==0&&(q.value=h.value[0].value)}catch(t){I("warning",t.response.data.message)}_.value=!1};G(),c(),U(V,(t,a)=>{c()});const g=d("list"),W=d({rowsPerPage:10});return(t,a)=>(i(),Q(O,null,[o("div",pe,[o("div",ve,[o("div",{class:y(["q-mb-md q-mt-none",[r(n).screen.xs?"q-mb-md q-pt-sm":"q-ml-lg q-pl-none"]]),style:{display:"flex"}},[o("div",{class:y(["row",[r(n).screen.xs?"flex-center":""]])},[o("div",fe,[o("label",ge,[o("span",{class:y([r(n).screen.xs?"text-weight-bold":""])}," Filtrar por fecha: ",2)])]),o("div",be,[s(P,{outlined:"",dense:"",modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value=e),mask:"date"},{append:l(()=>[v.value!==""?(i(),m(w,{key:0,name:"close",onClick:a[0]||(a[0]=e=>(v.value="",c())),class:"cursor-pointer"})):p("",!0),s(w,{name:"event",class:"cursor-pointer"},{default:l(()=>[s(E,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[s(B,{modelValue:v.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>v.value=e),c]},{default:l(()=>[o("div",_e,[D(s(b,{label:"Close",color:"primary",flat:""},null,512),[[A]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("div",ye,[o("label",{class:y(["q-mx-md",[r(n).screen.xs?"text-weight-medium":""]])}," Hasta ",2)]),o("div",xe,[s(P,{outlined:"",dense:"",modelValue:f.value,"onUpdate:modelValue":a[5]||(a[5]=e=>f.value=e),mask:"date"},{append:l(()=>[f.value!==""?(i(),m(w,{key:0,name:"close",onClick:a[3]||(a[3]=e=>(f.value="",c())),class:"cursor-pointer"})):p("",!0),s(w,{name:"event",class:"cursor-pointer"},{default:l(()=>[s(E,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[s(B,{modelValue:f.value,"onUpdate:modelValue":[a[4]||(a[4]=e=>f.value=e),c]},{default:l(()=>[o("div",he,[D(s(b,{onClick:c,label:"Close",color:"primary",flat:""},null,512),[[A]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])],2)],2),o("div",we,[s(Z,{flat:"",class:"shadow_custom"},{default:l(()=>[s(se,{"title-class":"text-grey-7 text-h6",rows:F.value,loading:_.value,"hide-header":g.value==="grid",columns:H,"row-key":"name",grid:g.value==="grid",filter:V.value,pagination:W.value},{header:l(e=>[s(oe,{props:e,style:{height:"60px"}},{default:l(()=>[(i(!0),Q(O,null,ae(e.cols,u=>(i(),m(te,{key:u.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:l(()=>[N(R(u.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":l(e=>[r(x).roles[0]!=="SUPER-ADMINISTRADOR"&&r(x).roles[0]!=="ADMINISTRADOR"?(i(),Q("div",ke,Ve)):p("",!0),o("div",{style:z([{display:"flex"},!r(n).screen.xs||"width: 100%;justify-content: center;position: relative;right: 8px;"]),class:y([r(n).screen.xs?"q-mb-md":""])},[qe,s(Y,{outlined:"",dense:"",modelValue:C.value,"onUpdate:modelValue":a[6]||(a[6]=u=>C.value=u),"emit-value":"","map-options":"",options:[{label:"Todos",value:"TODOS"},{label:"Aceptados",value:"Aceptados"},{label:"Anulados",value:"Anulados"}]},null,8,["modelValue"])],6),r(x).roles[0]=="SUPER-ADMINISTRADOR"||r(x).roles[0]=="ADMINISTRADOR"?(i(),Q("div",{key:1,style:{display:"flex"},class:y([r(n).screen.xs?"q-mb-md":""])},[Qe,s(Y,{outlined:"",dense:"",modelValue:q.value,"onUpdate:modelValue":[a[7]||(a[7]=u=>q.value=u),a[8]||(a[8]=u=>c())],"emit-value":"","map-options":"",options:h.value},null,8,["modelValue","options"])],2)):p("",!0)]),"top-right":l(e=>[!r(n).screen.xs&&r(T)("crear.compra")?(i(),m(b,{key:0,onClick:a[9]||(a[9]=u=>t.$router.push("/compras/add")),outline:"",color:"primary",label:"Agregar Compra",class:"q-mr-xs"})):p("",!0),s(P,{style:z(r(n).screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:V.value,"onUpdate:modelValue":a[10]||(a[10]=u=>V.value=u),placeholder:"Buscar..."},{append:l(()=>[s(w,{name:"search"})]),_:1},8,["style","modelValue"]),g.value==="list"?(i(),m(b,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:l(()=>[D((i(),m(M,{disable:r(n).platform.is.mobile},{default:l(()=>[N(R(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[A]])]),_:2},1032,["icon","onClick"])):p("",!0),e.inFullscreen?p("",!0):(i(),m(b,{key:2,flat:"",round:"",dense:"",icon:g.value==="grid"?"list":"grid_on",onClick:a[11]||(a[11]=u=>{g.value=g.value==="grid"?"list":"grid",t.separator=g.value==="grid"?"none":"horizontal"})},{default:l(()=>[D((i(),m(M,{disable:r(n).platform.is.mobile},{default:l(()=>[N(R(g.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[A]])]),_:1},8,["icon"]))]),"body-cell-estado":l(e=>[s(j,{props:e},{default:l(()=>[s(re,{outline:"",class:"q-py-xs q-px-md",color:e.row.isActive?"secondary":"negative",label:e.row.isActive?"Aceptado":"Anulado"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":l(e=>[s(j,{props:e},{default:l(()=>[s(b,{round:"",color:"blue-grey",icon:"visibility",class:"q-mr-sm",onClick:u=>($.value=!0,le(k)?k.value={...e.row}:k={...e.row}),size:"10px"},null,8,["onClick"]),e.row.isActive&&r(T)("anular.compra")?(i(),m(b,{key:0,round:"",color:"blue-grey",onClick:u=>J(e.row),icon:"close",size:"10px"},null,8,["onClick"])):p("",!0)]),_:2},1032,["props"])]),"no-data":l(({icon:e})=>[De]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),r(n).screen.xs&&r(T)("crear.compra")?(i(),m(ne,{key:0,position:"bottom-right",offset:[18,18]},{default:l(()=>[s(b,{round:"",color:"secondary",size:"lg",icon:"add",onClick:a[12]||(a[12]=e=>t.$router.push("/compras/add"))})]),_:1})):p("",!0),s(ee,{modelValue:$.value,"onUpdate:modelValue":a[13]||(a[13]=e=>$.value=e)},{default:l(()=>[s(me,{detalleData:r(k)},null,8,["detalleData"])]),_:1},8,["modelValue"])],64))}});export{Ke as default};
