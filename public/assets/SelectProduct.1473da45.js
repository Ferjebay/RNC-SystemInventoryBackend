import{r as n,n as D,d as R,o as A,a9 as F,g as o,aU as V,f as r,aV as B,e as N,ae as x,ad as q,h as T,i as $,aa as _,ab as b}from"./index.a31813ff.js";import{Q as m}from"./QTd.d20c671a.js";import{Q as M}from"./QInnerLoading.62ac6dcd.js";import{Q as O}from"./QTable.a908524b.js";import{u as z}from"./useHelpers.98f280cb.js";const v=n([]),I=n(""),d=n(!1),C=n({}),w=n(!1),Q=n(""),E=n([{name:"acciones",label:"Quitar",align:"left"},{label:"Codigo Barra",align:"left",field:"codigoBarra",name:"codigoBarra"},{label:"Producto",align:"left",field:"nombre",name:"nombre"},{name:"cantidad",label:"Cantidad",align:"center"},{name:"iva",label:"Aplica IVA",align:"center"},{name:"descuento",label:"Descuento(%)",align:"center",field:"descuento"},{label:"Stock",align:"center",field:"stock",name:"stock"},{name:"pvm",label:"Costo Neto",align:"center"},{name:"v_total",label:"Valor Total",align:"center",field:"v_total"}]),U=()=>{const p=n(0),{api:y,mostrarNotify:c,claim:i}=z(),f=(e,t)=>{if(v.value.some(s=>s.id==e.id))c("warning","Ya fue agregado este articulo");else{if(t!=="compras"&&e.stock<=0&&e.tipo!="Servicio")return c("negative",`No hay stock del articulo ${e.nombre}`);let s=0;t=="proforma"?s=e.cantidad:e.tipo=="Servicio"?s=1:s=0,e.cantidad=s,e.v_total=t=="proforma"?parseFloat(e.v_total):0,e.descuento=t=="venta"||t=="proforma"?e.descuento:0,v.value.unshift(e),e.tipo=="Servicio"&&k(e,"ventas"),I.value=""}},h=async e=>{if(I.value.length==0)return c("warning","Ingresa el termino de busqueda");d.value=!0;try{let t={"company-id":i.company.id},{data:l}=await y.get(`/products/${I.value}`,{headers:t});if(l=l.filter(s=>{if(e=="compras"&&s.tipo=="Producto"||e=="venta")return s}),l.length>1)return C.value={data:l,tipo:e},w.value=!0,d.value=!1;if(l.length===0)return c("warning","No se encontro el articulo..."),d.value=!1;if(i.roles[0]=="ADMINISTRADOR"||i.roles[0]=="SUPER-ADMINISTRADOR"){if(Q.value!==l[0].sucursal_id.id)return c("warning","No se encontro el articulo..."),d.value=!1}else if(i.sucursales[0]!==l[0].sucursal_id.id)return c("warning","No se encontro el articulo..."),d.value=!1;d.value=!1,f(l[0],e)}catch(t){console.log(t),d.value=!1}},g=e=>{const t=v.value.findIndex(l=>l.id==e);v.value.splice(t,1)},S=async()=>{const{data:{iva:e}}=await y.get(`/companies/get-iva/${i.company.id}`);e=="4"&&(p.value=15),e=="3"&&(p.value=14),e=="2"&&(p.value=12)},P=D(()=>{let e=0,t=0,l=0,s=0;return v.value.forEach(u=>{u.descuento>0&&(l+=parseFloat(u.v_total)*parseFloat(u.descuento)/100),u.aplicaIva&&(t+=(parseFloat(u.v_total)-parseFloat(u.v_total)*parseFloat(u.descuento)/100)*p.value/100),e+=parseFloat(u.v_total)}),s=e+t-l,{subtotal:a(e),iva:a(t),descuento:a(l),total:a(s)}}),k=(e,t="compras")=>{t=="compras"?e.v_total=parseInt(e.cantidad)*parseFloat((Math.floor(e.precio_compra*100)/100).toString()):e.v_total=a(parseInt(e.cantidad)*parseFloat(e.pvp)),e.pvp=a(e.pvp)},a=e=>{let t=e.toString().split("."),l=parseFloat(t[0]);return t.length>1?l+=parseFloat("."+t[1].substring(0,2)):l+=parseFloat(".00"),parseFloat(l.toFixed(2))};return S(),{agregarAndValidarStock:f,columns:E,claim:i,formatearNumero:a,filterArticulo:h,filterByCodBarra:I,loadingState:d,listProductos:C,modalSelectProducto:w,sucursal_selected:Q,iva_selected:p,getSubtotalByProduct:k,quitarArticulo:g,valorFactura:P,rows:v}};const H=N("div",{class:"text-h6 text-center"},"Selecciona un producto",-1),L={class:"row q-gutter-sm"},Y={class:"col-xs-12 col-sm-12 q-my-sm"},X=R({__name:"SelectProduct",props:{listProductos:{}},emits:["agregarProduct"],setup(p,{emit:y}){const c=p,i=[{name:"add",label:"Agregar"},{name:"codigoBarra",label:"Codigo Barra",align:"left",field:"codigoBarra"},{name:"producto",label:"Producto",align:"left",field:"nombre"},{name:"stock",label:"Stock",align:"center",field:"stock"},{name:"aplicaIva",label:"Aplica IVA",align:"center",field:"aplicaIva"},{name:"pvm",label:"Precio de Compra",align:"center",field:"pvm"},{name:"pvp",label:"P.V.P",align:"center",field:"pvp"},{name:"sucursal",label:"Sucursal",align:"center",field:"sucursal"}],{claim:f,sucursal_selected:h}=U();let g;f.roles[0]=="ADMINISTRADOR"||f.roles[0]=="SUPER-ADMINISTRADOR"?g=h.value:g=f.sucursales[0];const S=n([]);return c.listProductos.tipo,S.value=c.listProductos.data,(P,k)=>(A(),F(V,{style:{width:"1040px","max-width":"80vw"}},{default:o(()=>[r(B,{class:"q-pb-none"},{default:o(()=>[H]),_:1}),r(B,null,{default:o(()=>[N("div",L,[N("div",Y,[r(O,{class:x([P.$q.dark.isActive?"":"my-sticky-header-table2"]),rows:S.value,columns:i,"hide-bottom":"","row-key":"name"},{"body-cell-add":o(a=>[r(m,{props:a},{default:o(()=>[q(g)==a.row.sucursal_id.id?(A(),F(T,{key:0,round:"",color:"green-9",class:"q-ml-md",size:"sm",onClick:e=>y("agregarProduct",a.row),icon:"fa-solid fa-plus"},null,8,["onClick"])):(A(),F($,{key:1,color:"red-9",class:"q-ml-md",size:"sm",name:"fa-solid fa-ban"}))]),_:2},1032,["props"])]),"body-cell-descuento":o(a=>[r(m,{props:a},{default:o(()=>[_(b(a.row.descuento)+"% ",1)]),_:2},1032,["props"])]),"body-cell-aplicaIva":o(a=>[r(m,{props:a},{default:o(()=>[_(b(a.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":o(a=>[r(m,{props:a},{default:o(()=>[_("$"+b(a.row.pvp),1)]),_:2},1032,["props"])]),"body-cell-pvm":o(a=>[r(m,{props:a},{default:o(()=>[_("$"+b(a.row.precio_compra),1)]),_:2},1032,["props"])]),"body-cell-sucursal":o(a=>[r(m,{props:a},{default:o(()=>[_(b(a.row.sucursal_id.nombre),1)]),_:2},1032,["props"])]),loading:o(()=>[r(M,{showing:"",color:"primary"})]),_:1},8,["class","rows"])])])]),_:1})]),_:1}))}});export{X as _,U as u};
