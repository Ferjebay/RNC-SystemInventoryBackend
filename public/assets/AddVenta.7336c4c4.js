import{Q as ge,a as E}from"./QBreadcrumbs.82496c9f.js";import{p as f,m as _e,bA as be,bB as he,r as x,v as ye,x as we,o as v,c as k,e as l,ae as u,f as s,g as o,aa as h,ab as m,ad as i,a9 as y,bC as xe,bb as U,af as F,by as G,Q as V,ba as Ae,aj as Ie,bz as Ve,P as M,i as R,w as qe,h as P,O as Z}from"./index.7e6e0c1f.js";import{a as D,Q as O,d as H}from"./format.a57e8416.js";import{Q}from"./QSelect.f9dfedb4.js";import{Q as Se,a as q}from"./QTable.208cdf47.js";import{Q as Ce}from"./QPopupEdit.b49cd29c.js";import{Q as Re}from"./QBadge.c29970ea.js";import{Q as De}from"./QList.b38dfcbe.js";import{Q as Oe}from"./QBtnDropdown.0c07dfc6.js";import{Q as Te}from"./QForm.3ac0604a.js";import{C as W}from"./ClosePopup.465445af.js";import{u as Ne}from"./useHelpers.104cd01b.js";import{d as $e}from"./date.d3157090.js";import{u as Ee,_ as ke}from"./SelectProduct.231053a9.js";import"./QBtnGroup.fdc05c3f.js";import"./use-quasar.fab57ded.js";import"./axios.7bffd825.js";import"./QInnerLoading.843c21ad.js";const Ue=[f("g",{transform:"translate(20 50)"},[f("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.6"},[f("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),f("g",{transform:"translate(50 50)"},[f("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.8"},[f("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.1s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),f("g",{transform:"translate(80 50)"},[f("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.9"},[f("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.2s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])])];var Fe=_e({name:"QSpinnerFacebook",props:be,setup(L){const{cSize:_,classes:S}=he(L);return()=>f("svg",{class:S.value,width:_.value,height:_.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},Ue)}});const Me={class:"q-ma-lg q-pt-md q-mb-none",style:{"margin-bottom":"10px"}},Pe={class:"row q-col-gutter-lg"},Qe=l("label",{class:"text-h6 text-center"},"Nueva Venta/Proforma",-1),Le=[Qe],Be={class:"row q-mx-lg q-col-gutter-md"},je={class:"text-weight-regular"},ze=l("span",{class:"q-mr-sm"},"N\xB0 Factura:",-1),Ke={key:1,class:"text-weight-regular"},Ye={class:"col-xs-12 col-sm-12 col-md-6 q-mt-md q-pl-none"},Je=l("label",null,"Seleccionar Cliente: ",-1),Ge=l("label",null,"Seleccionar Sucursal: ",-1),Ze={class:"row q-pt-lg q-mx-lg q-col-gutter-md"},He={class:"col-xs-12 col-md-6 q-pl-none"},We=l("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),Xe=l("label",null,"Forma de pago:",-1),ea={class:"row q-mx-lg justify-center q-mt-md"},aa={class:"col-12"},ta={class:"full-width row flex-center text-lime-10 q-gutter-sm"},la=l("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1),sa=l("div",{class:"col-3 text-right"},[l("label",{class:"q-pr-md"},"Descripci\xF3n")],-1),oa={class:"col-9"},ra={class:"col-xs-12 col-sm-5",style:{display:"flex","justify-content":"end"}},ia={class:"text-right"},na=l("td",null,[l("b",null,"TOTAL BRUTO:")],-1),ua={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},da={class:"text-right"},ca=l("td",null,[l("b",null,"DESCUENTOS:")],-1),ma={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},pa={class:"text-right"},va=l("td",null,[l("b",null,"SUBTOTAL:")],-1),fa={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},ga={class:"text-right"},_a={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},ba={class:"text-right"},ha=l("td",null,[l("b",null,"TOTAL DE VENTA:")],-1),ya={style:{width:"50px"}},Ma={__name:"AddVenta",setup(L){const{filterByCodBarra:_,columns:S,rows:w,modalSelectProducto:C,loadingState:X,listProductos:ee,valorFactura:g,agregarAndValidarStock:B,filterArticulo:ae,formatearNumero:te,getSubtotalByProduct:j,sucursal_selected:p,iva_selected:z,quitarArticulo:le}=Ee();let K=[];const b=x([]),{api:A,claim:c,mostrarNotify:I,route:Y,router:se}=Ne(),T=x([]),oe=x(!1),N=x(!1),re=Date.now();let ie=$e.formatDate(re,"DD/MM/YYYY");(c.roles[0]!=="SUPER-ADMINISTRADOR"||c.roles[0]!=="ADMINISTRADOR")&&(p.value=c.sucursales[0]),S.value[7]={name:"pvp",label:"Precio de Venta",align:"center"};const r=x({customer_id:"386f5a32-7c96-4a51-8f50-86ea8338325b",numero_comprobante:"--- --- ---------",products:[],user_id:"",forma_pago:"",descripcion:""}),d=x({customer_id:{message:"",isValid:!0},sucursal_id:{message:"",isValid:!0},forma_pago:{message:"",isValid:!0}});ye(p,(a,e)=>{J()});const ne=async a=>{T.value=[];const{data:e}=await A.get(`/sucursal/find/${a}/company`);e.forEach(t=>{T.value.push({label:t.nombre,value:t.id})})},ue=async()=>{if(Y.params.venta_id!==""){const{data:a}=await A.get(`/invoices/filterInvoice/${Y.params.venta_id}`);r.value.customer_id=a.customer_id.id,r.value.id=a.id,r.value.clave_acceso=a.clave_acceso,r.value.estadoSRI=a.estadoSRI,r.value.forma_pago=a.forma_pago,r.value.descripcion=a.descripcion,p.value=a.sucursal_id.id,a.invoiceToProduct.forEach(e=>{e.product_id.cantidad=e.cantidad,e.product_id.descuento=parseFloat(e.descuento),e.product_id.v_total=e.v_total,B(e.product_id,"proforma")})}},de=a=>{B(a,"venta"),C.value=!1},ce=async()=>{const a=r.value.customer_id;r.value.customer_id="",oe.value=!1;try{let e={company_id:c.company.id};const{data:t}=await A.get("/customers",{headers:e});b.value=[],t.forEach(n=>{b.value.push({label:n.nombres,value:n.id,num_doc:n.numero_documento})}),b.value.unshift({label:"CONSUMIDOR FINAL",value:"386f5a32-7c96-4a51-8f50-86ea8338325b",num_doc:"9999999999999"}),K=b.value,r.value.customer_id=a,ue()}catch(e){console.log(e)}},me=(a="",e)=>{if(a==="")return e(()=>{b.value=K});e(()=>{const t=a.toLowerCase();b.value=b.value.filter(n=>n.num_doc.indexOf(t)>-1||n.label.toLowerCase().indexOf(t)>-1)})},pe=()=>{let a=!1;return(c.roles[0]=="SUPER-ADMINISTRADOR"||c.roles[0]=="ADMINISTRADOR")&&p.value==""&&(d.value.sucursal_id.message="Debes seleccionar una sucursal",d.value.sucursal_id.isValid=!1,a=!0),g.value.total>50&&r.value.customer_id=="386f5a32-7c96-4a51-8f50-86ea8338325b"&&(d.value.customer_id.message="La factura supera los $50.00, no puede ser emitida a CONSUMIDOR FINAL",d.value.customer_id.isValid=!1,a=!0),g.value.total>50&&r.value.forma_pago=="01"&&(d.value.forma_pago.message="La factura supera los $500.00, debes elegir otra forma de pago",d.value.forma_pago.isValid=!1,a=!0),w.value.length==0&&(a=!0,I("warning","Debes agregar algun producto..")),r.value.forma_pago.length==0&&(d.value.forma_pago.message="Debes elegir una forma de pago",d.value.forma_pago.isValid=!1,a=!0),w.value.forEach((e,t)=>{e.cantidad<=0&&(a=!0,I("warning",`Agrega una cantidad cantidad al producto: ${e.nombre} de la fila: ${t+1}`)),e.cantidad>e.stock&&e.tipo!="Servicio"&&(a=!0,I("warning",`La cantidad de venta del producto: ${e.nombre} supera su stock disponible`))}),a},$=async a=>{if(pe())return;r.value={...r.value,...g.value,products:w.value,user_id:c.id,tipo:a,porcentaje_iva:z.value};let e;a=="EMISION"&&(e="\xBFDeseas emitir factura de esta proforma?"),a=="FACTURA"&&(e="\xBFDeseas generar esta FACTURA?"),a=="PROFORMA"&&(e="\xBFDeseas guardar como PROFORMA?"),Ve.create({title:e,ok:{push:!0,color:"cyan-10",label:"Enviar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{M.show({message:"Cargando..."});let t={headers:{sucursal_id:p.value}};await A.post("/invoices",r.value,t),M.hide(),I("positive","Venta realizada exitosamente"),se.push("/ventas")}catch(t){console.log(t),M.hide()}})},ve=()=>{if((c.roles[0]=="SUPER-ADMINISTRADOR"||c.roles[0]=="ADMINISTRADOR")&&typeof p.value=="undefined")return I("warning","Elige una sucursal primeramente");ae("venta")},J=async()=>{N.value=!0;let a={headers:{sucursal_id:p.value}};const{data:e}=await A.get("/CE/facturas/getNumFactura",a);r.value.numero_comprobante=e.numComprobante,N.value=!1};return we(()=>{w.value=[]}),c.roles[0]=="SUPER-ADMINISTRADOR"||c.roles[0]=="ADMINISTRADOR"?ne(c.company.id):J(),ce(),(a,e)=>(v(),k(Ie,null,[l("div",Me,[l("div",Pe,[l("div",{class:u(["col-xs-12 col-md-6",[a.$q.screen.width<1022?"q-pt-sm":""]])},[s(ge,{class:u(["row q-mr-xs",[a.$q.screen.width<1022?"justify-center q-pt-sm":"justify-start "]])},{default:o(()=>[s(E,{label:"Inicio",icon:"home",to:"/"}),s(E,{label:"Ventas",icon:"payments",to:"/ventas"}),s(E,{label:"Venta/Prof.",icon:"add_circle"})]),_:1},8,["class"])],2),l("div",{class:u(["col-xs-12 col-md-6",[a.$q.screen.width<1022?"text-center q-pt-sm":"text-right"]])},Le,2)])]),l("div",Be,[l("div",{class:u(["col-xs-12 col-md-6 q-pt-xs q-mt-md",a.$q.screen.width>=1023||"text-center"])},[l("label",{class:u(["text-weight-medium",[a.$q.screen.xs?"text-subtitle1":"text-h5"]])},[h("Fecha de Emisi\xF3n: "),l("span",je,m(i(ie)),1)],2)],2),l("div",{class:u(["col-xs-12 col-md-6",a.$q.screen.width<=1023?"text-center q-pt-sm":"text-right q-pt-xs q-mt-md"])},[l("label",{class:u(["q-mr-lg text-weight-medium",[a.$q.screen.xs?"text-subtitle1":"text-h5"]])},[ze,N.value?(v(),y(Fe,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(v(),k("span",Ke,m(r.value.numero_comprobante),1))],2)],2),l("div",Ye,[Je,s(Q,{color:"orange",filled:"",modelValue:r.value.customer_id,"onUpdate:modelValue":[e[1]||(e[1]=t=>r.value.customer_id=t),e[2]||(e[2]=t=>d.value.customer_id.isValid=!0)],options:b.value,"emit-value":"","map-options":"",dense:"",error:!d.value.customer_id.isValid,onFilter:me,"use-input":"","input-debounce":"0"},xe({error:o(()=>[l("label",{class:u(a.$q.dark.isActive?"text-red-4":"text-negative")},m(d.value.customer_id.message),3)]),"no-option":o(()=>[s(D,null,{default:o(()=>[s(O,{class:"text-grey"},{default:o(()=>[h(" No hay resultados ")]),_:1})]),_:1})]),_:2},[r.value.customer_id&&r.value.customer_id!=="CONSUMIDOR FINAL"?{name:"append",fn:o(()=>[s(R,{name:"cancel",onClick:e[0]||(e[0]=qe(t=>r.value.customer_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","error"])]),i(c).roles[0]=="SUPER-ADMINISTRADOR"||i(c).roles[0]=="ADMINISTRADOR"?(v(),k("div",{key:0,class:u(["col-xs-12 col-md-5 q-mt-md",a.$q.screen.width<=1023?"q-pl-none":"offset-1"])},[Ge,s(Q,{filled:"",modelValue:i(p),"onUpdate:modelValue":[e[3]||(e[3]=t=>U(p)?p.value=t:null),e[4]||(e[4]=t=>(d.value.sucursal_id.isValid=!0,w.value=[]))],error:!d.value.sucursal_id.isValid,options:T.value,"emit-value":"","map-options":"",dense:""},{error:o(()=>[l("label",{class:u(a.$q.dark.isActive?"text-red-4":"text-negative")},m(d.value.sucursal_id.message),3)]),"no-option":o(()=>[s(D,null,{default:o(()=>[s(O,{class:"text-grey"},{default:o(()=>[h(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","error","options"])],2)):F("",!0)]),l("div",Ze,[l("div",He,[We,s(V,{outlined:"","bottom-slots":"",loading:i(X),dense:"",modelValue:i(_),"onUpdate:modelValue":e[6]||(e[6]=t=>U(_)?_.value=t:null),modelModifiers:{trim:!0},onKeyup:G(ve,["enter"])},{append:o(()=>[i(_)!==""?(v(),y(R,{key:0,name:"close",onClick:e[5]||(e[5]=t=>_.value=""),class:"cursor-pointer"})):F("",!0),s(R,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])]),l("div",{class:u(["col-xs-12 col-sm-5",a.$q.screen.width<=1023?"q-pl-none q-mb-lg":"offset-1"])},[Xe,s(Q,{dense:"",modelValue:r.value.forma_pago,"onUpdate:modelValue":[e[7]||(e[7]=t=>r.value.forma_pago=t),e[8]||(e[8]=t=>d.value.forma_pago.isValid=!0)],modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",error:!d.value.forma_pago.isValid,options:[{label:"SIN UTILIZACION DEL SISTEMA FINANCIERO",value:"01"},{label:"COMPENSACI\xD3N DE DEUDAS",value:"15"},{label:"TARJETA DE D\xC9BITO",value:"16"},{label:"DINERO ELECTR\xD3NICO",value:"17"},{label:"TARJETA PREPAGO",value:"18"},{label:"TARJETA DE CR\xC9DITO",value:"19"},{label:"OTROS CON UTILIZACI\xD3N DEL SISTEMA FINANCIERO",value:"20"},{label:"ENDOSO DE T\xCDTULOS",value:"21"}]},{error:o(()=>[l("label",{class:u(a.$q.dark.isActive?"text-red-4":"text-negative")},m(d.value.forma_pago.message),3)]),_:1},8,["modelValue","error"])],2)]),s(Te,{onSubmit:e[13]||(e[13]=t=>$("EMISION"))},{default:o(()=>[l("div",ea,[l("div",aa,[s(Se,{rows:i(w),columns:i(S),"row-key":"name",class:u([a.$q.dark.isActive?"":"my-sticky-header-table3"]),"hide-pagination":!0,"rows-per-page-options":[50]},{"no-data":o(({})=>[l("div",ta,[la,s(R,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":o(t=>[s(q,{props:t},{default:o(()=>[s(V,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:n=>i(j)(t.row,"ventas"),min:"0",max:t.row.stock,readonly:t.row.tipo=="Servicio",type:"number",style:{width:"100px"},modelValue:t.row.cantidad,"onUpdate:modelValue":n=>t.row.cantidad=n,modelModifiers:{trim:!0}},null,8,["onChange","max","readonly","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-descuento":o(t=>[s(q,{props:t},{default:o(()=>[s(V,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:n=>i(j)(t.row,"ventas"),min:"0",type:"number",style:{width:"100px"},modelValue:t.row.descuento,"onUpdate:modelValue":n=>t.row.descuento=n},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":o(t=>[s(q,{props:t},{default:o(()=>[h(m(t.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":o(t=>[s(q,{props:t},{default:o(()=>[h(" $"+m(t.row.pvp)+" ",1),s(Ce,{modelValue:t.row.pvp,"onUpdate:modelValue":n=>t.row.pvp=n},{default:o(n=>[s(V,{modelValue:n.value,"onUpdate:modelValue":fe=>n.value=fe,dense:"",autofocus:"",counter:"",onKeyup:G(n.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":o(t=>[s(q,{props:t},{default:o(()=>[s(P,{round:"",color:"deep-orange",onClick:n=>i(le)(t.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),l("div",{class:u(["col-xs-12 col-sm-7 row items-center",a.$q.screen.width<=1023?"q-mt-lg q-mb-sm":""])},[sa,l("div",oa,[s(V,{modelValue:r.value.descripcion,"onUpdate:modelValue":e[9]||(e[9]=t=>r.value.descripcion=t),filled:"",type:"textarea",rows:"4"},null,8,["modelValue"])])],2),l("div",ra,[l("table",{class:u([a.$q.screen.xs?"":"linearTablaDetalle"])},[l("tr",ia,[na,l("td",ua," $"+m(i(g).subtotal.toFixed(2)),1)]),l("tr",da,[ca,l("td",ma," $"+m(i(g).descuento.toFixed(2)),1)]),l("tr",pa,[va,l("td",fa," $"+m(i(te)(i(g).subtotal-i(g).descuento).toFixed(2)),1)]),l("tr",ga,[l("td",null,[l("b",null,"IVA("+m(i(z))+"%):",1)]),l("td",_a," $"+m(i(g).iva.toFixed(2)),1)]),l("tr",ba,[ha,l("td",ya,[s(Re,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${i(g).total.toFixed(2)}`},null,8,["label"])])])],2)]),l("div",{class:u(["col-12 flex q-mt-md q-my-lg",[a.$q.screen.width<600?"justify-center":"justify-between"]])},[a.$q.screen.width>600?(v(),y(P,{key:0,icon:"arrow_back",onClick:e[10]||(e[10]=t=>a.$router.push("/ventas")),outline:"",rounded:"",class:"q-mr-lg",color:a.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:o(()=>[h(" \xA0 Regresar ")]),_:1},8,["color"])):F("",!0),a.$route.params.venta_id==""?(v(),y(Oe,{key:1,outline:"",rounded:"",style:{color:"#696cff"},label:"Generar",class:u(a.$q.screen.width>=1023?"q-px-xl":"full-width")},{default:o(()=>[s(De,null,{default:o(()=>[Z((v(),y(D,{clickable:"",onClick:e[11]||(e[11]=t=>$("FACTURA"))},{default:o(()=>[s(O,null,{default:o(()=>[s(H,null,{default:o(()=>[h("FACTURA")]),_:1})]),_:1})]),_:1})),[[W]]),Z((v(),y(D,{type:"submit",clickable:"",onClick:e[12]||(e[12]=t=>$("PROFORMA"))},{default:o(()=>[s(O,null,{default:o(()=>[s(H,null,{default:o(()=>[h("PROFORMA")]),_:1})]),_:1})]),_:1})),[[W]])]),_:1})]),_:1},8,["class"])):(v(),y(P,{key:2,type:"submit",label:"Emitir Factura",class:u(a.$q.screen.width>=1023?"q-px-xl":"full-width"),outline:"",rounded:"",style:{color:"#696cff"}},null,8,["class"]))],2)])]),_:1}),s(Ae,{modelValue:i(C),"onUpdate:modelValue":e[14]||(e[14]=t=>U(C)?C.value=t:null)},{default:o(()=>[s(ke,{listProductos:i(ee),onAgregarProduct:de},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}};export{Ma as default};
