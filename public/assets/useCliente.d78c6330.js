import{u as G}from"./useHelpers.0546c524.js";import{d as C}from"./date.2a22ff86.js";import{r as o,C as H,v as z,by as J}from"./index.b55b9a32.js";const h=o(!1),w=o(1),F=o(!1),S=o(!1),Y=o(!1);let j=o([]),x=o([]);const K=o([]),Q=o([]),U=o([]);let W=o([]),X=o([]);const s=o({nombres:"",tipo_documento:"",numero_documento:"",email:"",celular:"",direccion:""}),l=o({tipo:"",dia_pago:"",tipo_impuesto:"",tipo_comprobante:"",dia_gracia:"",aplicar_corte:"",recordatorio_pago:null}),i=o({router_id:"",direccion:"",coordenadas:"",perfil_internet:"",precio:0,fecha_instalacion:C.formatDate(Date.now(),"YYYY/MM/DD"),mac:"",red_id:"",ipv4:"",caja_id:"",puerto_id:""}),n=o({router_id:{message:"",isValid:!0},direccion:{message:"",isValid:!0},coordenadas:{message:"",isValid:!0},perfil_internet:{message:"",isValid:!0},precio:{message:"",isValid:!0},fecha_instalacion:{message:"",isValid:!0},mac:{message:"",isValid:!0},red_id:{message:"",isValid:!0},ipv4:{message:"",isValid:!0},caja_id:{message:"",isValid:!0},puerto_id:{message:"",isValid:!0}}),p=o({tipo:{message:"",isValid:!0},dia_pago:{message:"",isValid:!0},tipo_impuesto:{message:"",isValid:!0},tipo_comprobante:{message:"",isValid:!0},dia_gracia:{message:"",isValid:!0},aplicar_corte:{message:"",isValid:!0},recordatorio_pago:{message:"",isValid:!0}}),c=o({nombres:{message:"",isValid:!0},tipo_documento:{message:"",isValid:!0},numero_documento:{message:"",isValid:!0},email:{message:"",isValid:!0},celular:{message:"",isValid:!0},direccion:{message:"",isValid:!0},company_id:{message:"",isValid:!0}}),re=()=>{const{api:V,claim:R,router:N,mostrarNotify:b,confirmDelete:q,isDeleted:P,route:$}=G(),I=["nombres","tipo_documento","numero_documento","email","celular","direccion"],E=["tipo","dia_pago","tipo_impuesto","dia_gracia","aplicar_corte","tipo_comprobante"],y=["perfil_internet","precio","red_id","ipv4"],k=()=>{s.value={nombres:"",tipo_documento:"",numero_documento:"",email:"",celular:"",direccion:""},l.value={tipo:"",dia_pago:"",tipo_impuesto:"",tipo_comprobante:"",dia_gracia:"",aplicar_corte:"",recordatorio_pago:null},i.value={router_id:"",direccion:"",coordenadas:"",perfil_internet:"",precio:0,fecha_instalacion:C.formatDate(Date.now(),"YYYY/MM/DD"),mac:"",red_id:"",ipv4:"",caja_id:"",puerto_id:""}},A=()=>{I.forEach(e=>{c.value[e].isValid=!0}),E.forEach(e=>{p.value[e].isValid=!0}),y.forEach(e=>{n.value[e].isValid=!0})},B=e=>{let a=0;a=i.value[e];const r=/^\d{0,9}(\.\d{1,2})?$/;setTimeout(function(){let t=0;if(t=i.value[e],!r.test(t.toString())){const d=parseFloat(a.toString().substring(0,a.toString().length-1));i.value[e]=d}},0),n.value.precio.isValid=!0},L=()=>{let e=!1;var a=/^\w+([.-_+]?\w+)*@\w+([.-]?\w+)*(\.\w{2,10})+$/;a.test(s.value.email)||(c.value.email.message="Ingresa un email valido",c.value.email.isValid=!1,e=!0),I.forEach(t=>{(s.value[t].length==0||s.value[t]==0)&&(c.value[t].message="Debes completar este campo",c.value[t].isValid=!1,e=!0)});let r;return s.value.tipo_documento==="04"&&(r=13),s.value.tipo_documento==="05"&&(r=10),s.value.tipo_documento==="06"&&(r=10),c.value.numero_documento.isValid&&s.value.numero_documento.length!=r&&(c.value.numero_documento.message=`Debes completar ${r} digitos`,c.value.numero_documento.isValid=!1,e=!0),e||(F.value=!0,w.value=2),e},O=()=>{let e=!1;return E.forEach(a=>{(l.value[a].length==0||l.value[a]==0)&&(p.value[a].message="Debes completar este campo",p.value[a].isValid=!1,e=!0)}),(l.value.recordatorio_pago==null||l.value.recordatorio_pago.length==0)&&(p.value.recordatorio_pago.message="Debes elegir al menos una opci\xF3n",p.value.recordatorio_pago.isValid=!1,e=!0),e||(S.value=!0,w.value=3),e},M=()=>{let e=!1;return i.value.router_id.length==0?(n.value.router_id.message="Debes elegir un router",n.value.router_id.isValid=!1,e=!0):(y.forEach(a=>{(i.value[a].length==0||i.value[a]==0)&&(n.value[a].message="Debes completar este campo",n.value[a].isValid=!1,e=!0)}),i.value.caja_id.length>0&&i.value.puerto_id.length==""&&(n.value.puerto_id.message="Elige una opci\xF3n",n.value.puerto_id.isValid=!1,e=!0)),e||(Y.value=!0),e};return H(()=>{z(s.value,(e,a)=>{if(e.tipo_documento!==""&&e.tipo_documento!=="04"&&s.value.numero_documento.length>10){const r=e.numero_documento.length-10,t=e.numero_documento.substring(0,e.numero_documento.length-r);s.value.numero_documento=t}})}),{api:V,claim:R,formCliente:s,formFacturacion:l,loading:h,limpiarFormulario:k,groupedIpsByRed:e=>{const a={};return e.forEach(r=>{const t=r.substring(0,r.lastIndexOf("."));a.hasOwnProperty(t)||(a[t]=[]),a[t].push(r)}),a},obtenerListaSubred:e=>{const[a,r]=e.split("/"),t=a.split(".").map(Number),d=parseInt(r,10),_="1".repeat(d)+"0".repeat(32-d),g=[];for(let u=0;u<4;u++)g.push(parseInt(_.substr(u*8,8),2));const v=t.map((u,f)=>u&g[f]).join("."),m=[];for(let u=0;u<Math.pow(2,32-d);u++){const f=v.split(".").map((D,T)=>parseInt(D,10)+Math.floor(u/Math.pow(2,(3-T)*8))%256).join(".");f.split(".").every(D=>parseInt(D,10)<=255)&&m.push(f)}return m},listRedes:K,listRouter:j,listServicionsInternet:x,listCajasNap:W,listPuertosCajaNap:X,validaciones:c,validacionesFacturacion:p,validarDatosPersonales:L,validarFormFact:O,validarFormInternet:M,validacionesInternet:n,validDecimal:B,mostrarNotify:b,quitarErrores:A,confirmDelete:q,optionsListIps:U,listIps:Q,route:$,step:w,done1:F,done2:S,done3:Y,formInternet:i,isDeleted:P,onSubmit:async e=>{M()||J.create({title:"\xBFDeseas agregar este cliente?",ok:{push:!0,color:"cyan-10",label:"Guardar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{h.value=!0;const a=j.value.find(m=>m.value==i.value.router_id),r=x.value.find(m=>m.value==i.value.perfil_internet),t=new Date,d=t.getDate(),_=t.getMonth(),g=t.getFullYear();let v="";d>l.value.dia_pago?v=new Date(g,_+2,l.value.dia_pago):v=new Date(g,_+1,l.value.dia_pago),e?await V.patch("/customers/"+s.value.id,s.value):(i.value.red_id.includes("|")&&(i.value.indice=i.value.red_id.split("|")[1],i.value.red_id=i.value.red_id.split("|")[0]),await V.post("/customers",{cliente:s.value,facturacion:l.value,servicio:i.value,route:a,internet:r,fechaPago:v})),b("positive",`Cliente ${e?"editado":"agregado"} exitosamente`),h.value=!1,N.push({name:"cliente.index"})}catch(a){console.log(a),b("warning",a.response.data.message),h.value=!1}})}}};export{re as u};
