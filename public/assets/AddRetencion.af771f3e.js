import{Q as de,a as Q}from"./QBreadcrumbs.1ec8a5f7.js";import{Q as me}from"./QSpinnerFacebook.461d28c2.js";import{d as ce,o as V,a9 as U,g as n,aU as O,f as s,e as a,aa as b,O as L,h as g,aV as A,ah as pe,r as v,v as j,x as ve,c as S,ae as i,ba as _e,aj as be,bB as fe,P as ge,ab as d,ad as _,bw as qe,i as D,w as Ve,bb as xe,af as B,Q as x}from"./index.3f282eda.js";import{a as P,Q as z}from"./format.7cb823e4.js";import{Q as h}from"./QSelect.2811d936.js";import{Q as he}from"./QDate.43f0d22e.js";import{Q as ye}from"./QPopupProxy.80b18e61.js";import{Q as N}from"./QTd.2cb016c5.js";import{Q as we}from"./QTable.2fe37284.js";import{Q as De}from"./QForm.a21ab251.js";import{C as H}from"./ClosePopup.f9fc1bf2.js";import{u as Ae}from"./useHelpers.18aa3d69.js";import{d as Y}from"./date.1f8e2511.js";import{u as $e}from"./useProduct.0947674b.js";import"./QList.169df514.js";import"./use-quasar.3d12d71e.js";import"./axios.d032c155.js";const Ie={class:"text-h6 text-center"},Re=a("h4",null,"Todo ok",-1),Ce=ce({__name:"ModalAddImpuesto",setup(G){return console.log("object"),(p,y)=>(V(),U(O,{style:{width:"740px !important","max-width":"fit-content"}},{default:n(()=>[s(A,null,{default:n(()=>[a("div",Ie,[b(" Agregar Impuesto "),L(s(g,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[H]])])]),_:1}),s(pe,{inset:""}),s(A,{class:"q-pt-none"},{default:n(()=>[Re]),_:1})]),_:1}))}});const ke={class:"q-ma-lg q-pt-md q-mb-none",style:{"margin-bottom":"10px"}},Qe={class:"row q-col-gutter-lg flex items-center"},Se=a("label",{class:"text-h6 text-center"},"Nueva Retenci\xF3n",-1),Ne=[Se],Ue={class:"text-weight-regular"},Oe=a("span",{class:"q-mr-sm"},"N\xB0 Retenci\xF3n:",-1),Te={key:1,class:"text-weight-regular"},Me={class:"col-xs-12 col-sm-12 col-md-6 q-mt-md q-pl-none"},Ee=a("label",null,"Seleccionar Cliente: ",-1),Fe=a("label",null,"Seleccionar Sucursal: ",-1),je=a("label",null,"Clave Acceso: ",-1),Be=a("label",null,"Numero de Comprobante: ",-1),Pe=a("label",null,"Fecha emisi\xF3n sustento: ",-1),ze={class:"row items-center justify-end"},Ye=a("label",null,"Tipo de documento:",-1),Le=a("label",null,"Impuesto:",-1),He=a("label",null,"Retenci\xF3n del I.V.A:",-1),Ge=a("label",null,"Base Imponible:",-1),Je=a("label",null,"Valor Retenido:",-1),Ke={class:"col-xs-12 col-md-2 flex flex-center"},We={class:"q-mx-lg justify-center q-mt-md"},Xe={class:"col-12"},Ze=a("div",{class:"text-center row justify-center",style:{width:"100%"}},[a("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Comprobantes ")],-1),eo={class:"full-width row flex-center text-lime-10 q-gutter-sm"},oo=a("span",{class:"text-subtitle1"}," No existen impuestos ",-1),wo={__name:"AddRetencion",setup(G){const{rows:p,formatearNumero:y,sucursal_selected:m,quitarArticulo:J}=$e(),K=v([{name:"acciones",label:"Quitar",align:"left"},{label:"Impuesto",align:"left",field:"tipo_documento",name:"tipo_documento"},{name:"numero_comprobante_documento",label:"Documento",align:"center",field:"numero_comprobante_documento"},{name:"fecha",label:"Fecha",align:"center",field:"inputDate"},{name:"descripcion",label:"Descripci\xF3n",align:"center",field:"descripcion"},{name:"base_imponible",label:"Base imponible",align:"center",field:"base_imponible"},{name:"porcentaje",label:"% de retenci\xF3n",align:"center",field:"porcentaje_iva"},{label:"Valor retenido",align:"center",field:"valor_retenido",name:"stock"}]),{api:w,claim:u,mostrarNotify:T,router:lo}=Ae();let M=[];const f=v([]),$=v([]),I=v(!1),R=v(!1),W=v(!0),X=Date.now();let Z=Y.formatDate(X,"DD/MM/YYYY");(u.roles[0]!=="SUPER-ADMINISTRADOR"||u.roles[0]!=="ADMINISTRADOR")&&(m.value=u.sucursales[0]);const o=v({customer_id:"",numero_comprobante:"--- --- ---------",numero_comprobante_documento:"",clave_acceso:"",descripcion:"",inputDate:"",tipo_documento:"FACTURA",tipo_impuesto:"",retencion:"",base_imponible:0,valor_retenido:0}),c=v({customer_id:{message:"",isValid:!0},sucursal_id:{message:"",isValid:!0},forma_pago:{message:"",isValid:!0}}),r=v({numero_comprobante_documento:{message:"",isValid:!0},inputDate:{message:"",isValid:!0},tipo_impuesto:{message:"",isValid:!0},retencion:{message:"",isValid:!0},base_imponible:{message:"",isValid:!0}});j(()=>o.value.inputDate,e=>{r.value.inputDate.isValid=!0}),j(m,(e,l)=>{E()});const ee=async e=>{$.value=[];const{data:l}=await w.get(`/sucursal/find/${e}/company`);l.forEach(t=>{$.value.push({label:t.nombre,value:t.id})})},oe=async()=>{o.value.customer_id="";try{let e={"company-id":u.company.id};const{data:l}=await w.get("/customers",{headers:e});f.value=[],l.forEach(t=>{f.value.push({label:t.nombres,value:t.id,num_doc:t.numero_documento})}),M=f.value}catch(e){console.log(e)}},le=(e="",l)=>{if(e==="")return l(()=>{f.value=M});l(()=>{const t=e.toLowerCase();f.value=f.value.filter(q=>q.num_doc.indexOf(t)>-1||q.label.toLowerCase().indexOf(t)>-1)})},te=()=>{let e=!1;return(u.roles[0]=="SUPER-ADMINISTRADOR"||u.roles[0]=="ADMINISTRADOR")&&(m.value==""||m.value==null)&&(c.value.sucursal_id.message="Debes seleccionar una sucursal",c.value.sucursal_id.isValid=!1,e=!0),o.value.customer_id.length==0&&(c.value.customer_id.message="Debes seleccionar un cliente",c.value.customer_id.isValid=!1,e=!0),p.value.length==0&&(e=!0,T("warning","Debes agregar algun impuesto..")),e},ae=()=>{let e=!1;return["numero_comprobante_documento","inputDate","tipo_impuesto","retencion"].forEach(t=>{o.value[t].length==0&&(r.value[t].message="Debes completar este campo",r.value[t].isValid=!1,e=!0)}),r.value.numero_comprobante_documento.isValid&&o.value.numero_comprobante_documento.includes("_")&&(r.value.numero_comprobante_documento.message="Debes completar este campo",r.value.numero_comprobante_documento.isValid=!1,e=!0),o.value.base_imponible<=0&&(r.value.base_imponible.message="Debes completar este campo",r.value.base_imponible.isValid=!1,e=!0),e},se=()=>{o.value={...o.value,descripcion:"",tipo_documento:"FACTURA",tipo_impuesto:"",retencion:"",base_imponible:0,valor_retenido:0}},ne=()=>{if(ae())return;let e=0;o.value.retencion==9&&(e=10),o.value.retencion==10&&(e=20),o.value.retencion==1&&(e=30),o.value.retencion==11&&(e=50),o.value.retencion==2&&(e=70),o.value.retencion==3&&(e=100),p.value.push({codigo:p.value.length+1,numero_comprobante_documento:o.value.numero_comprobante_documento,tipo_documento:o.value.tipo_documento,tipo_impuesto:o.value.tipo_impuesto,porcentaje_iva:e,retencion:o.value.retencion,base_imponible:o.value.base_imponible,valor_retenido:o.value.valor_retenido}),se()},ie=async()=>{if(te())return;const{tipo_documento:e,tipo_impuesto:l,retencion:t,base_imponible:q,valor_retenido:to,descripcion:ao,numero_comprobante_documento:so,...ue}=o.value,F={...ue,sucursal_id:m.value,impuestos:p.value,user_id:u.id,send_messages:W.value,tipo_documento:o.value.tipo_documento};fe.create({title:"\xBFDeseas emitir factura de esta retenci\xF3n?",ok:{push:!0,color:"cyan-10",label:"Enviar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{console.log(F);let k={headers:{"sucursal-id":m.value}};await w.post("/retenciones/generar-retencion",F,k)}catch(k){T("warning",k.response.data.message),ge.hide()}})},E=async()=>{I.value=!0;let e={headers:{"sucursal-id":m.value}};const{data:l}=await w.get("/retenciones/getNumRetencion",e);o.value.numero_comprobante=l.numComprobante,I.value=!1},C=()=>{if(o.value.tipo_impuesto=="IVA"&&o.value.retencion!=""&&o.value.base_imponible>0){let e=0;o.value.retencion==9&&(e=10),o.value.retencion==10&&(e=20),o.value.retencion==1&&(e=30),o.value.retencion==11&&(e=50),o.value.retencion==2&&(e=70),o.value.retencion==3&&(e=100);const l=y(o.value.base_imponible*e/100);o.value.valor_retenido=l}},re=e=>{o.value.numero_comprobante_documento=e.numero_comprobante_documento,o.value.inputDate=e.inputDate,o.value.tipo_documento=e.tipo_documento,o.value.tipo_impuesto=e.tipo_impuesto,o.value.retencion=e.retencion,o.value.base_imponible=e.base_imponible,o.value.valor_retenido=e.valor_retenido,p.value=p.value.filter(l=>l.codigo!=e.codigo)};return ve(()=>{p.value=[]}),u.roles[0]=="SUPER-ADMINISTRADOR"||u.roles[0]=="ADMINISTRADOR"?ee(u.company.id):E(),oe(),(e,l)=>(V(),S(be,null,[a("div",ke,[a("div",Qe,[a("div",{class:i(["col-xs-12 col-md-6",[(e.$q.screen.width<1022,"q-pt-sm")]])},[s(de,{class:i(["row q-mr-xs",[e.$q.screen.width<1022?"justify-center q-pt-sm":"justify-start "]])},{default:n(()=>[s(Q,{label:"Inicio",icon:"home",to:"/"}),s(Q,{label:"Retenciones",icon:"payments",to:"/retenciones"}),s(Q,{label:"Retenci\xF3n",icon:"add_circle"})]),_:1},8,["class"])],2),a("div",{class:i(["col-xs-12 col-md-6",[e.$q.screen.width<1022?"text-center q-pt-sm":"text-right q-pt-sm"]])},Ne,2)])]),s(O,{class:"q-mx-lg q-mt-lg"},{default:n(()=>[s(A,{class:"q-pt-none"},{default:n(()=>[a("div",{class:i(["row q-col-gutter-md",[e.$q.screen.xs?"q-mx-xs":"q-mx-lg"]])},[a("div",{class:i(["col-xs-12 col-md-6 q-pt-xs q-mt-md",e.$q.screen.width>=1023||"text-center q-pl-none"])},[a("label",{class:i(["text-weight-medium",[e.$q.screen.xs?"text-subtitle1":"text-h5"]])},[b("Fecha de Emisi\xF3n: "),a("span",Ue,d(_(Z)),1)],2)],2),a("div",{class:i(["col-xs-12 col-md-6",e.$q.screen.width<=1023?"text-center q-pt-sm q-pl-none":"text-right q-pt-xs q-mt-md"])},[a("label",{class:i(["text-weight-medium",[e.$q.screen.xs?"text-subtitle1":"text-h5 q-mr-lg"]])},[Oe,I.value?(V(),U(me,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(V(),S("span",Te,d(o.value.numero_comprobante),1))],2)],2),a("div",Me,[Ee,s(h,{color:"orange",filled:"",modelValue:o.value.customer_id,"onUpdate:modelValue":[l[1]||(l[1]=t=>o.value.customer_id=t),l[2]||(l[2]=t=>c.value.customer_id.isValid=!0)],options:f.value,"emit-value":"","map-options":"",dense:"",error:!c.value.customer_id.isValid,onFilter:le,"use-input":"","input-debounce":"0"},qe({error:n(()=>[a("label",{class:i(e.$q.dark.isActive?"text-red-4":"text-negative")},d(c.value.customer_id.message),3)]),"no-option":n(()=>[s(P,null,{default:n(()=>[s(z,{class:"text-grey"},{default:n(()=>[b(" No hay resultados ")]),_:1})]),_:1})]),_:2},[o.value.customer_id&&o.value.customer_id!=="CONSUMIDOR FINAL"?{name:"append",fn:n(()=>[s(D,{name:"cancel",onClick:l[0]||(l[0]=Ve(t=>o.value.customer_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","error"])]),_(u).roles[0]=="SUPER-ADMINISTRADOR"||_(u).roles[0]=="ADMINISTRADOR"?(V(),S("div",{key:0,class:i(["col-xs-12 col-md-5 q-mt-md",e.$q.screen.width<=1023?"q-pl-none":"offset-1"])},[Fe,s(h,{filled:"",modelValue:_(m),"onUpdate:modelValue":[l[3]||(l[3]=t=>xe(m)?m.value=t:null),l[4]||(l[4]=t=>c.value.sucursal_id.isValid=!0)],error:!c.value.sucursal_id.isValid,options:$.value,"emit-value":"","map-options":"",dense:""},{error:n(()=>[a("label",{class:i(e.$q.dark.isActive?"text-red-4":"text-negative")},d(c.value.sucursal_id.message),3)]),"no-option":n(()=>[s(P,null,{default:n(()=>[s(z,{class:"text-grey"},{default:n(()=>[b(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","error","options"])],2)):B("",!0),a("div",{class:i(["col-xs-12 col-md-7 q-mt-md",e.$q.screen.width<=1023?"q-pl-none":"q-pl-none q-pt-none"])},[je,s(x,{modelValue:o.value.clave_acceso,"onUpdate:modelValue":l[5]||(l[5]=t=>o.value.clave_acceso=t),modelModifiers:{trim:!0},dense:"",filled:""},null,8,["modelValue"])],2)],2),a("div",{class:i(["row q-pt-none q-col-gutter-md",[e.$q.screen.xs?"q-mx-xs":"q-mx-lg q-mb-md"]])},[a("div",{class:i(["col-xs-12 col-md-4 q-pl-none",e.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[Be,s(x,{modelValue:o.value.numero_comprobante_documento,"onUpdate:modelValue":[l[6]||(l[6]=t=>o.value.numero_comprobante_documento=t),l[7]||(l[7]=t=>r.value.numero_comprobante_documento.isValid=!0)],"input-style":{textAlign:"center",fontSize:"16px"},error:!r.value.numero_comprobante_documento.isValid,filled:"",mask:"###-###-#########","fill-mask":"",dense:""},{error:n(()=>[a("label",{class:i(e.$q.dark.isActive?"text-red-4":"text-negative")},d(r.value.numero_comprobante_documento.message),3)]),_:1},8,["modelValue","error"])],2),a("div",{class:i(["col-xs-12 col-md-4",e.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[Pe,s(x,{filled:"",dense:"",modelValue:o.value.inputDate,"onUpdate:modelValue":l[9]||(l[9]=t=>o.value.inputDate=t),"input-style":{textAlign:"center"},hint:"Fecha de Emisi\xF3n del comprobante de venta autorizado",error:!r.value.inputDate.isValid},{append:n(()=>[s(D,{name:"event",class:"cursor-pointer"},{default:n(()=>[s(ye,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[s(he,{modelValue:o.value.inputDate,"onUpdate:modelValue":l[8]||(l[8]=t=>o.value.inputDate=t)},{default:n(()=>[a("div",ze,[L(s(g,{label:"Close",color:"primary",flat:""},null,512),[[H]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),error:n(()=>[a("label",{class:i(e.$q.dark.isActive?"text-red-4":"text-negative")},d(r.value.inputDate.message),3)]),_:1},8,["modelValue","error"])],2),a("div",{class:i(["col-xs-12 col-md-4",e.$q.screen.width<=1023?"q-pl-none":"q-mt-lg"])},[Ye,s(h,{modelValue:o.value.tipo_documento,"onUpdate:modelValue":l[10]||(l[10]=t=>o.value.tipo_documento=t),modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",dense:"",options:[{label:"FACTURA",value:"FACTURA"},{label:"NOTA DE DEBITO",value:"NOTA_DE_DEBITO"},{label:"LIQ. DE COMPRAS",value:"LIQ_COMPRAS"}]},null,8,["modelValue","options"])],2),a("div",{class:i(["col-xs-12 col-md-4 q-pl-none",e.$q.screen.width<=1023?"q-pl-none":""])},[Le,s(h,{modelValue:o.value.tipo_impuesto,"onUpdate:modelValue":[l[11]||(l[11]=t=>o.value.tipo_impuesto=t),l[12]||(l[12]=t=>r.value.tipo_impuesto.isValid=!0)],modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",dense:"",error:!r.value.tipo_impuesto.isValid,options:[{label:"I.V.A",value:"IVA"},{label:"Impuesto a la Renta",value:"impuesto_renta"}]},{error:n(()=>[a("label",{class:i(e.$q.dark.isActive?"text-red-4":"text-negative")},d(r.value.tipo_impuesto.message),3)]),_:1},8,["modelValue","error","options"])],2),a("div",{class:i(["col-xs-12 col-md-2",e.$q.screen.width<=1023?"q-pl-none":""])},[He,s(h,{modelValue:o.value.retencion,"onUpdate:modelValue":[l[13]||(l[13]=t=>o.value.retencion=t),l[14]||(l[14]=t=>r.value.retencion.isValid=!0)],modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",dense:"",error:!r.value.retencion.isValid,options:[{label:"10%",value:9},{label:"20%",value:10},{label:"30%",value:1},{label:"50%",value:11},{label:"70%",value:2},{label:"100%",value:3}]},{error:n(()=>[a("label",{class:i(e.$q.dark.isActive?"text-red-4":"text-negative")},d(r.value.retencion.message),3)]),_:1},8,["modelValue","error"])],2),a("div",{class:i(["col-xs-12 col-md-2",e.$q.screen.width<=1023?"q-pl-none":""])},[Ge,s(x,{"input-class":"resaltarTextoInput",dense:"",filled:"",onChange:l[15]||(l[15]=t=>(o.value.base_imponible=_(y)(o.value.base_imponible),C())),"onUpdate:modelValue":[l[16]||(l[16]=t=>r.value.base_imponible.isValid=!0),l[17]||(l[17]=t=>o.value.base_imponible=t)],error:!r.value.base_imponible.isValid,min:"0",type:"number",modelValue:o.value.base_imponible},{error:n(()=>[a("label",{class:i(e.$q.dark.isActive?"text-red-4":"text-negative")},d(r.value.base_imponible.message),3)]),_:1},8,["error","modelValue"])],2),a("div",{class:i(["col-xs-12 col-md-2",e.$q.screen.width<=1023?"q-pl-none":""])},[Je,s(x,{"input-class":"resaltarTextoInput",dense:"",outlined:"",readonly:"",onChange:l[18]||(l[18]=t=>o.value.valor_retenido=_(y)(o.value.valor_retenido)),min:"0",type:"number",modelValue:o.value.valor_retenido,"onUpdate:modelValue":l[19]||(l[19]=t=>o.value.valor_retenido=t)},null,8,["modelValue"])],2),a("div",Ke,[s(g,{onClick:ne,class:"q-mt-xs","icon-right":"add_circle",outline:"",rounded:"",color:e.$q.dark.isActive?"teal-4":"blue-grey-8"},{default:n(()=>[b(" A\xF1adir impuesto\xA0 ")]),_:1},8,["color"])])],2)]),_:1})]),_:1}),s(De,{onSubmit:ie},{default:n(()=>[a("div",We,[a("div",Xe,[s(we,{rows:_(p),columns:K.value,"row-key":"name",dense:"",class:i([e.$q.dark.isActive?"":"my-sticky-header-table3"]),"hide-pagination":!0,"rows-per-page-options":[50]},{"top-left":n(t=>[Ze]),"top-right":n(t=>[s(D,{onClick:l[20]||(l[20]=q=>R.value=!0),class:"cursor-pointer",name:"add_circle",size:"md"})]),"no-data":n(({})=>[a("div",eo,[oo,s(D,{size:"2em",name:"playlist_add"})])]),"body-cell-fecha":n(t=>[s(N,{props:t},{default:n(()=>[b(d(_(Y).formatDate(t.row.inputDate,"DD/MM/YYYY")),1)]),_:2},1032,["props"])]),"body-cell-descripcion":n(t=>[s(N,{props:t},{default:n(()=>[b(d(t.row.porcentaje_iva)+"% ",1)]),_:2},1032,["props"])]),"body-cell-acciones":n(t=>[s(N,{props:t},{default:n(()=>[s(g,{round:"",color:"indigo-6",onClick:q=>re(t.row),class:"q-mr-sm",icon:"edit",size:"8px"},null,8,["onClick"]),s(g,{round:"",color:"deep-orange",onClick:q=>_(J)(t.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),s(O,{class:"q-mt-md"},{default:n(()=>[s(A,{class:"q-py-none row"},{default:n(()=>[a("div",{class:i(["col-12 flex q-my-md",[e.$q.screen.width<600?"justify-center":"justify-between"]])},[e.$q.screen.width>600?(V(),U(g,{key:0,icon:"arrow_back",onClick:l[21]||(l[21]=t=>e.$router.push("/ventas")),outline:"",rounded:"",class:"q-mr-lg",color:e.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:n(()=>[b(" \xA0 Regresar ")]),_:1},8,["color"])):B("",!0),s(g,{type:"submit","icon-right":"send",outline:"",rounded:"",class:"q-mr-lg",style:{color:"#696cff"}},{default:n(()=>[b(" Enviar \xA0 ")]),_:1})],2)]),_:1})]),_:1})])]),_:1}),s(_e,{modelValue:R.value,"onUpdate:modelValue":l[22]||(l[22]=t=>R.value=t)},{default:n(()=>[s(Ce)]),_:1},8,["modelValue"])],64))}};export{wo as default};
