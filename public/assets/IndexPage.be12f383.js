import{Q as pe,a as z,b as ve}from"./QTable.fc3e737e.js";import{Q as ge,a as le}from"./QTooltip.5a826ced.js";import{Q as R}from"./QSelect.eb6986f4.js";import{r as v,d as H,o as c,a7 as _,g as s,ab as o,e as n,f as l,Q as C,c as B,aS as Q,ad as h,h as w,aP as Z,a8 as $,N as M,aQ as j,af as ne,v as J,B as fe,aT as oe,ah as K,ag as _e,ac as ye,aU as be,i as W,a9 as F}from"./index.63602cd2.js";import{Q as ae}from"./QBadge.3ad7d9bf.js";import{Q as we}from"./QPageSticky.8172df02.js";import{C as L}from"./ClosePopup.4ff1d69f.js";import{a as X}from"./axios.22257619.js";import{Q as xe}from"./QForm.3f67d641.js";import{u as ie}from"./useHelpers.d026a779.js";import"./QList.ad591dc3.js";import"./QItemLabel.b338ce31.js";import"./QChip.8319138a.js";import"./format.2bc25e5f.js";import"./use-quasar.37c9aa3a.js";const r=v({aplicaIva:!1,codigoBarra:"",nombre:"",precio_compra:0,pvp:0,tipo:"",stock:0,descuento:0}),O=v(!1),te=v(!1),se=v(!1),re=v(!1),Y=v("");v(!1);const G=()=>{const{api:P,claim:V,mostrarNotify:g}=ie(),m=()=>{r.value.aplicaIva=!1,r.value.codigoBarra="",r.value.nombre="",r.value.precio_compra=0,r.value.pvp=0,r.value.stock=0,r.value.tipo="",r.value.descuento=0};return{api:P,allowOnlyNumber:()=>{r.value.codigoBarra=r.value.codigoBarra.replace(/\D/g,""),r.value.stock.toString().length>0?r.value.stock=parseFloat(r.value.stock.toString().replace(/\D/g,"")):r.value.stock=0,r.value.descuento.toString().length>0?r.value.descuento=parseFloat(r.value.descuento.toString().replace(/\D/g,"")):r.value.descuento=0},actualizarTabla:re,claim:V,formProduct:r,transformToUpperCase:()=>{r.value.nombre=r.value.nombre.toUpperCase()},limpiarFormulario:m,loading:O,mostrarNotify:g,onSubmit:async u=>{try{if(Y.value.length==0)return g("warning","Elige una sucursal por favor");if(r.value.tipo.length==0)return g("warning","Completa el campo tipo por favor");O.value=!0;let f={headers:{sucursal_id:Y.value}};u?await P.patch("/products/"+r.value.id,r.value,f):await P.post("/products",r.value,f),g("positive",`Producto ${u?"editado":"agregado"} exitosamente`),te.value=!1,se.value=!1,re.value=!0,m(),O.value=!1}catch(f){O.value=!1,g("warning",f.response.data.message)}},selectSucursal:Y,validDecimal:u=>{let f=0;u=="pvm"?f=r.value.precio_compra:f=r.value.pvp;const T=/^\d{0,9}(\.\d{1,2})?$/;setTimeout(function(){let S=0;if(u=="pvm"?S=r.value.precio_compra:S=r.value.pvp,!T.test(S.toString())){const k=parseFloat(f.toString().substring(0,f.toString().length-1));u=="pvm"?r.value.precio_compra=k:r.value.pvp=k}},0)},modalAgregarProducto:te,modalEditarProducto:se}};const he={class:"row q-pt-lg q-gutter-lg justify-center"},Ve={class:"col-xs-12 col-sm-5"},ke=n("label",null,"Codigo / Serial:",-1),Pe={class:"col-xs-12 col-sm-5"},Se=n("label",null,"Nombre:",-1),qe={class:"col-xs-12 col-sm-5"},$e=n("label",null,"Precio de Compra:",-1),Ce={class:"col-xs-12 col-sm-5"},Be=n("label",null,"PVP:",-1),Qe={class:"col-xs-12 col-sm-5"},Ae=n("label",null,"Aplica IVA:",-1),Ie={class:"col-xs-12 col-sm-5"},Te=n("label",null,"Descuento(%):",-1),Ue={class:"col-xs-12 col-sm-5"},Ne=n("label",null,"Tipo:",-1),Fe={class:"col-xs-12 col-sm-5"},ze=n("label",null,"Stock:",-1),De={key:0,class:"col-xs-12 col-sm-5"},Ee=n("label",null,"Sucursal:",-1),Ke={class:"col-xs-9 col-sm-12 q-mt-lg q-mb-md flex justify-center"},ue=H({__name:"FormProduct",props:{edit:{type:Boolean}},setup(P){const V=P,g=v([]),{claim:m,api:x,mostrarNotify:A,selectSucursal:I}=G();(async()=>{try{const{data:y}=await x.get("/sucursal");y.forEach(t=>{g.value.push({label:t.nombre,value:t.id})})}catch{A("warning","No se puedo cargar las sucursales")}})();const{formProduct:u,allowOnlyNumber:f,transformToUpperCase:T,validDecimal:S,onSubmit:k,loading:E}=G();return(y,t)=>(c(),_(xe,{onSubmit:t[11]||(t[11]=i=>o(k)(V.edit))},{default:s(()=>[n("div",he,[n("div",Ve,[ke,l(C,{modelValue:o(u).codigoBarra,"onUpdate:modelValue":t[0]||(t[0]=i=>o(u).codigoBarra=i),onKeyup:o(f),dense:"",filled:"",required:""},null,8,["modelValue","onKeyup"])]),n("div",Pe,[Se,l(C,{modelValue:o(u).nombre,"onUpdate:modelValue":t[1]||(t[1]=i=>o(u).nombre=i),modelModifiers:{trim:!0},onKeyup:o(T),dense:"",filled:"",required:""},null,8,["modelValue","onKeyup"])]),n("div",qe,[$e,l(C,{type:"number",modelValue:o(u).precio_compra,"onUpdate:modelValue":t[2]||(t[2]=i=>o(u).precio_compra=i),modelModifiers:{trim:!0},min:"0","input-class":"resaltarTextoInput",step:".01",onKeyup:t[3]||(t[3]=i=>o(S)("pvm")),dense:"",filled:""},null,8,["modelValue"])]),n("div",Ce,[Be,l(C,{modelValue:o(u).pvp,"onUpdate:modelValue":t[4]||(t[4]=i=>o(u).pvp=i),modelModifiers:{trim:!0},type:"number",min:"0","input-class":"resaltarTextoInput",step:".01",onKeyup:t[5]||(t[5]=i=>o(S)("pvp")),dense:"",filled:"",required:""},null,8,["modelValue"])]),n("div",Qe,[Ae,l(R,{modelValue:o(u).aplicaIva,"onUpdate:modelValue":t[6]||(t[6]=i=>o(u).aplicaIva=i),filled:"",dense:"",required:"","emit-value":"","map-options":"",options:[{label:"SI",value:!0},{label:"NO",value:!1}]},null,8,["modelValue"])]),n("div",Ie,[Te,l(C,{type:y.$q.platform.is.mobile?"number":"text",modelValue:o(u).descuento,"onUpdate:modelValue":t[7]||(t[7]=i=>o(u).descuento=i),"input-class":"resaltarTextoInput",onKeyup:o(f),dense:"",filled:"",required:""},null,8,["type","modelValue","onKeyup"])]),n("div",Ue,[Ne,l(R,{modelValue:o(u).tipo,"onUpdate:modelValue":t[8]||(t[8]=i=>o(u).tipo=i),filled:"",dense:"",required:"",options:["Producto","Servicio"]},null,8,["modelValue"])]),n("div",Fe,[ze,l(C,{modelValue:o(u).stock,"onUpdate:modelValue":t[9]||(t[9]=i=>o(u).stock=i),readonly:"","input-class":"resaltarTextoInput",onKeyup:o(f),dense:"",filled:"",required:""},null,8,["modelValue","onKeyup"])]),o(m).roles[0]=="Super-Administrador"||o(m).roles[0]=="Administrador"?(c(),B("div",De,[Ee,l(R,{filled:"",dense:"",modelValue:o(I),"onUpdate:modelValue":t[10]||(t[10]=i=>Q(I)?I.value=i:null),"emit-value":"","map-options":"",options:g.value},null,8,["modelValue","options"])])):h("",!0),n("div",Ke,[l(w,{label:y.edit?"Editar":"Guardar",loading:o(E),class:"q-px-xl",type:"submit",color:"green-9"},null,8,["label","loading"])])])]),_:1}))}}),Oe={class:"text-h6 text-center"},Re=H({__name:"AddProduct",setup(P){const{limpiarFormulario:V}=G();return V(),(g,m)=>(c(),_(Z,{style:{width:"643px !important","max-width":"fit-content"}},{default:s(()=>[l(j,null,{default:s(()=>[n("div",Oe,[$(" Agregar Producto "),M(l(w,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[L]])])]),_:1}),l(ne,{inset:""}),l(j,{class:"q-pt-none"},{default:s(()=>[l(ue,{edit:!1})]),_:1})]),_:1}))}}),Me={class:"text-h6 text-center"},je=H({__name:"EditProduct",setup(P){return(V,g)=>(c(),_(Z,{style:{width:"643px !important","max-width":"fit-content"}},{default:s(()=>[l(j,null,{default:s(()=>[n("div",Me,[$(" Editar Producto "),M(l(w,{round:"",flat:"",dense:"",icon:"close",class:"float-right",color:"grey-8"},null,512),[[L]])])]),_:1}),l(ne,{inset:""}),l(j,{class:"q-pt-none"},{default:s(()=>[l(ue,{edit:!0})]),_:1})]),_:1}))}}),Le={class:"q-ma-lg q-pt-md"},Ge={class:"row q-col-gutter-lg"},He={class:"col-12"},Je={key:0,class:"text-center row justify-center",style:{width:"100%"}},We=n("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Productos ",-1),Xe=[We],Ye=n("label",{class:"q-mr-sm row items-center"},[n("span",null,"Sucursal: ")],-1),Ze={class:"full-width row flex-center text-lime-10 q-gutter-sm"},el=n("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1),fl=H({__name:"IndexPage",setup(P){let{actualizarTabla:V,claim:g,modalAgregarProducto:m,modalEditarProducto:x,formProduct:A}=G();const I=[{name:"acciones",label:"acciones",align:"center"},{name:"codigoBarra",label:"Codigo de Barra",align:"center",field:"codigoBarra"},{name:"producto",label:"Producto",align:"center",field:"nombre"},{name:"stock",label:"Stock",align:"center",field:"stock"},{name:"aplicaIva",label:"Aplica Iva",align:"center",field:"aplicaIva"},{name:"estado",label:"Estado",align:"center",field:"isActive"}],{mostrarNotify:D,confirmDelete:u,isDeleted:f}=ie(),T=v([]),S=v("codigo"),k=v(""),E=v(),y=v(!1),t=v(""),i=v([]),b=v({sortBy:"desc",descending:!1,page:1,rowsPerPage:5,rowsNumber:5}),ee=async(d,a)=>{try{const{data:{msg:e}}=await X.patch(`/products/${d}/${a}`);D("positive",e),U(1,b.value.rowsPerPage,null)}catch(e){console.log(e)}};J(f,(d,a)=>{d&&U(1,b.value.rowsPerPage,null)}),J(S,(d,a)=>{U(1,b.value.rowsPerPage,null)}),J(V,(d,a)=>{d&&(U(1,b.value.rowsPerPage,null),V.value=!1)});const de=async d=>{try{u("Estas seguro de eliminar este producto?",`/products/${d}`)}catch(a){console.log(a)}},ce=async()=>{y.value=!0;try{const{data:d}=await X.get("/sucursal");d.forEach(a=>{i.value.push({label:a.nombre,value:a.id})}),i.value.length!==0&&(t.value=i.value[0].value)}catch(d){D("warning",d.response.data.message)}y.value=!1},U=async(d=1,a=5,e=null)=>{i.value.length==0&&await ce();let p={headers:{sucursal_id:t.value}};try{const{data:N}=await X.get("/products",{params:{page:d,limit:a,busqueda:0},headers:p.headers});b.value.rowsNumber=N.meta.totalItems,T.value=N.items}catch(N){console.log(N)}};async function me(d){const{page:a,rowsPerPage:e,sortBy:p,descending:N}=d.pagination;y.value=!0,await U(a,e),b.value.page=a,b.value.rowsPerPage=e,b.value.sortBy=p,b.value.descending=N,y.value=!1}fe(()=>{E.value.requestServerInteraction()});const q=v("list");return(d,a)=>(c(),B(K,null,[n("div",Le,[n("div",Ge,[n("div",He,[l(Z,{flat:"",class:"shadow_custom"},{default:s(()=>[l(pe,{"title-class":"text-grey-7 text-h6",rows:T.value,loading:y.value,"hide-header":q.value==="grid",columns:I,"row-key":"name",grid:q.value==="grid",filter:k.value,pagination:b.value,"onUpdate:pagination":a[5]||(a[5]=e=>b.value=e),"rows-per-page-options":[3,7,15,0],ref_key:"tableRef",ref:E,"binary-state-sort":"",onRequest:me},{header:s(e=>[l(ge,{props:e,style:{height:"60px"}},{default:s(()=>[(c(!0),B(K,null,_e(e.cols,p=>(c(),_(ve,{key:p.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:s(()=>[$(F(p.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":s(e=>[o(g).roles[0]!=="Super-Administrador"&&o(g).roles[0]!=="Administrador"?(c(),B("div",Je,Xe)):h("",!0),o(g).roles[0]=="Super-Administrador"||o(g).roles[0]=="Administrador"?(c(),B("div",{key:1,style:{display:"flex"},class:ye([d.$q.screen.xs?"q-mb-md":""])},[Ye,l(R,{outlined:"",dense:"",modelValue:t.value,"onUpdate:modelValue":[a[0]||(a[0]=p=>t.value=p),a[1]||(a[1]=p=>U())],"emit-value":"","map-options":"",options:i.value},null,8,["modelValue","options"])],2)):h("",!0)]),"top-right":s(e=>[d.$q.screen.xs?h("",!0):(c(),_(w,{key:0,onClick:a[2]||(a[2]=p=>Q(m)?m.value=!o(m):m=!o(m)),outline:"",color:"primary",label:"Agregar Producto",class:"q-mr-xs"})),l(C,{style:be(d.$q.screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=p=>k.value=p),placeholder:"Buscar..."},{append:s(()=>[l(W,{name:"search"})]),_:1},8,["style","modelValue"]),q.value==="list"?(c(),_(w,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:s(()=>[M((c(),_(le,{disable:d.$q.platform.is.mobile},{default:s(()=>[$(F(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[L]])]),_:2},1032,["icon","onClick"])):h("",!0),e.inFullscreen?h("",!0):(c(),_(w,{key:2,flat:"",round:"",dense:"",icon:q.value==="grid"?"list":"grid_on",onClick:a[4]||(a[4]=p=>{q.value=q.value==="grid"?"list":"grid",d.separator=q.value==="grid"?"none":"horizontal"})},{default:s(()=>[M((c(),_(le,{disable:d.$q.platform.is.mobile},{default:s(()=>[$(F(q.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[L]])]),_:1},8,["icon"]))]),"body-cell-acciones":s(e=>[l(z,{props:e},{default:s(()=>[l(w,{round:"",color:"blue-grey",onClick:p=>(Q(A)?A.value={...e.row}:A={...e.row},Q(x)?x.value=!0:x=!0),icon:"edit",class:"q-mr-sm",size:"10px"},null,8,["onClick"]),e.row.isActive?(c(),B(K,{key:0},[e.row.isActive?(c(),_(w,{key:0,round:"",color:"blue-grey",icon:"close",onClick:p=>ee(e.row.id,!1),size:"10px"},null,8,["onClick"])):h("",!0)],64)):(c(),B(K,{key:1},[e.row.isActive?h("",!0):(c(),_(w,{key:0,round:"",color:"blue-grey",icon:"done",size:"10px",onClick:p=>ee(e.row.id,!0)},null,8,["onClick"])),e.row.isActive?h("",!0):(c(),_(w,{key:1,round:"",color:"blue-grey",class:"q-ml-sm",icon:"delete",size:"10px",onClick:p=>de(e.row.id)},null,8,["onClick"]))],64))]),_:2},1032,["props"])]),"body-cell-codigoBarra":s(e=>[l(z,{props:e},{default:s(()=>[$(F(e.row.codigoBarra),1)]),_:2},1032,["props"])]),"body-cell-producto":s(e=>[l(z,{props:e},{default:s(()=>[$(F(e.row.nombre),1)]),_:2},1032,["props"])]),"body-cell-aplicaIva":s(e=>[l(z,{props:e},{default:s(()=>[$(F(e.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-estado":s(e=>[l(z,{props:e},{default:s(()=>[e.row.isActive?(c(),_(ae,{key:0,outline:"",color:"positive",label:"Activo",class:"q-pa-sm"})):(c(),_(ae,{key:1,outline:"",color:"red",label:"Inactivo",class:"q-pa-sm"}))]),_:2},1032,["props"])]),"no-data":s(({icon:e})=>[n("div",Ze,[l(W,{size:"2em",name:"sentiment_dissatisfied"}),el,l(W,{size:"2em",name:k.value?"filter_b_and_w":e},null,8,["name"])])]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),l(oe,{modelValue:o(m),"onUpdate:modelValue":a[6]||(a[6]=e=>Q(m)?m.value=e:m=e)},{default:s(()=>[l(Re)]),_:1},8,["modelValue"]),l(oe,{modelValue:o(x),"onUpdate:modelValue":a[7]||(a[7]=e=>Q(x)?x.value=e:x=e)},{default:s(()=>[l(je)]),_:1},8,["modelValue"]),d.$q.screen.xs?(c(),_(we,{key:0,position:"bottom-right",offset:[18,18]},{default:s(()=>[l(w,{round:"",color:"secondary",size:"lg",icon:"add",onClick:a[8]||(a[8]=e=>Q(m)?m.value=!0:m=!0)})]),_:1})):h("",!0)],64))}});export{fl as default};
