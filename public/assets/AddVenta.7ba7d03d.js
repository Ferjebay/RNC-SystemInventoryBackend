import{Q as xe,a as P}from"./QBreadcrumbs.e476a85f.js";import{p as f,m as ye,bA as we,bB as Ae,r as y,v as qe,x as Ie,o as m,c as Q,e as t,ae as i,f as o,g as s,aU as X,ad as n,bb as L,ba as Ce,aj as Se,by as Re,P as B,aV as ee,aa as _,ab as p,a9 as b,bC as Ve,i as T,w as Oe,af as j,Q as R,bz as De,h as ae,bj as Te,O as N}from"./index.c5a18271.js";import{a as q,Q as I,d as $}from"./format.5ac9df33.js";import{Q as z}from"./QSelect.176d9688.js";import{Q as Ne,a as V}from"./QTable.e17eb612.js";import{Q as $e}from"./QBadge.622a6c5b.js";import{Q as te}from"./QList.ae7d2d0c.js";import{Q as le}from"./QBtnDropdown.e04646c1.js";import{Q as ke}from"./QForm.ba659cac.js";import{C as k}from"./ClosePopup.3aadf31c.js";import{u as Ee}from"./useHelpers.b7467d42.js";import{d as Fe}from"./date.c3be0dfb.js";import{u as Me,_ as Ue}from"./SelectProduct.72bc2b3e.js";import"./QBtnGroup.c591874d.js";import"./use-quasar.9f5cef0c.js";import"./axios.4a244b56.js";import"./QInnerLoading.76c04814.js";const Pe=[f("g",{transform:"translate(20 50)"},[f("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.6"},[f("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),f("g",{transform:"translate(50 50)"},[f("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.8"},[f("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.1s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),f("g",{transform:"translate(80 50)"},[f("rect",{x:"-10",y:"-30",width:"20",height:"60",fill:"currentColor",opacity:"0.9"},[f("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.2s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])])];var Qe=ye({name:"QSpinnerFacebook",props:we,setup(Y){const{cSize:h,classes:O}=Ae(Y);return()=>f("svg",{class:O.value,width:h.value,height:h.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},Pe)}});const Le={class:"q-ma-lg q-pt-md q-mb-none",style:{"margin-bottom":"10px"}},Be={class:"row q-col-gutter-lg flex items-center"},je=t("label",{class:"text-h6 text-center"},"Nueva Factura/Proforma",-1),ze=[je],Ye={class:"row q-mx-lg q-col-gutter-md"},Ge={class:"text-weight-regular"},Je=t("span",{class:"q-mr-sm"},"N\xB0 Factura:",-1),Ke={key:1,class:"text-weight-regular"},Ze={class:"col-xs-12 col-sm-12 col-md-6 q-mt-md q-pl-none"},He=t("label",null,"Seleccionar Cliente: ",-1),We=t("label",null,"Seleccionar Sucursal: ",-1),Xe={class:"row q-pt-lg q-mx-lg q-col-gutter-md"},ea={class:"col-xs-12 col-md-6 q-pl-none"},aa=t("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),ta=t("label",null,"Forma de pago:",-1),la={class:"q-mx-lg justify-center q-mt-md"},sa={class:"col-12"},oa={class:"full-width row flex-center text-lime-10 q-gutter-sm"},ra=t("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1),na={class:"row",style:{width:"100%"}},ia=t("label",{class:"q-pr-md"}," Descripci\xF3n (Opcional) ",-1),da=[ia],ua={class:"col-xs-12 col-sm-7 col-md-9"},ca={class:"q-ml-sm q-mt-md"},ma={class:"col-xs-12 col-sm-4 col-md-5",style:{display:"flex","justify-content":"end"}},pa={class:"text-right"},va=t("td",null,[t("b",null,"TOTAL BRUTO:")],-1),fa={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},ga={class:"text-right"},_a=t("td",null,[t("b",null,"DESCUENTOS:")],-1),ba={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},ha={class:"text-right"},xa=t("td",null,[t("b",null,"SUBTOTAL:")],-1),ya={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},wa={class:"text-right"},Aa={style:{width:"50px"},class:"text-subtitle1 text-weight-regular"},qa={class:"text-right"},Ia=t("td",null,[t("b",null,"TOTAL DE VENTA:")],-1),Ca={style:{width:"50px"}},ja={__name:"AddVenta",setup(Y){const{filterByCodBarra:h,columns:O,rows:w,modalSelectProducto:D,loadingState:se,listProductos:oe,valorFactura:g,agregarAndValidarStock:G,filterArticulo:re,formatearNumero:ne,getSubtotalByProduct:E,sucursal_selected:v,iva_selected:J,quitarArticulo:ie}=Me();let K=[];const x=y([]),{api:C,claim:c,mostrarNotify:A,route:Z,router:de}=Ee(),F=y([]),ue=y(!1),M=y(!1),U=y(!0),H=y(""),ce=Date.now();let me=Fe.formatDate(ce,"DD/MM/YYYY");(c.roles[0]!=="SUPER-ADMINISTRADOR"||c.roles[0]!=="ADMINISTRADOR")&&(v.value=c.sucursales[0]),O.value[7]={name:"pvp",label:"Precio de Venta",align:"center"};const r=y({customer_id:"5e909ecb-81f5-4cab-a663-ce3786c0db49",numero_comprobante:"--- --- ---------",products:[],user_id:"",forma_pago:"",descripcion:""}),u=y({customer_id:{message:"",isValid:!0},sucursal_id:{message:"",isValid:!0},forma_pago:{message:"",isValid:!0}});qe(v,(l,e)=>{W()});const pe=async l=>{F.value=[];const{data:e}=await C.get(`/sucursal/find/${l}/company`);e.forEach(a=>{F.value.push({label:a.nombre,value:a.id})})},ve=async()=>{if(Z.params.venta_id!==""){const{data:l}=await C.get(`/invoices/filterInvoice/${Z.params.venta_id}`);r.value.customer_id=l.customer_id.id,r.value.id=l.id,r.value.clave_acceso=l.clave_acceso,r.value.estadoSRI=l.estadoSRI,r.value.forma_pago=l.forma_pago,r.value.descripcion=l.descripcion,v.value=l.sucursal_id.id,H.value=l.name_proforma,l.invoiceToProduct.forEach(e=>{e.product_id.cantidad=e.cantidad,e.product_id.descuento=parseFloat(e.descuento),e.product_id.v_total=e.v_total,e.product_id.pvp=parseFloat(e.v_total)/parseInt(e.cantidad),G(e.product_id,"proforma")})}},fe=l=>{G(l,"venta"),D.value=!1},ge=async()=>{const l=r.value.customer_id;r.value.customer_id="",ue.value=!1;try{let e={company_id:c.company.id};const{data:a}=await C.get("/customers",{headers:e});x.value=[],a.forEach(d=>{x.value.push({label:d.nombres,value:d.id,num_doc:d.numero_documento})}),x.value.unshift({label:"CONSUMIDOR FINAL",value:"5e909ecb-81f5-4cab-a663-ce3786c0db49",num_doc:"9999999999999"}),K=x.value,r.value.customer_id=l,ve()}catch(e){console.log(e)}},_e=(l="",e)=>{if(l==="")return e(()=>{x.value=K});e(()=>{const a=l.toLowerCase();x.value=x.value.filter(d=>d.num_doc.indexOf(a)>-1||d.label.toLowerCase().indexOf(a)>-1)})},be=l=>{let e=!1;return(c.roles[0]=="SUPER-ADMINISTRADOR"||c.roles[0]=="ADMINISTRADOR")&&v.value==""&&(u.value.sucursal_id.message="Debes seleccionar una sucursal",u.value.sucursal_id.isValid=!1,e=!0),g.value.total>50&&r.value.customer_id=="5e909ecb-81f5-4cab-a663-ce3786c0db49"&&l!="PROFORMA"&&(u.value.customer_id.message="La factura supera los $50.00, no puede ser emitida a CONSUMIDOR FINAL",u.value.customer_id.isValid=!1,e=!0),g.value.total>50&&r.value.forma_pago=="01"&&(u.value.forma_pago.message="La factura supera los $500.00, debes elegir otra forma de pago",u.value.forma_pago.isValid=!1,e=!0),w.value.length==0&&(e=!0,A("warning","Debes agregar algun producto..")),r.value.forma_pago.length==0&&(u.value.forma_pago.message="Debes elegir una forma de pago",u.value.forma_pago.isValid=!1,e=!0),w.value.forEach((a,d)=>{a.cantidad<=0&&(e=!0,A("warning",`Agrega una cantidad cantidad al producto: ${a.nombre} de la fila: ${d+1}`)),a.cantidad>a.stock&&a.tipo!="Servicio"&&(e=!0,A("warning",`La cantidad de venta del producto: ${a.nombre} supera su stock disponible`))}),e},S=async l=>{if(be(l))return;r.value={...r.value,...g.value,products:w.value,user_id:c.id,tipo:l,send_messages:U,porcentaje_iva:J.value,name_proforma:H.value};let e;l=="EMISION"&&(e="\xBFDeseas emitir factura de esta proforma?"),l=="FACTURA"&&(e="\xBFDeseas generar esta FACTURA?"),l=="PROFORMA"&&(e="\xBFDeseas guardar como PROFORMA?"),Re.create({title:e,ok:{push:!0,color:"cyan-10",label:"Enviar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{try{B.show({message:"Cargando..."});let a={headers:{sucursal_id:v.value}};await C.post("/invoices",r.value,a),B.hide(),A("positive","Venta realizada exitosamente"),de.push("/ventas")}catch(a){A("warning",a.response.data.message),B.hide()}})},he=()=>{if((c.roles[0]=="SUPER-ADMINISTRADOR"||c.roles[0]=="ADMINISTRADOR")&&typeof v.value=="undefined")return A("warning","Elige una sucursal primeramente");re("venta")},W=async()=>{M.value=!0;let l={headers:{sucursal_id:v.value}};const{data:e}=await C.get("/CE/facturas/getNumFactura",l);r.value.numero_comprobante=e.numComprobante,M.value=!1};return Ie(()=>{w.value=[]}),c.roles[0]=="SUPER-ADMINISTRADOR"||c.roles[0]=="ADMINISTRADOR"?pe(c.company.id):W(),ge(),(l,e)=>(m(),Q(Se,null,[t("div",Le,[t("div",Be,[t("div",{class:i(["col-xs-12 col-md-6",[(l.$q.screen.width<1022,"q-pt-sm")]])},[o(xe,{class:i(["row q-mr-xs",[l.$q.screen.width<1022?"justify-center q-pt-sm":"justify-start "]])},{default:s(()=>[o(P,{label:"Inicio",icon:"home",to:"/"}),o(P,{label:"Facturas",icon:"payments",to:"/ventas"}),o(P,{label:"Factura/Prof.",icon:"add_circle"})]),_:1},8,["class"])],2),t("div",{class:i(["col-xs-12 col-md-6",[l.$q.screen.width<1022?"text-center q-pt-sm":"text-right q-pt-sm"]])},ze,2)])]),o(X,{class:"q-mx-lg q-mt-lg"},{default:s(()=>[o(ee,{class:"q-pt-none"},{default:s(()=>[t("div",Ye,[t("div",{class:i(["col-xs-12 col-md-6 q-pt-xs q-mt-md",l.$q.screen.width>=1023||"text-center"])},[t("label",{class:i(["text-weight-medium",[l.$q.screen.xs?"text-subtitle1":"text-h5"]])},[_("Fecha de Emisi\xF3n: "),t("span",Ge,p(n(me)),1)],2)],2),t("div",{class:i(["col-xs-12 col-md-6",l.$q.screen.width<=1023?"text-center q-pt-sm":"text-right q-pt-xs q-mt-md"])},[t("label",{class:i(["q-mr-lg text-weight-medium",[l.$q.screen.xs?"text-subtitle1":"text-h5"]])},[Je,M.value?(m(),b(Qe,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(m(),Q("span",Ke,p(r.value.numero_comprobante),1))],2)],2),t("div",Ze,[He,o(z,{color:"orange",filled:"",modelValue:r.value.customer_id,"onUpdate:modelValue":[e[1]||(e[1]=a=>r.value.customer_id=a),e[2]||(e[2]=a=>u.value.customer_id.isValid=!0)],options:x.value,"emit-value":"","map-options":"",dense:"",error:!u.value.customer_id.isValid,onFilter:_e,"use-input":"","input-debounce":"0"},Ve({error:s(()=>[t("label",{class:i(l.$q.dark.isActive?"text-red-4":"text-negative")},p(u.value.customer_id.message),3)]),"no-option":s(()=>[o(q,null,{default:s(()=>[o(I,{class:"text-grey"},{default:s(()=>[_(" No hay resultados ")]),_:1})]),_:1})]),_:2},[r.value.customer_id&&r.value.customer_id!=="CONSUMIDOR FINAL"?{name:"append",fn:s(()=>[o(T,{name:"cancel",onClick:e[0]||(e[0]=Oe(a=>r.value.customer_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","error"])]),n(c).roles[0]=="SUPER-ADMINISTRADOR"||n(c).roles[0]=="ADMINISTRADOR"?(m(),Q("div",{key:0,class:i(["col-xs-12 col-md-5 q-mt-md",l.$q.screen.width<=1023?"q-pl-none":"offset-1"])},[We,o(z,{filled:"",modelValue:n(v),"onUpdate:modelValue":[e[3]||(e[3]=a=>L(v)?v.value=a:null),e[4]||(e[4]=a=>(u.value.sucursal_id.isValid=!0,w.value=[]))],error:!u.value.sucursal_id.isValid,options:F.value,"emit-value":"","map-options":"",dense:""},{error:s(()=>[t("label",{class:i(l.$q.dark.isActive?"text-red-4":"text-negative")},p(u.value.sucursal_id.message),3)]),"no-option":s(()=>[o(q,null,{default:s(()=>[o(I,{class:"text-grey"},{default:s(()=>[_(" No se encontro sucursal ")]),_:1})]),_:1})]),_:1},8,["modelValue","error","options"])],2)):j("",!0)]),t("div",Xe,[t("div",ea,[aa,o(R,{outlined:"","bottom-slots":"",loading:n(se),dense:"",modelValue:n(h),"onUpdate:modelValue":e[6]||(e[6]=a=>L(h)?h.value=a:null),modelModifiers:{trim:!0},onKeyup:De(he,["enter"])},{append:s(()=>[n(h)!==""?(m(),b(T,{key:0,name:"close",onClick:e[5]||(e[5]=a=>h.value=""),class:"cursor-pointer"})):j("",!0),o(T,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])]),t("div",{class:i(["col-xs-12 col-sm-5",l.$q.screen.width<=1023?"q-pl-none q-mb-lg":"offset-1"])},[ta,o(z,{dense:"",modelValue:r.value.forma_pago,"onUpdate:modelValue":[e[7]||(e[7]=a=>r.value.forma_pago=a),e[8]||(e[8]=a=>u.value.forma_pago.isValid=!0)],modelModifiers:{trim:!0},filled:"","emit-value":"","map-options":"",error:!u.value.forma_pago.isValid,options:[{label:"SIN UTILIZACION DEL SISTEMA FINANCIERO",value:"01"},{label:"COMPENSACI\xD3N DE DEUDAS",value:"15"},{label:"TARJETA DE D\xC9BITO",value:"16"},{label:"DINERO ELECTR\xD3NICO",value:"17"},{label:"TARJETA PREPAGO",value:"18"},{label:"TARJETA DE CR\xC9DITO",value:"19"},{label:"OTROS CON UTILIZACI\xD3N DEL SISTEMA FINANCIERO",value:"20"},{label:"ENDOSO DE T\xCDTULOS",value:"21"}]},{error:s(()=>[t("label",{class:i(l.$q.dark.isActive?"text-red-4":"text-negative")},p(u.value.forma_pago.message),3)]),_:1},8,["modelValue","error"])],2)])]),_:1})]),_:1}),o(ke,{onSubmit:e[16]||(e[16]=a=>S("EMISION"))},{default:s(()=>[t("div",la,[t("div",sa,[o(Ne,{rows:n(w),columns:n(O),"row-key":"name",class:i([l.$q.dark.isActive?"":"my-sticky-header-table3"]),"hide-pagination":!0,"rows-per-page-options":[50]},{"no-data":s(({})=>[t("div",oa,[ra,o(T,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":s(a=>[o(V,{props:a,class:"flex flex-center"},{default:s(()=>[o(R,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:d=>n(E)(a.row,"ventas"),min:"0",max:a.row.stock,readonly:a.row.tipo=="Servicio",type:"number",style:{width:"80px"},modelValue:a.row.cantidad,"onUpdate:modelValue":d=>a.row.cantidad=d,modelModifiers:{trim:!0}},null,8,["onChange","max","readonly","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-descuento":s(a=>[o(V,{props:a,class:"flex flex-center"},{default:s(()=>[o(R,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:d=>n(E)(a.row,"ventas"),min:"0",type:"number",style:{width:"100px"},modelValue:a.row.descuento,"onUpdate:modelValue":d=>a.row.descuento=d},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-iva":s(a=>[o(V,{props:a},{default:s(()=>[_(p(a.row.aplicaIva?"SI":"NO"),1)]),_:2},1032,["props"])]),"body-cell-pvp":s(a=>[o(V,{props:a,class:"flex flex-center"},{default:s(()=>[o(R,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:d=>n(E)(a.row,"ventas"),min:"0",type:"number",style:{width:"100px"},modelValue:a.row.pvp,"onUpdate:modelValue":d=>a.row.pvp=d},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":s(a=>[o(V,{props:a},{default:s(()=>[o(ae,{round:"",color:"deep-orange",onClick:d=>n(ie)(a.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","class"])]),o(X,{class:"q-mt-md"},{default:s(()=>[o(ee,{class:"q-pt-none row"},{default:s(()=>[t("div",{class:i(["col-xs-12 col-sm-8 col-md-7 row items-center q-mt-md",l.$q.screen.width<=1023?"q-mt-lg q-mb-sm":""])},[t("div",na,[t("div",{class:i(["col-xs-12 col-sm-5 col-md-3 flex flex-center",l.$q.screen.xs?"text-center":"text-right"])},da,2),t("div",ua,[o(R,{modelValue:r.value.descripcion,"onUpdate:modelValue":e[9]||(e[9]=a=>r.value.descripcion=a),filled:"",type:"textarea",rows:"4"},null,8,["modelValue"])])]),t("div",ca,[o(Te,{"left-label":"",size:"xl",modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=a=>U.value=a),label:"Enviar mensaje al cliente",color:"deep-orange-9","checked-icon":"task_alt","unchecked-icon":"highlight_off"},null,8,["modelValue"])])],2),t("div",ma,[t("table",{class:i([l.$q.screen.xs?"":"linearTablaDetalle"])},[t("tr",pa,[va,t("td",fa," $"+p(n(g).subtotal.toFixed(2)),1)]),t("tr",ga,[_a,t("td",ba," $"+p(n(g).descuento.toFixed(2)),1)]),t("tr",ha,[xa,t("td",ya," $"+p(n(ne)(n(g).subtotal-n(g).descuento).toFixed(2)),1)]),t("tr",wa,[t("td",null,[t("b",null,"IVA("+p(n(J))+"%):",1)]),t("td",Aa," $"+p(n(g).iva.toFixed(2)),1)]),t("tr",qa,[Ia,t("td",Ca,[o($e,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${n(g).total.toFixed(2)}`},null,8,["label"])])])],2)]),t("div",{class:i(["col-12 flex q-mt-md q-my-lg",[l.$q.screen.width<600?"justify-center":"justify-between"]])},[l.$q.screen.width>600?(m(),b(ae,{key:0,icon:"arrow_back",onClick:e[11]||(e[11]=a=>l.$router.push("/ventas")),outline:"",rounded:"",class:"q-mr-lg",color:l.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:s(()=>[_(" \xA0 Regresar ")]),_:1},8,["color"])):j("",!0),l.$route.params.venta_id==""?(m(),b(le,{key:1,outline:"",rounded:"",style:{color:"#696cff"},label:"Generar",class:i(l.$q.screen.width>=1023?"q-px-xl":"full-width")},{default:s(()=>[o(te,null,{default:s(()=>[N((m(),b(q,{clickable:"",onClick:e[12]||(e[12]=a=>S("FACTURA"))},{default:s(()=>[o(I,null,{default:s(()=>[o($,null,{default:s(()=>[_("FACTURA")]),_:1})]),_:1})]),_:1})),[[k]]),N((m(),b(q,{clickable:"",onClick:e[13]||(e[13]=a=>S("PROFORMA"))},{default:s(()=>[o(I,null,{default:s(()=>[o($,null,{default:s(()=>[_("PROFORMA")]),_:1})]),_:1})]),_:1})),[[k]])]),_:1})]),_:1},8,["class"])):(m(),b(le,{key:2,outline:"",rounded:"",style:{color:"#696cff"},label:"Generar",class:i(l.$q.screen.width>=1023?"q-px-xl":"full-width")},{default:s(()=>[o(te,null,{default:s(()=>[N((m(),b(q,{clickable:"",onClick:e[14]||(e[14]=a=>S("EMISION"))},{default:s(()=>[o(I,null,{default:s(()=>[o($,null,{default:s(()=>[_("Emitir Factura")]),_:1})]),_:1})]),_:1})),[[k]]),N((m(),b(q,{clickable:"",onClick:e[15]||(e[15]=a=>S("PROFORMA"))},{default:s(()=>[o(I,null,{default:s(()=>[o($,null,{default:s(()=>[_("Guardar Cambios")]),_:1})]),_:1})]),_:1})),[[k]])]),_:1})]),_:1},8,["class"]))],2)]),_:1})]),_:1})])]),_:1}),o(Ce,{modelValue:n(D),"onUpdate:modelValue":e[17]||(e[17]=a=>L(D)?D.value=a:null)},{default:s(()=>[o(Ue,{listProductos:n(oe),onAgregarProduct:fe},null,8,["listProductos"])]),_:1},8,["modelValue"])],64))}};export{ja as default};
