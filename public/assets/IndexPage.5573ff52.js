import{Q as Z,a as v,b as G}from"./QTable.c68d4824.js";import{Q as J,a as I}from"./QTooltip.60324491.js";import{Q}from"./QSelect.f6522d6c.js";import{d as K,a as W,r as u,v as q,o,c as A,e as c,f as t,g as l,aP as X,ab as r,a7 as i,ad as y,aT as ee,ah as $,ag as le,aU as V,ac as U,h as f,Q as ae,i as E,N as P,a8 as m,a9 as g}from"./index.d85affaa.js";import{Q as R}from"./QBadge.907e5c7e.js";import{Q as te}from"./QPageSticky.d0876ade.js";import{C as z}from"./ClosePopup.db8b856c.js";import{M as se}from"./index.2065a85c.js";import{u as oe,a as ne}from"./use-quasar.e657ba01.js";import{a as T}from"./axios.f5337df6.js";import{u as re,_ as ie}from"./DetalleProducts.c1b3cf43.js";import{u as de}from"./useHelpers.8f0dc291.js";import{d as ue}from"./date.04020182.js";import"./QList.7f984ff4.js";import"./QItemLabel.aa07e798.js";import"./QChip.87ca916f.js";import"./format.2bc25e5f.js";import"./QInnerLoading.50b34129.js";const ce={class:"q-ma-lg q-pt-md"},me={class:"row q-col-gutter-lg"},ge={class:"col-12"},be={key:0,class:"text-center row justify-center",style:{width:"100%"}},ye=c("label",{class:"q-mb-sm text-grey-7 text-h6"}," Listado de Comprobantes ",-1),fe=[ye],pe=c("label",{class:"q-mr-sm row items-center"},[c("span",null,"Tipo: ")],-1),we=c("label",{class:"q-mr-sm row items-center"},[c("span",null,"Por Sucursal: ")],-1),ve={class:"full-width row flex-center text-lime-10 q-gutter-sm"},he=c("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun resultado ",-1),Pe=K({__name:"IndexPage",setup(_e){let h;const L=oe(),{claim:p}=W.read(L.token),M=s=>{const a=new se("http://205.235.6.108:3000/socket.io/socket.io.js",{extraHeaders:{autentication:p.id}});h==null||h.removeAllListeners(),h=a.socket("/"),h.on("updateStateInvoice",()=>{w()})},B=[{name:"acciones",label:"acciones",align:"center"},{name:"sucursal",label:"Sucursal",align:"center"},{name:"num_comprobante",label:"Num. Comprobante",field:"numero_comprobante",align:"center"},{name:"usuario",label:"Usuario",align:"center"},{name:"cliente",label:"Cliente",align:"center"},{name:"f/h",label:"Fecha/Hora",align:"center",field:"created_at"},{name:"total",label:"Total",name:"total",align:"center"},{name:"estado",label:"Estado",field:"estado",align:"center"}],N=u([]),O=u(!1);u({desde:"",hasta:"",pv_id:""});const S=u("Todos"),_=u(""),D=u({}),x=u([]),k=u([]);re(),de();const n=ne(),C=u(!1);q(S,(s,a)=>{w()});const w=async()=>{try{C.value=!0;let s={headers:{tipo:S.value,sucursal_id:k.value}};const{data:a}=await T.get("/invoices",s);a.map(e=>e.created_at=ue.formatDate(e.created_at,"DD/MM/YYYY HH:mm a")),N.value=a,C.value=!1}catch(s){console.log(s),C.value=!1}},H=s=>{n.dialog({title:"<center>\xBFEstas seguro de anular esta factura?</center>",message:`<span style="display: block;width: 100%;display: flex;align-items: center;">
                  <strong style="display: inline-block;width: 40%;text-align: end;">
                    Num Comprobante:
                  </strong> 
                  <label style="display: inline-block;width: 57%;" class="q-ml-xs">
                    ${s.numero_comprobante}
                  </label>
                </span>
              <span class='q-my-xs' style="display: block;width: 100%;display: flex;align-items: center;">
                <strong style="display: inline-block;width: 40%;text-align: end;">
                  Cliente:
                </strong> 
                <label style="display: inline-block;width: 57%;" class="q-ml-xs">
                  ${s.customer_id.nombres}
                </label>
              </span>
              <span class='q-my-xs' style="display: block;width: 100%;display: flex;align-items: center;">
                <strong style="display: inline-block;width: 40%;text-align: end;">
                  Fecha/Hora:
                </strong> 
                <label style="display: inline-block;width: 57%;" class="q-ml-xs">
                  ${s.created_at}
                </label>
              </span>
              <span style="display: block;width: 100%;display: flex;align-items: center;">
                <strong style="display: inline-block;width: 40%;text-align: end;">
                  Total:
                </strong> 
                <label style="display: inline-block;width: 57%;" class="q-ml-xs">
                  $${s.total}
                </label>                
              </span>`,html:!0,ok:{push:!0,label:"Anular",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{n.loading.show({message:"Cargando, por favor espere..."}),await T.post("/CE/facturas/anularFactura",{factura:s}),n.loading.hide()}catch(a){console.log(a)}})};q(k,(s,a)=>{w()});const j=async s=>{x.value=[];const{data:a}=await T.get(`/sucursal/find/${s}/company`);a.forEach(e=>{x.value.push({label:e.nombre,value:e.id})}),x.value.length!=0&&(k.value=x.value[0].value),w()};M(),q(_,(s,a)=>{w()}),p.roles[0]=="Super-Administrador"||p.roles[0]=="Administrador"?j(p.company.id):w();const b=u("list"),Y=u({rowsPerPage:10});return(s,a)=>(o(),A($,null,[c("div",ce,[c("div",me,[c("div",ge,[t(X,{flat:"",class:"shadow_custom"},{default:l(()=>[t(Z,{"title-class":"text-grey-7 text-h6",rows:N.value,loading:C.value,"hide-header":b.value==="grid",columns:B,"row-key":"name",grid:b.value==="grid",filter:_.value,pagination:Y.value},{header:l(e=>[t(J,{props:e,style:{height:"60px"}},{default:l(()=>[(o(!0),A($,null,le(e.cols,d=>(o(),i(G,{key:d.name,props:e,class:"text-grey-7 text-weight-bold text-uppercase",style:{"font-size":"13px"}},{default:l(()=>[m(g(d.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":l(e=>[r(n).screen.xs?(o(),A("div",be,fe)):y("",!0),c("div",{style:V([{display:"flex"},!r(n).screen.xs||"width: 100%;justify-content: center;position: relative;right: 8px;"]),class:U([r(n).screen.xs?"q-mb-md":""])},[pe,t(Q,{outlined:"",dense:"",modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=d=>S.value=d),"emit-value":"","map-options":"",options:[{label:"PROFORMAS",value:"PROFORMA"},{label:"TODOS",value:"TODOS"},{label:"FACTURAS",value:"FACTURAS"}]},null,8,["modelValue"])],6),r(p).roles[0]=="Super-Administrador"||r(p).roles[0]=="Administrador"?(o(),A("div",{key:1,style:V([!r(n).screen.xs||"width: 100%;justify-content: center;",{display:"flex"}]),class:U([r(n).screen.xs?"q-mb-md":"q-ml-lg"])},[we,t(Q,{outlined:"",dense:"",modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=d=>k.value=d),"emit-value":"","map-options":"",options:x.value},null,8,["modelValue","options"])],6)):y("",!0)]),"top-right":l(e=>[r(n).screen.width>=1023?(o(),i(f,{key:0,onClick:a[2]||(a[2]=d=>s.$router.push("/ventas/add")),outline:"",color:"primary",label:"Agregar Venta",class:"q-mr-xs"})):y("",!0),t(ae,{style:V(r(n).screen.width>700||"width: 70%"),outlined:"",dense:"",debounce:"300",modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=d=>_.value=d),placeholder:"Buscar..."},{append:l(()=>[t(E,{name:"search"})]),_:1},8,["style","modelValue"]),b.value==="list"?(o(),i(f,{key:1,flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},{default:l(()=>[P((o(),i(I,{disable:r(n).platform.is.mobile},{default:l(()=>[m(g(e.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[z]])]),_:2},1032,["icon","onClick"])):y("",!0),e.inFullscreen?y("",!0):(o(),i(f,{key:2,flat:"",round:"",dense:"",icon:b.value==="grid"?"list":"grid_on",onClick:a[4]||(a[4]=d=>{b.value=b.value==="grid"?"list":"grid",s.separator=b.value==="grid"?"none":"horizontal"})},{default:l(()=>[P((o(),i(I,{disable:r(n).platform.is.mobile},{default:l(()=>[m(g(b.value==="grid"?"List":"Grid"),1)]),_:1},8,["disable"])),[[z]])]),_:1},8,["icon"]))]),"body-cell-total":l(e=>[t(v,{props:e},{default:l(()=>[m(" $"+g(e.row.total),1)]),_:2},1032,["props"])]),"body-cell-cliente":l(e=>[t(v,{props:e},{default:l(()=>[m(g(e.row.customer_id.nombres),1)]),_:2},1032,["props"])]),"body-cell-sucursal":l(e=>[t(v,{props:e},{default:l(()=>[m(g(e.row.sucursal_id.nombre),1)]),_:2},1032,["props"])]),"body-cell-usuario":l(e=>[t(v,{props:e},{default:l(()=>[m(g(e.row.user_id.fullName),1)]),_:2},1032,["props"])]),"body-cell-estado":l(e=>[t(v,{props:e},{default:l(()=>[e.row=="NO AUTORIZADO"||e.row.estadoSRI.trim()=="DEVUELTA"?(o(),i(R,{key:0,outline:"",class:"q-py-xs q-px-md",color:r(n).dark.isActive?"warning":"orange-10",label:e.row.estadoSRI},{default:l(()=>[t(I,{anchor:"center left",self:"center right",offset:[10,10],class:"blue-grey-9 text-subtitle2"},{default:l(()=>[m(g(e.row.respuestaSRI),1)]),_:2},1024)]),_:2},1032,["color","label"])):e.row.estadoSRI=="AUTORIZADO"?(o(),i(R,{key:1,outline:"",class:"q-py-xs q-px-md",color:"secondary",label:e.row.estadoSRI},null,8,["label"])):e.row.estadoSRI=="PROFORMA"?(o(),i(R,{key:2,outline:"",class:"q-py-xs q-px-md",color:r(n).dark.isActive?"blue-grey-3":"blue-grey-7",label:e.row.estadoSRI},null,8,["color","label"])):e.row.estadoSRI=="ANULADO"?(o(),i(R,{key:3,outline:"",class:"q-py-xs q-px-md",color:"red-4",label:e.row.estadoSRI},null,8,["label"])):(o(),i(R,{key:4,outline:"",class:"q-py-xs q-px-md",color:r(n).dark.isActive?"blue-grey-3":"blue-grey-7",label:e.row.estadoSRI},{default:l(()=>[t(I,{anchor:"center left",self:"center right",offset:[10,10],class:"blue-grey-9 text-subtitle2"},{default:l(()=>[m(g(e.row.respuestaSRI),1)]),_:2},1024)]),_:2},1032,["color","label"]))]),_:2},1032,["props"])]),"body-cell-acciones":l(e=>[t(v,{props:e},{default:l(()=>{var d;return[t(f,{round:"",color:"blue-grey",icon:"visibility",size:"10px",class:"q-mr-sm",onClick:F=>(O.value=!0,D.value={...e.row})},null,8,["onClick"]),e.row.estadoSRI=="PROFORMA"||e.row.estadoSRI.trim()=="ERROR ENVIO RECEPCION"||e.row.estadoSRI.trim()=="ERROR ENVIO RECEPCION - ANULACION"||e.row.estadoSRI.trim()=="PENDIENTE"?(o(),i(f,{key:0,onClick:F=>s.$router.push(`ventas/add/${e.row.id}`),round:"",color:"blue-grey",icon:"description",size:"10px",class:"q-mr-sm"},null,8,["onClick"])):y("",!0),e.row.customer_id.nombres!=="CONSUMIDOR FINAL"&&(e.row.estadoSRI=="AUTORIZADO"||((d=e.row.respuestaSRI)==null?void 0:d.includes("ERROR SECUENCIAL REGISTRADO")))?(o(),i(f,{key:1,round:"",color:"blue-grey",onClick:F=>H(e.row),icon:"close",size:"10px"},null,8,["onClick"])):y("",!0)]}),_:2},1032,["props"])]),"no-data":l(({icon:e})=>[c("div",ve,[t(E,{size:"2em",name:"sentiment_dissatisfied"}),he,t(E,{size:"2em",name:_.value?"filter_b_and_w":e},null,8,["name"])])]),_:1},8,["rows","loading","hide-header","grid","filter","pagination"])]),_:1})])])]),r(n).screen.width<=1023?(o(),i(te,{key:0,position:"bottom-right",offset:[18,18]},{default:l(()=>[t(f,{round:"",color:"secondary",size:"lg",icon:"add",onClick:a[5]||(a[5]=e=>s.$router.push("/ventas/add"))})]),_:1})):y("",!0),t(ee,{modelValue:O.value,"onUpdate:modelValue":a[6]||(a[6]=e=>O.value=e)},{default:l(()=>[t(ie,{detalleData:D.value},null,8,["detalleData"])]),_:1},8,["modelValue"])],64))}});export{Pe as default};
