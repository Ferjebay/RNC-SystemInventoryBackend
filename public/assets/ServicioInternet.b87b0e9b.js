import{aL as Ne,av as ee,D as Te,aO as Ee,as as ne,aP as qe,aB as be,ap as ge,at as he,r as j,n as B,v as ce,z as ze,p as se,T as Fe,bn as Ye,s as Ce,_ as Re,bE as Be,o as I,c as L,e,ae as o,f as h,i as K,aa as M,g as f,ab as w,ad as t,aj as ye,h as O,a9 as ie,af as W,Q as te,O as Qe,w as Xe,aW as Le,aV as Oe}from"./index.a0af90d8.js";import{g as $e,s as xe}from"./touch.3df10340.js";import{d as Ge}from"./QItemLabel.f168f8c2.js";import{u as We,Q as Ke}from"./QDate.28a5ec23.js";import{Q as A}from"./QSelect.a8dffeb9.js";import{Q as He}from"./QChip.1e4a924c.js";import{Q as oe}from"./QBadge.57a9e4b4.js";import{u as _e}from"./useCliente.4c242404.js";import{u as Je}from"./useHelpers.c128bb69.js";import{d as X}from"./date.25a34ea2.js";import{Q as Ze}from"./QPopupProxy.a1977bc0.js";import{C as et}from"./ClosePopup.0a722c91.js";import{_ as tt}from"./ModalMapBox.b525f6a6.js";function st(p){const y=[.06,6,50];return typeof p=="string"&&p.length&&p.split(":").forEach((m,q)=>{const u=parseFloat(m);u&&(y[q]=u)}),y}var it=Ne({name:"touch-swipe",beforeMount(p,{value:y,arg:m,modifiers:q}){if(q.mouse!==!0&&ee.has.touch!==!0)return;const u=q.mouseCapture===!0?"Capture":"",a={handler:y,sensitivity:st(m),direction:$e(q),noop:Te,mouseStart(v){xe(v,a)&&Ee(v)&&(ne(a,"temp",[[document,"mousemove","move",`notPassive${u}`],[document,"mouseup","end","notPassiveCapture"]]),a.start(v,!0))},touchStart(v){if(xe(v,a)){const s=v.target;ne(a,"temp",[[s,"touchmove","move","notPassiveCapture"],[s,"touchcancel","end","notPassiveCapture"],[s,"touchend","end","notPassiveCapture"]]),a.start(v)}},start(v,s){ee.is.firefox===!0&&qe(p,!0);const b=be(v);a.event={x:b.left,y:b.top,time:Date.now(),mouse:s===!0,dir:!1}},move(v){if(a.event===void 0)return;if(a.event.dir!==!1){ge(v);return}const s=Date.now()-a.event.time;if(s===0)return;const b=be(v),N=b.left-a.event.x,_=Math.abs(N),P=b.top-a.event.y,x=Math.abs(P);if(a.event.mouse!==!0){if(_<a.sensitivity[1]&&x<a.sensitivity[1]){a.end(v);return}}else if(window.getSelection().toString()!==""){a.end(v);return}else if(_<a.sensitivity[2]&&x<a.sensitivity[2])return;const k=_/s,S=x/s;a.direction.vertical===!0&&_<x&&_<100&&S>a.sensitivity[0]&&(a.event.dir=P<0?"up":"down"),a.direction.horizontal===!0&&_>x&&x<100&&k>a.sensitivity[0]&&(a.event.dir=N<0?"left":"right"),a.direction.up===!0&&_<x&&P<0&&_<100&&S>a.sensitivity[0]&&(a.event.dir="up"),a.direction.down===!0&&_<x&&P>0&&_<100&&S>a.sensitivity[0]&&(a.event.dir="down"),a.direction.left===!0&&_>x&&N<0&&x<100&&k>a.sensitivity[0]&&(a.event.dir="left"),a.direction.right===!0&&_>x&&N>0&&x<100&&k>a.sensitivity[0]&&(a.event.dir="right"),a.event.dir!==!1?(ge(v),a.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),Ge(),a.styleCleanup=D=>{a.styleCleanup=void 0,document.body.classList.remove("non-selectable");const c=()=>{document.body.classList.remove("no-pointer-events--children")};D===!0?setTimeout(c,50):c()}),a.handler({evt:v,touch:a.event.mouse!==!0,mouse:a.event.mouse,direction:a.event.dir,duration:s,distance:{x:_,y:x}})):a.end(v)},end(v){a.event!==void 0&&(he(a,"temp"),ee.is.firefox===!0&&qe(p,!1),a.styleCleanup!==void 0&&a.styleCleanup(!0),v!==void 0&&a.event.dir!==!1&&ge(v),a.event=void 0)}};if(p.__qtouchswipe=a,q.mouse===!0){const v=q.mouseCapture===!0||q.mousecapture===!0?"Capture":"";ne(a,"main",[[p,"mousedown","mouseStart",`passive${v}`]])}ee.has.touch===!0&&ne(a,"main",[[p,"touchstart","touchStart",`passive${q.capture===!0?"Capture":""}`],[p,"touchmove","noop","notPassiveCapture"]])},updated(p,y){const m=p.__qtouchswipe;m!==void 0&&(y.oldValue!==y.value&&(typeof y.value!="function"&&m.end(),m.handler=y.value),m.direction=$e(y.modifiers))},beforeUnmount(p){const y=p.__qtouchswipe;y!==void 0&&(he(y,"main"),he(y,"temp"),ee.is.firefox===!0&&qe(p,!1),y.styleCleanup!==void 0&&y.styleCleanup(),delete p.__qtouchswipe)}});const bs={name:{required:!0},disable:Boolean},we={setup(p,{slots:y}){return()=>se("div",{class:"q-panel scroll",role:"tabpanel"},Ce(y.default))}},$s={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},xs=["update:modelValue","beforeTransition","transition"];function ws(){const{props:p,emit:y,proxy:m}=ze(),{getCacheWithFn:q}=We();let u,a;const v=j(null),s=j(null);function b(g){const $=p.vertical===!0?"up":"left";T((m.$q.lang.rtl===!0?-1:1)*(g.direction===$?1:-1))}const N=B(()=>[[it,b,void 0,{horizontal:p.vertical!==!0,vertical:p.vertical,mouse:!0}]]),_=B(()=>p.transitionPrev||`slide-${p.vertical===!0?"down":"right"}`),P=B(()=>p.transitionNext||`slide-${p.vertical===!0?"up":"left"}`),x=B(()=>`--q-transition-duration: ${p.transitionDuration}ms`),k=B(()=>typeof p.modelValue=="string"||typeof p.modelValue=="number"?p.modelValue:String(p.modelValue)),S=B(()=>({include:p.keepAliveInclude,exclude:p.keepAliveExclude,max:p.keepAliveMax})),D=B(()=>p.keepAliveInclude!==void 0||p.keepAliveExclude!==void 0);ce(()=>p.modelValue,(g,$)=>{const U=E(g)===!0?H(g):-1;a!==!0&&ae(U===-1?0:U<H($)?-1:1),v.value!==U&&(v.value=U,y("beforeTransition",g,$),Re(()=>{y("transition",g,$)}))});function c(){T(1)}function d(){T(-1)}function n(g){y("update:modelValue",g)}function E(g){return g!=null&&g!==""}function H(g){return u.findIndex($=>$.props.name===g&&$.props.disable!==""&&$.props.disable!==!0)}function ue(){return u.filter(g=>g.props.disable!==""&&g.props.disable!==!0)}function ae(g){const $=g!==0&&p.animated===!0&&v.value!==-1?"q-transition--"+(g===-1?_.value:P.value):null;s.value!==$&&(s.value=$)}function T(g,$=v.value){let U=$+g;for(;U>-1&&U<u.length;){const G=u[U];if(G!==void 0&&G.props.disable!==""&&G.props.disable!==!0){ae(g),a=!0,y("update:modelValue",G.props.name),setTimeout(()=>{a=!1});return}U+=g}p.infinite===!0&&u.length!==0&&$!==-1&&$!==u.length&&T(g,g===-1?u.length:-1)}function J(){const g=H(p.modelValue);return v.value!==g&&(v.value=g),!0}function re(){const g=E(p.modelValue)===!0&&J()&&u[v.value];return p.keepAlive===!0?[se(Be,S.value,[se(D.value===!0?q(k.value,()=>({...we,name:k.value})):we,{key:k.value,style:x.value},()=>g)])]:[se("div",{class:"q-panel scroll",style:x.value,key:k.value,role:"tabpanel"},[g])]}function le(){if(u.length!==0)return p.animated===!0?[se(Fe,{name:s.value},re)]:re()}function pe(g){return u=Ye(Ce(g.default,[])).filter($=>$.props!==null&&$.props.slot===void 0&&E($.props.name)===!0),u.length}function me(){return u}return Object.assign(m,{next:c,previous:d,goTo:n}),{panelIndex:v,panelDirectives:N,updatePanelsList:pe,updatePanelIndex:J,getPanelContent:le,getEnabledPanels:ue,getPanels:me,isValidPanelName:E,keepAliveProps:S,needsUniqueKeepAliveWrapper:D,goToPanelByOffset:T,goToPanel:n,nextPanel:c,previousPanel:d}}const Ve=j({dia_pago:"",dia_vencimiento:"",meses_vencidos:0,estado:""});let de=j(""),Q=j(""),je=j("");const{formFacturacion:ke}=_e(),ot=j([]),at=j(),rt=j(""),lt=j(!1),nt=j(!1),dt=j([]),ct=j(""),ut=()=>{const{api:p,claim:y,route:m,mostrarNotify:q}=Je();return ce(Ve.value,u=>{if(u.estado=="pagado"){let v=X.addToDate(u.dia_vencimiento,{months:1});de.value=X.formatDate(v,"DD/MM/YYYY")}else de.value=X.formatDate(u.dia_vencimiento,"DD/MM/YYYY");if(ke.value.aplicar_corte.trim()!=="Desactivado"){const v=parseInt(ke.value.aplicar_corte.split(" ")[0])-u.meses_vencidos;Q.value=X.addToDate(u.dia_vencimiento,{months:v}),Q.value=X.formatDate(Q.value,"DD/MM/YYYY"),new Date(de.value)>=new Date(Q.value)&&(Q.value="Suspendido")}else Q.value="Desactivado";const a=u.dia_pago.split("-");je.value=X.addToDate(`${a[0]}-${a[1]}-02`,{months:1})}),{api:p,client_name:ct,claim:y,dia_pago:de,dia_corte:Q,dia_crear_factura:je,dia_vencimiento:rt,mes_pago:Ve,servicios:ot,showModalPago:lt,showModalNuevaFactura:nt,mostrarNotify:q,factura:at,pagos:dt,route:m}},pt={class:"col-12 flex justify-start items-center q-pt-none"},mt={class:"row"},vt={class:"col-xs-12 col-md-7"},ft={class:"row"},qt={class:"col-xs-12 col-md-7"},gt={class:"row"},ht={class:"col-xs-12 col-md-7"},yt={class:"row"},_t={class:"col-xs-12 col-md-7"},bt={class:"row"},$t={class:"col-xs-12 col-md-7"},xt={class:"row"},wt={class:"col-xs-12 col-md-7"},Vt={class:"col-12 flex justify-start items-center q-py-md"},jt={class:"row"},kt={class:"col-xs-12 col-md-7"},Ct={class:"col-md-12 q-py-md"},Pt={class:"row q-col-gutter-sm"},At={class:"col-xs-12 col-md-4"},Dt={class:"text-weight-bold"},Mt={class:"col-xs-12 col-md-4"},It={class:"text-weight-bold"},St={class:"col-xs-12 col-md-4"},Ut={class:"text-weight-bold"},Vs={__name:"FactAndNot",props:["edit"],setup(p){const{api:y,mostrarNotify:m,formFacturacion:q,validacionesFacturacion:u,validarFormFact:a,step:v}=_e(),{dia_pago:s,dia_corte:b,dia_crear_factura:N}=ut(),_=j(!1),P=async()=>{if(!a())try{_.value=!0;const{data:d}=await y.put(`/customers/actualizarDatosFactura/${q.value.id}`,q.value);q.value={...d.factura[0]},m("positive",d.msg),_.value=!1}catch(d){_.value=!1,m("warning",d.response.data.message)}};let x=new Array(28).fill(0).map((c,d)=>d+1),k=new Array(25).fill(0).map((c,d)=>`${d+1}  ${d==0?"D\xEDa":"D\xEDas"} antes`),S=new Array(25).fill(0).map((c,d)=>`${d+1}  ${d==0?"D\xEDa":"D\xEDas"}`),D=new Array(12).fill(0).map((c,d)=>`${d+1}  ${d==0?"Mes":"Meses"} ${d==0?"Vencido":"Vencidos"}`);return k.unshift("Desactivado"),D.unshift("Desactivado"),(c,d)=>(I(),L("div",{class:o(["row q-col-gutter-md",c.$q.screen.width>1022?"q-col-gutter-y-lg q-pt-md":""])},[e("div",pt,[e("label",{class:o(["text-h6 text-weight-medium",c.$q.screen.width>1022||"q-pt-xs"])},[h(K,{name:"description"}),M(" Facturaci\xF3n: ")],2)]),e("div",{class:o(["col-xs-12 col-md-6",(c.$q.screen.width<1022,"q-pt-xs")])},[e("div",mt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[c.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(c.$q.screen.width<1022||"q-pr-md")}," Tipo: ",2)],2),e("div",vt,[h(A,{dense:"",modelValue:t(q).tipo,"onUpdate:modelValue":[d[0]||(d[0]=n=>t(q).tipo=n),d[1]||(d[1]=n=>t(u).tipo.isValid=!0)],modelModifiers:{trim:!0},outlined:"",error:!t(u).tipo.isValid,"emit-value":"","map-options":"",options:[{label:"Prepago (Adelantado)",value:"prepago"},{label:"Postpago (Vencido)",value:"postpago"}]},{error:f(()=>[e("label",{class:o(c.$q.dark.isActive?"text-red-4":"text-negative")},w(t(u).tipo.message),3)]),_:1},8,["modelValue","error","options"])])])],2),e("div",{class:o(["col-xs-12 col-md-6",c.$q.screen.width<1022?"q-pt-none":"q-pt-xs"])},[e("div",ft,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[c.$q.screen.width<1022?"justify-center q-mt-md q-pb-xs":"justify-end text-right q-pb-md"]])},[e("label",{class:o(c.$q.screen.width<1022||"q-pr-md")}," Dia Pago: ",2)],2),e("div",qt,[h(A,{dense:"",modelValue:t(q).dia_pago,"onUpdate:modelValue":[d[2]||(d[2]=n=>t(q).dia_pago=n),d[3]||(d[3]=n=>t(u).dia_pago.isValid=!0)],modelModifiers:{trim:!0},outlined:"",options:t(x),error:!t(u).dia_pago.isValid},{error:f(()=>[e("label",{class:o(c.$q.dark.isActive?"text-red-4":"text-negative")},w(t(u).dia_pago.message),3)]),_:1},8,["modelValue","options","error"])])])],2),e("div",{class:o(["col-xs-12 col-md-6",c.$q.screen.width<1022?"q-pt-none":"q-pt-xs"])},[e("div",gt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[c.$q.screen.width<1022?"justify-center q-mt-md q-pb-xs":"justify-end text-right q-pb-md"]])},[e("label",{class:o(c.$q.screen.width<1022||"q-pr-md")}," Tipo Impuesto: ",2)],2),e("div",ht,[h(A,{dense:"",modelValue:t(q).tipo_impuesto,"onUpdate:modelValue":[d[4]||(d[4]=n=>t(q).tipo_impuesto=n),d[5]||(d[5]=n=>t(u).tipo_impuesto.isValid=!0)],modelModifiers:{trim:!0},outlined:"",options:["Impuestos incluido","Mas impuestos","Ninguno"],error:!t(u).tipo_impuesto.isValid},{error:f(()=>[e("label",{class:o(c.$q.dark.isActive?"text-red-4":"text-negative")},w(t(u).tipo_impuesto.message),3)]),_:1},8,["modelValue","error"])])])],2),e("div",{class:o(["col-xs-12 col-md-6",c.$q.screen.width<1022?"q-pt-none":"q-pt-xs"])},[e("div",yt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[c.$q.screen.width<1022?"justify-center q-mt-md q-pb-xs":"justify-end text-right q-pb-md"]])},[e("label",{class:o(c.$q.screen.width<1022||"q-pr-md")}," D\xEDas de gracia: ",2)],2),e("div",_t,[h(A,{dense:"",modelValue:t(q).dia_gracia,"onUpdate:modelValue":[d[6]||(d[6]=n=>t(q).dia_gracia=n),d[7]||(d[7]=n=>t(u).dia_gracia.isValid=!0)],modelModifiers:{trim:!0},outlined:"",options:t(S),hint:"*d\xEDas tolerancia para aplicar corte",error:!t(u).dia_gracia.isValid},{error:f(()=>[e("label",{class:o(c.$q.dark.isActive?"text-red-4":"text-negative")},w(t(u).dia_gracia.message),3)]),_:1},8,["modelValue","options","error"])])])],2),e("div",{class:o(["col-xs-12 col-md-6",c.$q.screen.width<1022?"q-pt-none":"q-pt-xs"])},[e("div",bt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[c.$q.screen.width<1022?"justify-center q-mt-md q-pb-xs":"justify-end text-right q-pb-md"]])},[e("label",{class:o(c.$q.screen.width<1022||"q-pr-md")}," Aplicar Corte: ",2)],2),e("div",$t,[h(A,{dense:"",modelValue:t(q).aplicar_corte,"onUpdate:modelValue":[d[8]||(d[8]=n=>t(q).aplicar_corte=n),d[9]||(d[9]=n=>t(u).aplicar_corte.isValid=!0)],modelModifiers:{trim:!0},outlined:"",options:t(D),error:!t(u).aplicar_corte.isValid},{error:f(()=>[e("label",{class:o(c.$q.dark.isActive?"text-red-4":"text-negative")},w(t(u).aplicar_corte.message),3)]),_:1},8,["modelValue","options","error"])])])],2),e("div",{class:o(["col-xs-12 col-md-6",c.$q.screen.width<1022?"q-pt-none":"q-pt-xs"])},[e("div",xt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[c.$q.screen.width<1022?"justify-center q-mt-md q-pb-xs":"justify-end text-right q-pb-md"]])},[e("label",{class:o(c.$q.screen.width<1022||"q-pr-md")}," Tipo Comprobante: ",2)],2),e("div",wt,[h(A,{dense:"",modelValue:t(q).tipo_comprobante,"onUpdate:modelValue":[d[10]||(d[10]=n=>t(q).tipo_comprobante=n),d[11]||(d[11]=n=>t(u).tipo_comprobante.isValid=!0)],modelModifiers:{trim:!0},outlined:"",options:["Factura","Recibo"],error:!t(u).tipo_comprobante.isValid},{error:f(()=>[e("label",{class:o(c.$q.dark.isActive?"text-red-4":"text-negative")},w(t(u).tipo_comprobante.message),3)]),_:1},8,["modelValue","error"])])])],2),e("div",Vt,[e("label",{class:o(["text-h6 text-weight-medium",c.$q.screen.width>1022||"q-pt-xs"])},[h(K,{name:"notifications"}),M(" Notificaciones: ")],2)]),e("div",{class:o(["col-xs-12 col-md-6",(c.$q.screen.width<1022,"q-pt-xs")])},[e("div",jt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[c.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(c.$q.screen.width<1022||"q-pr-md")}," Recordatorios de pago: ",2)],2),e("div",kt,[h(A,{dense:"",modelValue:t(q).recordatorio_pago,"onUpdate:modelValue":[d[12]||(d[12]=n=>t(q).recordatorio_pago=n),d[13]||(d[13]=n=>t(u).recordatorio_pago.isValid=!0)],modelModifiers:{trim:!0},outlined:"",error:!t(u).recordatorio_pago.isValid,multiple:"","stack-label":"",options:["Correo","Telegram"]},{error:f(()=>[e("label",{class:o(c.$q.dark.isActive?"text-red-4":"text-negative")},w(t(u).recordatorio_pago.message),3)]),"selected-item":f(n=>[h(He,{color:"deep-orange-14","text-color":"white",icon:"done",removable:"",dense:"",onRemove:E=>n.removeAtIndex(n.index),tabindex:n.tabindex,class:"q-ma-none q-mr-sm"},{default:f(()=>[M(w(n.opt),1)]),_:2},1032,["onRemove","tabindex"])]),_:1},8,["modelValue","error"])])])],2),p.edit?(I(),L(ye,{key:0},[e("div",Ct,[e("div",Pt,[e("div",At,[h(oe,{class:"text-center flex-center q-py-md",style:{width:"100%","text-align":"center","font-size":"15px"},outline:"",color:"lime-7"},{default:f(()=>[M(" D\xEDa de pago: "),e("span",Dt," \xA0"+w(t(s)),1)]),_:1})]),e("div",Mt,[h(oe,{class:"text-center flex-center q-py-md",style:{width:"100%","text-align":"center","font-size":"15px"},outline:"",color:"red-4"},{default:f(()=>[M(" D\xEDa de corte: "),e("span",It," \xA0"+w(t(b)),1)]),_:1})]),e("div",St,[h(oe,{class:"text-center flex-center q-py-md",style:{width:"100%","text-align":"center","font-size":"15px"},outline:"",color:"cyan-4"},{default:f(()=>[M(" Crear factura: "),e("span",Ut," \xA0"+w(t(X).formatDate(t(N),"DD/MM/YYYY"))+" 12:00 AM ",1)]),_:1})])])]),e("div",{class:o(["col-xs-12 col-md-12 flex q-py-md justify-center",[c.$q.screen.width<600?" q-pt-none q-ml-md":""]]),style:{"padding-bottom":"0px"}},[h(O,{"icon-right":"save",onClick:P,loading:_.value,outline:"",rounded:"",class:"q-mr-lg",style:{color:"#696cff"}},{default:f(()=>[M(" \xA0 Guardar\xA0 ")]),_:1},8,["loading"])],2)],64)):(I(),L("div",{key:1,class:o(["col-xs-12 col-md-12 flex q-py-md",[c.$q.screen.width<600?"justify-center q-pt-none q-ml-md":"justify-between"]]),style:{"padding-bottom":"0px"}},[c.$q.screen.width>600?(I(),ie(O,{key:0,icon:"arrow_back",onClick:d[14]||(d[14]=n=>v.value=1),outline:"",rounded:"",class:"q-ml-md",color:c.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:f(()=>[M(" \xA0 Anterior ")]),_:1},8,["color"])):W("",!0),h(O,{onClick:t(a),"icon-right":"arrow_forward",outline:"",rounded:"",class:"q-mr-lg",style:{color:"#696cff"}},{default:f(()=>[M(" \xA0 Siguiente\xA0 ")]),_:1},8,["onClick"])],2))],2))}},Nt={class:"row justify-center"},Tt={class:"row"},Et={class:"col-xs-12 col-md-7 justify-center"},zt={class:"col-xs-12 col-md-6 q-pt-none"},Ft={class:"row"},Yt={class:"col-xs-12 col-md-7"},Rt={class:"row"},Bt={class:"col-xs-12 col-md-7"},Qt={class:"row"},Xt={class:"col-xs-12 col-md-7 justify-center"},Lt={class:"row"},Ot={class:"col-xs-12 col-md-7"},Gt={class:"col-xs-12 col-md-6 q-pt-none"},Wt={class:"row"},Kt={class:"col-xs-12 col-md-7"},Ht={class:"row items-center justify-end"},Jt={class:"row"},Zt={class:"col-xs-12 col-md-7"},es={class:"row"},ts={class:"col-xs-12 col-md-7 justify-center"},ss={class:"row"},is={class:"col-xs-12 col-md-7"},os={class:"row"},as={class:"col-xs-12 col-md-7 justify-center"},rs={class:"row"},ls={class:"col-xs-12 col-md-7"},js={__name:"ServicioInternet",props:["edit","servicio"],emits:["actualizarDatos"],setup(p,{emit:y}){const m=p;let q=[],u=[];const{api:a,claim:v,formInternet:s,listIps:b,loading:N,listCajasNap:_,listPuertosCajaNap:P,groupedIpsByRed:x,listRedes:k,optionsListIps:S,listRouter:D,listServicionsInternet:c,obtenerListaSubred:d,validacionesInternet:n,mostrarNotify:E,validDecimal:H,validarFormInternet:ue,step:ae}=_e(),T=j(!1),J=j({edit:!1,coords:""}),re=()=>{m.edit&&(J.value={edit:!0,coords:s.value.coordenadas}),T.value=!0},le=async()=>{m.edit&&(s.value.router_id=m.servicio.router_id.id,s.value.direccion=m.servicio.direccion,s.value.coordenadas=m.servicio.coordenadas,s.value.perfil_internet=m.servicio.perfil_internet.id,s.value.precio=m.servicio.precio,s.value.fecha_instalacion=m.servicio.fecha_instalacion,s.value.mac=m.servicio.mac,s.value.red_id=`${m.servicio.red_id.id}|${m.servicio.indice}`,s.value.ipv4=m.servicio.ipv4,s.value.caja_id=m.servicio.caja_id?m.servicio.caja_id.id:"",s.value.puerto_id=m.servicio.puerto_id?m.servicio.puerto_id.id:"");const i=s.value.router_id;s.value.router_id="";const{data:r}=await a.get(`/router/find/${v.company.id}`);D.value=[],r.forEach((l,V)=>{D.value.push({label:l.nombre,value:l.id,ip_host:l.ip_host,puerto_api:l.puerto_api,user:l.user_api,password:l.password_api}),V+1==r.length&&(s.value.router_id=i)})},pe=async()=>{n.value.router_id.isValid=!0,m.edit||(s.value.perfil_internet="",s.value.precio=0);const i=s.value.perfil_internet;s.value.perfil_internet="",c.value=[];let r={headers:{router_id:s.value.router_id}};const{data:l}=await a.get("/internet",r);l.length==0?E("warning","Por favor agrega un perfil de internet"):l.forEach((V,C)=>{c.value.push({label:V.nombre_plan,value:V.id,precio_plan:V.precio_plan,detalles:V}),C+1==l.length&&(s.value.perfil_internet=i)}),g(),U()},me=(i,r)=>{const l=r.split(".");for(const V in i)if(i.hasOwnProperty(V)&&V.split(".").every((F,z)=>F===l[z]))return i[`${V}`].length;return 0},g=async()=>{k.value=[],u=[];let i={headers:{router_id:s.value.router_id}};const r=await a.get(`/customers/get-ips/${s.value.router_id}`);r.data.forEach((C,F)=>{C.puerto_id&&u.push(C.puerto_id.id),q.push(C.ipv4),F+1==r.data.length&&m.edit&&(q=q.filter(z=>z!=m.servicio.ipv4))}),await Promise.resolve();const l=x(q),{data:V}=await a.get("/red-ipv4",i);V.forEach(C=>{const F=C.red,z=C.cidr.split(" ")[0],Ie=d(`${F}/${z}`),Se=x(Ie);let fe;parseInt(z)>=25&&parseInt(z)<=32?fe=2**(32-z):fe=256;let Y=Object.keys(Se);for(let R=0;R<Y.length;R++){const Ue=me(l,Y[R]);let Z;Y.length==1?Z=2:Y.length>1&&R==0||Y.length>1&&R+1==Y.length?Z=1:Z=0,k.value.push({value:`${C.id}|${R}`,label:`${Y[R]}.0 
          (${fe-(Z+Ue)} Ips disponibles) ${C.nombre}`,red_name:C.nombre,cidr:z})}})},$=()=>{m.edit||(s.value.ipv4="");const i=k.value.find(V=>V.value==s.value.red_id),r=k.value.filter(V=>V.red_name==i.red_name);let l;parseInt(i.cidr)>=25&&parseInt(i.cidr)<=32?l=i.cidr:l="24",b.value=d(`${i.label.split(" ")[0]}/${l}`),r.length==1?(b.value.shift(),b.value.pop()):s.value.red_id==r[0].value?b.value.shift():s.value.red_id==r[r.length-1].value&&b.value.pop(),S.value=b.value,n.value.red_id.isValid=!0,q.forEach(V=>{const C=b.value.findIndex(F=>F==V);C!=-1&&b.value.splice(C,1)}),b.value.length>0&&(m.edit||(s.value.ipv4=b.value[0]),n.value.ipv4.isValid=!0)},U=async()=>{let i={headers:{router_id:s.value.router_id}};_.value=[];const{data:r}=await a.get("/caja-nap",i);r.forEach(l=>{_.value.push({value:`${l.id}`,label:`${l.nombre}`,puertos:l.puertos})})},G=()=>{P.value=[],_.value.find(i=>i.value==s.value.caja_id).puertos.forEach(i=>{u.includes(i.id)||P.value.push({value:`${i.id}`,label:`Puerto ${i.puerto}`})}),P.value.unshift({value:"Ninguno",label:"Ninguno"})},Pe=()=>{n.value.perfil_internet.isValid=!0,n.value.precio.isValid=!0;const i=c.value.find(r=>r.value==s.value.perfil_internet);s.value.precio=i.precio_plan},Ae=(i="",r)=>{if(i===""){r(()=>{b.value=S.value});return}r(()=>{const l=i.toLowerCase();b.value=b.value.filter(V=>V.toLowerCase().indexOf(l)>-1)})},De=i=>{s.value.coordenadas=`${i.lng}, ${i.lat}`,T.value=!1};ce(()=>s.value.router_id,i=>{s.value.router_id.length!=0&&pe()}),ce(()=>s.value.red_id,i=>{m.edit?setTimeout(()=>{$()},2e3):s.value.indice||$()});const ve=j(!1),Me=async()=>{try{ve.value=!0;const i=ue(),r=c.value.filter(l=>l.value==s.value.perfil_internet);if(!i){const{data:l}=await a.put(`/customers/actualizarDatosServicio/${m.servicio.id}`,{...s.value,indice:s.value.red_id.split("|")[1],red_id:s.value.red_id.split("|")[0],cliente:m.servicio.cliente,perfil_internet:r[0].detalles,ipv4_old:m.servicio.ipv4,estado:m.servicio.estado});E("positive",l.msg),ve.value=!1,y("actualizarDatos")}}catch(i){ve.value=!1,E("warning",i.response.data.message)}};return(D.value.length==0||m.edit)&&le(),(i,r)=>(I(),L(ye,null,[e("div",{class:o(["row q-col-gutter-md",i.$q.screen.width<1022||"q-col-gutter-y-lg q-pt-md"])},[e("div",{class:o(["col-12 q-pt-none",i.$q.screen.width<1022||"q-pl-none"])},[e("div",Nt,[e("div",{class:o(["col-xs-12 col-md-6",(i.$q.screen.width<1022,"q-pt-xs")])},[e("div",Tt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," Router: ",2)],2),e("div",Et,[h(A,{dense:"",modelValue:t(s).router_id,"onUpdate:modelValue":r[0]||(r[0]=l=>t(s).router_id=l),modelModifiers:{trim:!0},filled:"",error:!t(n).router_id.isValid,"emit-value":"","map-options":"",options:t(D)},{error:f(()=>[e("label",{class:o(i.$q.dark.isActive?"text-red-4":"text-negative")},w(t(n).router_id.message),3)]),_:1},8,["modelValue","error","options"])])])],2)])],2),t(s).router_id.length!=0?(I(),L(ye,{key:0},[e("div",zt,[e("div",Ft,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," Direcci\xF3n: ",2)],2),e("div",Yt,[h(te,{modelValue:t(s).direccion,"onUpdate:modelValue":r[1]||(r[1]=l=>t(s).direccion=l),modelModifiers:{trim:!0},"input-style":"width: 81%",error:!t(n).direccion.isValid,dense:"",outlined:""},{error:f(()=>[e("label",{class:o(i.$q.dark.isActive?"text-red-4":"text-negative")},w(t(n).direccion.message),3)]),append:f(()=>[h(oe,{filled:"",color:"blue-grey-6",style:{height:"100%",width:"19%",position:"absolute",right:"0px","justify-content":"center","font-size":"14px",cursor:"pointer"}},{default:f(()=>[h(K,{name:"fa-solid fa-street-view",size:"xs"})]),_:1})]),_:1},8,["modelValue","error"])])])]),e("div",{class:o(["col-xs-12 col-md-6 q-pt-none",i.$q.screen.width<1022||"q-pl-none"])},[e("div",Rt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," Coordenadas: ",2)],2),e("div",Bt,[h(te,{modelValue:t(s).coordenadas,"onUpdate:modelValue":r[2]||(r[2]=l=>t(s).coordenadas=l),modelModifiers:{trim:!0},placeholder:"Coordenadas Longitud, Latitud","input-style":"width: 81%",error:!t(n).coordenadas.isValid,dense:"",outlined:""},{error:f(()=>[e("label",{class:o(i.$q.dark.isActive?"text-red-4":"text-negative")},w(t(n).coordenadas.message),3)]),append:f(()=>[h(oe,{filled:"",color:"blue-grey-6",onClick:re,style:{height:"100%",width:"19%",position:"absolute",right:"0px","justify-content":"center","font-size":"14px",cursor:"pointer"}},{default:f(()=>[h(K,{name:"fa-solid fa-location-dot",size:"xs"})]),_:1})]),_:1},8,["modelValue","error"])])])],2),e("div",{class:o(["col-xs-12 col-md-6",(i.$q.screen.width<1022,"q-pt-xs")])},[e("div",Qt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," Perfil Internet: ",2)],2),e("div",Xt,[h(A,{dense:"",modelValue:t(s).perfil_internet,"onUpdate:modelValue":[r[3]||(r[3]=l=>t(s).perfil_internet=l),Pe],modelModifiers:{trim:!0},filled:"",error:!t(n).perfil_internet.isValid,"emit-value":"","map-options":"",options:t(c)},{error:f(()=>[e("label",{class:o(i.$q.dark.isActive?"text-red-4":"text-negative")},w(t(n).perfil_internet.message),3)]),_:1},8,["modelValue","error","options"])])])],2),e("div",{class:o(["col-xs-12 col-md-6 q-pt-none",i.$q.screen.width<1022||"q-pl-none"])},[e("div",Lt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," Precio: ",2)],2),e("div",Ot,[h(te,{modelValue:t(s).precio,"onUpdate:modelValue":[r[4]||(r[4]=l=>t(s).precio=l),r[5]||(r[5]=l=>t(H)("precio"))],modelModifiers:{trim:!0},type:"number",step:"0.01",error:!t(n).precio.isValid,"input-class":"resaltarTextoInput",dense:"",outlined:""},{error:f(()=>[e("label",{class:o(i.$q.dark.isActive?"text-red-4":"text-negative")},w(t(n).precio.message),3)]),_:1},8,["modelValue","error"])])])],2),e("div",Gt,[e("div",Wt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," Fecha Instalaci\xF3n: ",2)],2),e("div",Kt,[h(te,{filled:"",dense:"",modelValue:t(s).fecha_instalacion,"onUpdate:modelValue":r[7]||(r[7]=l=>t(s).fecha_instalacion=l),"input-style":{textAlign:"center"},mask:"date",rules:["date"]},{append:f(()=>[h(K,{name:"event",class:"cursor-pointer"},{default:f(()=>[h(Ze,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:f(()=>[h(Ke,{modelValue:t(s).fecha_instalacion,"onUpdate:modelValue":r[6]||(r[6]=l=>t(s).fecha_instalacion=l)},{default:f(()=>[e("div",Ht,[Qe(h(O,{label:"Close",color:"primary",flat:""},null,512),[[et]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),e("div",{class:o(["col-xs-12 col-md-6 q-pt-none",i.$q.screen.width<1022||"q-pl-none"])},[e("div",Jt,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," MAC: ",2)],2),e("div",Zt,[h(te,{modelValue:t(s).mac,"onUpdate:modelValue":r[8]||(r[8]=l=>t(s).mac=l),modelModifiers:{trim:!0},mask:"XX:XX:XX:XX:XX:XX","unmasked-value":"",error:!t(n).mac.isValid,"input-class":"resaltarTextoInput",dense:"",outlined:""},{error:f(()=>[e("label",{class:o(i.$q.dark.isActive?"text-red-4":"text-negative")},w(t(n).mac.message),3)]),_:1},8,["modelValue","error"])])])],2),e("div",{class:o(["col-xs-12 col-md-6",(i.$q.screen.width<1022,"q-pt-xs")])},[e("div",es,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," Redes IPv4: ",2)],2),e("div",ts,[h(A,{dense:"",modelValue:t(s).red_id,"onUpdate:modelValue":r[9]||(r[9]=l=>t(s).red_id=l),modelModifiers:{trim:!0},filled:"",error:!t(n).red_id.isValid,"emit-value":"","map-options":"",options:t(k)},{error:f(()=>[e("label",{class:o(i.$q.dark.isActive?"text-red-4":"text-negative")},w(t(n).red_id.message),3)]),_:1},8,["modelValue","error","options"])])])],2),t(s).red_id!=""?(I(),L("div",{key:0,class:o(["col-xs-12 col-md-6 q-pt-none",i.$q.screen.width<1022||"q-pl-none"])},[e("div",ss,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," IPv4: ",2)],2),e("div",is,[h(A,{dense:"",modelValue:t(s).ipv4,"onUpdate:modelValue":r[10]||(r[10]=l=>t(s).ipv4=l),modelModifiers:{trim:!0},filled:"",error:!t(n).ipv4.isValid,"emit-value":"","map-options":"","use-input":"","input-debounce":"10",onFilter:Ae,options:t(b)},{error:f(()=>[e("label",{class:o(i.$q.dark.isActive?"text-red-4":"text-negative")},w(t(n).ipv4.message),3)]),_:1},8,["modelValue","error","options"])])])],2)):W("",!0),e("div",{class:o(["col-xs-12 col-md-6",(i.$q.screen.width<1022,"q-pt-xs")])},[e("div",os,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," Caja(s) Nap: ",2)],2),e("div",as,[h(A,{dense:"",modelValue:t(s).caja_id,"onUpdate:modelValue":[r[12]||(r[12]=l=>t(s).caja_id=l),G],modelModifiers:{trim:!0},filled:"",error:!t(n).caja_id.isValid,"emit-value":"","map-options":"",options:t(_)},{error:f(()=>[e("label",{class:o(i.$q.dark.isActive?"text-red-4":"text-negative")},w(t(n).caja_id.message),3)]),append:f(()=>[t(s).caja_id.length>0?(I(),ie(K,{key:0,name:"close",onClick:r[11]||(r[11]=Xe(l=>(t(s).caja_id="",t(s).puerto_id=""),["stop","prevent"])),class:"cursor-pointer"})):W("",!0)]),_:1},8,["modelValue","error","options"])])])],2),t(s).caja_id!=""?(I(),L("div",{key:1,class:o(["col-xs-12 col-md-6 q-pt-none",i.$q.screen.width<1022||"q-pl-none"])},[e("div",rs,[e("div",{class:o(["col-xs-12 col-md-4 flex items-center justify-end",[i.$q.screen.width<1022?"justify-center q-mt-sm q-pb-xs":"texto-rigth q-pb-md"]])},[e("label",{class:o(i.$q.screen.width<1022||"q-pr-md")}," Puerto Nap: ",2)],2),e("div",ls,[h(A,{dense:"",modelValue:t(s).puerto_id,"onUpdate:modelValue":[r[13]||(r[13]=l=>t(s).puerto_id=l),r[14]||(r[14]=l=>t(n).puerto_id.isValid=!0)],modelModifiers:{trim:!0},filled:"",error:!t(n).puerto_id.isValid,"emit-value":"","map-options":"",options:t(P)},{error:f(()=>[e("label",{class:o(i.$q.dark.isActive?"text-red-4":"text-negative")},w(t(n).puerto_id.message),3)]),_:1},8,["modelValue","error","options"])])])],2)):W("",!0)],64)):W("",!0),e("div",{class:o(["col-xs-12 col-md-12 flex q-py-md",[i.$q.screen.width<600?"justify-center q-pt-none q-ml-md":"justify-between"]]),style:{"padding-bottom":"0px"}},[i.$q.screen.width>600?(I(),ie(O,{key:0,icon:"arrow_back",onClick:r[15]||(r[15]=l=>ae.value=2),outline:"",rounded:"",class:"q-ml-md",style:Le(m.edit?"visibility: hidden;":""),color:i.$q.dark.isActive?"blue-grey-2":"blue-grey-10"},{default:f(()=>[M(" \xA0 Anterior ")]),_:1},8,["style","color"])):W("",!0),m.edit?(I(),ie(O,{key:2,onClick:Me,"icon-right":"save",outline:"",rounded:"",class:"q-mr-lg",style:{color:"#696cff"}},{default:f(()=>[M(" \xA0 Actualizar\xA0 ")]),_:1})):(I(),ie(O,{key:1,type:"submit","icon-right":"save",loading:t(N),outline:"",rounded:"",class:"q-mr-lg",style:{color:"#696cff"}},{default:f(()=>[M(" \xA0 Guardar\xA0 ")]),_:1},8,["loading"]))],2)],2),h(Oe,{modelValue:T.value,"onUpdate:modelValue":r[16]||(r[16]=l=>T.value=l)},{default:f(()=>[h(tt,{objMap:J.value,onCoordenadasSelected:De},null,8,["objMap"])]),_:1},8,["modelValue"])],64))}};export{Vs as _,$s as a,xs as b,ws as c,js as d,ut as e,bs as u};
